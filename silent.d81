 =  THEN GOSUB CLEARTXTTALK      READ ACTION      ACTTIMER=0      IF ACTION =  THEN READ ACTSTR$, ACTX, ACTY      IF ACTION =  THEN READ ACTSTR$, ACTDUR      IF ACTION =  THEN GOSUB CLEARTEXT      IF ACTION =  THEN READ ACTANIM:ANIMIDX=0:ANIMREPEATCOUNT=0      IF ACTION =  THEN READ ACTPAINTING:GOSUB DRAWPAINTING      IF ACTION =  THEN READ ACTSTR$, ACTREACTION, ACTDUR:GOSUB INITREACTION      IF ACTION =  THEN PRINT "";      IF ACTION =  THEN READ FRAMEIDX:GOSUB DRAWPETSCIIFRAME      IF ACTION =  THEN EXIT      TSTART = TI      READ TIME ' TIME FOR NEXT ACTION    BEND    IF ACTION =  THEN GOSUB DRAWTXTGREY    IF ACTION =  THEN GOSUB DRAWTXTTALK    IF ACTION =  THEN GOSUB DRAWREACTION    GOSUB POLLPLAY    GOSUB POLLANIM  LOOP    RETURN#DEFINE 1 = -1#DEFINE 2 = -2#DEFINE 3 = -3#DEFINE  = -10#DEFINE  = -1#DEFINE į = -999#DEFINE ̯ = -1000#DECLARE FRAMESTART.POLLANIM'---------  IF ACTANIM = -1 THEN RETURN  IF FRAMEDUR > 0 AND (TI - FRAMESTART) < FRAMEDUR THEN RETURN  FRAMEDUR = 0  'CURSOR 0,1:PRINT "POLLANIM";  'CURSOR 0,2:PRINT "ACTANIM=";ACTANIM;  'CURSOR 0,3:PRINT "ANIMIDX=";ANIMIDX;  AVAL = ANIMS(ACTANIM,ANIMIDX)  ANIMIDX = ANIMIDX + 1'PRINT "                     ANIMIDX=";ANIMIDX;  FOUND = 0  IF AVAL = 1 THEN FOUND=1:MARK(1)=ANIMIDX  IF AVAL = 2 THEN FOUND=1:MARK(2)=ANIMIDX  IF AV 0  1 A=126:B=124:C=123:D=108:E=254:F=252:G=251:H=236:I=127:J=255:K=98:L=226:M=97:N=225:O=32:P=160:Q=3.141592654269: 2 DIM AQ(10):DIM AR(10):DIM BO(10):DIM BP(10):DIM BQ(10):DIM BR(10):GOSUB 78 3 PRINT"";:PRINT"PETLINE EXAMPLE MENU:":PRINT"--------------------":PRINT"1) LINES":PRINT"2) SQUARE":PRINT"3) MANY SQUARES":PRINT"4) DRAW CUBE" 4 PRINT"5) DRAW MANY CUBES":PRINT"6) QIX LINES":GETKEYB$:IFB$="1"THENGOSUB 27 5 IFB$="2"THENGOSUB 24 6 IFB$="3"THENGOSUB 23 7 IFB$="4"THENGOSUB 17 8 IFB$="5"THEN	GOSUB 16 9 IFB$="6"THENGOSUB 12 10 IFB$>="1"ANDB$<="5"THENGETKEYB$ 11 GOTO 3:END 12 BM=.:BN=. 13 BO(BM)=INT(RND(1)*160):BP(BM)=INT(RND(1)*100):BQ(BM)=INT(RND(1)*160):BR(BM)=INT(RND(1)*100):BW=INT(RND(1)*16)+64:SYS32268,1:BN=BN+1:R=BO(BM):S=BP(BM) 1
4 T=BQ(BM):U=BR(BM):GOSUB 28:BM=MOD(BM+1,10) 15 GOTO 13:RETURN 16 BD=.:FORBC=.TO1.9*Q/4STEPQ/16:GOSUB 17:NEXTBC:BC=.:FORBD=.TO1.9*Q/2STEPQ/16:GOSUB 17:NEXTBD:RETURN 17 AV=45:AZ=.:AY=ATN(1/SQR(2)):FORAX=Q/4TO1.9*QSTEPQ/2:BA=AV*COS(AY):BB=BA*SIN(AX):AR(AZ)=AV*SIN(AY):AQ(AZ)=BA*COS(AX):GOSUB 21 18 GOSUB 22:AQ(AZ)=AN+AQ(AZ)-BB*BF/4:AR(AZ)=AO+AR(AZ)+BB*BF:AZ=AZ+1:NEXTAX:AS=4:GOSUB 26:AZ=.:AY=-ATN(1/SQR(2)):FORAX=Q/4TO1.9*QSTEPQ/2 19 R=AQ(AZ):S=AR(AZ):BA=AV*COS(AY):BB=BA*SIN(AX):AR(AZ)=AV*SIN(AY):AQ(AZ)=BA*COS(AX):GOSUB 21:GOSUB 22:AQ(AZ)=AN+AQ(AZ)-BB*BF/4 20 AR(AZ)=AO+AR(AZ)+BB*BF:T=AQ(AZ):U=AR(AZ):GOSUB 28:AZ=AZ+1:NEXTAX:AS=4:GOSUB 26:RETURN 21 AD=AQ(AZ):AE=BB:BA=SQR(AD*AD+AE*AE):GOSUB 29:AI=AI+BC:AQ(AZ)=BA*COS(AI):BB=BA*SIN(AI):RETURN 22 AD=AQ(AZ):AE=AR(AZ):BA=SQR(AD*AD+AE*AE):GOSUB 29:AI=AI+BD:AQ(AZ)=BA*COS(AI):AR(AZ)=BA*SIN(AI):RETURN 23 FORAW=.TOQ/2STEPQ/8:GOSUB 24:NEXTAW:RETURN 24 AV=45:AT=AW-3*Q/4:AQ(.)=AN+AV*COS(AT):AR(.)=AO+AV*SIN(AT):AT=AW-Q/4:AQ(1)=AN+AV*COS(AT):AR(1)=AO+AV*SIN(AT):AT=AW+Q/4:AQ(2)=AN+AV*COS(AT) 25 AR(2)=AO+AV*SIN(AT):AT=AW+3*Q/4:AQ(3)=AN+AV*COS(AT):AR(3)=AO+AV*SIN(AT):AS=4:GOSUB 26:RETURN 26 FORAU=.TOAS-2:R=AQ(AU):S=AR(AU):T=AQ(AU+1):U=AR(AU+1):GOSUB 28:NEXTAU:R=AQ(AS-1):S=AR(AS-1):T=AQ(.):U=AR(.):GOSUB 28:RETURN 27 FORAJ=.TO2*QSTEPQ/8:R=80:S=50:T=INT(80+30*COS(AJ)):U=INT(50+30*SIN(AJ)):GOSUB 28:NEXTAJ:RETURN 28 SYS32259:R=MOD(INT(R)+256,256):S=MOD(INT(S)+256,256):T=MOD(INT(T)+256,256):U=MOD(INT(U)+256,256):SYS32265,R,S,T,U:RETURN 29 IFAD=.THENBEGIN 30 IFAE<.THENAI=-Q/2 31 IFAE>.THENAI=Q/2 32 BEND:ELSEBEGIN:AH=AE/AD:AI=ATN(AH) 33 IFAD<.THENBEGIN 34 IFAE<.THENAI=AI-Q:ELSEAI=AI+Q 35 BEND 36 BEND 37 RETURN 38 BANK.:SYS32262,MOD(Z+256,256),MOD(AA+256,256),5:RETURN 39 IFZ<.ORZ>159ORAA<.ORAA>99THENRETURN 40 V=INT(Z/2):W=INT(AA/2):X=MOD(INT(Z),2):Y=MOD(INT(AA),2):AB=PEEK(264192+V+W*80):GOSUB 45:IFX=.ANDY=.THENAC=ACOR1 41 IFX=1ANDY=.THENAC=ACOR2 42 IFX=.ANDY=1THENAC=ACOR4 43 IFX=1ANDY=1THENAC=ACOR8 44 GOSUB 61:POKE264192+V+W*80,AB:RETURN 45 AC=.:IFAB=ATHENAC=1:RETURN 46 IFAB=BTHENAC=2:RETURN 47 IFAB=CTHENAC=4:RETURN 48 IFAB=DTHENAC=8:RETURN 49 IFAB=ETHENAC=14:RETURN 50 IFAB=FTHENAC=13:RETURN 51 IFAB=GTHENAC=11:RETURN 52 IFAB=HTHENAC=7:RETURN 53 IFAB=ITHENAC=9:RETURN 54 IFAB=JTHENAC=6:RETURN 55 IFAB=KTHENAC=12:RETURN 56 IFAB=LTHENAC=3:RETURN 57 IFAB=MTHENAC=5:RETURN 58 IFAB=NTHENAC=10:RETURN 59 IFAB=PTHENAC=15:RETURN 60 RETURN 61 IFAC=.THENAB=O:RETURN 62 IFAC=1THENAB=A:RETURN 63 IFAC=2THENAB=B:RETURN 64 IFAC=3THENAB=L:RETURN 65 IFAC=4THENAB=C:RETURN 66 IFAC=5THENAB=M:RETURN 67 IFAC=6THENAB=J:RETURN 68 IFAC=7THENAB=H:RETURN 69 IFAC=8THENAB=D:RETURN 70 IFAC=9THENAB=I:RETURN 71 IFAC=10THENAB=N:RETURN 72 IFAC=11THENAB=G:RETURN 73 IFAC=12THENAB=K:RETURN 74 IFAC=13THENAB=F:RETURN 75 IFAC=14THENAB=E:RETURN 76 IFAC=15THENAB=P:RETURN 77 RETURN 78 BANK.:BLOAD"MEGAPLOT":SYS32259:AN=80:AO=50:PRINTCHR$(27);"5";CHR$(147);:BF=COS(Q/4):RETURN 79 REM د = :A: 80 REM د = :B: 81 REM د = :C: 82 REM د = :D: 83 REM د֯ = :E: 84 REM د֯ = :F: 85 REM د֯ = :G: 86 REM د֯ = :H: 87 REM دǯ̯ = :I: 88 REM دǯ̯ = :J: 89 REM دů = :K: 90 REM دů = :L: 91 REM دů = :M: 92 REM دů5 = :N: 93 REM د = :O: 94 REM د = :P: 95 REM  = :Q: 96 REM X1 = :R: 97 REM Y1 = :S: 98 REM X2 = :T: 99 REM Y2 = :U: 100 REM DX = :V: 101 REM DY = :W: 102 REM MX = :X: 103 REM MY = :Y: 104 REM CX = :Z: 105 REM CY = :AA: 10AL = 3 THEN FOUND=1:MARK(3)=ANIMIDX  IF AVAL =  THEN BEGIN    FOUND=1    ' GET MARK NUMBER (IN AVAL)    GMARKNUM = ABS(ANIMS(ACTANIM,ANIMIDX))    ANIMIDX = ANIMIDX + 1    GCOUNT = ANIMS(ACTANIM,ANIMIDX)    ANIMIDX = ANIMIDX + 1    BAIL=0    IF ANIMREPEATCOUNT = 0 THEN BEGIN      IF GCOUNT <> -1 THEN ANIMREPEATCOUNT = GCOUNT      ANIMIDX = MARK(GMARKNUM)      BAIL=1    BEND          IF BAIL=0 AND ANIMREPEATCOUNT > 0 THEN BEGIN      ANIMREPEATCOUNT = ANIMREPEATCOUNT -1      IF ,ANIMREPEATCOUNT = 0 THEN BAIL=1      IF BAIL=0 THEN ANIMIDX=MARK(GMARKNUM)      BAIL=1    BEND    'IF BAIL=0 AND ANIMREPEATCOUNT =  THEN BEGIN    '  ANIMIDX=MARK(GMARKNUM)    '  BAIL=1    'BEND  BEND  IF AVAL = į THEN BEGIN   FINE ͯԯ          = 0#DEFINE ͯԯ          = 1#DEFINE ͯԯ          = 2#DEFINE ͯԯ          = 3#DEFINE ͯԯ   = 4#DEFINE ͯԯ¯    = 4#DEFINE ͯԯ¯   = 8#DEFINE ͯԯ¯    = 12#DEFINE ͯԯ¯  = 16#DEFINE ͯԯ       = 20'----.MAIN'----  GOSUB INIT  GOSUB LOADDATA  GOSUB STATELOOP  GOSUB ANIMATELOGO  END#DEFINE ԯůϯ = 0#DEFINE ԯׯЯ = 1#DEFINE ԯůϯ = 2#DEFINE ԯЯί = 3#DEFINE ԯ = 4#DEFINE ԯ = 5'----------.STATELOOP'----------  TSTART = TI  IF LOGOSTATE = ԯůϯ THEN BEGIN    GOSUB FADETOWHITE    LOGOSTATE = ԯׯЯ  BEND    IF LOGOSTATE = ԯׯЯ THEN BEGIN    BANK 128    POKE $D020, 1, 1    GOSUB INIT80X50    GOSUB DRAWBACKDROP    GOSUB PAGEFLIP    GOSUB STORECURRCOLOURS    GOSUB SETPALETTEFORBACKDROP    FADEVAL=0    M=0    LOGOSTATE = ԯůϯ  BEND    IF LOGOSTATE = ԯůϯ THEN BEGIN    IF FADEVAL <= 128 THEN BEGIN      ' FADECOLOURSTODEFAULTS      BANK 0:VSYNC 10:SYS $7E03, FADEVAL:BANK 128      FADEVAL = FADEVAL + 1    BEND    '  CYCLEALTPALETTE    BANK 0:SYS $7E06:BANK 128    M = M + 1    IF M = 130 THEN LOGOSTATE = ԯЯί  BEND  IF LOGOSTATE = ԯЯί THEN BEGIN    GOSUB ANIMATELOGO    ' CYCLEALTPALETTE    BANK 0:SYS $7E06:BANK 128    M = M + 1   ! IF M > 250 THEN LOGOSTATE = ԯ:FADEVAL = 0  BEND  IF LOGOSTATE = ԯ THEN BEGIN    GOSUB ANIMDRAWSUBTEXT    ' CYCLEALTPALETTE    BANK 0:SYS $7E06:BANK 128    M = M + 1    IF M > 360 THEN BEGIN      ' FADE TO BLACK      #BANK 0:SYS $7E0C, FADEVAL:BANK 128      FADEVAL = FADEVAL + 1    BEND    IF FADEVAL = 128 THEN BEGIN      POKE $D020, 0, 0      LOGOSTATE = ԯ    BEND  BEND  IF LOGOSTATE = ԯ THEN BEGIN    PRINT "ANATHEMA!";  BEND  DO$=1#DEFINE =2#DEFINE =3#DEFINE =4#DEFINE =5#DEFINE =6#DEFINE =7#DEFINE =8' ANIMATIONS#DEFINE ͯ=0#DEFINE ͯ=1#DEFINE ͯ=2#DEFINE ͯ=3.INITPETSCIIFRAMES'---------------,  LOOP WHILE (TI-TSTART) < .03  GOTO STATELOOP  RETURN'----------.INIT80X50'----------  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $FD  ' SWITCH TO 80X50  ' SETBIT ǯ7, 7  ' POKE $D031, $E8 ' 1110 1000 = 640,,%----  MAXFRAMES = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  DO WHILE FRMIDX < MAXFRAMES    FRAMEADDR(FRMIDX) = DATAADDR    DATAADDR = DATAADDR + 2    FRMW = PEEK(DATAADDR)    DATAADDR = DATAADDR + 1    FRMH = PEEK(DATAADDR)    DAT&AADDR = DATAADDR + 1    DATAADDR = DATAADDR + FRMW * FRMH * 2    ':PRINT CHR$(147);"FRMIDX=";FRMIDX    'FRAMEIDX=FRMIDX    'GOSUB DRAWPETSCIIFRAME    'GETKEY TEST2$    FRMIDX = FRMIDX + 1  LOOP  RETURN#DECLARE ANIMIDX, ANIMREPEATCO'UNT'=============.PETSCIISTORY'=============  GOSUB SWITCHTO80X25MODE  GOSUB RESTORESCREENPOINTER  PALETTE RESTORE  BACKGROUND 0:BORDER 0  PRINT CHR$(147);  GOSUB INITPETSCIIFRAMES  GOSUB INITANIMS  #DECLARE TSTART, TIME, ACTION, A CTANIM=-1, ACTPAINTING  #DECLARE ACTSTR$, ACTX, ACTY, ACTDUR, ACTREACTION  #DECLARE ACTTIMER  TSTART = TI  READ TIME  ACTION = -1  DO WHILE ACTION <>     ' TIME TO SWITCH TO NEXT ACTION?    IF (TI-TSTART) >= TIME THEN BEGIN      IF ACTION(INT(X1)+256,256)  Y1 = MOD(INT(Y1)+256,256)  X2 = MOD(INT(X2)+256,256)  Y2 = MOD(INT(Y2)+256,256)  SYS $7E09, X1, Y1, X2, Y2  RETURN  '-----.ATAN2'-----  IF DIFFX = 0 THEN BEGIN    IF DIFFY<0 THEN ANGLE = - /2    IF DIFFY>0 THEN ANGLE = FFY<0 THEN ANGLE = - /2    IF DIFFY>0 THEN ANGLE = /2  BEND:ELSE BEGIN    TANVAL = DIFFY / DIFFX    ANGLE = ATN(TANVAL)  ' THIS IS RANGE -90DEG TO 90DEG    IF DIFFX<0 THEN BEGIN     IF DIFFY<0 THEN ANGLE = ANGLE - :ELSE ANGLE = ANGLE +    /2  BEND:ELSE BEGIN    TANVAL = DIFFY / DIFFX    ANGLE = ATN(TANVAL)  ' THIS IS RANGE -90DEG TO 90DEG    IF DIFFX<0 THEN BEGIN     IF DIFFY<0 THEN ANGLE = ANGLE - :ELSE ANGLE = ANGLE +     BEND  BEND  RETURN'----------.DRAWPIXEL'----------  BANK 0:SYS $7E06, MOD(CX+256, 256), MOD(CY+256, 256), 5  RETURN  ' PIXEL CROPPED?  IF CX<0 OR CX>159 OR CY<0 OR CY>99 THEN RETURN  DX = INT(CX/2) : DY = INT(CY/2)  MX = MOD(INT(CX),2) : MY = MOD(INT(CY),2)    ' CURSOR 0,16:PRINT CHR$(27); BEND  BEND  RETURN'----------.DRAWPIXEL'----------  BANK 0:SYS $7E06, MOD(CX+256, 256), MOD(CY+256, 256), 5  RETURN  ' PIXEL CROPPED?  IF CX<0 OR CX>159 OR CY<0 OR CY>99 THEN RETURN  DX = INT(CX/2) : DY = INT(CY/2)  MX = MOD(INT(CX),2) :"QHX =";HX;", HY =";HY    ' CURSOR 0,17:PRINT CHR$(27);"QMX =";MX;", MY =";MY  CURCHAR = PEEK($40800 + DX + DY * 80)  GOSUB READONPIXELS  IF MX = 0 AND MY = 0 THEN PIX = PIX OR 1  IF MX = 1 AND MY = 0 THEN PIX = PIX OR 2  IF MX = 0 AND MY = 1  MY = MOD(INT(CY),2)    ' CURSOR 0,16:PRINT CHR$(27);"QHX =";HX;", HY =";HY    ' CURSOR 0,17:PRINT CHR$(27);"QMX =";MX;", MY =";MY  CURCHAR = PEEK($40800 + DX + DY * 80)  GOSUB READONPIXELS  IF MX = 0 AND MY = 0 THEN PIX = PIX OR 1  IF MX = 1	THEN PIX = PIX OR 4  IF MX = 1 AND MY = 1 THEN PIX = PIX OR 8  GOSUB SETONPIXELS  POKE $40800 + DX + DY * 80, CURCHAR  RETURN'--------------.READONPIXELS'--------------  PIX = 0 ' BITFIELDS: TL = 1, TR = 2, BL = 4, BR = 8  IF CURCHAR =
 AND MY = 0 THEN PIX = PIX OR 2  IF MX = 0 AND MY = 1 THEN PIX = PIX OR 4  IF MX = 1 AND MY = 1 THEN PIX = PIX OR 8  GOSUB SETONPIXELS  POKE $40800 + DX + DY * 80, CURCHAR  RETURN'--------------.READONPIXELS'--------------  PIX = 0 ' BI د THEN PIX = 1:RETURN  IF CURCHAR = د THEN PIX = 2:RETURN  IF CURCHAR = د THEN PIX = 4:RETURN  IF CURCHAR = د THEN PIX = 8:RETURN  IF CURCHAR = د֯ THEN PIX=14:RETURN  IF CURCHAR = د֯ THEN PIX=13:RETURN  IFTFIELDS: TL = 1, TR = 2, BL = 4, BR = 8  IF CURCHAR = د THEN PIX = 1:RETURN  IF CURCHAR = د THEN PIX = 2:RETURN  IF CURCHAR = د THEN PIX = 4:RETURN  IF CURCHAR = د THEN PIX = 8:RETURN  IF CURCHAR = د֯ THEN PIX=14:RE CURCHAR = د֯ THEN PIX=11:RETURN  IF CURCHAR = د֯ THEN PIX=7:RETURN  IF CURCHAR = دǯ̯ THEN PIX=9:RETURN  IF CURCHAR = دǯ̯ THEN PIX=6:RETURN  IF CURCHAR = دů THEN PIX=12:RETURN  IF CURCHAR = TURN  IF CURCHAR = د֯ THEN PIX=13:RETURN  IF CURCHAR = د֯ THEN PIX=11:RETURN  IF CURCHAR = د֯ THEN PIX=7:RETURN  IF CURCHAR = دǯ̯ THEN PIX=9:RETURN  IF CURCHAR = دǯ̯ THEN PIX=6:RETURN  IF CURCHAدů THEN PIX=3:RETURN  IF CURCHAR = دů THEN PIX=5:RETURN  IF CURCHAR = دů THEN PIX=10:RETURN  IF CURCHAR = د THEN PIX=15:RETURN  RETURN'-------------.SETONPIXELS'-------------  IF PIX = 0 THEN CURCR = دů THEN PIX=12:RETURN  IF CURCHAR = دů THEN PIX=3:RETURN  IF CURCHAR = دů THEN PIX=5:RETURN  IF CURCHAR = دů THEN PIX=10:RETURN  IF CURCHAR = د THEN PIX=15:RETURN  RETURN'------------HAR = د:RETURN  IF PIX = 1 THEN CURCHAR = د:RETURN  IF PIX = 2 THEN CURCHAR = د:RETURN  IF PIX = 3 THEN CURCHAR = دů:RETURN  IF PIX = 4 THEN CURCHAR = د:RETURN  IF PIX = 5 THEN CURCHAR = دů:RETURN  -.SETONPIXELS'-------------  IF PIX = 0 THEN CURCHAR = د:RETURN  IF PIX = 1 THEN CURCHAR = د:RETURN  IF PIX = 2 THEN CURCHAR = د:RETURN  IF PIX = 3 THEN CURCHAR = دů:RETURN  IF PIX = 4 THEN CURCHAR = د:RETURIF PIX = 6 THEN CURCHAR = دǯ̯:RETURN  IF PIX = 7 THEN CURCHAR = د֯:RETURN  IF PIX = 8 THEN CURCHAR = د:RETURN  IF PIX = 9 THEN CURCHAR = دǯ̯:RETURN  IF PIX = 10 THEN CURCHAR = دů:RETURN  IF PIX = N  IF PIX = 5 THEN CURCHAR = دů:RETURN  IF PIX = 6 THEN CURCHAR = دǯ̯:RETURN  IF PIX = 7 THEN CURCHAR = د֯:RETURN  IF PIX = 8 THEN CURCHAR = د:RETURN  IF PIX = 9 THEN CURCHAR = دǯ̯:RETURN  IF PIX 11 THEN CURCHAR = د֯:RETURN  IF PIX = 12 THEN CURCHAR = دů:RETURN  IF PIX = 13 THEN CURCHAR = د֯:RETURN  IF PIX = 14 THEN CURCHAR = د֯:RETURN  IF PIX = 15 THEN CURCHAR = د:RETURN  RETURN'----.INIT'-= 10 THEN CURCHAR = دů:RETURN  IF PIX = 11 THEN CURCHAR = د֯:RETURN  IF PIX = 12 THEN CURCHAR = دů:RETURN  IF PIX = 13 THEN CURCHAR = د֯:RETURN  IF PIX = 14 THEN CURCHAR = د֯:RETURN  IF PIX = 15 T ---  BANK 0:BLOAD "MEGAPLOT"  SYS $7E03 ' INIT  CENTREX = 80 : CENTREY = 50  PRINT CHR$(27);"5";CHR$(147);  ZFACT = COS(/4)  RETURN                                                                                                                 HEN CURCHAR = د:RETURN  RETURN'----.INIT'----  BANK 0:BLOAD "MEGAPLOT"  SYS $7E03 ' INIT  CENTREX = 80 : CENTREY = 50  PRINT CHR$(27);"5";CHR$(147);  ZFACT = COS(/4)  RETURN                                                         #OUTPUT "XANADU-BASIC65"'============.DECLARATIONS'============  ' MUSIC RELATED VARS  ' ------------------  #DECLARE MUSICCHUNKINDEX     ' OLD T  #DECLARE BARINDEX             ' OLD TT  #DECLARE MAPBARTOCHUNK(10)  ' OLD M()  #DECLARE V1$(4), V2$(4), V3$(4), V4$(4)  ' PALETTE  ' -------  #DECLARE DEFAULTRED(32)  #DECLARE DEFAULTGREEN(32)  #DECLARE DEFAULTBLUE(32)  #DECLARE CURRRED(32)  #DECLARE CURRGREEN(32)  #DECLARE CURRBLUE(32)  #DECLARE FADEVAL, TEMPVAL  ' /  ' ---  #DEFINE ǯ7 = $D05D  #DEFINE  = $D060  #DEFINE  = $D062  ' MISC  ' ----  #DECLARE K,M,N  #DECLARE RAINBOWSTR$  #DECLARE RAINBOWX, RAINBOWY  #DECLARE PLEN=0  #DECLARE SUBTEXT$(2)  #DECLARE SUBTEXTIDX = 0  SUBTEXT$(0) = "PRESENTS..."  SUBTEXT$(1) = "A TRIBUTE TO THE LATE OLIVIA NEWTON JOHN..."  #DECLARE PANIDX = 0  #DECLARE PANSRCIDX  #DECLARE PANDESTIDX  #DECLARE PANY, PANLEN  ' PETSCII  ' -------  #DECLARE DATAADDR = $4270C  #DECLARE MAXFRAMES  #DECLARE FRAMEADDR(64)  #DECLARE FRMIDX = 0  #DECLARE FRMW, FRMH#DECLARE ANIMS(4,100) ' ANIMIDX, ANIMDATA#DECLARE AVAL,MARK(3),GMARKNUM,GCOUNT,BAIL,FOUND,FRAMEIDX,FRAMEDUR=0#DECLARE FRMX, FRMY, FRMX1, FRMY1, CDATAADDR#DEFINE ͯ = 0#DEFINE ͯͯ1 = 1#DEFINE ͯͯ2 = 2#DEFINE ͯͯ3 = 3#DEFINE ͯͯ4 = 4#DEFINE ͯͯ1 = 5#DEFINE ͯͯ2 = 6#DEFINE ͯͯ3 = 7#DEFINE ͯͯ4 = 8#DEFINE ͯů = 9#DEFINE ͯί = 10#DEFINE ͯů = 11#DEFINE ͯͯ1 = 12#DEFINE ͯͯ2 = 13#DEFINE ͯͯ3 = 14#DEFINE ͯͯ4 = 15#DEFINE ͯί = 16#DEFINE ͯͯ5 = 17#DEFINE ͯͯ6 = 18#DEFINE ͯԯ1 = 19#DEFINE ͯԯ2 = 20#DEFINE ͯ˯ = 21#DEFINE ͯů = 22#DEFINE ͯӯ = 23#DEFINE ͯү = 24#DEFINE ͯį = 25#DEFINE ͯͯ = 26#DEFINE ͯ1 = 27#DEFINE ͯ2 = 28#D EFINE ͯ3 = 29#DEFINE ͯ4 = 30#DEFINE ͯ5 = 31#DEFINE ͯ6 = 32#DEFINE ͯ7 = 33#DEFINE ͯ8 = 34#DEFINE ͯ9 = 35#DEFINE ͯ10 = 36#DEFINE ͯ11 = 37#DEFINE ͯ = 38#DEFINE ͯ1 = 39#DEFIN!E ͯ2 = 40#DEFINE ͯ3 = 41#DEFINE ͯ = 42'====.MAIN'====  GOSUB INIT  GOSUB BASLOGO  GOSUB XANADUTITLE  GOSUB PETSCIISTORY  GOSUB ENDER  ' BACKUP PALETTE TO $48000  EDMA 0, $300, $FFD3100, $48000   ' SET ALL "COLOURS TO BLACK  EDMA 3, $300, 0, $FFD3100   ': DELETE  IF PEEK($D020)<>0 THEN BORDER 2:GOSUB INITPETSCIIFRAMES  FRAMEIDX=ͯ  GOSUB DRAWPETSCIIFRAME  CLR  DLOAD "BIGSPRITE"  END' ACTION NAMES#DEFINE =0#DEFINE $---------.DRAWLINE'---------  SYS $7E03  X1 = MOD(INT(X1)+256,256)  Y1 = MOD(INT(Y1)+256,256)  X2 = MOD(INT(X2)+256,256)  Y2 = MOD(INT(Y2)+256,256)  SYS $7E09, X1, Y1, X2, Y2, 5  RETURN    ' BORROWED FROM: WWW.BAELDUNG.COM/CS/BRESENHAMS-LINE-%B DRAWLINE  RETURN'--------------------------.DRAWLINESFROMCENTREOUT'--------------------------  FOR ANG = 0 TO 2* STEP  / 8    X1 = 80    Y1 = 50    X2 = INT(80 + 30 * COS(ANG))    Y2 = INT(50 + 30 * SIN(ANG))    ' CURSOR 0,20:PRI&ALGORITHM  X1 = INT(X1)  Y1 = INT(Y1)  X2 = INT(X2)  Y2 = INT(Y2)  DDX = ABS(X2-X1)  IF X1 < X2 THEN SX = 1 : ELSE SX = -1  DDY = -ABS(Y2-Y1)  IF Y1 < Y2 THEN SY = 1 : ELSE SY = -1  E = DDX + DDY  CX = X1 : CY = Y1  DO WHILE 1    GOSUB DRA NT CHR$(27);"QX1 =";X1;", Y1 =";Y1    ' CURSOR 0,21:PRINT CHR$(27);"QX2 =";X2;", Y2 =";Y2    ' GET KEY A$    ' IF A$="D" THEN DEBUG = 1: ELSE DEBUG = 0    GOSUB DRAWLINE  NEXT ANG  RETURN'---------.DRAWLINE'---------  SYS $7E03  X1 = MOD'WPIXEL    IF CX = (X2) AND CY = Y2 THEN EXIT  E2 = 2 * E  IF E2 >= DDY THEN BEGIN    IF CX = X2 THEN EXIT    E = E + DDY    CX = CX + SX  BEND  IF E2 <= DDX THEN BEGIN    IF CY = Y2 THEN EXIT    E = E + DDX    CY = CY + SY  BEND    IF DEBUG=1 THEN BEGIN      CURSOR 0,15:PRINT CHR$(27);"QCX =";CX;", CY =";CY      CURSOR 0,16:PRINT CHR$(27);"QDDX =";DDX;", DDY =";DDY;", E=";E;", E2=";E2      GET KEY A$    BEND  LOOP  RETURN'-----.ATAN2'-----  IF DIFFX = 0 THEN BEGIN    IF DI :  D0:E0:F0:I0:A%0: A&(12288):B%0:C%0:D&0:O2: B   5 O   6: 80 W   3   $:J1:K1:L.:B%.:B&.:D&.:"";:53280,11:53281,.:N.:   A$: 29:A$"" 33   A$""E. 77:EE1:   A$""E78 77:EE1: !	 A$""F. 77:FF1: +!
 A$""F49 77:FF1: >! A$"" 61: Q! A$"" 64: d! A$"" 57: u! A$"" 24 ! A$"" 36: ! A$""P1: 36: ! A$""D&1: ! A$""D&.: ! A$""B,C:A&(B)C " A$""D(D1,2):A$"":A.,.:(27);"QDEBUG=";D $" A$"" M" AE,F: 77: 34:GE:HF: 28: 66: S"  f" OO1:O4O1 " "";(27);"QVERSION";O;:A$"":O3 27 "  " "----------":::".........."::::"----------": " A$;: " M(54801)16:M. # A$"" 82 # A$"" 84 )#  A$"": V#! "";(27);"QFNAME=";C$;"  DIDX%=";B%;: m#" D&1"";:ՙ""; s##  #$ "";:O3 27 #% N.:C%.:P1C%Q:P. #& C%B%:A.,49:(27);"QPIDX=";C%;"[";A&(C%);A&(C%1);A&(C%2);:C&A&(C%):C%C%1 $' O3C&255 $(  27:C%QQC% +$)  55: 8$* EC&127 D$+ O2 s$, EC&:C&A&(C%):C%C%1:EE(C&127)256: $- C&128"";:ՙ""; $. FA&(C%):C%C%1:A$(A&(C%)):C%C%1 $/ O2 $0 EN78: 84:"";(27);"QOFFS=";N;:: %1 GEN:HF:AG,H: 28:D1B$ $%2 B$"X" 56 8%3 B$"<"C%C%6 N%4 B$"H"C%.: 36 `%5 B$"T"B%C% p%6 B&..02 ~%7 :EEN: %8 B%B%3:C%C%3:BC%B%:A&(B)A&(B3):A&(B1)A&(B4):A&(B2)A&(B5):B: %9 B&. &: A&(B%)255:53280,((53280)1)15: 27 &; :: "&< B%B%1: A&= "LOAD NAME: ";C$:C$"" g&>  5:#2,(C$),R,U8::#2,C&:ST &? A&(B%)C&:B%B%1::#2: 36: &@ "SAVE NAME: ";C$:C$"" &A (C$):#2,(C$),W,U8:G.B%:2,(A&(G));:G:#2: 'B JEKFLN("",A$). 'C O2 P'D A&(B%4)(EN)255:A&(B%3)(EN)256D&128 p'E ::A&(B%3)ED&128: 'F A&(B%1)(A$) 'G :: 'H O2 'I A&(B%)(EN)255:B%B%1:A&(B%)(EN)256D&128:B%B%1 (J ::A&(B%)(EN)	D&128:B%B%1: ;(K A&(B%)F:B%B%1:A&(B%)(A$):B%B%1:JE:KF:LN: A(L  L(M A% {(N A267911168E80F:A,(A)32:A%.:ITI: (O  (P TIIITI.5:Վ (Q A267911168E80F:A,(A)32:A%A%1: (R N.NN1:Վ  )S H.49:!03216,79,
264192H8078,264192H8079:264192H80,32:H: i)T NN1:H.49:!0,79,264193H80,264192H80:26419279H80,32:H: y)U  LOC = :A: )V  K = :B: )W  V = :C: )X  DEBUG = :D: )Y  X = :E: )Z  Y = :F: )[  XX = :G: )\  YY = :H: )]  T0 = :I: *^  OLDX = :J: *_  OLDY = :K: &*`  OLDOFFS = :L: :*a  ALTKEY = :M: K*b  OFFS = :N: [*c  VER = :O: p*d  LASTFLAG = :P: *e  LASTGROUPIDX = :Q: *f   = :R: *g  MODIFIED% = :A%: *h  DIDX% = :B%: *i  PIDX% = :C%: *j   = :D%: *k   A$ = :A$: +l  Z$ = :B$: +m  FNAME$ = :C$: %+n   = :D$: 9+o  LDATA& = :A&: R+p  GROUPFLAG& = :B&: d+q  VAL& = :C&: {+r  REVFLAG& = :D&: +s   = :E&:                                                                                               128: t$ F.49:SK:TL:E.79:267911168EO,(262144S65536(T65536)96):SSI:TTJ:E:KKM:LLN:OO80:F:A$: $  ǯ7 = :A: $   = :B: $   = :C: $  T = :D: $  X = :E: $  Y = :F: $   COLR = :G: %!  ANG = :H: %"  XINC = :I: $%#  YINC = :J: 3%$  TX = :K: B%%  TY = :L: T%&  TXINC = :M: f%'  TYINC = :N: x%(  Y1ADD = :O: %)  XFRAC = :P: %*  YFRAC = :Q: %+  BOXANG = :R: %,  CX = :S: %-  CY = :T: %.  HYP = :U: %/  PLRAD = :V: & 0  PLANG = :W: &1  PLDIR = :X: *&2  PLCLR = :Y: <&3  STATE = :Z: J&4   = :AA: X&5   = :A%: h&6  A$ = :A$: v&7   = :B$: &8   = :A&:                                                                                                              A    GOSUB ROTATEINCB    PX(CBIDX) = CENTREX + PX(CBIDX) - PZ * ZFACT / 4    PY(CBIDX) = CENTREY + PY(CBIDX) + PZ * ZFACT    'PRINT "PX(";CBIDX;")=";PX(CBIDX);", PY(";CBIDX;")=";PY(CBIDX)    CBIDX = CBIDX + 1  NEXT CBANGA   PLEN = 4  GOSUB DRAWPOLY  ' DRAW LINES FROM POLY  CBIDX = 0  CBANGB = -ATN(1/SQR(2))  FOR CBANGA =  / 4 TO 1.9 *  STEP /2    X1 = PX(CBIDX)    Y1 = PY(CBIDX)    CBTMP = PDIST * COS(CBANGB)    PZ = CBTMP * SIN(CBANGA)    PY(CBIDX) = PDIST * SIN(CBANGB)    PX(CBIDX) = CBTMP * COS(CBANGA)    GOSUB ROTATEINCA    GOSUB ROTATEINCB    PX(CBIDX) = CENTREX + PX(CBIDX) - PZ * ZFACT / 4    PY(CBIDX) = CENTREY + PY(CBIDX) + PZ * ZFACT    X2 = PX(CBIDX)    Y2 = PY(CBIDX)    GOSUB DRAWLINE    CBIDBIDX) - PZ * ZFACT / 4    PY(CBIDX) = CENTREY + PY(CBIDX) + PZ * ZFACT    'PRINT "PX(";CBIDX;")=";PX(CBIDX);", PY(";CBIDX;")=";PY(CBIDX)    CBIDX = CBIDX + 1  NEXT CBANGA   PLEN = 4  GOSUB DRAWPOLY  ' DRAW LINES FROM POLY  CBIDX = 0  CBANGX = CBIDX + 1  NEXT CBANGA  PLEN = 4  GOSUB DRAWPOLY  RETURN'-----------.ROTATEINCA'-----------  ' ROTATE ALONG Y-AXIS BY INCA  DIFFX = PX(CBIDX)  DIFFY = PZ  CBTMP = SQR(DIFFX*DIFFX + DIFFY*DIFFY)  GOSUB ATAN2  ' RETURNS ANGLE  ANGLEB = -ATN(1/SQR(2))  FOR CBANGA =  / 4 TO 1.9 *  STEP /2    X1 = PX(CBIDX)    Y1 = PY(CBIDX)    CBTMP = PDIST * COS(CBANGB)    PZ = CBTMP * SIN(CBANGA)    PY(CBIDX) = PDIST * SIN(CBANGB)    PX(CBIDX) = CBTMP * COS(CBANGA)    GOSUB ROTA = ANGLE + CBINCA  PX(CBIDX) = CBTMP * COS(ANGLE)  PZ = CBTMP * SIN(ANGLE)   RETURN'-----------.ROTATEINCB'-----------  ' ROTATE ALONG Z-AXIS BY INCB  DIFFX = PX(CBIDX)  DIFFY = PY(CBIDX)  CBTMP = SQR(DIFFX*DIFFX + DIFFY*DIFFY)  GOSUB ATANTEINCA    GOSUB ROTATEINCB    PX(CBIDX) = CENTREX + PX(CBIDX) - PZ * ZFACT / 4    PY(CBIDX) = CENTREY + PY(CBIDX) + PZ * ZFACT    X2 = PX(CBIDX)    Y2 = PY(CBIDX)    GOSUB DRAWLINE    CBIDX = CBIDX + 1  NEXT CBANGA  PLEN = 4  GOSUB DRAW2  ' RETURNS ANGLE  ANGLE = ANGLE + CBINCB  PX(CBIDX) = CBTMP * COS(ANGLE)  PY(CBIDX) = CBTMP * SIN(ANGLE)   RETURN'-----------------.DRAWMANYSQUARES'-----------------  FOR SQANG = 0 TO /2 STEP  / 8    GOSUB DRAWSQUARE  NEXT SQANG  RPOLY  RETURN'-----------.ROTATEINCA'-----------  ' ROTATE ALONG Y-AXIS BY INCA  DIFFX = PX(CBIDX)  DIFFY = PZ  CBTMP = SQR(DIFFX*DIFFX + DIFFY*DIFFY)  GOSUB ATAN2  ' RETURNS ANGLE  ANGLE = ANGLE + CBINCA  PX(CBIDX) = CBTMP * COS(ANGLE)  ETURN'-----------.DRAWSQUARE'-----------  PDIST = 45  PANG = SQANG - 3 *  / 4  PX(0) = CENTREX + PDIST * COS(PANG)  PY(0) = CENTREY + PDIST * SIN(PANG)  PANG = SQANG -  / 4  PX(1) = CENTREX + PDIST * COS(PANG)  PY(1) = CENTREY + PDIST PZ = CBTMP * SIN(ANGLE)   RETURN'-----------.ROTATEINCB'-----------  ' ROTATE ALONG Z-AXIS BY INCB  DIFFX = PX(CBIDX)  DIFFY = PY(CBIDX)  CBTMP = SQR(DIFFX*DIFFX + DIFFY*DIFFY)  GOSUB ATAN2  ' RETURNS ANGLE  ANGLE = ANGLE + CBINCB  PX(CBID* SIN(PANG)  PANG = SQANG +  / 4  PX(2) = CENTREX + PDIST * COS(PANG)  PY(2) = CENTREY + PDIST * SIN(PANG)  PANG = SQANG + 3 *  / 4  PX(3) = CENTREX + PDIST * COS(PANG)  PY(3) = CENTREY + PDIST * SIN(PANG)  PLEN = 4  GOSUB DRAWPOLY  RETX) = CBTMP * COS(ANGLE)  PY(CBIDX) = CBTMP * SIN(ANGLE)   RETURN'-----------------.DRAWMANYSQUARES'-----------------  FOR SQANG = 0 TO /2 STEP  / 8    GOSUB DRAWSQUARE  NEXT SQANG  RETURN'-----------.DRAWSQUARE'-----------  PDISTURN'---------.DRAWPOLY'---------  FOR PIDX = 0 TO PLEN-2    X1 = PX(PIDX) : Y1 = PY(PIDX)    X2 = PX(PIDX+1) : Y2 = PY(PIDX+1)    ' PRINT "X1=";X1;", Y1=";Y1;", X2=";X2;", Y2=";Y2    ' GET KEY A$    GOSUB DRAWLINE  NEXT PIDX  X1 = PX(PLEN  = 45  PANG = SQANG - 3 *  / 4  PX(0) = CENTREX + PDIST * COS(PANG)  PY(0) = CENTREY + PDIST * SIN(PANG)  PANG = SQANG -  / 4  PX(1) = CENTREX + PDIST * COS(PANG)  PY(1) = CENTREY + PDIST * SIN(PANG)  PANG = SQANG +  / 4  PX(2) = CENTREX!-1) : Y1 = PY(PLEN-1)  X2 = PX(0) : Y2 = PY(0)  GOSUB DRAWLINE  RETURN'--------------------------.DRAWLINESFROMCENTREOUT'--------------------------  FOR ANG = 0 TO 2* STEP  / 8    X1 = 80    Y1 = 50    X2 = INT(80 + 30 * COS(ANG)) " + PDIST * COS(PANG)  PY(2) = CENTREY + PDIST * SIN(PANG)  PANG = SQANG + 3 *  / 4  PX(3) = CENTREX + PDIST * COS(PANG)  PY(3) = CENTREY + PDIST * SIN(PANG)  PLEN = 4  GOSUB DRAWPOLY  RETURN'---------.DRAWPOLY'---------  FOR PIDX = 0 "   Y2 = INT(50 + 30 * SIN(ANG))    ' CURSOR 0,20:PRINT CHR$(27);"QX1 =";X1;", Y1 =";Y1    ' CURSOR 0,21:PRINT CHR$(27);"QX2 =";X2;", Y2 =";Y2    ' GET KEY A$    ' IF A$="D" THEN DEBUG = 1: ELSE DEBUG = 0    GOSUB DRAWLINE  NEXT ANG  RETURN'#TO PLEN-2    X1 = PX(PIDX) : Y1 = PY(PIDX)    X2 = PX(PIDX+1) : Y2 = PY(PIDX+1)    ' PRINT "X1=";X1;", Y1=";Y1;", X2=";X2;", Y2=";Y2    ' GET KEY A$    GOSUB DRAWLINE  NEXT PIDX  X1 = PX(PLEN-1) : Y1 = PY(PLEN-1)  X2 = PX(0) : Y2 = PY(0)  GOSU%  QLX2(QLIDX) = INT(RND(1)*160)  QLY2(QLIDX) = INT(RND(1)*100)  QLCLR = INT(RND(1)*16) + 64  SYS $7E0C, QLCLR  QLCNT = QLCNT + 1  X1 = QLX1(QLIDX)  Y1 = QLY1(QLIDX)  X2 = QLX2(QLIDX)  Y2 = QLY2(QLIDX)  'CURSOR 0,0:PRINT CHR$(27);"QX1,Y1,X  PDIST = 45  CBIDX = 0  CBANGB = ATN(1/SQR(2))  FOR CBANGA =  / 4 TO 1.9 *  STEP /2    CBTMP = PDIST * COS(CBANGB)    PZ = CBTMP * SIN(CBANGA)    PY(CBIDX) = PDIST * SIN(CBANGB)    PX(CBIDX) = CBTMP * COS(CBANGA)    GOSUB ROTATEINC&2,Y2=",X1,Y1,X2,Y2  GOSUB DRAWLINE  'GET KEY A$  QLIDX = MOD(QLIDX + 1, 10)  GOTO QLLLOOP    RETURN'---------------.DRAWMANYCUBES'---------------  CBINCB = 0  FOR CBINCA = 0 TO 1.9*/4 STEP /16    ' PRINT""    GOSUB DRAWCUBE'    ' SLEEP .02  NEXT CBINCA  CBINCA = 0  FOR CBINCB = 0 TO 1.9*/2 STEP /16    ' PRINT""    GOSUB DRAWCUBE    ' SLEEP .02  NEXT CBINCB  RETURN  '---------.DRAWCUBE'---------  PDIST = 45  CBIDX = 0  CBANGB = ATN(1/SQR(2))  FOR CBANGA =  / 4 TO 1.9 *  STEP /2    CBTMP = PDIST * COS(CBANGB)    PZ = CBTMP * SIN(CBANGA)    PY(CBIDX) = PDIST * SIN(CBANGB)    PX(CBIDX) = CBTMP * COS(CBANGA)    GOSUB ROTATEINCA    GOSUB ROTATEINCB    PX(CBIDX) = CENTREX + PX(C T "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)    'GET KEY A$    SLEEP .02.PDENDLOOP  LOOP  RETURN'---------.DRAWCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN    VAL& =' ROTATE SCREEN CONTENTS#OUTPUT "ROTATE"' 4.0000 = 96X96 CLRBOX CANVAS (9216 BYTES)' 4.2400 = FREE.DEFINES'-------#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DECLARE ǯ7 = $D05D#DECLARE  = $D060#DECLARE  = $D062#DECLARE T, X, Y, COLR, ANG, XINC, YINC, TX, TY, TXINC, TYINC#DECLARE Y1ADD#DECLARE XFRAC, YFRAC#DECLARE BOXANG, CX, CY, HYP#DEFINE  = 3.1415926535#DECLARE PLRAD, PLANG, PLDIR, PLCLR#DECLARE A$#DECLARE STATE.MAIN'----  GOSUB INIT  GOSUB DUMMYCONTENT.MNLOOP  GOSUB ROTATELOGIC  GOSUB DRAWCONTENT  GOTO MNLOOP.INIT'----  ^^BLOAD "ASMROTATE",B0  ' PRINT CHR$(27);"5";CHR$(147);  ANG = 2* + .1  STATE = 0  PLRAD = 0  PLANG = 0  PLDIR = 0  PLCLR = 0  ' SWITCH TO 80X50  BANK 128  SETBIT ǯ7, 7  POKE $D031, $E8 ' 1110 1000 = 640,,,400  ' MOVE  TO BANK4 - $8000  WPOKE , $8000  POKE ,$04  ' CLEAR 80X50 CHARS AND COLOUR RAM  EDMA 3, 4000, 160, $48000  EDMA 3, 4000, 6, $FF80000  ' FOR IDX=0 TO 3999:POKE $48000+IDX,160:POKE $FF80000+IDX,6:NEXT IDX  RETURN.DUMMYCONTENT'-------------  EDMA Я, 96*96, 0, $40000  'POKE $40000 + 48*96, 1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6  'FOR T = 0 TO 50  '  COLR = INT(RND(1)*16)  '  X = INT(RND(1)*96)  '  Y = INT(RND(1)*96)  '  POKE $40000 + X + Y * 96, COLR  'NEXT T  'FOR Y = 0 TO 96  '  FOR X = 0 TO 95  '    POKE $40000 + X + Y * 96, MOD(Y, 16)  '  NEXT X  'NEXT Y  RETURN.ROTATELOGIC'------------  ANG = ANG - .1  IF ANG < 0 THEN ANG = ANG + (2 * )  HYP = SQR(25*25+40*40) * 65536  XINC = COS(ANG) * 65536  YINC = SIN(ANG) * 65536  TXINC = COS(ANG+/2) * 65536  TYINC = SIN(ANG+/2) * 65536  BOX	ANG = ATN(-25/-40)+  +ANG  IF BOXANG < 0 THEN BOXANG = BOXANG + (2 * )  TX = HYP * COS(BOXANG) + 48 * 65536  TY = HYP * SIN(BOXANG) + 48 * 65536  CX = TX  CY = TY  XFRAC = 0  YFRAC = 0  Y1ADD = 0  RETURN.DRAWCONTENT'------------  
GOSUB PLOTITERATION  GOSUB ASMROTATION  ' GOSUB BASICROTATION  'CURSOR 0,0:PRINT CHR$(27);"Q TX=";TX;", TY=";TY;  'CURSOR 0,1:PRINT CHR$(27);"Q ANG=";ANG;", HYP=";HYP;  'CURSOR 0,2:PRINT CHR$(27);"Q XINC=";XINC;", YINC=";YINC;  'CURSOR 0,3:PRINT CHR$(27);"Q TXINC=";TXINC;", TYINC=";TYINC;  'GET KEY A$  RETURN.PLOTITERATION'--------------  X = 48 + COS(PLANG) * PLRAD  Y = 48 + SIN(PLANG) * PLRAD  POKE $40000 + X + INT(Y) * 96, PLCLR + 64  PLANG = PLANG + .025  IF PLANG > 2 *  THEN PLANG = PLANG - 2 *   PLRAD = PLRAD + .05  IF PLRAD > 30 THEN BEGIN    PLRAD=0    PLCLR = PLCLR + 1    IF PLCLR = 16 THEN STATE = STATE + 1    PLANG = .3926 * PLCLR  BEND  RETURN.ASMROTATION'------------  '  VERSION  IF XINC < 0 THEN XINC = XINC + 4294967296  IF YINC < 0 THEN YINC = YINC + 4294967296  IF TXINC < 0 THEN TXINC = TXINC + 4294967296  IF TYINC < 0 THEN TYINC = TYINC + 4294967296  WPOKE $1A00, MOD(TX,65536)  WPOKE $1A02, TX/65536  WPOKE $1A04, MOD(TY, 65536)  WPOKE $1A06, TY/65536  WPOKE $1A08, MOD(XINC,65536)  WPOKE $1A0A, XINC/65536  WPOKE $1A0C, MOD(YINC, 65536)  WPOKE $1A0E, YINC/65536  WPOKE $1A10, MOD(TXINC, 65536)  WPOKE $1A12, TXINC/65536  WPOKE $1A14, MOD(TYINC, 6 X = X-OFFS(FIDX%)  RETURN'---------.DRAWCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)    CHR = ASC(A$)  GOSUB PETSCIITOSCREENCODE  IF REVFLAG&(FIDX%) = 1 THEN CHR = CHR + 128  IF VER(FIDX%) = 1 THEN BEGIN    POKE $52000 + DXX + DYY*80, CHR    POKE $53000 + DXX + DYY*80, 1  BEND  IF VER(FIDX%) = 2 OR VER(FIDX%) = 3 THEN BEGIN    POKE $54000 + DXX + DYY*80, CHR    POKE $55000 + DXX + DYY*80, 2  BEND  RETURN'---------------------5536)  WPOKE $1A16, TYINC/65536  BANK 0:SYS $1800:BANK 128  RETURN.BASICROTATION'--------------  '  VERSION  FOR Y = 0 TO 49    CX = TX    CY = TY    FOR X = 0 TO 79      POKE $FF80000 + X + Y1ADD, PEEK($40000 + CX/65536 + INT(CY/655.PETSCIITOSCREENCODE'---------------------  ' ASED ON THE TABLE HERE:  ' HTTPS://STA.C64.ORG/CBM64PETTOSCR.HTML  ' - SEEMS LIKE  NEEDED TO DO A REPAIR TO IT ON THE $A0-->$BF RANGE  IF CHR>=$00 AND CHR<=$1F THEN CHR=CHR OR $80:RETURN  IF CHR>=$2 0000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN                                                                                                                                                                                                               0 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF:RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF:RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40:RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=(CHR AND $7F) OR $40:RETURN5 ' $BF:RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F:RETURN  RETURN'-----------------.SCREENCODETOIDX'-----------------  IF CHR >= 65 AND CHR <= 90 THEN CHR = CHR - 65:RETURN  IF CHR = 46 THEN CHR = 26:RETURN ' FULL-STOP  IF CHR = 33  36) * 96)      CX = CX + XINC      CY = CY + YINC    NEXT X    TX = TX + TXINC    TY = TY + TYINC    Y1ADD = Y1ADD + 80  NEXT Y  GET KEY A$  RETURN                                                                                              = 3.141592654269'----.VARS'----#DECLARE X1, Y1, X2, Y2#DECLARE DX, DY, MX, MY, CX, CY#DECLARE CURCHAR, PIX#DECLARE DIFFX, DIFFY, DELTAX, DELTAY, TANVAL, ANGLE#DECLARE A$, ANG, LINELENGTH, K, DEBUG#DECLARE CENTREX, CENTREY, CENTREZ#DECLARE PX(10), PY(10), PLEN, PANG, PIDX, PDIST#DECLARE SQANG#DECLARE CBANGA, CBANGB, CBIDX, CBTMP, PZ#DECLARE CBINCA, CBINCB, RETANG, Z$, ZFACT#DECLARE DDX, DDY, SX, SY, E, E2#DECLARE QLIDX, QLCNT#DECLARE QLX1(10), QLY1(10), QLX2(10), QLY2(10)#DECLAC0 AND CHR<=$FE THEN CHR=CHR AND $7F:RETURN  RETURN'-----------------.SCREENCODETOIDX'-----------------  IF CHR >= 65 AND CHR <= 90 THEN CHR = CHR - 65:RETURN  IF CHR = 46 THEN CHR = 26:RETURN ' FULL-STOP  IF CHR = 33 THEN CHR = 27:RETURN ' EXCLAMATION  IF CHR = 44 THEN CHR = 28:RETURN ' COMMA (SMILEY)  IF CHR = 47 THEN CHR = 29:RETURN ' FORWARD SLASH (LOVE HEART)  IF CHR = 35 THEN CHR = 30:RETURN ' # HASH (DHUFISH)  IF CHR >= 1 AND CHR <= 26 THEN CHR = CHR + 30  RETURN'----------.WRITECHAR'----------  ' ITERATE OVER CHARS IN STRING    ' DRAW CURRENT CHAR AT GIVEN X,Y POS    ' INCREMENT X,Y LOCATION   PIDX% = CHARIDX%(CHR)  DO WHILE PIDX% < DIDX% AND LDATA&(PIDX%) <> $FF    ' CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& = LDATA&(PIDX%) : PIDX% = PIDX% + 1    X = VAL& AND $7F    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% + 1    CURSOR XX+X, YY+Y : GOSUB DRAWCHAR    'PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)    'GET KEY A$    SLEEP .02.PDENDLOOP  LOOP  RETURN'---------.DRAWCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80RE QLVX1, QLVY1, QLVX2, QLVY2#DECLARE QLCLRGOSUB INIT'----.MAIN'----  PRINT "";  PRINT "PETLINE EXAMPLE MENU:"  PRINT "--------------------"  PRINT "1) LINES"  PRINT "2) SQUARE"  PRINT "3) MANY SQUARES"  PRINT "4) DRAW CUBE"  PRINT "5) D"RAW MANY CUBES"  PRINT "6) QIX LINES"  GET KEY Z$  IF Z$="1" THEN GOSUB DRAWLINESFROMCENTREOUT  IF Z$="2" THEN GOSUB DRAWSQUARE  IF Z$="3" THEN GOSUB DRAWMANYSQUARES  IF Z$="4" THEN GOSUB DRAWCUBE  IF Z$="5" THEN GOSUB DRAWMANYCUBES  I X(10), PY(10), PLEN, PANG, PIDX, PDIST#DECLARE SQANG#DECLARE CBANGA, CBANGB, CBIDX, CBTMP, PZ#DECLARE CBINCA, CBINCB, RETANG, Z$, ZFACT#DECLARE DDX, DDY, SX, SY, E, E2GOSUB INIT'----.MAIN'----  PRINT "";  PRINT "PETLINE EXAMPLE MENU:" ! PRINT "--------------------"  PRINT "1) LINES"  PRINT "2) SQUARE"  PRINT "3) MANY SQUARES"  PRINT "4) DRAW CUBE"  PRINT "5) DRAW MANY CUBES"  GET KEY Z$  IF Z$="1" THEN GOSUB DRAWLINESFROMCENTREOUT  IF Z$="2" THEN GOSUB DRAWSQUARE  IF Z$=#"3" THEN GOSUB DRAWMANYSQUARES  IF Z$="4" THEN GOSUB DRAWCUBE  IF Z$="5" THEN GOSUB DRAWMANYCUBES  IF Z$>="1" AND Z$<="5" THEN GET KEY Z$  GOTO MAIN  END'---------------.DRAWMANYCUBES'---------------  CBINCB = 0  FOR CBINCA = 0 TO 1#F Z$="6" THEN GOSUB DRAWQIXLINES  IF Z$>="1" AND Z$<="5" THEN GET KEY Z$  GOTO MAIN  END'--------------.DRAWQIXLINES'--------------  ' INIT  QLIDX = 0 : QLCNT = 0.QLLLOOP  QLX1(QLIDX) = INT(RND(1)*160)  QLY1(QLIDX) = INT(RND(1)*100)$.9*/2 STEP /16    ' PRINT""    GOSUB DRAWCUBE    ' SLEEP .02  NEXT CBINCA  CBINCA = 0  FOR CBINCB = 0 TO 1.9*/2 STEP /16    ' PRINT""    GOSUB DRAWCUBE    ' SLEEP .02  NEXT CBINCB  RETURN  '---------.DRAWCUBE'---------%   A53341:B53344:C53346: *   5: 7 7   8: 12 ?   3    "ASMROTATE",B0:H23.1415926535.1:Z.:V.:W.:X.:Y.:128:-NA,7:53297,232:B,32768:C,4:!3,4000,160,294912   !3,4000,6,267911168:   !3,9696,.,262144: ! HH.1:H.&HH(23.1415926535) !	 U(25254040)65536:I(H)65536:J(H)65536:M(H3.14159265352)65536:N(H3.14159265352)65536:R(2540)3.1415926535H !
 R.RR(23.1415926535) ! KU(R)4865536:LU(R)4865536:SK:TL:P.:Q.:O.: " ' 13: 13: 19: m" E48(W)V:F48(W)V:262144E(F)96,Y64:WW.025:W23.1415926535WW23.1415926535 y" VV.05 " V30 " V.:YY1:Y16ZZ1 " W.3926Y: "  " I.II4294967296 " J.JJ4294967296 " M.MM4294967296 # N.NN4294967296 # 6656,(K,65536):6658,K65536:6660,(L,65536):6662,L65536:6664,(I,65536):6666,I65536:6668,(J,65536) # 6670,J65536:6672,(M,65536):6674,M65536:6676,(N,65536):6678,N65536:.:6144: N  A53335:B53333:C53334:D53344:E53346:F53358:G53356:H53358:I53341: a   3:A$: 4:   53281,9:H,5128:G,.:J.4:J,1:J,64J24,50:J:A,255:B,255:C,200:   J.4:J,.:J:    64 = :A:     = :B: !  								  			

	 		  = :C: !   = :D: 4!	   = :E: I!
  16 = :F: _!   = :G: u!   = :H: !  ǯ7 = :I: !  K = :J: !   = :K: !   = :A%: !  A$ = :A$: !   = :B$: !   = :A&:   = :J: 15 REM  = :K: 16 R					



								 										

				


							 							 	 						


 K					                                                                                                                                                                                     #OUTPUT "WRITER"'--------.DECLARES'--------#DECLARE S$, PIDX%, DIDX%, LDATA&(12000), PTR, VAL&#DECLARE CHARIDX%(60)#DECLARE CHARWIDTH%(60)#DECLARE CHARCNT, MAXWIDTH, TXTK#DECLARE X, Y, A$, DEBUG=0, Z$#DECLARE XX, YY, CHR'----.MAIN'---#OUTPUT "WRITER"'--------.DECLARES'--------#DECLARE S$, PIDX%, DIDX%, LDATA&(12000), PTR, VAL&#DECLARE CHARIDX%(60)#DECLARE CHARWIDTH%(60)#DECLARE CHARCNT, MAXWIDTH, K#DECLARE X, Y, A$, DEBUG=0, Z$#DECLARE XX, YY, CHR'----.MAIN'----  -  GOSUB INIT  XX=0:YY=0  S$ = ",/#"  GOSUB WRITETEXT  XX=0:YY=15    S$ = "RUM OOGIE!"  GOSUB WRITETEXT  END'----.INIT'----  PRINT "";  XX = 0 : YY = 0  PTR = $42000  ' LOAD 'ABC.LN' FONT  GOSUB LOADFONT  CHARCNT = 0  CHARGOSUB INIT  XX=0:YY=0  S$ = ",/#"  GOSUB WRITETEXT  XX=0:YY=15    S$ = "HIS IS !"  GOSUB WRITETEXT  END'----.INIT'----  PRINT "";  XX = 0 : YY = 0  PTR = $42000  ' LOAD 'ABC.LN' FONT  GOSUB LOADFONT  CHARCNT = 0  CHARIDXIDX%(0) = 0  CHARWIDTH%(0) = 0  MAXWIDTH = 0  TXTK = 0  DO WHILE TXTK < DIDX%    ' GET X VALUE    VAL& = LDATA&(TXTK)    TXTK=TXTK+1    IF VAL& = $FF THEN BEGIN      ' KEEP AN ARRAY OF WIDTHS OF EACH LETTER      CHARWIDTH%(CHARCNT)=%(0) = 0  CHARWIDTH%(0) = 0  MAXWIDTH = 0  K = 0  DO WHILE K < DIDX%    ' GET X VALUE    VAL& = LDATA&(K)    K=K+1    IF VAL& = $FF THEN BEGIN      ' KEEP AN ARRAY OF WIDTHS OF EACH LETTER      CHARWIDTH%(CHARCNT)=MAXWIDTH      ' PRINTMAXWIDTH      ' PRINT "CHARWIDTH(";CHARCNT;") = ";MAXWIDTH      ' GET KEY Z$      MAXWIDTH = 0      CHARCNT=CHARCNT+1      ' KEEP AN ARRAY OF INDICES TO EACH DRAWN LETTER      CHARIDX%(CHARCNT) = TXTK      'PRINT "CHARIDX%(";CHARCNT "CHARWIDTH(";CHARCNT;") = ";MAXWIDTH      ' GET KEY Z$      MAXWIDTH = 0      CHARCNT=CHARCNT+1      ' KEEP AN ARRAY OF INDICES TO EACH DRAWN LETTER      CHARIDX%(CHARCNT) = K      'PRINT "CHARIDX%(";CHARCNT;")=";K      'GET KEY A$  ;")=";K      'GET KEY A$    BEND    IF VAL& = $FF THEN GOTO CONTLOOP    VAL& = VAL& AND $7F    IF VAL& > MAXWIDTH THEN MAXWIDTH = VAL&        TXTK=TXTK+1  ' SKIP Y VALUE    TXTK=TXTK+1  ' SKIP CHAR .CONTLOOP  LOOP  RETURN'------  BEND    IF VAL& = $FF THEN GOTO CONTLOOP    VAL& = VAL& AND $7F    IF VAL& > MAXWIDTH THEN MAXWIDTH = VAL&        K=K+1  ' SKIP Y VALUE    K=K+1  ' SKIP CHAR .CONTLOOP  LOOP  RETURN'---------.LOADFONT'---------  DOPEN #2,("ABC.LN"),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) = VAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  RETURN'----------.WRITETEXT'----------  FOR K = 1 TO LEN(S$)    CHR = ASC(MID$(S$,K,1))    ' PRINT "";CHR$(27);"QCHR=";CHR;---.LOADFONT'---------  DOPEN #2,("ABC.LN"),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) = VAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  RETURN'----------.WRITETEXT'----------  FOR TXTK = 1 TO LEN(S$)    CHR = ASC(MID$(S$, TXTK, 1))    ' PRINT "";CHR$(27);"QCHR=";CHR;    GOSUB PETSCIITOSCREENCODE    GOSUB SCREENCODETOIDX    ' PRINT "FIXED CHR=";CHR;    IF CHR=32 THEN BEGIN      XX=XX+7    BEND:ELSE:BEGIN      GOSUB WRITECHAR      XX = XX + CHARWIDTH%(CHR) + 1    BEND  NEXT TXTK  RETURN'---------------------.PETSCIITOSCREENCODE'---------------------  ' ASED ON THE TABLE HERE:  ' HTTPS://STA.C64.ORG/CBM64PETTOSCR.HTML  IF CHR>=$00 AND CHR<=$1F THEN CHR=CHR OR $80:RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF:RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF:RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40:RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=CHR AND $BF:RETURN  IF CHR>=$     GOSUB PETSCIITOSCREENCODE    GOSUB SCREENCODETOIDX    ' PRINT "FIXED CHR=";CHR;    IF CHR=32 THEN BEGIN      XX=XX+7    BEND:ELSE:BEGIN      GOSUB WRITECHAR      XX = XX + CHARWIDTH%(CHR) + 1    BEND  NEXT K  RETURN'-------------											 												)) 																					 	 		  		 	 											 			
										
					

	
		
	
	

	!--------.PETSCIITOSCREENCODE'---------------------  ' ASED ON THE TABLE HERE:  ' HTTPS://STA.C64.ORG/CBM64PETTOSCR.HTML  IF CHR>=$00 AND CHR<=$1F THEN CHR=CHR OR $80:RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CH"R=CHR AND $BF:RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF:RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40:RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=CHR AND $BF:RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F:RETURN  RETURN'--#---------------.SCREENCODETOIDX'-----------------  IF CHR >= 65 AND CHR <= 90 THEN CHR = CHR - 65:RETURN  IF CHR = 46 THEN CHR = 26:RETURN ' FULL-STOP  IF CHR = 33 THEN CHR = 27:RETURN ' EXCLAMATION  IF CHR = 44 THEN CHR = 28:RETURN ' COMMA (SMIL&EY)  IF CHR = 47 THEN CHR = 29:RETURN ' FORWARD SLASH (LOVE HEART)  IF CHR = 35 THEN CHR = 30:RETURN ' # HASH (DHUFISH)  IF CHR >= 1 AND CHR <= 26 THEN CHR = CHR + 30  RETURN'----------.WRITECHAR'----------  ' ITERATE OVER CHARS IN STRING    ' RN'-------------------.SCROLLCANVASRIGHT'-------------------  OFFS=OFFS+1  FOR YY = 0 TO 49    EDMA Я, 79, $40801 + YY*80, $40800 + YY*80    POKE $40800 + 79 + YY*80, 32   NEXT YY                  RETURN MODIFIED% XOR 1  RETURN'-- URN'-------------------.SCROLLCANVASRIGHT'-------------------  OFFS=OFFS+1  FOR YY = 0 TO 49    EDMA Я, 79, $40801 + YY*80, $40800 + YY*80    POKE $40800 + 79 + YY*80, 32   NEXT YY                  RETURN MODIFIED% XOR 1  RETURN'-' DRAW CURRENT CHAR AT GIVEN X,Y POS    ' INCREMENT X,Y LOCATION   PIDX% = CHARIDX%(CHR)  DO WHILE PIDX% < DIDX% AND LDATA&(PIDX%) <> $FF    ' CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& =  LDATA&(PIDX%) : PIDX% = PIDX% + 1    X = VAL& AND $7F    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% + 1    CURSOR XX+X, YY+Y : GOSUB DRAWCHAR    'PRIN, $E0 ' 640, ,   RETURN.RESTORESCREENPOINTER'----------------------  ' TO BANK 0 - $0800  BANK 128  WPOKE , $0800  POKE , 0  RETURN.SETSCREENPOINTER'------------------  ' MOVE TO BANK4 - $8000  BANK 128  SETBIT ǯ7, 7  WPOKE , $8000  POKE , $04  RETURN.PANTITLE'---------  FOR PANIDX = 0 TO 196    IF PANIDX > 79 THEN BEGIN      PANSRCIDX = PANIDX - 79      PANDESTIDX = 0      IF PANIDX > 117 THEN BEGIN        PANLEN = 80 - (PANIDX - 117)        IF PANLEN < 1 THEN PANLEN = 0      BEND:ELSE BEGIN        PANLEN = 80      BEND    BEND:ELSE BEGIN      PANSRCIDX = 0      PANDESTIDX = 79 - PANIDX      PANLEN=PANIDX + 1    BEND    FOR PANY = 0 TO 49      EDMA 0,PANLEN,$41000+PANY*118+PANSRCIDX,$FF80000+PANY*80+PANDESTIDX    NEXT PANY    SLEEP .02    GOSUB POLLPLAY  NEXT PANIDX  RETURN.LOADPALETTE'------------  #DECLARE LOC=$40FA0  FOR K = 0 TO 31    POKE $D100+K,PEEK(LOC):LOC=LOC+1    POKE $D200+K,PEEK(LOC):LOC=LOC+1    POKE $D300+K,PEEK(LOC):LOC=LOC+1  NEXT K  RETURN'========.BASLOGO'========  GOSUB POLLPLAY  GOSUB FADETOWHITE  GOSUB DRAWLOGO  GOSUB FADETODEFAULTS  GOSUB CYCLEALTPALETTELOOP  GOSUB FADETOBLACK  RETURN.CYCLEALTPALETTELOOP'----------------------  FOR M = 0 TO 32*4    GOSUB CYCLEALTPALETTE    GOSUB POLLPLAY    GOSUB ANIMDRAWSUBTEXT    SLEEP .04  NEXT M  RETURN.ANIMDRAWSUBTEXT'-----------------  IF M = 40 THEN BEGIN    SUBTEXTIDX = 1    PLEN = 0    EDMA 3,80,32,$800+80*24  BEND  IF PLEN < LEN(SUBTEXT$(SUBTEXTIDX)) THEN BEGIN    PLEN = PLEN + 1    RAINBOWSTR$=LEFT$(SUBTEXT$(SUBTEXTIDX),PLEN)    IF SUBTEXTIDX = 0 THEN RAINBOWX = 36:ELSE RAINBOWX = 21    RAINBOWY = 24    GOSUB PRINTRAINBOWSTR  BEND  RETURN.PRINTRAINBOWSTR  #DECLARE RAINIDX  CURSOR RAINBOWX, RAINBOWY  FOR RAINIDX=1 TO LEN(RAINBOWSTR$)    FOREGROUND MOD(RAINIDX-1,16)+16    PRINT MID$(RAINBOWSTR$,RAINIDX,	1);  NEXT RAINIDX  RETURN.CYCLEALTPALETTE'-----------------  #DECLARE TEMPR, TEMPG, TEMPB  TEMPR = PEEK($D100+16)  TEMPG = PEEK($D200+16)  TEMPB = PEEK($D300+16)  FOR K = 16 TO 30    POKE $D100+K, PEEK($D100+K+1)    POKE $D200+K, PEEK($D20
0+K+1)    POKE $D300+K, PEEK($D300+K+1)  NEXT K  POKE $D100+31, TEMPR  POKE $D200+31, TEMPG  POKE $D300+31, TEMPB  RETURN.DRAWLOGO'---------  BACKGROUND 1  BORDER 1  EDMA 0, 2000, $40000, $800  EDMA 0, 2000, $407D0, $FF80000  RETURN.FADETOWHITE'-------------  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTOWHITE    SLEEP .05  NEXT FADEVAL  RETURN.FADETOBLACK'-------------  GOSUB STORECURRCOLOURS  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTOBLACK    SLEEP .05  NEXT FADEVAL  RETURN.FADETODEFAULTS'----------------  GOSUB STORECURRCOLOURS  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTODEFAULTS    SLEEP .05  NEXT FADEVAL  RETURN'====.INIT'====  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $FD  ^^BLOAD "INTRO.DAT",P($40000),R  ' $4,0000 +------------------+ .  '         !  LOGO CHARS   !  ' $4,070 +..................+  '         !  LOGO COLORS  !  ' $4,00 +..................+  '         ! 32 X   !  ' $4,1000 +..................+  '         !  COLORS     !  ' $4,270 +..................+  '         !  FRAMES   !  ' $4,54 +------------------+  GOSUB INITMUSIC  GOSUB STOREDEFAULTCOLOURS  RETURN.STOREDEFAULTCOLOURS'---------------------  FOR K = 0 TO 31    DEFAULTRED(K)=PEEK($D100+K)    DEFAULTGREEN(K)=PEEK($D200+K)    DEFAULTBLUE(K)=PEEK($D300+K)  NEXT K  RETURN.STORECURRCOLOURS'------------------  FOR K = 0 TO 31    CURRRED(K)=PEEK($D100+K)    CURRGREEN(K)=PEEK($D200+K)    CURRBLUE(K)=PEEK($D300+K)  NEXT K  RETURN.FADECOLOURSTOWHITE'---------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    POKE $D100+K, DEFAULTRED(K) + (15 - DEFAULTRED(K)) * TEMPVAL    POKE $D200+K, DEFAULTGREEN(K) + (15 - DEFAULTGREEN(K)) * TEMPVAL    POKE $D300+K, DEFAULTBLUE(K) + (15 - DEFAULTBLUE(K)) * TEMPVAL  NEXT K  RETURN.FADECOLOURSTODEFAULTS'------------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    POKE $D100+K, CURRRED(K) + (DEFAULTRED(K)-CURRRED(K)) * TEMPVAL    POKE $D200+K, CURRGREEN(K) + (DEFAULTGREEN(K)-CURRGREEN(K)) * TEMPVAL    POKE $D300+K, CURRBLUE(K) + (DEFAULTBLUE(K)-CURRBLUE(K)) * TEMPVAL  NEXT K  RETURN.FADECOLOURSTOBLACK'---------------------  TEMPVAL = (16-FADEVAL) / 16  FOR K = 0 TO 31    POKE $D100+K, CURRRED(K) * TEMPVAL    POKE $D200+K, CURRGREEN(K) * TEMPVAL    POKE $D300+K, CURRBLUE(K) * TEMPVAL  NEXT K  RETURN'==========.INITMUSIC'==========  PLAY  BARINDEX=0  MAPBARTOCHUNK(0)=0  MAPBARTOCHUNK(1)=1  MAPBARTOCHUNK(2)=1  MAPBARTOCHUNK(3)=2  MAPBARTOCHUNK(4)=3  FILTER 1,100,1  FILTER 2,100,1  ENVELOPE 2,3,3,3,10,0  ENVELOPE 4,9,4,9,8  ENVELOPE 7,0,9,9,0,2,1100  ENVELOPE 8,0,12,3,5,2,1100  ENVELOPE 9,0,10,3,5,2,1100  ' *** VOICE1 - GUITAR1 ***  ' ------------------------  V1$(0)="T2O6M2 QDIR QC.R QDIR QC.R QDIR QC.R QDIR QC.R"  V1$(1)="T2O6M2 QDIR QC.R QDIR QC.R P9A IR QAIR P0IDP9O5A O5IAO6DA Q.G IDO5A IBO6DG Q.A IGD O5BO6EG Q.A IGE O5IBO6DG Q.A IGD  O5BO6EGQA IG#FE "  V1$(2)="T2O6M2 QDIR QC.R QDIR QC.R  IDDFQ.DIFD O5Q.#AHO6CIR O5#AQ#AO6HCIR IDDFHDIR  DDFQ.DIFD O5Q.#AHO6CIR O5#AQ#AO6HCIR O5Q.A O6HE IR  V1$(3)="T2O6M2 IGG#GHGIR O5Q.G O6HD IR AA#AHA IR A O6D #F QE I#F QD  Q.#F.EDO6.G.#FE O5G I#A O6 QE O5I#A O6QE QDIR QC.R QDIR QC.R  V1$(3)=V1$(3)+"O6Q.G.#FE O5G I#A O6QE O5I#A O6QE QDIR QC.R QDIR QC.R QDIR QC.R QDIR QC.R"  ' *** VOICE2 - GUITAR2 ***  ' ------------------------  V2$(0)="T2O5M4 QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R"  V2$(1)="T2O5M4 QAIR Q#G.R QAIR Q#G.R  O5 Q.#C .D O6I#FD O5D#FAO6Q.D IO5A#F  EGBO6Q.E O5IBG EAO6#CQ.E I#CO5A EGBO6Q.E O5IBG EAO6#CQE ID#CD"  V2$(2)="T2O5M4 QAIR Q#G.R QAIR Q#G.R  IAAO6CO5Q.AIGA Q.FHG IR IFQF HG IR IAAO6CO5HA IR  AAO6CO5Q.AIGA Q.FHG IRFQF HG IR Q.E .A O6E "  V2$(3)="T2O5M4 IGG#G HG IR Q.D HG IR DDGHD IR DDAQGIAQD Q.A.G#F .#A .A G  O5QEIGQ#AIG#AO6C QAIR Q#G.R QAIR Q#G.R Q.#A .A G O5QEIGQ#AIG#AO6C"  V2$(3)=V2$(3)+"QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R"  ' *** VOICE3 - BASS ***  ' ---------------------  V3$(0)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A   O2ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(1)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD QR IR O1A T8 O2Q.#CQD IDE#F Q.#F O1A IA O2Q#C O1Q.E E IEBG Q.A A IA O2QC Q.E E IE O1 QB Q.A A O2IE QA"  V3$(2)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(2)=V3$(2)+"T9O2IDDDDDDDD O1#A#A#A#A#A#A#A#A #A#A#A#A#A#A#A#A O2DDFQDIDDDDDDDDDDD O1#A#A#A#A#A#A#A#A #A#A#A T8O2QCICCC O1Q.AAIAAA"  V3$(3)="O2Q.DDIDDD O1Q.GGI#AA#A Q.#A#AI#AQ#A Q.AAIAQA O2Q.DDIO1GO2QD Q.EEIEQE O1Q.AAIAQA T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(3)=V3$(3)+"O2Q.EEIEQE O1Q.AAIAQA T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A  T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  ' *** VOICE4 - MELODY ***  ' -----------------------  V4$(0)=""  V4$(1)="T4O5P0 QR M2ID M4QD P5 M1O4#G H.A IAQA   O5Q.E H#F IR #F#FA QG IG#F W M5 .G P9M2O4IA O5I.B.A SG#F AGABAB QG O4IAB O5H#F SG#F Q.E.D"  V4$(2)="O5T4P7WDHRQ.RICP5O5IDDFQ.GIFDQ.FSEDHCIFFAQGIFDSCP2H.DP5I.RICDDFQ.GIFD Q.F SED HC IFFAQGIFD IGP1H.A P7IRA"  V4$(3)="T4 IO6DD#DQDICO5#AH.#AQ.R IAA#AQAIAGP1WAP7IR"  V4$(3)=V4$(3)+"HRI#FGAQ.GI#FG#FHERIR DHDRR IR#FGAQ.GI#FG#FHERIR DHD"  RETURN'---------.POLLPLAY'---------  IF RPLAY(1) THEN RETURN  MUSICCHUNKINDEX=MAPBARTOCHUNK(BARINDEX)    PLAY V1$(MUSICCHUNKINDEX),V3$(MUSICCHUNKINDEX),V4$(MUSICCHUNKINDEX)  SLEEP .05  PLAY ,,,V2$(MUSICCHUNKINDEX),V3$(MUSICCHUNKINDE _X),V4$(MUSICCHUNKINDEX)  BARINDEX=BARINDEX+1  IF BARINDEX=5 THEN BARINDEX=1  RETURN                                                                                                                                                                !LARE  = $D06E  #DECLARE ǯ7 = $D05D#DECLARE K, A$'----.MAIN'----  GOSUB INIT  GET KEY A$  GOSUB DEINIT  END'----.INIT'----  POKE $D021,9  ' ENFORCE SPRITES INTO 5 AND 16 BIT TURNED ON  POKE , 5+12"8  WPOKE , 0  ' TURN ON ALL SPRITES  FOR K = 0 TO 4    SPRITE K, 1    MOVSPR K, 64*K+24, 50  NEXT K  POKE 64, 255  POKE , 255  POKE , 200  RETURN'-------.DEINIT'-------  FOR K = 0 TO 4    SPRITE K, 0  NEX T K    RETURN                                                                                                                                                                                                                                               $----------------.SCROLLCANVASLEFT'------------------  IF OFFS>0 THEN OFFS=OFFS-1:ELSE RETURN  FOR YY = 0 TO 49    EDMA Я+ԯ+ï, _           79, $40800 + YY*80 + 78, $40800 + YY*80 + 79    POKE $40800 + YY*80, 32   NEXT YY  RETU%-----------------.SCROLLCANVASLEFT'------------------  IF OFFS>0 THEN OFFS=OFFS-1:ELSE RETURN  FOR YY = 0 TO 49    EDMA Я+ԯ+ï, _           79, $40800 + YY*80 + 78, $40800 + YY*80 + 79    POKE $40800 + YY*80, 32   NEXT YY  RET&LARE  = $D06E  #DECLARE ǯ7 = $D05D#DECLARE K, A$'----.MAIN'----  GOSUB INIT  GET KEY A$  GOSUB DEINIT  END'----.INIT'----  POKE $D021,9  ' ENFORCE SPRITES INTO 5 AND 16 BIT TURNED ON  POKE , 5+12'8  WPOKE , 0  ' TURN ON ALL SPRITES  FOR K = 0 TO 4    SPRITE K, 1    MOVSPR K, 64*K+22, 50  NEXT K  POKE 64, 255  POKE , 255  POKE , 200  RETURN'-------.DEINIT'-------  FOR K = 0 TO 4    SPRITE K, 0  NEX T K    RETURN                                                                                                                                                                                                                                               UNT'=============.PETSCIISTORY'=============  GOSUB SWITCHTO80X25MODE  GOSUB RESTORESCREENPOINTER  PALETTE RESTORE  BACKGROUND 0:BORDER 0  PRINT CHR$(147);  GOSUB INITPETSCIIFRAMES  GOSUB INITANIMS  #DECLARE TSTART, TIME, ACTION, ACTANIM=-1, ACTPAINTING  #DECLARE ACTSTR$, ACTX, ACTY, ACTDUR, ACTREACTION  #DECLARE ACTTIMER  TSTART = TI  READ TIME  ACTION = -1  DO WHILE ACTION <>     ' TIME TO SWITCH TO NEXT ACTION?    IF (TI-TSTART) >= TIME THEN BEGIN      IF ACTION =  THEN GOSUB CLEARTXTTALK      READ ACTION      ACTTIMER=0      IF ACTION =  THEN READ ACTSTR$, ACTX, ACTY      IF ACTION =  THEN READ ACTSTR$, ACTDUR      IF ACTION =  THEN GOSUB CLEARTEXT      IF ACTION =  THEN READ ACTANIM:ANIMIDX=0:ANIMREPEATCOUNT=0      IF ACTION =  THEN READ ACTPAINTING:GOSUB DRAWPAINTING      IF ACTION =  THEN READ ACTSTR$, ACTREACTION, ACTDUR:GOSUB INITREACTION      IF ACTION =  THEN PRINT "";      IF ACTION =  THEN READ FRAMEIDX:GOSUB DRAWPETSCIIFRAME      IF ACTION =  THEN EXIT      TSTART = TI      READ TIME ' TIME FOR NEXT ACTION    BEND    IF ACTION =  THEN GOSUB DRAWTXTGREY    IF ACTION =  THEN GOSUB DRAWTXTTALK    IF ACTION =  THEN GOSUB DRAWREACTION    GOSUB POLLPLAY    GOSUB POLLANIM  LOOP    RETURN#DEFINE 1 = -1#DEFINE 2 = -2#DEFINE 3 = -3#DEFINE  = -10#DEFINE  = -1#DEFINE į = -999#DEFINE ̯ = -1000#DECLARE FRAMESTART.POLLANIM'---------  IF ACTANIM = -1 THEN RETURN  IF FRAMEDUR > 0 AND (TI - FRAMESTART) < FRAMEDUR THEN RETURN  FRAMEDUR = 0  'CURSOR 0,1:PRINT "POLLANIM";  'CURSOR 0,2:PRINT "ACTANIM=";ACTANIM;  'CURSOR 0,3:PRINT "ANIMIDX=";ANIMIDX;  AVAL = ANIMS(ACTANIM,ANIMIDX)  ANIMIDX = ANIMIDX + 1'PRINT "                     ANIMIDX=";ANIMIDX;  FOUND = 0  IF AVAL = 1 THEN FOUND=1:MARK(1)=ANIMIDX  IF AVAL = 2 THEN FOUND=1:MARK(2)=ANIMIDX  IF AV	AL = 3 THEN FOUND=1:MARK(3)=ANIMIDX  IF AVAL =  THEN BEGIN    FOUND=1    ' GET MARK NUMBER (IN AVAL)    GMARKNUM = ABS(ANIMS(ACTANIM,ANIMIDX))    ANIMIDX = ANIMIDX + 1    GCOUNT = ANIMS(ACTANIM,ANIMIDX)    ANIMIDX = ANIMIDX + 1    BAIL
=0    IF ANIMREPEATCOUNT = 0 THEN BEGIN      IF GCOUNT <> -1 THEN ANIMREPEATCOUNT = GCOUNT      ANIMIDX = MARK(GMARKNUM)      BAIL=1    BEND          IF BAIL=0 AND ANIMREPEATCOUNT > 0 THEN BEGIN      ANIMREPEATCOUNT = ANIMREPEATCOUNT -1      IF ANIMREPEATCOUNT = 0 THEN BAIL=1      IF BAIL=0 THEN ANIMIDX=MARK(GMARKNUM)      BAIL=1    BEND    'IF BAIL=0 AND ANIMREPEATCOUNT =  THEN BEGIN    '  ANIMIDX=MARK(GMARKNUM)    '  BAIL=1    'BEND  BEND  IF AVAL = į THEN BEGIN    FOUND = 1    ACTANIM = -1  BEND  'CURSOR 0,8:PRINT "FOUND = ";FOUND;  IF FOUND = 0 THEN BEGIN ' WE'RE DRAWING A PETSCII FRAME NOW?    FRAMEIDX = AVAL    'CURSOR 0,5:PRINT "DRAW FRAMEIDX=";FRAMEIDX;    'INPUT AVAL    GOSUB DRAWPETSCIIFRAME    FRAMEDUR = ANIMS(ACTANIM,ANIMIDX)    ANIMIDX = ANIMIDX + 1    FRAMESTART = TI  BEND  RETURN.CLEARTEXT'-----------  EDMA 3,80,32,$800  RETURN.DRAWTXTGREY'-------------  IF ACTTIMER = -1 THEN RETURN  SLEEP .05  CURSOR ACTX + ACTTIMER, ACTY  PRINT "";MID$(ACTSTR$,1+ACTTIMER,1);  ACTTIMER = ACTTIMER + 1  IF ACTTIMER >= LEN(ACTSTR$) THEN ACTTIMER = -1  RETURN.DRAWTXTTALK'-------------  IF ACTTIMER = -1 THEN RETURN  SLEEP .05  ACTX=(80-LEN(ACTSTR$))/2+7  ACTY=1  CURSOR ACTX + ACTTIMER, ACTY  PRINT "";MID$(ACTSTR$,1+ACTTIMER,1);  ACTTIMER = ACTTIMER + 1  IF ACTTIMER >= LEN(ACTSTR$) THEN ACTTIMER = -1  IF MOD(ACTTIMER,2) = 0 THEN FRAMEIDX=ͯί:ELSE FRAMEIDX=ͯů  GOSUB DRAWPETSCIIFRAME  RETURN.CLEARTXTTALK'--------------  CURSOR 0,1:PRINT CHR$(27);"Q";  RETURN.DRAWPETSCIIFRAME'------------------  DATAADDR = FRAMEADDR(FRAMEIDX)  FRMX = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMY = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMW = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMH = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  #DECLARE YY, SCRADDR,CLRADDR  SCRADDR = $800 + FRMX + FRMY * 80  CLRADDR = $1F800 + FRMX + FRMY * 80  CDATAADDR = DATAADDR + FRMW * FRMH  FOR YY=FRMY TO FRMY1    EDMA 0, FRMW, DATAADDR, SCRADDR    EDMA 0, FRMW, CDATAADDR, CLRADDR    DATAADDR = DATAADDR + FRMW    CDATAADDR = CDATAADDR + FRMW    SCRADDR = SCRADDR + 80    CLRADDR = CLRADDR + 80    NEXT YY  RETURN.INITREACTION'-------------  PRINT "";  FRAMEIDX = ͯ:GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯԯ1:GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯԯ2:GOSUB DRAWPETSCIIFRAME  RETURN.DRAWREACTION'-------------  ACTTIMER = ACTTIMER + 1  SLEEP .1  IF MOD(ACTTIMER,2) = 0 THEN FRAMEIDX=ͯ˯:ELSE FRAMEIDX=ͯү  GOSUB DRAWPETSCIIFRAME  IF ACTTIMER > 10 THEN ACTION = :ACTTIMER = 0  RETURN.DRAWPAINTING'-------------  PRINT "";  FRAMEIDX = ͯ  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ1 + ACTPAINTING - 1  GOSUB DRAWPETSCIIFRAME  RETURN#DECLARE RVAL, AIDX, VIDX#DECLARE TEST$.INITANIMS'----------  AIDX = 0  VIDX = 0  DO    READ RVAL    ' PRINT RVAL;", ";    IF RVAL = ̯ӯ THEN EXIT    ANIMS(AIDX,VIDX) = RVAL    VIDX = VIDX + 1    IF RVAL = į THEN AIDX=AIDX+1:VIDX=0  LOOP  RETURN.ANIMS'-----  ' ͯ  DATA ͯ,   .3, _       ͯͯ1, .3, _       ͯͯ2, .3, _       ͯͯ3, .3    ' RAISE ARM TO CHIN  DATA 1  DATA ͯͯ4, .5, _       ͯͯ3, .5, _       ͯͯ4, .5, _       ͯͯ3, .5    ' SCRATCH CHIN  DATA ͯů, 0 , _       ͯͯ4,     .5, _       ͯͯ3,     .5, _       ͯͯ4,     .5, _       ͯͯ3,     .5    ' CLOSE EYES & SCRATCH CHIN  DATA ͯů, .2    ' NORMAL FACE  DATA , 1,   DATA į  ' ͯ  DATA ͯί, 0 , _       ͯͯ1, 1     ' GAPING MOUTH AND FINGER POINT UP  DATA ͯů,.2, _       ͯͯ2,  .2, _       ͯͯ3,  .2, _       ͯͯ4,  .2, _       ͯͯ1, .2, _       ͯͯ2, .2 ' GET BRUSH  DATA 1  DATA ͯů, .1  DATA 2  DATA ͯͯ3, .1, _       ͯͯ4, .1  DATA , 2,   5  DATA ͯů,  .5  DATA 3  DATA ͯͯ3, .1, _       ͯͯ4, .1  DATA , 3,   5  DATA , 1,   DATA į  ' ͯ  DATA ͯͯ2, .25, _       ͯͯ1, .25, _       ͯί, .5, _       ͯͯ5, .25, _       ͯͯ6, .25, _       ͯԯ1, .25, _       ͯԯ2, .25  DATA 1  DATA ͯů, .1, _       ͯӯ, .1, _       , 1, 5  DATA į  ' ͯ  DATA ͯͯ, .2, _       ͯ1, .1, _       ͯ2, .1, _       ͯ3, .1, _       ͯ4, .1, _       ͯ5, .1, _       ͯ6, .1, _       ͯ7, .1, _       ͯ8, .1, _       ͯ9, .1, _       ͯ10, .1, _       ͯ11, .1  DATA į  DATA ̯ӯ.STORYDATA'----------                  '      TIMEDELTA  ACTION       TEXT                            X   Y  DUR(SEC)  ' ONNY: ATTEMPT #1  DATA 0,        ,        ͯ  DATA 2,        ,     "HERE'S SONNY...",              4,  0  DATA 1.5,      ,     "A STRUGGLING ARTIST...",       22, 0  DATA 1.7,      ,     "SEARCHING FOR INSPIRATION...", 47, 0  DATA 2,          DATA .5,       ,     "HMM... WHAT TO DRAW TODAY...",        3  DATA 2,        ,         ͯ  DATA 1.5,      ,     "I KNOW!",                             2  DATA 1,          DATA 3,        ,        ͯ  DATA 4,        ,    1  DATA 2,        ,    "BLECH!",                       1,     2  DATA !2,        ,        ͯ  DATA 1.5,        DATA .,        ,     "TRY AGAIN SONNY...",           34, 12  DATA 2,        ' ONNY: ATTEMPT #2  DATA .,        ,        ͯ  DATA 2,        ,        ͯ  DATA 1.5",      ,     "AHA!",                             2  DATA 1,          DATA 3,        ,        ͯ  DATA 4,        ,    2  DATA 2,        ,    "YUCK!",                       1,     2  DATA 2,        ,       # ͯ  DATA 1.5,        DATA .,        ,     "DON'T GIVE UP SONNY!",           32, 12  DATA 2,          ' ONNY: ATTEMPT #3  DATA .,        ,        ͯ  DATA 2,        ,        ͯ  DATA 1.5,      ,   $  "I GOT IT!",                             2  DATA 1,          DATA 3,        ,        ͯ  DATA 4,        ,    3  DATA 2,        ,    "EWW!",                       1,     2  DATA 2,        ,        ͯ  DAT%A 1.5,      ,     ͯį  DATA .,        ,     "AWW... POOR SONNY...",           32, 0  DATA 2,          DATA .1,       ,     "GUYS LIKE ME SHOULDN'T DREAM ANYWAY...", 3.5  DATA 3.5,      ,     ͯį & DATA 1,          DATA .5,       ,     "...AND WITH THAT, SONNY'S DREAMS BLEW AWAY WITH THE WIND...", 10, 12  DATA 3.5,        DATA 1,       '=====.ENDER'=====  GOSUB SWITCHTO80X25MODE  GOSUB RESTORESCREENPOINTER  PALET'TE RESTORE  RETURN'============.XANADUTITLE'============  PRINT CHR$(147);  BACKGROUND 0  BORDER 0  ' FILL SCREEN WITH BLACK INVERTED SPACES  EDMA 3,4000,0,$FF80000  EDMA 3,4000,160,$48000      GOSUB LOADPALETTE  GOSUB SWITCHTO80X50MO DE  GOSUB SETSCREENPOINTER  GOSUB PANTITLE  RETURN.SWITCHTO80X50MODE'--------------------  BANK 128  SETBIT ǯ7, 7  POKE $D031, $E8 ' 640, , , 400  RETURN.SWITCHTO80X25MODE'--------------------  BANK 128  POKE $D031CQC T2P0IEP5G#F Q.R P0T7I#D P7S#DD#DE#FE#FGHG"  V2$(7)="T7P0M1O3QDO2#F QAA IO3ECEQDIDDD O3QDO2#F QAA IO3ECEQDIDDD EE#F#F Q.EIEEEEE"  V3$(7)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  V4$(7)="T0M4O4P0IDP8SCDICSO3BO4C QO3BIO4CQC O5T2P0IGP5BA QRR T0M4O4P0IDP8SCDICSO3BO4C QO3BIO4CQC O5T2P0IGP5BA Q.R O4P0T0I#DP9S#DD#DE#FE#FGHGR"  V5$(7)="T7P0M1O3QAD EE IGEG Q#F I#F#F#F QAD EE IGEG Q#F I#F#F#F GGAA Q.B IBBBBB"  V6$(7)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  ' *** I'M ALIVE! CHORUS2 ***  ' -------------------------  V1$(8)="T7M5O5P0QAA P3HB QBBO6H.#C O51QBQ.BIR QP0BB P3H.O6#CP1O5QBQ.BIR"  V2$(8)="T7P0M1O3QDDHG QEE SARARARARARARARAR ERERERERERERERER ARARARARARARARAR ERERERER"  V3$(8)="T3O2 IBRBR BRRR BRBR O1S GRGRGRGRGRGRGRGRGRGRGRGRGRGRGRGR GRGRGRGRGRGRGRGRGRGRGRGR"  V4$(8)="T7M5O6P0QDD HD QEE RO5EP9O6EID#CO5HB P0O6QEE RO5EP9O6EID#CO5HB"  V5$(8)="T7P0M1O3QAAO4HD O3QBB O4SERERERERERERERER O3BRBRBRBRBRBRBRBR O4ERERERERERERERER O3BRBRBRBR"  V6$(8)="T3O2 IBRBR BRRR BRBR O1S GRGRGRGRGRGRGRGRGRGRGRGRGRGRGRGR GRGRGRGRGRGRGRGRGRGRGRGR"  ' *** IM ALIVE! VERSE PITCH SHIFT ***  ' -----------------------------------  V1$(9)="T7M5O5QP0AA ARIRP7 #F#G QAIAQA#G#F H#F S#FE#F#G#F#G HEIR"  V2$(9)="T7P0M1O2QGO3D O2QAAIAQAIO3D O2Q#F#FI#FQ#FIB QDDIDQDI#F QEE"  V3$(9)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR"  V4$(9)="T7M5O6QP0GP9S#FD#FG QERIR T0O6P0#FP8#G QAIAQA#G#F H#F S#FE#F#G#F#G HEIR"  V5$(9)="T7P0M1O3QDA EEIEQEIA O3Q#C#CI#CQ#CI#F O2 QAAIAQAIO3#C O2QBB"  V6$(9)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR"  ' *** SEEMS LIKE FOREVER ***  V1$(10)="T7M5O5QP0IEP5SDEIDS#CO5D Q#CIO5DQD T2P0I#FP5A#G QRR T7M5O5P0IEP5SDEIDS#CD Q#CIO5DQD T2P0I#FP5A#G Q.R P0T7IF P7SFEF#F#G#F#GAHAR"  V2$(10)="T7P0M1O3QEO2#G QBB IO3#FD#FQEIEEE O3QEO2#G QBB IO3#FD#FQEIEEE #F#F#G#G Q.#FI#F#F#F#F#F"  V3$(10)="T3O2 IBRBR O1GR O2	GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  V4$(10)="T0M4O4P0IEP8SDEIDS#CD Q#CIO4DQD O5T2P0IAP5O6#CO5B QRR T0M4O4P0IEP8SDEIDS#CD Q#CIO4DQD O5T2P0IAP5O6#CO5B Q.R O4P0T0IFP9SFEF#F#G#F#GAHAR"  V5$(10)="T7P0M1O
3QBE #F#F IA#FA Q#G I#G#G#G QBE #F#F IA#FA Q#G I#G#G#G AABB QO4.#C I#C#C#C#C#C"  V6$(10)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  ' *** IM ALIVE CHORUS3 ***  V1$(11)="T7M5O5P0QBB P3HO6#C O5IBO6#CDH#CIR O5QBB P3HO6#C O5IBO6#CDH#CIR O5QBB HO6#C O5IBO6#CDH#CIR SP9O5BABO6#CO5BO6#CO5AB"  V2$(11)="T7P0M1O3QEE SAEAEAEAE #GE#GE#GE#GE #FE#FE#FE#FE EBEBEBEB SAEAEAEAE#GE#GE#GE#GE#FE#FE#FE#FE EBEBEBEB SAEAEAEAE#GE#GE#GE#GE#FE#FE#FE#FE EBEBEBEB"  V3$(11)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR"  V4$(11)="T7M5O5P0Q#G#G P3HA I#GABHAIR Q#G#GHA I#GABHAIR Q#G#GHA I#GABHAIR P9S#G#F#GA#F#GE#F"  V5$(11)="QT6O4EE O5IP0AE#CO4A O5BE#CO4A O6#CO5E#CO4A O6EO5B#GE O5IP0AE#CO4A O5BE#CO4A O6#CO5E#CO4A O6EO5B#GE"  V5$(11)=V5$(11)+"O5SP0AE#CEAE#CE BE#CEBE#CE O6#CO5E#CEO6#CO5E#CE O6EO5B#GBO6EO5B#GB"  V6$(11)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR"  ' *** FINAL INTERLUDE INTRO ***  V1$(12)="T8M5O5P0 H.#FIRS#F#F Q.GSGGIGSRIGSRIG":V1$(12)=V1$(12)+V1$(12)+V1$(12):V1$(12)=V1$(12)+"H.#FIRS#F#F Q.GSGGIFSRIFSRIF"  V2$(12)="T8O3H.DIRSDD Q.DSDDO2IASRIASRIA O3H.DIRSDD Q.DSDDIDSRIDSRID H.DIRSDD Q.DSDDO2IASRIASRIA H.DIRSDD Q.DSDD O2I#GSRI#GSRI#G"  V3$(12)="T3O2 QBRRIRSBB Q.BSBBIDSRIDSRID QBRRIRSBB Q.BSBBIDSRIDSRID O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR IDSRIDSRID"  V4$(12)="M0P0T7O1H.DIRSDD Q.DSDDIDSRIDSRID":V4$(12)=V4$(12)+V4$(12)+V4$(12):V4$(12)=V4$(12)+"H.DIRSDD Q.DSDD I#GSRI#GSRI#G"  V5$(12)="T8O3H.AIRSAA Q.ASAAIDSRIDSRID H.AIRSAA Q.ASAAIASRIASRIA H.AIRSAA Q.ASAAIDSRIDSRID H.AIRSAA Q.ASAA I#CSRI#CSRI#C"  V6$(12)="T3O2 QBRRIRSBB Q.BSBBIDSRIDSRID QBRRIRSBB Q.BSBBIDSRIDSRID O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR IDSRIDSRID"  ' *** FINAL INTERLUDE 1 ***  V1$(13)="O5T8W.E QO6IDP5SRI#CSR O5IB H.A IRB WB WE O6H#C O5A WG R"  V2$(13)="T6O2 IAAAAAAAA AAAAAAAA EEEEEEEE EEEE T8QGB T6IAAAAAAAA AAAAAAAA EEEEEEEE EEEE T8QGB"  V3$(13)="T3O2I O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR BRBR":V3$(13)=V3$(13)+V3$(13)  V4$(13)="O4T8W.E QO5IDP5SRI#CSR O4IB H.A IRB WB WE O5H#C O4A WG R"  V5$(13)="T6O3 IEEEEEEEE EEEEEEEE O2BBBBBBBB BBBBO3 T8QD#F T6IO3EEEEEEEE EEEEEEEE O2BBBBBBBB BBBBO3 T8QD#F"  V6$(13)="T3O2I O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR BRBR":V6$(13)=V6$(13)+V6$(13)  ' *** FINAL INTERLUDE 2 ***  V1$(14)="O6T8W.#C Q#CIO5BO6#C HD IREF HEIR"  V2$(14)="T7M0O2 SARARARARARARARAR ARARARARARARARAR #AR#AR#AR#AR#AR#AR#AR#AR T8Q.EIEQEE"  V3$(14)="T3I O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR BRR BBRBR"  V4$(14)="O5T8W.#C Q#CIO4BO5#C HD IREF HEIR"  V5$(14)="T7M0P0O3 SERERERERERERERER ERERERERERERERER FRFRFRFRFRFRFRFR T8O2 Q.BIBQBB"  V6$(14)="T3I O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR O1GR O2GR O1GG O2GR BRR BBRBR"  ' *** FINAL IM ALIVE CHORUS ***  V1$(15)="T7M5O5P0 QBB P3O6H.#C O5QBQ.BIR QP0BB P3H.O6#CP1O5QBQ.BIR QP0BB P3H.O6#CP1O5QBQ.BIR QP0BB T1O6HC"  V2$(15)="SO2AO3AO2AO3AO2AO3AO2AO3A O2AO3AO2AO3AO2AO3AO2AO3A O2Q.E IEQEE":V2$(15)="T7P0M1O2QEE"+V2$(15)+V2$(15)+V2$(15)+"P1T1HF"  V3$(15)="T3I O2BRBR O1GR O2GR O1GG O2GR BRRB BRBR O1GR O2GR O1GG O2GR BRRB BRBR O1GR O2GR O1GG O2GR BRRB BRBR O1HG"  V4$(15)="P0T7O5Q#G#G P2H.A Q#GQ.#GIR Q#G#G H.A Q#GQ.#GIR Q#G#G H.A Q#GQ.#GIR Q#G#G T1 P1SFHO2F"  V5$(15)="QT6O4EE O5IP0AE#CO4A O5IP0AE#CO4A O5B#GEO4B O5B#GEO4B O5IP0AE#CO4A O5IP0AE#CO4A O5B#GEO4B O5B#GEO4B"  V5$(15)=V5$(15)+"O5SP0AE#CEAE#CE AE#CEAE#CE B#GE#GB#GE#G B#GE#GB#GE#G O5T1SEP1O2HE"  V6$(15)="T3I O2BRBR O1GR O2GR O1GG O2GR BRRB BRBR O1GR O2GR O1GG O2GR BRRB BRBR O1GR O2GR O1GG O2GR BRRB BRBR O1HG"#ENDIF  RETURN'---------.POLLPLAY'---------  IF RPLAY(1) THEN RETURN  IF BARINDEX>22 THEN RETURN  MUSICCHUNKINDEX=MAPBARTOCHUNK(BARINDEX)    PLAY V1$(MUSICCHUNKINDEX),V2$(MUSICCHUNKINDEX),V3$(MUSICCHUNKINDEX)  SLEEP .02  PLAY ,,,V g4$(MUSICCHUNKINDEX),V5$(MUSICCHUNKINDEX),V6$(MUSICCHUNKINDEX)  BARINDEX=BARINDEX+1  RETURN                                                                                                                                                        #OUTPUT "XANADU-BASIC65"'============.DECLARATIONS'============  ' MUSIC RELATED VARS  ' ------------------  #DECLARE MUSICCHUNKINDEX     ' OLD T  #DECLARE BARINDEX             ' OLD TT  #DECLARE MAPBARTOCHUNK(10)  ' OLD M()  #DECLARE V1$(4), V2$(4), V3$(4), V4$(4)  ' PALETTE  ' -------  #DECLARE DEFAULTRED(32)  #DECLARE DEFAULTGREEN(32)  #DECLARE DEFAULTBLUE(32)  #DECLARE CURRRED(32)  #DECLARE CURRGREEN(32)  #DECLARE CURRBLUE(32)  #DECLARE FADEVAL, TEMPVAL  ' /  ' ---  #DEFINE ǯ7 = $D05D  #DEFINE  = $D060  #DEFINE  = $D062  ' MISC  ' ----  #DECLARE K,M,N  #DECLARE RAINBOWSTR$  #DECLARE RAINBOWX, RAINBOWY  #DECLARE PLEN=0  #DECLARE SUBTEXT$(2)  #DECLARE SUBTEXTIDX = 0  SUBTEXT$(0) = "PRESENTS..."  SUBTEXT$(1) = "A TRIBUTE TO THE LATE OLIVIA NEWTON JOHN..."  #DECLARE PANIDX = 0  #DECLARE PANSRCIDX  #DECLARE PANDESTIDX  #DECLARE PANY, PANLEN  ' PETSCII  ' -------  #DECLARE DATAADDR = $4270C  #DECLARE MAXFRAMES  #DECLARE FRAMEADDR(64)  #DECLARE FRMIDX = 0  #DECLARE FRMW, FRMH#DECLARE ANIMS(4,100) ' ANIMIDX, ANIMDATA#DECLARE AVAL,MARK(3),GMARKNUM,GCOUNT,BAIL,FOUND,FRAMEIDX,FRAMEDUR=0#DECLARE FRMX, FRMY, FRMX1, FRMY1, CDATAADDR#DEFINE ͯ  = 0#DEFINE ͯͯ1 = 1#DEFINE ͯͯ2 = 2#DEFINE ͯͯ3 = 3#DEFINE ͯͯ4 = 4#DEFINE ͯͯ1 = 5#DEFINE ͯͯ2 = 6#DEFINE ͯͯ3 = 7#DEFINE ͯͯ4 = 8#DEFINE ͯů = 9#DEFINE ͯί != 10#DEFINE ͯů = 11#DEFINE ͯͯ1 = 12#DEFINE ͯͯ2 = 13#DEFINE ͯͯ3 = 14#DEFINE ͯͯ4 = 15#DEFINE ͯί = 16#DEFINE ͯͯ5 = 17#DEFINE ͯͯ6 = 18#DEFINE ͯԯ"1 = 19#DEFINE ͯԯ2 = 20#DEFINE ͯ˯ = 21#DEFINE ͯů = 22#DEFINE ͯӯ = 23#DEFINE ͯү = 24#DEFINE ͯį = 25#DEFINE ͯͯ = 26#DEFINE ͯ1 = 27#DEFINE ͯ2 = 28#D#EFINE ͯ3 = 29#DEFINE ͯ4 = 30#DEFINE ͯ5 = 31#DEFINE ͯ6 = 32#DEFINE ͯ7 = 33#DEFINE ͯ8 = 34#DEFINE ͯ9 = 35#DEFINE ͯ10 = 36#DEFINE ͯ11 = 37#DEFINE ͯ = 38#DEFINE ͯ1 = 39#DEFIN$E ͯ2 = 40#DEFINE ͯ3 = 41#DEFINE ͯ = 42'====.MAIN'====  GOSUB INIT  GOSUB BASLOGO  GOSUB XANADUTITLE  GOSUB PETSCIISTORY  GOSUB ENDER  ' BACKUP PALETTE TO $48000  EDMA 0, $300, $FFD3100, $48000   ' SET ALL %COLOURS TO BLACK  EDMA 3, $300, 0, $FFD3100   ': DELETE  IF PEEK($D020)<>0 THEN BORDER 2:GOSUB INITPETSCIIFRAMES  FRAMEIDX=ͯ  GOSUB DRAWPETSCIIFRAME  CLR  DLOAD "BIGSPRITE"  END' ACTION NAMES#DEFINE =0#DEFINE &=1#DEFINE =2#DEFINE =3#DEFINE =4#DEFINE =5#DEFINE =6#DEFINE =7#DEFINE =8' ANIMATIONS#DEFINE ͯ=0#DEFINE ͯ=1#DEFINE ͯ=2#DEFINE ͯ=3.INITPETSCIIFRAMES'---------------'----  MAXFRAMES = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  DO WHILE FRMIDX < MAXFRAMES    FRAMEADDR(FRMIDX) = DATAADDR    DATAADDR = DATAADDR + 2    FRMW = PEEK(DATAADDR)    DATAADDR = DATAADDR + 1    FRMH = PEEK(DATAADDR)    DAT AADDR = DATAADDR + 1    DATAADDR = DATAADDR + FRMW * FRMH * 2    ':PRINT CHR$(147);"FRMIDX=";FRMIDX    'FRAMEIDX=FRMIDX    'GOSUB DRAWPETSCIIFRAME    'GETKEY TEST2$    FRMIDX = FRMIDX + 1  LOOP  RETURN#DECLARE ANIMIDX, ANIMREPEATCO	TER=0:GOSUB STORECURRCOLOURS:MUSESTATE=0  RETURN.HIGHLIGHTCURRMUSE'-------------------    FADEVAL = DEFCOLVAL    K = MUSECLR(CURRMUSE)    STARTCOL = K:ENDCOL = K    GOSUB FADECOLOURSTOWHITE    DEFCOLVAL = DEFCOLVAL + DEFCOLDIR    IF D	EFCOLVAL = 16 THEN DEFCOLDIR=-2    IF DEFCOLVAL = 0 THEN DEFCOLDIR=2:COUNTER=COUNTER+1    IF COUNTER = 3 AND DEFCOLVAL = 14 AND DEFCOLDIR=-2 THEN BEGIN      STATE=STATE+1      COUNTER=0      PALETTE RESTORE      FADEVAL=0      GOSUB SAVESCREEN  	    GOSUB STORECURRCOLOURS    BEND    RETURN.FADECOLOURSTOWHITE'---------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = STARTCOL TO ENDCOL    POKE $D100+K, DEFAULTRED(K) + (15 - DEFAULTRED(K)) * TEMPVAL    POKE $D	200+K, DEFAULTGREEN(K) + (15 - DEFAULTGREEN(K)) * TEMPVAL    POKE $D300+K, DEFAULTBLUE(K) + (15 - DEFAULTBLUE(K)) * TEMPVAL  NEXT K  RETURN  .CYCLECOLOURS'-------------  TEMPR = PEEK($D100+STARTCOL)  TEMPG = PEEK($D200+STARTCOL)  TEMPB = P	EEK($D300+STARTCOL)  FOR K = STARTCOL TO ENDCOL    POKE $D100+K, PEEK($D100+K+1)    POKE $D200+K, PEEK($D200+K+1)    POKE $D300+K, PEEK($D300+K+1)  NEXT K  POKE $D100+ENDCOL, TEMPR  POKE $D200+ENDCOL, TEMPG  POKE $D300+ENDCOL, TEMPB  RETURN	.P1ENDER'--------  RETURN'==========================.P7BIGOLIVIAWITHSPRITES'==========================  GOSUB P7INIT  GOSUB P7LOOP  GOSUB P7ENDER  RETURN'----.P7INIT'----  POKE 53275,0  ' SWITCH TO 80X50  BANK 128  SETBIT 	ǯ7, 7  POKE $D031, $E8 ' 1110 1000 = 640,,,400  ' MOVE  TO BANK4 - $8000  WPOKE , $8000  POKE ,$04  ' LET ALL SPRITES BE 64 BITS WIDE  POKE 64, 255  ' LET ALL SPRITES BE 64 BITS HIGH  POKE 	, 255  POKE , 64  ' $4,0000 +------------------+  '         !  (8 WORDS) !  ' $4,0040 +------------------+ <-- SPRPTR $1001  '         ! .         !  '         ! ========         !  '         ! #1 - FRAME 0 !  ' $4,0240 +.		.................+ <-- SPRPTR $1001 + 8  '         ! #1 FRAMES1-5 !  ' $4,040 +..................+ <-- SPRPTR $1001 + 8*6  '         ! #2 FRAMES0-5 !  ' $4,140 +..................+ <-- SPRPTR $1001 + 8*12  '         ! #3 TO #8    !  	
' $4,6040 +..................+  '         ! 32 X   !  ' $4,60 +..................+  '         ! OLI - FRAME 0    !  ' $4,740 +------------------+  '         ! .        !  '         ! =========        !  '         !  - FRA	ME 0  !  ' $4,780 +..................+  '         !  - FRAME 1  !  ' $4,70 +..................+  '         !  FRM 2-12   !  ' $4,780 +------------------+  ' $4,8000 +------------------+  '         !   80X50 !  ' $4,80 +-	-----------------+  ' $5,0000 +------------------+  '         ! .          !  ' $5,00 +------------------+  ' ENFORCE SPRITES INTO 4 AND 16 BIT TURNED ON  POKE , 4+128             WPOKE , 0  ' BLACK OUT PALET	TE  EDMA 3, $300, 0, $FFD3100  ' CLEAR 80X50 CHARS AND COLOUR RAM  EDMA 3, 4000, 160, $48000  EDMA 3, 4000, 6, $FF80000  ' FOR IDX=0 TO 3999:POKE $48000+IDX,160:POKE $FF80000+IDX,6:NEXT IDX  ' SWITCH PALETTE  #DECLARE RED,GREEN,BLUE  LOC=$46040	  FOR IDX=0 TO 31    RED=PEEK(LOC):LOC=LOC+1    GREEN=PEEK(LOC):LOC=LOC+1    BLUE=PEEK(LOC):LOC=LOC+1    ' PRINT "R=";RED;", G=";GREEN;", B=";BLUE    POKE $D100+IDX,RED    POKE $D200+IDX,GREEN    POKE $D300+IDX,BLUE  NEXT IDX  FOR K = 0 TO 7 	   MOVSPR K, 0#0  NEXT K          ' DISPLAY SPRITE  #DECLARE SPRCLR,OFFX  SPRCLR = 30  OFFX=25  SPRITE 0,1,SPRCLR  MOVSPR 0,0+OFFX,50  SPRITE 1,1,SPRCLR  MOVSPR 1,85+OFFX,50  SPRITE 2,1,SPRCLR  MOVSPR 2,171+OFFX,50  SPRITE 3,1,SPRCLR  MOVSP	R 3,256+OFFX,50  SPRITE 4,1,SPRCLR  MOVSPR 4,0+OFFX+8,180  SPRITE 5,1,SPRCLR  MOVSPR 5,85+OFFX+8,180  SPRITE 6,1,SPRCLR  MOVSPR 6,171+OFFX,180  SPRITE 7,1,SPRCLR  MOVSPR 7,256+OFFX,180  ' POINT SPRITE0 TO $4040  BANK 4  FOR K=0 TO 14 STEP 2	    WPOKE K, $1001+8*(3*K)  NEXT K  ' SET BACKGROUND, BORDER  BACKGROUND 6  BORDER 14  IDX = 0  ^^OI=0:OD=0  COUNTER = 0  RETURN/----.P7LOOP'----  ' SELECT SPRITE FRAME  BANK 4  FOR K=0 TO 7    WPOKE K*2, $1001+8*(IDX+6*K)  NEXT K 	 GOSUB DRAWOLIVIA  GOSUB POLLPLAY  SLEEP .3  IDX=IDX+1  IF IDX=6 THEN IDX=0  COUNTER = COUNTER + 1  IF COUNTER < 30 THEN GOTO P7LOOP  RETURN'-----.P7ENDER'-----  FOR IDX = 0 TO 7    SPRITE IDX,0  NEXT IDX  ' SWITCH TO 80X25  BANK 1	28  POKE $D031, $E0 ' 1110 0000 = 640,,  ' RESTORE  TO BANK 0 - $0800  WPOKE , $0800  POKE , 0  PALETTE RESTORE  PLAY  PRINT "";  BOOT'----------.DRAWOLIVIA'----------  #DECLARE X,Y,Z,BVAL,OLIDX  ^^IF 	OI=0 THEN LO=$460A0  ^^IF OI>0 THEN LO=$50000+4000*(OI-1)  LOC=$46CA0 ' FIRST OLIVIA FRAME  ^^EDMA 0,4000,LO,$FF80000  ^^IF OD = 0 THEN OI = OI + 1:IF OI > 8 THEN OD = 1:OI=8  ^^IF OD = 1 THEN OI = OI - 1:IF OI < 1 THEN OD = 0  RETURN'========	==.INITMUSIC'==========  PLAY  TEMPO 17  BARINDEX=0  MAPBARTOCHUNK(0)=0  MAPBARTOCHUNK(1)=0  MAPBARTOCHUNK(2)=1  MAPBARTOCHUNK(3)=2  MAPBARTOCHUNK(4)=2  MAPBARTOCHUNK(5)=3  MAPBARTOCHUNK(6)=4  MAPBARTOCHUNK(7)=2  M	APBARTOCHUNK(8)=2  MAPBARTOCHUNK(9)=3  MAPBARTOCHUNK(10)=4  MAPBARTOCHUNK(11)=5  MAPBARTOCHUNK(12)=6  MAPBARTOCHUNK(13)=7  MAPBARTOCHUNK(14)=8  MAPBARTOCHUNK(15)=9  MAPBARTOCHUNK(16)=9  MAPBARTOCHUNK(17)=10  MAPBA	RTOCHUNK(18)=11  MAPBARTOCHUNK(19)=12  MAPBARTOCHUNK(20)=13  MAPBARTOCHUNK(21)=14  MAPBARTOCHUNK(22)=15  ENVELOPE 8,0,12,3,7  ENVELOPE 1,0,9,9,12,2,2048  ' *** INTRO WAILING ***  ' ---------------------  V1$(0)="O5T4M9WFFFHF"  V	2$(0)="O3T5M0SP0CP1O5RCRCRCRCRCRCRCR P0O5CRP1O3CRCRCRCRCRCRCR P0O4GR P1O2GRGRGRGRGRGRGR P0O4ER P1O2ERERER"  V3$(0)="M1P0T6O1IFE#DEFD#DEFE#DEFE#DEFE#DEFE#DEFE#DE"  V4$(0)="O5T4M9W#F#F#FH#F"  V5$(0)="O3T5M0SP0#CP1O5R#CR#CR#CR#CR#CR#CR#CR P0O5#CRP1O3#CR#	CR#CR#CR#CR#CR#CR P0O4#GR P1O2#GR#GR#GR#GR#GR#GR#GR P0O4#ER P1O2#ER#ER#ER"  V6$(0)="M1T9O6SEGEG#D#F#D#FDFDF#CE#CE FAFAE#GE#G#DG#DGD#FD#F GBGB#F#A#F#AFAFAE#GE#G FA#F#AFA#F#A"  ' *** FIRST RIFF ***  ' ------------------  V1$(1)="T7P0M1O2QFO3C O2IGGGGG	GGGGGGG O2QFO3C O2IGGGGGGGGGGGG"  V2$(1)="T9 P0O6 QFE SGR P2O2GRGRGRGRGRGRGRGRGRGRGR":V2$(1)=V2$(1)+V2$(1)  V3$(1)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR"  V4$(1)="T7P0M1QO3CG IDDDDDDDDDDDD QO3CG IDDDDDDDDDDDD"  	V5$(1)="T9 P0O5QAG SBR P1O1BRBRBRBRBRBRBRBRBRBRBR":V5$(1)=V5$(1)+V5$(1)  V6$(1)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR"  ' REM *** I'M ALIVE! ***  ' ---------------------  V1$(2)="T7M5O5QP0GG GRIRP7 E#F QGIGQG#F	E HE SEDE#FE#F HDIR"  V2$(2)="T7P0M1O2QFO3C O2QGGIGQGIO3C O2QEEIEQEIA QCCICQCIE QDD"  V3$(2)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR"  V4$(2)="T7M5O6QP0FP9SEDEF QDRIR T0O6P0EP8#F QGIGQG#FE HE SEDE#FE#F HDIR"  V5$(	2)="T7P0M1O3QCG DDIDQDIG O2QBBIBQBO3IE O2 QGGIGQGIB QAA"  V6$(2)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR"#IFDEF   ' *** SEEMS LIKE FOREVER ***  V1$(3)="T7M5O5QP0IDP5SCDICSO4BO5C QO4BIO5CQC T2P0IEP5G#F QRR	 T7M5O5P0IDP5SCDICSO4BO5C QO4BIO5CQC T2P0IEP5G#F Q.R P0T7I#D P7S#DD#DE#FE#FGHGR"  V2$(3)="T7P0M1O3QDO2#F QAA IO3ECEQDIDDD O3QDO2#F QAA IO3ECEQDIDDD EE#F#F Q.EIEEEEE"  V3$(3)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O	1GR O2GR O1GG O2GR O1GG O2GR"  V4$(3)="T0M4O4P0IDP8SCDICSO3BO4C QO3BIO4CQC O5T2P0IGP5BA QRR T0M4O4P0IDP8SCDICSO3BO4C QO3BIO4CQC O5T2P0IGP5BA Q.R O4P0T0I#DP9S#DD#DE#FE#FGHGR"  V5$(3)="T7P0M1O3QAD EE IGEG Q#F I#F#F#F QAD EE IGEG Q#F I#F#F#F GGAA Q.B IBBB	 BB"  V6$(3)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  ' *** IM ALIVE (CHORUS1) ***  ' --------------------------  V1$(4)="T7M5O5P0QAA P3H.BP1QAQ.AIR QP0AA P3H.BP1QAQ.AIR"  V2$(4)="T	!7P0M1O3QDDIGGGGGGGG DDDDDDDD GGGGGGGG DDDD"  V3$(4)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  V4$(4)="T7M5O6P0QDDWDQDR DDWDQDR"  V5$(4)="T7P0M1O3QAA O4IDDDDDDDD O3IAAAAAAAA O4DDDDDDDD 	"O3IAAAA"  V6$(4)="T3O2 IBRBR O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR O1GR O2GR O1GG O2GR O1GG O2GR"  ' *** I'M ALIVECLOSE(CHORUS2 ENDING) ***  ' --------------------------------------  V1$(5)="T7M5O5P0QAA HBIAB O6CO5HBIRSAP9	#GABABGA W.G"  V2$(5)="T7P0M1O3QDD GG#F#FEEDDW.C"  V3$(5)="T3O2 IBRBR O1GR GR O2 GR O1 GR GR GR O2 GR O1 GR T0O2P0S#CR O5P1 #CR#CR#CR#CR#CR#CR#CR#CR#CR#CR#CR"  V4$(5)="T7M5O5P0Q#F#F HGI#FGAHGIRS#FP9E#FG#FGE#F W.C"  V5$(5)="T7P0M1O3QAA O4DDCCO3BBAAW.G"	$  V6$(5)="T3O2 IBRBR O1GR GR O2 GR O1 GR GR GR O2 GR O1 GR T0O2P0SCR O5P1 CRCRCRCRCRCRCRCRCRCRCR"  ' *** INSTRUMENTAL ***  ' --------------------  V1$(6)="T7M5P5O5 QRR R Q.G IED O4QB IO5DEG P0SDO4BO5DEDO4BIP9G O4IEGGEQGIE QBO5IDDO4BO5QDE P9O5R Q.GIE	%DQESGEGEIGBO6DO5SP0BAIG"  V1$(6)=V1$(6)+"O5QP9IBP0SGBO6IDO5SBO6D SP0G#FDO5B O6#FDO5BG P9IBO6CDO5IB"  V2$(6)="T7P0M1O2QFO3C O2QGGIGQGIO3C O2QEEIEQEIA O1QAAIAQAIO2E QDD  FO3C O2QGGIGQGIO3C O2QEEIEQEIA O1QAAIAQAIO2E QDD"  V3$(6)="P0T3O2 IBRBR O1GR O2GR O	&1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR":V3$(6)=V3$(6)+V3$(6)  V4$(6)="QRRT2P0SO6B#F#AFAE#G#DGD#F#CFCEO5BO6#DO5#AO6DO5AO6#CO5#GO6CO5GB#F#AFAE#GDO3SCRP2T7O6CRCRCRCRCRCRCRCRCRCRCRCRCRGRGR"  V4$(6)=V4$(6)+"T6O6P0SDP6O5CO3P9CO2CO5P0SBP6O5CO3P	'9CO2CO5P0SGP6O5CO3P9O1CCO5P0SGP6O5CO3P9O1CC"  V4$(6)=V4$(6)+"O4P0GRP1O2CRCRCRCRCRCRCRT0O5P0SEGEGF#GF#G#FA#FAGBGBT7O6SGP3O2WC"  V5$(6)="T7P0M1O3QCG DDIDQDIG O2QBBIBQBO3IE QEEIEQEIG Q#F#F  CG DDIDQDIG O2QBBIBQBO3IE QEEIEQEIG Q#F#F"  V6$(6)="P0T3O2 IBRBR  O1GR O2GR O1GG O2GR O1GR O2GR BRBR O1GR O2GR O1GG O2GR O1GR O2GR":V6$(6)=V6$(6)+V6$(6)  ' *** SUDDENLY CAME THE DAWN ***  ' ------------------------------  V1$(7)="T7M5O5QP0IDP5SCDICSO4BO5C QO4BIO5CQC T2P0IEP5G#F QRR T7M5O5P0IDP5SCDICSO4BO5C QO4BIO5
BLOAD "OLI.DAT",P($50000),R  ' DISABLE ANY 64-BIT WIDE SPRITES  POKE 64, 0  ' ALL SPRITES NORMAL HEIGHT  POKE , 0  ' ENFORCE SPRITES INTO 4 AND 16 BIT TURNED ON  POKE , 4+128  WPOKE , 0  ' PREPARE ALL
 SPRITE  FOR K = 0 TO 7    SPRITEFRAMEIDX(K) = INT(RND(1)*13)    SPRITEX(K) = 30+40*K    SPRITEY(K) = INT(RND(1)*5)*5    SPRITE K, 1, 15    MOVSPR K, 0#0    MOVSPR K, SPRITEX(K), SPRITEY(K)    WPOKE ($40000+K*2), $11F1 + SPRITEFRAMEIDX(K)
  NEXT K  FADEVAL = 0  RETURN.STORECURRCOLOURS'------------------  FOR K = 0 TO 31    CURRRED(K)=PEEK($D100+K)    CURRGREEN(K)=PEEK($D200+K)    CURRBLUE(K)=PEEK($D300+K)  NEXT K  RETURN.P1LOOP'-------  ' DROP PAPER SPRITES DOWN  I
F STATE < 4 AND MUSESTATE=0 THEN BEGIN    FOR K = 0 TO 7      IF INT(RND(1)*3) = 0 THEN BEGIN        SPRITEFRAMEIDX(K) = MOD(SPRITEFRAMEIDX(K)+1,13)      BEND      IF SPRITEY(K) < 247 THEN BEGIN        SPRITEY(K) = SPRITEY(K) + INT(RND(1)*3
)        SPRITEX(K) = SPRITEX(K) + INT(RND(1)*5)-2        MOVSPR K, SPRITEX(K), SPRITEY(K)        WPOKE ($40000+K*2), $11F1 + SPRITEFRAMEIDX(K)      BEND    NEXT K  BEND  GOSUB POLLPLAY  SLEEP .025  ' FADE IN TO GREY  ' ---------------
  IF STATE = 0 THEN BEGIN    IF MOD(COUNTER,5)=0 THEN BEGIN      GOSUB FADECOLOURSTOGREY      FADEVAL = FADEVAL + 1      IF FADEVAL > 16 THEN STATE = STATE + 1:FADEVAL = 0:GOSUB STORECURRCOLOURS:COUNTER=0    BEND    COUNTER = COUNTER + 1  BE
ND  ' EBB-FADE TO COLOURS FOR DEFAULT PALETTE  ' ---------------------------------------  IF STATE = 1 THEN BEGIN    FADEVAL = DEFCOLVAL    STARTCOL = 0:ENDCOL = 15    IF COUNTER > 3 THEN ENDCOL = 31    GOSUB FADECOLOURSTODEFAULTS    DEFCOLVA
L = DEFCOLVAL + DEFCOLDIR    IF DEFCOLVAL = 16 THEN DEFCOLDIR=-1    IF DEFCOLVAL = 0 THEN DEFCOLDIR=1:COUNTER=COUNTER+1    IF COUNTER = 6 AND DEFCOLVAL = 15 AND DEFCOLDIR=-1 THEN STATE=STATE+1:COUNTER=0  BEND  ' COLOUR-CYCLE MUSES  ' -------------
	-----  IF STATE = 2 THEN BEGIN    DIST = DIST + VEL    IF DIST >= 1 THEN BEGIN      DIST = DIST - 1      COUNTER = COUNTER + 1      STARTCOL = 16:ENDCOL = 31      GOSUB CYCLECOLOURS      IF COUNTER > 16*2 THEN VEL=VEL*.93      IF COUNTER = 16*3

-1 THEN STATE = 3:PALETTE RESTORE:COUNTER=0:DEFCOLVAL=0:DEFCOLDIR=2    BEND  BEND  IF STATE = 3 THEN GOSUB HIGHLIGHTCURRMUSE  IF STATE = 4 THEN GOSUB FADEOUT  IF STATE = 5 THEN GOSUB FADEOUT  ' BAIL OUT TO OLIVIA?  IF STATE = 5 AND CURRMU
SE = 8 AND MUSESTATE=0 THEN RETURN  IF STATE = 6 THEN GOSUB FOCUSMUSE  ' GET A$:IF A$="" THEN GOTO P1LOOP  GOTO P1LOOP.FOCUSMUSE'----------  IF MUSESTATE = 0 THEN BEGIN    GOSUB INITMUSESPRITES    MUSESTATE=1    COUNTER = 0    PRIN
T "";    RETURN  BEND  IF MUSESTATE = 1 THEN BEGIN    FADEVAL=COUNTER    GOSUB FADECOLOURSTODEFAULTS    IF COUNTER=16 THEN COUNTER=0:MUSESTATE=2  BEND  IF MUSESTATE = 2 THEN GOSUB SHOWTHANKS  IF MUSESTATE = 3 THEN BEGIN    FADEVAL=CO
UNTER    'PRINT "";CHR$(27);"Q";FADEVAL;:GETKEY S$    STARTCOL=0:ENDCOL=31:GOSUB FADECOLOURSTOBLACK    IF COUNTER = 16 THEN COUNTER=0:MUSESTATE = 4  BEND  IF MUSESTATE = 4 THEN BEGIN    'PRINT "";CHR$(27);"Q MUSESTATE=4";FADEVAL;:GETKEY S$
    FOR K = 0 TO 7:SPRITE K,0:SPRACTIVE(K)=0:NEXT K    BANK 128    GOSUB RESTORESCREEN    CURRMUSE = CURRMUSE + 1    MUSESTATE = 5    GOSUB STORECURRCOLOURS    COUNTER = 0  BEND  IF MUSESTATE = 5 THEN BEGIN    FADEVAL=COUNTER    START
COL=0:ENDCOL=31:GOSUB FADECOLOURSTODEFAULTS    IF COUNTER=16 THEN BEGIN      MUSESTATE = 6      COUNTER = 0      STATE = 2:DIST = 0:VEL = 1    BEND  BEND  IF MUSESTATE > 0 AND MUSESTATE < 4 AND STATE=6 THEN BEGIN    GOSUB ANIMMUSESPRITES
  BEND    COUNTER = COUNTER + 1  RETURN.DRAWCLRTEXT'-------------  CURSOR SX+COUNTER,SY:COLOR MOD(COUNTER,16)+16:PRINT MID$(S$,1+COUNTER,1);  IF COUNTER = LEN(S$) THEN COUNTER = -1  RETURN.SHOWTHANKS'-----------  POKE 53275, 255  IF TH
ANKSTATE = 0 AND COUNTER > 5 THEN THANKSTATE = 1:COUNTER=0  IF THANKSTATE = 1 THEN BEGIN    S$=THANK1$(0):SX=1:SY=0:GOSUB DRAWCLRTEXT    IF COUNTER <> -1 THEN COUNTER=COUNTER+1:GOSUB DRAWCLRTEXT    IF COUNTER = -1 THEN THANKSTATE = 2:THANKID
X=1  BEND  ' PAUSE  IF THANKSTATE = 2 AND COUNTER > 5 THEN BEGIN    THANKSTATE = 3:COUNTER = 0  BEND  ' DRAW NEXT NAME  IF THANKSTATE = 3 THEN BEGIN    IF THANKIDX < 16 THEN BEGIN      S$=THANK1$(THANKIDX)      IF MOD(THANKIDX,2) = 1 THEN
 SX=10-LEN(S$)/2:ELSE SX=70-LEN(S$)/2      SY = INT((THANKIDX-1) / 2)*3 + 3      GOSUB DRAWCLRTEXT      IF COUNTER <> -1 THEN COUNTER=COUNTER+1:GOSUB DRAWCLRTEXT    BEND    IF COUNTER = -1 OR THANKIDX=16 THEN BEGIN      THANKIDX = THANKIDX 
+ 1      IF THANKIDX > 16 THEN BEGIN        THANKSTATE = 4        MUSESTATE=3        COUNTER=0        PALETTE RESTORE        GOSUB STORECURRCOLOURS      BEND:ELSE THANKSTATE = 2    BEND  BEND  ' 2ND PAGE OF THANKS  IF CURRMUSE >= 1 AND
 CURRMUSE <=4 THEN GOSUB THANKS2  ' 3RD PAGE OF THANKS  IF CURRMUSE >=5 AND CURRMUSE <=6 THEN GOSUB THANKS3  ' 4TH PAGE OF THANKS  IF CURRMUSE = 7 THEN GOSUB THANKS4  IF THANKSTATE<>4 AND THANKSTATE<>8 THEN BEGIN    STARTCOL=16:ENDCOL=3
1:GOSUB CYCLECOLOURS  BEND  RETURN.THANKS2'--------  IF THANKSTATE = 4 AND COUNTER > 10 THEN THANKSTATE = 5:COUNTER=0  IF THANKSTATE = 5 THEN BEGIN    S$=THANK2$(0):SX=40-LEN(S$)/2:SY=0:GOSUB DRAWCLRTEXT    IF COUNTER > -1 THEN COUNTER=C
OUNTER+1:GOSUB DRAWCLRTEXT    IF COUNTER = -1 THEN THANKSTATE = 6:THANKSTARTIDX=1+(CURRMUSE-1)*4:THANKIDX=THANKSTARTIDX  BEND  ' PAUSE  IF THANKSTATE = 6 AND COUNTER > 5 THEN BEGIN    THANKSTATE = 7:COUNTER = 0  BEND#DEFINE دӯ
ү = 4  ' DRAW NEXT SHOUT OUT  IF THANKSTATE = 7 THEN BEGIN    IF THANKIDX-THANKSTARTIDX < دӯү THEN BEGIN      S$=THANK2$(THANKIDX)      SX=40-LEN(S$)/2      SY=(THANKIDX - THANKSTARTIDX) * 3 + 3      IF SY > 6 THEN S
Y = SY + 11      GOSUB DRAWCLRTEXT      IF COUNTER > -1 THEN COUNTER=COUNTER+1:GOSUB DRAWCLRTEXT    BEND    IF COUNTER = -1 OR THANKIDX-THANKSTARTIDX=دӯү THEN BEGIN      THANKIDX = THANKIDX + 1      IF THANKIDX - THANKSTA
RTIDX >= دӯү+1 THEN BEGIN        THANKSTATE = 4        IF CURRMUSE = 4 THEN THANKSTATE = 8        MUSESTATE=3        COUNTER=0        PALETTE RESTORE        GOSUB STORECURRCOLOURS      BEND:ELSE THANKSTATE = 6    BEND  BE
ND  RETURN.THANKS3'--------  IF THANKSTATE = 8 AND COUNTER > 10 THEN THANKSTATE = 9:COUNTER=0  IF THANKSTATE = 9 THEN BEGIN    S$=THANK3$(0):SX=40-LEN(S$)/2:SY=0:GOSUB DRAWCLRTEXT    IF COUNTER > -1 THEN COUNTER=COUNTER+1:GOSUB DRAWCLRTE
XT    IF COUNTER = -1 THEN THANKSTATE = 10:THANKSTARTIDX=1+(CURRMUSE-5)*30:THANKIDX=THANKSTARTIDX  BEND  ' PAUSE  IF THANKSTATE = 10 AND COUNTER > 5 THEN BEGIN    THANKSTATE = 11:COUNTER = 0    IF THANKIDX-THANKSTARTIDX >= 30 THEN BEGIN
      THANKSTATE = 12      IF CURRMUSE = 5 THEN THANKSTATE = 8      MUSESTATE = 3      COUNTER = 0      PALETTE RESTORE      GOSUB STORECURRCOLOURS      RETURN    BEND  BEND  ' DRAW NEXT NAME  IF THANKSTATE = 11 THEN BEGIN    IF THANK
IDX-THANKSTARTIDX < 30 THEN BEGIN      S$=THANK3$(THANKIDX)      FOR K = 1 TO LEN(S$)        IF MOD(THANKIDX,2) = 1 THEN SX=10-LEN(S$)/2:ELSE SX=70-LEN(S$)/2        SY = INT((THANKIDX-THANKSTARTIDX) / 2) + 5        GOSUB DRAWCLRTEXT      
  COUNTER = COUNTER + 1      NEXT K    BEND    THANKIDX = THANKIDX + 1    THANKSTATE = 10:COUNTER = 0  BEND  RETURN.THANKS4'--------  IF THANKSTATE = 12 AND COUNTER > 10 THEN THANKSTATE = 13:COUNTER=0  IF THANKSTATE = 13 THEN BEGIN   
  S$=THANK4$(0):SX=40-LEN(S$)/2:SY=0:GOSUB DRAWCLRTEXT    IF COUNTER > -1 THEN COUNTER=COUNTER+1:GOSUB DRAWCLRTEXT    IF COUNTER = -1 THEN THANKSTATE = 14:THANKIDX=1  BEND  ' PAUSE  IF THANKSTATE = 14 AND COUNTER > 5 THEN BEGIN    THANKSTATE
! = 15:COUNTER = 0  BEND  ' DRAW NEXT SHOUT OUT  IF THANKSTATE = 15 THEN BEGIN    IF THANKIDX-1 < دӯү THEN BEGIN      S$=THANK4$(THANKIDX)      SX=40-LEN(S$)/2      SY=(THANKIDX - 1) * 3 + 3      IF SY > 6 THEN SY = SY + 11  
"    GOSUB DRAWCLRTEXT      IF COUNTER > -1 THEN COUNTER=COUNTER+1:GOSUB DRAWCLRTEXT    BEND    IF COUNTER = -1 OR THANKIDX-1=دӯү THEN BEGIN      THANKIDX = THANKIDX + 1      IF THANKIDX - 1 >= دӯү+1 THEN BEGIN
#        THANKSTATE = 16        MUSESTATE=3        COUNTER=0        PALETTE RESTORE        GOSUB STORECURRCOLOURS      BEND:ELSE THANKSTATE = 14    BEND  BEND  RETURN.ANIMMUSESPRITES'-----------------  NEXTCNT = NEXTCNT + 1  IF NEX
$TCNT = 5 THEN BEGIN    NEXTCNT = 0    BANK 4      WPOKE NEXTSPR*2,$1001+8*(NEXTFRM + 6 * CURRMUSE)      WPOKE 0,WPEEK(NEXTSPR*2)    BANK 128    MOVSPR NEXTSPR, 150, 120    MOVSPR 0, 150, 120    MOVSPR NEXTSPR, SPRANGLE#1    SPRANGLE=MO
%D(SPRANGLE+10,360)    SPRITE NEXTSPR, 1, GREYS(0)    SPRITE 0, 1, 1    SPRACTIVE(NEXTSPR) = 1    NEXTSPR = MOD(NEXTSPR+5, 7)+1    NEXTFRM = MOD(NEXTFRM+1, 6)  BEND  FOR K = 1 TO 7    IF SPRACTIVE(K)>0 THEN BEGIN      SPRACTIVE(K)=SPR
&ACTIVE(K)+1      FADEVAL=SPRACTIVE(K)/10      IF FADEVAL < 3 THEN BEGIN        SPRITE K, 1, GREYS(FADEVAL)      BEND:ELSE SPRITE K, 0:SPRACTIVE(K)=0    BEND  NEXT K  RETURN.INITMUSESPRITES'-----------------  ' TURN OF ALL SPRITES  FOR K =
' 0 TO 7    SPRITE K, 0    MOVSPR K, 160, 80  NEXT K  POKE 64, 255  POKE , 255  POKE , 64  POKE , 4+128  WPOKE , 0  RETURN.SAVESCREEN  ^^EDMA 0, $7D0, $800, $48000  ^^EDMA 0, $7D0, $1F800, $49000  RETU	 RN.RESTORESCREEN  ^^EDMA 0, $7D0, $48000, $800  ^^EDMA 0, $7D0, $49000, $1F800  RETURN.FADEOUT'--------  FADEVAL = COUNTER  GOSUB FADECOLOURSTOBLACK  COUNTER = COUNTER + 1  IF COUNTER > 16 THEN STATE = STATE + 1:STARTCOL=0:ENDCOL=31:COUN#OUTPUT "BIGSPRITE"#DEFINE =1'============.DECLARATIONS'============  ' MUSIC RELATED VARS  ' ------------------  #DECLARE MUSICCHUNKINDEX     ' OLD T  #DECLARE BARINDEX             ' OLD TT  #DECLARE MAPBARTOCHUNK(25)  ' OLD M()  #DECLARE V1$(15), V2$(15), V3$(15), V4$(15), V5$(15), V6$(15)  ' PALETTE  ' -------  #DECLARE DEFAULTRED(32)  #DECLARE DEFAULTGREEN(32)  #DECLARE DEFAULTBLUE(32)  #DECLARE CURRRED(32)  #DECLARE CURRGREEN(32)  #DECLARE CURRBLUE(32)  #DECLARE FADEVAL, TEMPVAL  #DECLARE GREY  #DECLARE TEMPR, TEMPG, TEMPB  #DECLARE VEL=1,DIST=0  ' MISC  '-----  #DECLARE A$ = ""  #DECLARE IDX = 0  #DECLARE VALUE = 0  #DECLARE LOC  #DECLARE K  #DECLARE SPRITEFRAMEIDX(8)  #DECLARE SPRITEX(8)  #DECLARE SPRITEY(8)  #DECLARE STATE = 0  #DECLARE COUNTER = 0  #DECLARE DEFCOLVAL = 0, DEFCOLDIR=1, ALTCOLVAL = 0, ALTCOLDIR=1  #DECLARE STARTCOL, ENDCOL  #DECLARE CURRMUSE = 0#DECLARE THANKSTATE = 0#DECLARE THANKIDX = 0#DECLARE S$,SX,SY#DECLARE THANK1$(15)THANK1$(0)="A BIG THANK YOU TO THE CORE MEGA65 TEAM FOR ALL THEIR EFFORTS OVER THE YEARS!"THANK1$(1)="HIGHLANDER"THANK1$(2)="DEFT"THANK1$(3)="SERIOUSLY"THANK1$(4)="ADTBM"THANK1$(5)="FALK/BLUEWAYWS"THANK1$(6)="ANTTI-BRAIN"THANK1$(7)="DOUBLEFLASH"THANK1$(8)="BIT SHIFTER"THANK1$(9)="LGB"THANK1$(10)="SY2002"THANK1$(11)="TAYGER"THANK1$(12)="LYDON"THANK1$(13)="M3WP"THANK1$(14)="FERALCHILD"THANK1$(15)="INDIOCOLIFA"#DECLARE THANK2$(16)THANK2$(0)="EXTRA SHOUT OUTS TO:"THANK2$(1)="TRENZ ELECTRONICS AND THE MOULDS TEAM!"THANK2$(2)="DEATHY FOR ALL YOUR PASSION AND DEDICATION TO THE MEGA65!"THANK2$(3)="BIT SHIFTER FOR ALL THE GREAT BASIC 65 ENHANCEMENTS!"THANK2$(4)="LYDON FOR ALL YOUR EFFORTS PREPARING BATCH#2!"THANK2$ ' ---' 4.20 .DECLARES'--------  #DECLARE 64 = $D057  #DECLARE  = $D055  #DECLARE    = $D056  #DECLARE  = $D060  #DECLARE  = $D062  #DECLARE 16 = $D06E  #DECLARE  = $D06C  #DEC	(5)="SY2002, MJOERGEN AND LYDON FOR ALL THE ADDITIONAL CORES!"THANK2$(6)="DDDAAANNN FOR ALL YOUR DOCUMENTATION, TOOLING AND COMMUNITY-BUILDING!"THANK2$(7)="TAYGER FOR MEGA65CONNECT AND THE 'FILES.MEGA65.ORG' FILEHOST!"THANK2$(8)="IMPAKT FOR THE DETERM
INED AND THOROUGH MANUAL PROOF-READING!"THANK2$(9)="THECHIEF FOR YOUR EFFORTS SUPPORTING THE NEXYS BOARD!"THANK2$(10)="HOJO FOR THE AWESOME NEW FRONT COVERS YOU MADE FOR ALL OUR MANUALS!"THANK2$(11)="AMOK FOR ALL YOUR DOCUMENTATION EFFORTS!"THANK2$(12)="UBIK FOR THE AWESOME ELEVEN IDE!"THANK2$(13)="MAURICE FOR TESTING EVERY SINGLE BASIC 65 EXAMPLE IN THE MANUAL!"THANK2$(14)="RETROCOMBS, PERIFRACTIC AND RB-JEFFREY FOR YOUR AWESOME YOUTUBE VIDS!"THANK2$(15)="MINDRAIL FOR THE MACGUYVER-JTAG VIDEO!"THANK2$(16)="DEFT AND ADTBM FOR ALL YOUR 'HELLO MEGA65 COMMUNITY' VIDEOS!"#DECLARE THANK3$(60)THANK3$(0)="THANKS TO ALL THE 1ST GEN DEVELOPERS THAT MADE DEMOS, UTILITIES AND GAMES!"THANK3$(1)="ADTBM"THANK3$(2)="AIRJURI"THANK3$(3)="AKMAFIN"THANK3$(4)="AMOK"THANK3$(5)="DDDAAANNN"THANK3$(6)="DEATHY"THANK3$(7)="DEFT"THANK3$(8)="DEXTROUS"THANK3$(9)="DILLOF"THANK3$(10)="DIRK"THANK3$(11)="DOCSTER"THANK3$(12)="EGONOLSEN71"THANK3$(13)="ELCH"THANK3$(14)="ENDURION"THANK3$(15)="FERALCHILD"THANK3$ = (X+OFFS) AND 255        DIDX% = DIDX% + 1      LDATA&(DIDX%) = (X+OFFS) / 256 + REVFLAG& * $80        DIDX% = DIDX% + 1    BEND:ELSE BEGIN      LDATA&(DIDX%) = (X+OFFS) + REVFLAG& * $80        DIDX% = DIDX% + 1          BEND    LDATA&(DIDX%)= (X+OFFS) AND 255        DIDX% = DIDX% + 1      LDATA&(DIDX%) = (X+OFFS) / 256 + REVFLAG& * $80        DIDX% = DIDX% + 1    BEND:ELSE BEGIN      LDATA&(DIDX%) = (X+OFFS) + REVFLAG& * $80        DIDX% = DIDX% + 1          BEND    LDATA&(DIDX%) 			

										= Y      DIDX% = DIDX% + 1    LDATA&(DIDX%) = ASC(A$)      DIDX% = DIDX% + 1        OLDX=X : OLDY=Y : OLDOFFS=OFFS  BEND  RETURN  '------------  .RESTORECHAR'------------  IF MODIFIED% THEN BEGIN    LOC = $FF80000 + X + 80 * Y    POKE LO	  							(16)="FREDRIKR"THANK3$(17)="GEEHAF"THANK3$(18)="GEIRS"THANK3$(19)="GRIM-FANDANGO"THANK3$(20)="GRUBI"THANK3$(21)="HEATH-MAN"THANK3$(22)="HERNANDP"THANK3$(23)="HSTAMPFL"THANK3$(24)="JAMES"THANK3$(25)="JESPERGRAVGAARD"THANK3$(26)="JOHAN"THANK3$(27)="JOHNWAYNER"THANK3$(28)="KIDRA"THANK3$(29)="KITHKANAN"THANK3$(30)="KRYAN1"THANK3$(31)="LAK132"THANK3$(32)="LIQUIDDREAM"THANK3$(33)="LYDON"THANK3$(34)="M3WP"THANK3$(35)="MAJIKEYRIC"THANK3$(36)="MAURICE"THANK3$(37)="MAXICE"THANK3$(38)="MC64" = Y      DIDX% = DIDX% + 1    LDATA&(DIDX%) = ASC(A$)      DIDX% = DIDX% + 1        OLDX=X : OLDY=Y : OLDOFFS=OFFS  BEND  RETURN  '------------  .RESTORECHAR'------------  IF MODIFIED% THEN BEGIN    LOC = $FF80000 + X + 80 * Y    POKE L$OC, PEEK(LOC) XOR 32    MODIFIED% = 0    T0 = TI  BEND  RETURN'-----------.SHOWCURSOR'-----------  IF TI > T0 THEN T0 = TI + .5:ELSE RETURN  LOC = $FF80000 + X + 80 * Y  POKE LOC, PEEK(LOC) XOR 32  MODIFIED% = MODIFIED% XOR 1  RETURN'-#C, PEEK(LOC) XOR 32    MODIFIED% = 0    T0 = TI  BEND  RETURN'-----------.SHOWCURSOR'-----------  IF TI > T0 THEN T0 = TI + .5:ELSE RETURN  LOC = $FF80000 + X + 80 * Y  POKE LOC, PEEK(LOC) XOR 32  MODIFIED% = MODIFIED% XOR 1  RETURN'--									  											 				 THANK3$(39)="MIGHTYAXLE"THANK3$(40)="MR.TOAST"THANK3$(41)="MTEUFEL"THANK3$(42)="N1K0M0"THANK3$(43)="NEOMAN"THANK3$(44)="OZIPHANTOM"THANK3$(45)="RETROCOMBS"THANK3$(46)="SHALLAN50K"THANK3$(47)="SNOOPY"THANK3$(48)="STEPZ"THANK3$(49)="STIGODUMP"THANK3$(50)="SY2002"THANK3$(51)="TAYGER"THANK3$(52)="THECHIEF"THANK3$(53)="UBIK"THANK3$(54)="URBANL"THANK3$(55)="WAULOK"THANK3$(56)="WOMBAT"THANK3$(57)="ZEHA"THANK3$(58)="ZZSILA"THANK3$(59)=""THANK3$(60)=""#DECLARE THANK4$(10)THANK4$(0)="...AND SOME FINAL THANK YOUS TO:"THANK4$(1)="OLIVIA NEWTOWN JOHN, ELO AND JOHN FARRAR, FOR THE WONDERFUL MUSICAL MEMORIES!"THANK4$(2)="SYNTAX PARTY ORGANISERS FOR HOSTING THIS LOVELY EVENT!"THANK4$(3)="MY WIFE, TRAM, AND BUBBY MOANA FOR THEIR LOVE AND SACRIFICE!"THANK4$(4)="...AND THANK YOU MUM TOO, FOR ALWAYS BEING THERE FOR ME!"#DECLARE MUSESTATE = 0#DECLARE NEXTSPR = 1#DECLARE NEXTFRM = 0#DECLARE NEXTCNT = 0#DECLARE SPRACTIVE(8)#DECLARE SPRANGLE = 0#DECLARE GREYS(3)GREYS(0)=15:GREYS(1)=12:GREYS(2)=11#DECLARE MUSECLR(9)MUSECLR(0)=20MUSECLR(1)=18MUSECLR(2)=29MUSECLR(3)=26MUSECLR(4)=22MUSECLR(5)=28MUSECLR(6)=16MUSECLR(7)=31MUSECLR(8)=25#DECLARE THANKSTARTIDX  #DECLARE 64 = $D057  #DECLARE  = $D055  #DECLARE    = $D056  #DECLARE  = $D060  #DECLARE  = $D062  #DECLARE 16 = $D06E  #DECLARE  = $D06C  #DECLARE  = $D06E  #DECLARE ǯ7 = $D05D'----.MAIN'----  POKE $D63C,$F ' SELECT 8580  SID  GOSUB INITDEFAULTCOLOURS  GOSUB INITMUSIC  GOSUB P1DROPPAPERS  GOSUB P7BIGOLIVIAWITHSPRITES.INITDEFAULTCOLOURS'--------------------#DECLARE DEBUGFLAG = 0  IF PEEK($D020)<>0 AND PEEK($D020)<>2 THEN BEGIN    BORDER 0    POKE $D!018, PEEK($D018) AND $FD    EDMA 0, $300, $FFD3100, $48000    EDMA 3, $300, 0, $FFD3100    ^^BLOAD "MURAL.BIN",P($800),R    ^^BLOAD "MURAL.CLR",P($1F800),R    DEBUGFLAG = 1  BEND  FOR K = 0 TO 31    DEFAULTRED(K) = PEEK($48000+K)    DEFAULTG"REEN(K) = PEEK($48100+K)    DEFAULTBLUE(K) = PEEK($48200+K)  NEXT K  IF DEBUGFLAG=1 THEN BEGIN    ^^BLOAD "MURAL.BIN",P($48000),R    ^^BLOAD "MURAL.CLR",P($49000),R  BEND  RETURN.FADECOLOURSTOGREY'--------------------': FADEVAL = 0# TO 16  TEMPVAL = (16-FADEVAL) / 16  FOR K = 0 TO 31    GREY = (DEFAULTRED(K) + DEFAULTGREEN(K) + DEFAULTBLUE(K)) / 3    POKE $D100+K, INT(GREY + (CURRRED(K) - GREY) * TEMPVAL)    POKE $D200+K, INT(GREY + (CURRGREEN(K) - GREY) * TEMPVAL)    PO%KE $D300+K, INT(GREY + (CURRBLUE(K) - GREY) * TEMPVAL)  NEXT K  RETURN.FADECOLOURSTODEFAULTS'------------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = STARTCOL TO ENDCOL    POKE $D100+K, CURRRED(K) + (DEFAULTRED(K)%' ---' 4.20 .DECLARES'--------  #DECLARE 64 = $D057  #DECLARE  = $D055  #DECLARE    = $D056  #DECLARE  = $D060  #DECLARE  = $D062  #DECLARE 16 = $D06E  #DECLARE  = $D06C  #DEC&-CURRRED(K)) * TEMPVAL    POKE $D200+K, CURRGREEN(K) + (DEFAULTGREEN(K)-CURRGREEN(K)) * TEMPVAL    POKE $D300+K, CURRBLUE(K) + (DEFAULTBLUE(K)-CURRBLUE(K)) * TEMPVAL  NEXT K  RETURN.FADECOLOURSTOBLACK'---------------------  ': FADE'VAL=0 TO 16  TEMPVAL = (16-FADEVAL) / 16  FOR K = STARTCOL TO ENDCOL    POKE $D100+K, CURRRED(K) * TEMPVAL    POKE $D200+K, CURRGREEN(K) * TEMPVAL    POKE $D300+K, CURRBLUE(K) * TEMPVAL  NEXT K  RETURN'==============.P1DROPPAPERS'========
 ======  GOSUB P1INIT  GOSUB P1LOOP  GOSUB P1ENDER  RETURN.P1INIT'-------  ' LOAD 13 STANDARD SPRITES FOR PAPER  ^^BLOAD "PAPER.DAT",P($47C40),R  ' LOAD 64X64 SPRITE DATA  ^^BLOAD "MUSE.DAT",P($40040),R  ' LOAD OLI FRAMES TO BANK 5  ^^ TIMISED VAR NAME) Y8'    1, (SI)" REM "  VT$(TY,ID)  " = :"VN$PF$(TY)":" Y='    SISI1 YB'   ID ZL' TY ZV'                                                                                                                                    IF M >= 70 AND M < 800 THEN BEGIN    FIDX%=0    GOSUB PLAYDATAITER  ' LINE DATA  BEND  GOSUB PAGEFLIP  IF M > 850 AND M < 950 THEN FIDX%=0:GOSUB SCROLLCANVASRIGHT  IF M > 300 THEN BEGIN    FIDX%=1    GOSUB PLAYDATAITER    IF M > 2630 THEN GOSUB SCROLLCANVASRIGHT  BEND  IF MNSTATE = 0 THEN BEGIN    S$ = "N DREAMLAND..."    TXTK = 1    MNSTATE = 1  BEND  IF MNSTATE = 1 THEN BEGIN    FIDX% = 2    GOSUB ITERWRITETEXT  BEND  GOSUB ITERSTARFIELD  ' CURSOR 0,0:PRINT M  DO WHILE (TI-TSTART < .03)  LOOP  GOTO MAINLOOP  END'----.INIT'----  M = 0  BANK 0:BLOAD "ASMHELPER":BANK 128  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $FD  PRINT CHR$(27);"5";  PRINT "";  POKE $D020,0,0  FOR K = 0 TO 20    STARX%(K) = INT(RND(1)*80)*256    STARY(K) = INT(RND(1)*50)    STARVX%(K) = (RND(1)*4 + .5)*256  NEXT K  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32, $50000  EDMA 3, $FA0, 0, $51000  EDMA 3, $FA0, 32, $52000  EDMA 3, $FA0, 0, $53000  EDMA 3, $FA0, 32, $54000  EDMA 3, $FA0, 0, $55000  FNAME$ = "ANA.LN"  FIDX% = 0  VER(FIDX%) = 1  GOSUB LOADLINEFILE  FNAME$ = "SILENT.L"  FIDX% = 1  VER(FIDX%) = 2  GOSUB LOADLINEFILE  POKE $40000, $81 ' OPT = DEST ADDR  SELECTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $00 '  LSB =   WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C, $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    '  MSB (IGNORE)  WPOKE $40010, $0000 ' MODULO (IGNORE	)  GOSUB INITWRITER  ' INIT VAR INTERFACE TO ASSEMBLY  LOC = $40036  PTR = POINTER(STARX%(0))  GOSUB STOREPTR  PTR = POINTER(STARVX%(0))  GOSUB STOREPTR  RETURN'-----------.INITWRITER'-----------  TXTK = 0  WXX = 0 : WYY = 0  FN
AME$ = "ABC.LN"  FIDX% = 2  VER(FIDX%) = 3  GOSUB LOADLINEFILE  CHARCNT = 0  CHARIDX%(0) = 0  CHARWIDTH%(0) = 0  MAXWIDTH = 0  K = 0  DO WHILE K < DIDX%(FIDX%)    ' GET X VALUE    VAL& = LDATA&(FIDX%, K)    K=K+1    IF VAL& = $FF THEN BEGIN      ' KEEP AN ARRAY OF WIDTHS OF EACH LETTER      CHARWIDTH%(CHARCNT)=MAXWIDTH      ' PRINT "CHARWIDTH(";CHARCNT;") = ";MAXWIDTH      ' GET KEY Z$      MAXWIDTH = 0      CHARCNT=CHARCNT+1      ' KEEP AN ARRAY OF INDICES TO EACH DRAWN LETTER      CHARIDX%(CHARCNT) = K      'PRINT "CHARIDX%(";CHARCNT;")=";K      'GET KEY A$    BEND    IF VAL& = $FF THEN GOTO CONTLOOP    VAL& = VAL& AND $7F    IF VAL& > MAXWIDTH THEN MAXWIDTH = VAL&        K=K+1  ' SKIP Y VALUE    K=K+1  ' SKIP CHAR .CONTLOOP  LOOP  RETURN'---------------.ITERWRITETEXT'---------------  IF WCFLAG = 0 AND TXTK > 0 AND TXTK <= LEN(S$) THEN BEGIN    CHR = ASC(MID$(S$, TXTK, 1))    ' PRINT "";CHR$(27);"QCHR=";CHR;    GOSUB PETSCIITOSCREENCODE    GOSUB SCREENCODETOIDX    ' PRINT "FIXED CHR=";CHR;    ' GET KEY Z$    IF CHR=32 THEN BEGIN      WXX=WXX+7      TXTK = TXTK + 1    BEND:ELSE:BEGIN      WCFLAG = 1      WCCHR = CHR      PIDX%(FIDX%) = CHARIDX%(CHR)    BEND  BEND  IF WCFLAG = 1 THEN BEGIN    CHR = WCCHR    GOSUB ITERWRITECHAR    IF RET = 1 THEN BEGIN      WXX = WXX + CHARWIDTH%(WCCHR) + 1      TXTK = TXTK + 1      WCFLAG = 0    BEND  BEND  RETURN'----------.ITERWRITECHAR'---------------  ' ITERATE OVER CHARS IN STRING    ' DRAW CURRENT CHAR AT GIVEN X,Y POS    ' INCREMENT X,Y LOCATION  RET = 1  IF PIDX%(FIDX%) < DIDX%(FIDX%) AND LDATA&(FIDX%, PIDX%(FIDX%)) <> $FF THEN BEGIN    ' CURSOR 0,49    ' PRINT CHR$(27);"QPIDX=";PIDX%(FIDX%);"[";LDATA&(FIDX%, PIDX%);    ' PRINT LDATA&(FIDX%, PIDX%+1);LDATA&(FIDX%, PIDX%+2);    VAL& = LDATA&(FIDX%, PIDX%(FIDX%))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    X = VAL& AND $7F    IF VAL& AND $80 THEN REVFLAG&(FIDX%) = 1 : ELSE REVFLAG&(FIDX%) = 0    Y = LDATA&(FIDX%, PIDX%(FIDX%))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    A$ = CHR$(LDATA&(FIDX%, PIDX%(FIDX%)))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    DXX = WXX+X : DYY = WYY+Y : GOSUB DRAWCHAR    ' PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%(FIDX%),ASC(A$)    ' GET KEY A$    RET = 0.PDENDLOOP  BEND  RETURN'---------.STOREPTR'---------  WPOKE LOC, PTR  LOC = LOC + 2  RETURN'--------------.LOADLINEFILE'-------------- ' (FNAME$)  IF FNAME$ = "" THEN RETURN  GOSUB LINEFILEINIT  DOPEN #2,(FNAME$),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(FIDX%, DIDX%(FIDX%)) = VAL&    DIDX%(FIDX%) = DIDX%(FIDX%) + 1  LOOP  DCLOSE #2  GOSUB PLAYDATAINIT  RETURN'--------------.LINEFILEINIT'--------------  OLDX = -1 : OLDY = -1 : OLDOFFS(FIDX%) = 0  DIDX%(FIDX%) = 0  GROUPFLAG& = 0 : REVFLAG&(FIDX%) = 0  OFFS(FIDX%) = 0  RETURN'--------------.DRAWSTARFIELD'--------------  FOR K = 0 TO 20    POKE $50000 + STARX%(K)/256 + STARY(K) * 80, 46  ' DOT  NEXT K  RETURN'--------------.ITERSTARFIELD'--------------  BANK 0:SYS $7E0F:BANK 128  'FOR K = 0 TO 20  '  STARX(K) = MOD( (STARX(K)-STARVX(K)) + 80, 80)  'NEXT K  'CURSOR 0,0  'FOR K = 0 TO 20  '  PRINT INT(STARX%(K)/256), STARY(K)  'NEXT K  'GET KEY A$  RETURN'---------.PAGEFLIP'---------  VSYNC 10  BANK 0 : SYS $7E15 : BANK 128  RETURN'--------------.PLAYDATAINIT'--------------  PRINT "";  OFFS(FIDX%)=0  PIDX%(FIDX%) = 0  IF LASTFLAG = 1 THEN PIDX%(FIDX%) = LASTGROUPIDX : LASTFLAG = 0  RETURN'--------------.PLAYDATAITER'--------------  IF PIDX%(FIDX%) < DIDX%(FIDX%) THEN BEGIN    VAL& = LDATA&(FIDX%, PIDX%(FIDX%))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    IF VER(FIDX%)=3 AND VAL& = $FF THEN BEGIN      IF PIDX%(FIDX%) > LASTGROUPIDX THEN LASTGROUPIDX = PIDX%(FIDX%)      GOTO PDENDLOOP    BEND    X = VAL& AND $7F    IF VER(FIDX%)=2 THEN BEGIN      X = VAL&      VAL& = LDATA&(FIDX%, PIDX%(FIDX%))      PIDX%(FIDX%) = PIDX%(FIDX%) + 1      X = X + (VAL& AND $7F) * 256    BEND    IF VAL& AND $80 THEN REVFLAG&(FIDX%) = 1: ELSE REVFLAG&(FIDX%) = 0    Y = LDATA&(FIDX%, PIDX%(FIDX%))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    A$ = CHR$(LDATA&(FIDX%, PVAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  GOSUB PLAYDATA  RETURN'---------.SAVEFILE'---------  INPUT "SAVE NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  DELETE (FNAME$)  DOPEN #2,(FNAME$),W,U8  FOR XX = 0 TO DIDX%    PRINT #2, CHR$(LD VAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  GOSUB PLAYDATA  RETURN'---------.SAVEFILE'---------  INPUT "SAVE NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  DELETE (FNAME$)  DOPEN #2,(FNAME$),W,U8  FOR XX = 0 TO DIDX%    PRINT #2, CHR$(LIDX%(FIDX%)))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    IF VER(FIDX%)=2 THEN BEGIN      IF X-OFFS(FIDX%) > 78 THEN BEGIN        GOSUB SCROLLCANVASRIGHT        PIDX%(FIDX%) = PIDX%(FIDX%) - 4        RETURN        ' PRINT "";CHR$(27);"QOFFS=";OFFS(FIDX%);      BEND    BEND    DXX = X-OFFS(FIDX%) : DYY = Y: GOSUB DRAWCHAR    DEBUG = 0    IF DEBUG=1 THEN BEGIN      PRINT "";CHR$(27);"Q X,Y,PIDX,A$,OFFS=";X;Y;PIDX%(FIDX%),ASC(A$),OFFS(FIDX%)      GET KEY A$    BEND.PDENDLOOP  BEND  ATA&(XX));  NEXT XX    DCLOSE #2  RETURN'---------.SAVECHAR'---------  IF OLDX=X AND OLDY=Y AND OLDOFFS=OFFS AND INSTR("", A$)=0 THEN BEGIN    ' REPLACE PREVIOUS CHAR    IF VER = 2 THEN BEGIN      LDATA&(DIDX%-4) = (X+OFFS)!DATA&(XX));  NEXT XX    DCLOSE #2  RETURN'---------.SAVECHAR'---------  IF OLDX=X AND OLDY=Y AND OLDOFFS=OFFS AND INSTR("", A$)=0 THEN BEGIN    ' REPLACE PREVIOUS CHAR    IF VER = 2 THEN BEGIN      LDATA&(DIDX%-4) = (X+OFFS AND 255      LDATA&(DIDX%-3) = (X+OFFS) / 256 + REVFLAG& * $80    BEND:ELSE BEGIN      LDATA&(DIDX%-3) = X + REVFLAG& * $80    BEND    LDATA&(DIDX%-1) = ASC(A$)  BEND:ELSE:BEGIN    ' WRITE NEW CHAR    IF VER = 2 THEN BEGIN      LDATA&(DIDX%) ) AND 255      LDATA&(DIDX%-3) = (X+OFFS) / 256 + REVFLAG& * $80    BEND:ELSE BEGIN      LDATA&(DIDX%-3) = X + REVFLAG& * $80    BEND    LDATA&(DIDX%-1) = ASC(A$)  BEND:ELSE:BEGIN    ' WRITE NEW CHAR    IF VER = 2 THEN BEGIN      LDATA&(DIDX%)#' N EXPERIMENT TO DROP 5 (OR 6) SPRITES (EACH 64X200) OVER THE 320X200 SCREEN' TO ACT LIKE AN OVERLAY THAT  CAN DRAW LINES ON TOP OF' ACH SPRITE WILL CONSUME 1.6KB ($640 IN HEX)' ILL NEED A ROUTINE THAT TAKES VECTOR COORDS FOR LINES (MAYBE FROM $VART)' AND DRAWS THEM ONTO THIS MULTI-SPRITE OVERLAY#OUTPUT "SPRITELINE"' 4 EMORY USAGE' ------------------' 4.0000  0 ' 4.0640  1 ' 4.120  2 ' 4.1900  3 ' 4.140  4 ' 4.2580  5 WCCHR'-------.DEFINES'-------#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE ԯ = 32#DEFINE ï = 16'----.MAIN'----  GOSUB INIT.MAINLOOP  TSTART = TI  M = M + 1  GOSUB DRAWSTARFIELD &PRINTSS$:LOOP:S$=SS$:TR$=WH$:STOP V%     (S$,1)","  S$(S$,(S$)1) 3W%    S$SK$(SZ)"("(SR)")="S$: 3007: 9800:S$"":SZSZ1: SAFE ADD TO LI$(LN) <W%   ^W%   SM1  S$"["  SM2:SZ0 {W%   SM1  S$"]"  SM0 W%   9400: READ 'NEXT TOKEN FROM CL$ INTO S$ W% W&S$"":CL$"":NL$""::ZZ$"Z" W>& XH& --- SAFE ADD L$+S$ TO CURRENT ORNEXT LI$(LN) 2XR& (L$)(S$)((LN))159 NL1 eXW& ZZ$""  S$"":ZZ$"":: FORCE S$ TO EMPTY tX\& NL1  Xf&  LI$(LN)L$:L$S$ X p&  LN%(LN)SL: Xz&  LNLN1 : NL0 X& :   -- ADD TO L$ X&   L$""  CN0  (L$,1)":" L$L$":" Y&  L$L$S$ Y& +Y& VB   "<<"LN;S$ 1Y& EY' --- DUMP VARS VY' TY  0  3 nY$'   ID  0  EC(TY) Y.'     5000:  GET VN$ (OPARS IN KEYBOARD BUFFER 4 688,13,13: RETURN 4 4: .4 DECLARE VAR(S) IN S$ n4S$(CL$,10DF):D$",;":IB1:2100:IB0:  SPLIT PARAMETERS 4 (IB=IGNORE BRACKETS) 4NL$"" :  NEW LINE IF DIMENSIONING... 4 AC0  PE$"?DECLARE PARAMETER MISSING IN LINE "(SL):1800 5 I0  AC 25  P$AL$(I): 1030: PARSE DECLARED VAR :5 I b5  NL$"" DL0:CL$"^^"NL$: DL1 h5 5 --- PARSE DECLARED VAR 5: DI$"" : VL$"" 5: B1(P$,"("):B2(P$,")"):EQ(P$,"=") 5:  EQ0  :  --- ASSIGNMENT ,6:   VL$(P$,EQ1):P$(P$,EQ1):TR$WH$:S$P$:2050:P$S$ N6:   S$VL$:2000:2050:VL$S$ 6:    (VL$,1)"$"HX$(VL$,2):4900:VL$C$ 6:    (VL$,1)"%"BI$(VL$,2):4800:VL$C$ 6:  6:  B10  B20  :  --- DIMENSION 7:   DI$(P$,B11,B2B11) : PP$(P$,B11) ^7:   S$DI$:DZ1: 3000:DZ0:DI$S$:P$PP$:  CHECK FOR DEFINE TOKENS k7":   DL0 t7$:  7&: TY0 :  VAR TYPE 7(: T$(P$,1):  TYPE (IF ANY) IN T$ 7*:  VB  "ADDING "; 7,:  ("%&$",T$)0 T$"":TY0 8-:  DF1 TY4 8.:  T$"%" TY1 -80:  T$"$" TY2 B81:  T$"&" TY3 \82: VT$(TY,EC(TY))  P$ p84:  DI$""  86:   IDEC(TY):5000:  FETCH VARNAME IN VN$ 8<:    DF0  NL$NL$"DIM "VN$T$"("DI$"):" 8=:  8@:  VL$""  	9A:   IDEC(TY):5000 59B:    DF0  NL$NL$VN$T$"="VL$":" >9D:  ]9E:  DF1  DF$(EC(TY))VL$ {9K:  VB  P$;": ";EC(TY) 9L: EC(TY)EC(TY)1 9` 9S$(CL$,8):D$",;":2100 9 AC0  "?INVALID PARAMETERS IN LINE ";LN%(SL): *:S$AL$(0):TR$Q$:2000:2050:  TRIM QUOTES LEFT & RIGHT X: VB  "SETTING OUTPUT FILE TO "S$"" c:OF$S$ :DL1 :  DISABLE PASSTHROUGH : :: : ADD TO LABEL TABLE :: : VB  "LABEL ";CL$;" AT LINE ";LN :DL1 :LB$(LC)(CL$,2) ;LL(LC)LN1 *;LCLC1 :  INCREASE LABEL COUNT 0; R; RETURN TO EDITOR WITH ERROR v; 4 :  SET ERROR MAILBOX FLAG ; R1  (PE$): $4FF30R1,((PE$,R,1)): R ; $4FF30R1,0 ; ("FF0	9"),(SL,256): ("FF0A"),SL256 < ("FF07"),(("FF07"))2 :  SET AUTOJUMP FLAG %<& /<07210 5<: j< -- STRIP TR$ FROM BEGINNING OF STRING IN S$ -- <  (TR$,((S$,1))) <  S$(S$,2) < < <: < -- STRIP CHARCTERS IN TR$
 FROM END OF S$ -- <  (TR$,(S$,1)) =  S$(S$,(S$)1) =  =* =/: 4=4 -- PARSE ARGUMENTS -- \=5     IN: S$ = STRING, D$=DELIMITER =6    OUT: AL$(X)=ARGUMENT LIST, AC=ARGUMENT COUNT =7         AL$(0)=FIRST ARG, AL$(1)=SECOND ARG... =8 ==: =>AC0:AL$S$:AL(S$):IG0 >@ AL0 AC1: :  NO STRING />CAI031:AL$(AI)"":AI ?>H AI1  AL R>MB$(AL$,AI,1) l>N B$"("  IB1 IG1 >O B$")"  IB1 IG0 >R (D$,B$)0  IG0  >T    S$AL$(AC):TR$" ":2000:2050:AL$(AC)S$ >\    ACAC1 >f   :  ?p    AL$(AC)AL$(AC)B$ ?z   !? AI O?S$AL$(AC):TR$" ":2000:2050:AL$(AC)S$ i?S$AL$ :  RESTORE S$ o? u?: ? -- REPLACE VARS & LABELS IN SOURCE STRING -- ?    IN:   S$ = SOURCE STRING ?    OUT:  S$ = DEST STRING WITH REPLACED ITEMS @: +@ (S$,2)"^^" S$(S$,(S$)2): I@Q0:A$"":C$"":SS0:TG0 n@CX$"?<>=+-#*/^,.:;() " : D$CX$ @ II1  (S$):B$(S$,II,1) @ B$":"  Q0  SS0:RI0 @ SS  B$"("  RI0 : D$CX$ @ SS  B$")"  RI1 : D$CX$  "DPUB" A   B$Q$  : Q(Q1) KA   Q1 4000:A$A$C$:C$"":A$A$B$:B$"" RA lA Q1 A$A$B$:3200 A (D$,B$)0  A4000:A$A$C$:C$"":B$" "B$"" AA$A$B$ A : C$C$B$ A A4000 AS$A$C$ A A< 
B C$""  C$"_"  ?B (C$)0 TG0:      :  NEVER CHANGE NUMBERS ~B C$"0" C$".":        :  STUPID MS BASIC OPTIMIZATION B TG  DZ0 4500:TG0:   :  REPLACE LABEL B C$"GOTO" NL1 B C$"GOTO"  C$"GOSUB"  C$"TRAP" TG1 CDR0 :  DID REPLACE FLAG :C (C$,1)"$" HX$(C$,2):4900: aC (C$,1)"%" BI$(C$,2):4800: sCP$" "C$" " C T0  6: (RW$(T),P$)0  LC$C$: 4100: C CT$(C$,1):TY0 C T$"%" TY1 C T$"$" TY2 C T$"&" TY3 D ID0  EC(TY) ED C$VT$(TY,ID) 5000:C$VN$PF$(TY):IDEC(TY):DR1 ND ID \D DR1  D ID0  EC(4): CHECK DEFINES TABLE TOO D   C$VT$(4,ID)  C$DF$(ID): D ID DCI1 D ID0  SS1: CHECK STRUCT NAMES ,E   C$SN$(ID)   9600:CIID:IDSS1: CREATE NEW STRUCT OBJECT 5E ID ]E CI1  :  (C$)222  : PI E (DC$, LC$)0  (C$"R"  C$"P"  C$"U8"  C$"W")   EPE$"?UNRESOLVED IDENTIFIER: '"C$"' IN LINE "(SL): 1: 1800 E E: E: (F CHECK IF COMMAND TRIGGERS SHITTY SYNTAX MODE sF TODO: COMPARE UBIK'S LOGIC HERE VERSUS MY OWN 4079 LC$="DOPEN" LOGIC yF FC$MK$C$MK$ :  :  MARK LABEL FDR0 F ID0  LC1 F C$LB$(ID) C$(LL(ID)):IDLC:DR1 F ID F DR  >GPE$"?UNRESOLVED LABEL: '"C$"' IN LINE"(LN%(SI1)): 1:1800 DG ]G --- CONVERT BINARY qGBR0 :  RESULT G B0  (BI$)1 GBC$(BI$,(BI$)B,1) G BC$"1"  BC$"0" 4:("FF08"),132:4082 G BC$"1" BRBRB(B) G B HC$((BR),2) H H# *H$ --- CONVERT HEX 4H)4940 BH.VL(HX$) TH8C$((VL),2) ZH= `HB HL: 4: ("FF08"),131 :  SET ILLEGAL HEX HV4082:  JUMP INTO ERROR HANDLER H~: H GENERATE VARNAME FROM INDEX H:  I ID26 VN$(65ID) :  IN2(ID,26):N1(ID26)1 9IVN$(65N1)(65N2) xI VN$"DO"  VN$"D1": AVOID ANY BASIC TERMS AS VAR NAMES I VN$"GO"  VN$"G1" I VN$"TO"  VN$"T1" I VN$"DS"  VN$"D2" I VN$"DT"  VN$"D3" I VN$"EL"  VN$"E1" J VN$"ER"  VN$"E2" .J VN$"FN"  VN$"F1" HJ VN$"IF"  VN$"I1" NJ TJ ZJT: `JU: fJV: yJX GET FILENAME Jb: Jl 4:BA("FF00") Jv (BA0)("S")  (BA1)("K")  J  VB(("FF07"))16 K  F$"":ABA16:(A)0:F$F$((A)):AA1:: 'K   (("FF07"))1  EK   "FILENAME? "F$:""; LK `K "FILENAME";A$ K A$""  "NO FILENAME SET": K BA,("S"): BA1,("K") KR116: BA8R1,((A$,R,1)):R KF$A$ K K --- SAVE FILENAME LAD("FF30"): 4 LR016:ADR,0:R HL OF$"" TF$OF$ : TF$"ELEVEN.OUT" qLR1(TF$):ADR1,((TF$,R,1)):R wL  L* CHAIN EDITOR L4 A$: A$""   ZZ: ZZ1  ADFSDF M9"EDMA 0,$D400,$8000000,$2001:NEW RESTORE":"RUN";: LOAD '11.EDIT' FROM CACHE M> 128 LMH 208,2     :  NO OF CHARS IN KEYBOARD BUFFER gMR 688,13,13 :  RETURN mM\ M# --- COPY ATTIC RAM TO LINE BUFFER M#CB$8030000 : CCB M#NL(C)256(C1):CC2 M#CL0 M#  CLNL N#  L(C):LI$(CL)(BL$,L):P
(LI$(CL)) 4N#  B$10000(P1)256(P2):CC1 VN#   L0  ! 0,L,C,B : CCL dN#  CLCL1 jN# pN# N# --- DEFINE IN S$ EXISTS? N$SH  1 N$K0EC(4) N$ VT$(4,K)  S$  SH0 N"$K N,$ NT$ --- READ IN STRUCT DETAILS !OY$CL$(CL$,9): 9400: GET NEXT TOKEN IN S$ VO[$ S$""   "ERROR: NO STRUCT NAME FOUND": 1: gO^$SN$(SS)  S$ yOh$SV$(SS)  CL$ Om$SSSS1 Or$ O$ --- READ NEXT TOKEN FROM CL$ INTO S$ O$S$CL$: 2000: 2050:CL$S$ O$SF$" ":SF0 P$ (S$,1)Q$  SF$Q$", ":SF2 P$A(CL$,SF$) `P$ A0  S$(CL$,1,(CL$,SF$)SF1):CL$(CL$,(CL$,SF$)SF1) zP$ A0  S$CL$:CL$"" P$ P% --- READ NEXT LINE P&% 0 P0%L(CA):CL$(BL$,L):P
(CL$):CACA1 P:%B$10000(P1)256(P2) QD% L0  ! 0,L,CA,B : CACAL QN%RLRL1 ;QX%TR$WH$:S$CL$:2000:CL$S$ SQb%Q  0 :  QUOTES ON vQl%CT  0 :  CUT CHARS FROM TAIL Qv% 1 Q{% Q% --- CHECK FOR CREATION OF STRUCT OBJECT Q%CO$S$:CL$S$:ZZ1: PRESERVE ORIGINAL STRING R% 9400: READ NEXT TOKEN FROM CL$ INTO S$ $R% ZI0  SS ER%   S$SN$(ZI)  ZZZI:ZISS NR% ZI mR% ZZ1  CL$CO$:S$CO$: R% 9400:SK$S$: GET STRUCT OBJECT NAME  R%BL(SK$,"(") R% *** FOUND IT, SO MAKE DIM'S FOR EACH MEMBER VAR S%S$SV$(ZZ): 2100: PARSE ARGS INTO AL$(), AC  S%ZZ1:SZ0 0S% ZI0  AC IS%   AL$(ZI)""   jS%     "AL$(";ZI;")=";AL$(ZI) S%     BL0  S$SK$""AL$(ZI): "STRUCT!: ";S$:P$S$: 1030 T%     BL0  S$(SK$,BL1)""AL$(ZI)(SK$,BL): "STRUCT: ";S$:P$S$: 1030:SK$(SZ)P$:SZSZ1 HT%     IF NL$<>"" THEN DL=0:CL$="^^"+NL$:ELSE DL=1 QT%   ZT% ZI T%S$NL$: 9800:NL$"": SAFE ADD L$+S$ TO CURRENT LI$(LN$) T% 9400: S$"="  CL$"": T% 9400:SZ0:SR0:SM0: READ NEXT TOKEN FROM CL$ INTO S$ U%  S$"" =U%     S$"_"  SLSL1: 9500: 9717: READ NEXT LINE sU%   SM0  S$"["   "ERROR: EXPECTED [": 1: U%   SM0  S$"["  SM1: 9#)#DECLARE K#DECLARE FNAME$, VAL&#DECLARE LDATA&(2, 12288), DIDX%(2)=0, PIDX%(2)=0, FIDX%=0#DECLARE GROUPFLAG&, VAL&, REVFLAG&(2) = 0#DECLARE OFFS(2), VER(2)#DECLARE LASTFLAG, LASTGROUPIDX#DECLARE OLDX, OLDY, OLDOFFS(2), X, Y, A$, XX, YY, DXX,$ DYY, DEBUG, Z$#DECLARE WXX, WYY#DECLARE CHR, TMP#DECLARE SRCADDR, DESTADDR, LENGTH, TRANSP#DECLARE LOC, PTR, M, TSTART, ADDR#DECLARE CHARCNT, CHARIDX%(60), CHARWIDTH%(60), MAXWIDTH#DECLARE TXTK, S$, RET#DECLARE MNSTATE = 0, WCFLAG, %717 U%   SM1  S$"["  S$"]"   "ERROR: EXPECTED [ OR ]": 1: U%   SM2   0V%     (S$,1)"]"  SRSR1:SZ0:SM1:S$"": 9714: NEXT ROW V% IF LEFT$(S$,1)=Q$ THEN SS$=S$:TR$="":DO WHILE RIGHT$(SS$,2)<>(Q$+","):GOSUB9400:SS$=SS$+S$:&"PASS 2 "; 1LP0   :  CURRENT LINE POINTER 31OL$"" :  CURRENT OPTIMIZED LINE E1  SI0  LN1 s1*S$LI$(SI)  :  VB  SI;"=> "S$:ՙ "."; 1,    (S$,MK$)0 1.     S1(S$,MK$):S2(S$,MK$,S12) 1/     C$(S$,S12,S2S12) 14     '4505 2>     S$(S$,S11)C$(S$,S22) 2\   (2a VB  "<= ";(SI)S$ >2k  1,(SI)" "S$ G2l SI c2p 10000: --- DUMP VARS 2q R0  10:1,(32000R):R 3vF$"D:D"Q$"11TOKENIZED"Q$":IFDS<>0THEN?"Q$"DISC ERROR: "Q$";DS$:ELSE?"Q $""Q$":D"Q$"11.POST" 3z1,F$  3 1 )3"" S3ETTIBT: "ELAPSED TIME:";ET;"TICKS" 3"EDMA 0,$1FFF,$8022000,$2001:NEW RESTORE":"RUN";: LOAD '11.TOKENIZE' FROM CACHE 3 128 3 208,2   :  NO OF CHUP ONE  K = SEQCNT - 2  DO WHILE K >= SEQPTR    SEQCHUNK(K+1) = SEQCHUNK(K)    SEQEXTRA(K+1) = SEQEXTRA(K)    K = K - 1  LOOP  SEQCHUNK(SEQPTR) = 0  SEQEXTRA(SEQPTR) = 0  RETURN.ADDCHUNKTOSEQ'----------------  SEQPTR = SEQCNT  SE LQCNT = SEQCNT + 1  SEQCHUNK(SEQPTR) = 0  SEQEXTRA(SEQPTR) = 0  RETURN                                                                                                                                                                                    1    IF VER=2 THEN BEGIN      DO WHILE X-OFFS > 78        GOSUB SCROLLCANVASRIGHT        PRINT "";CHR$(27);"QOFFS=";OFFS;      LOOP    BEND    XX = X-OFFS : YY = Y: CURSOR XX, YY : GOSUB DRAWCHAR    IF DEBUG=1 THEN GET KEY Z$    IF Z$="X" THEN GOSUB DELETECHAR    IF Z$="<" THEN PIDX%=PIDX%-6    IF Z$="H" THEN PIDX%=0:GOTO PLAYDATA    IF Z$="T" THEN DIDX%=PIDX%      'PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)      'GET KEY A$    IF GROUPFLAG& = 0 THEN SLEEP .02.PDENDLOOP  LOOP  X = X-OFFS  RETURN'-----------.DELETECHAR'-----------  DIDX% = DIDX% - 3  PIDX% = PIDX% - 3  FOR K = PIDX% TO DIDX%    LDATA&(K) = LDATA&(K+3)    LDATA&(K+1) = LDATA&(K+4)    LDATA&(K+2) = LDATA&(K+5)  NEXT K  RETURN'--------------.SETGROUPFLAG'--------------  IF GROUPFLAG& = 0 THEN BEGIN    ' GROUPFLAG& = 1    LDATA&(DIDX%) = $FF    POKE $D020, (PEEK($D020)+1) AND 15    GOSUB DRAWFONTGUIDELINES  BEND:ELSE BEGIN  '  GROUPFLAG& = 0  '  LDATA&(DIDX%) = $FE  '  POKE $D020, $00  BEND  DIDX% = DIDX% + 1  RETURN'---------.LOADFILE'---------  INPUT "LOAD NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  GOSUB INIT  DOPEN #2,(FNAME$),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) =    6  PN$"11.PARSE":MK$"@":Q$(34):H34:Y39 >    e   " PREPROCESSOR V0.5.0":   7,"SCRATCH"Q$PN$Q$":DSAVE"(34)PN$Q$":DVERIFY"Q$PN$ ! T$"                                                                             	  ":BL$T$T$T$:T$"" !
 RW$(0)" PRINT INPUT IF THEN ELSE DO LOOP WHILE UNTIL GOSUB GOTO OPEN CLOSE DOPEN DCLOSE FOR NEXT GETKEY HEX$ DIM PEEK POKE WAIT DEC CHR$ ASC SGN SQR STR$" 1" RW$(0)RW$(0)" GRAPHIC CLR SCREEN DEF BEGIN BEND LEN MID$ RIGHT$ L
EFT$ INSTR FOR NEXT STEP TRAP BORDER AND FOREGROUND " " RW$(1)" BACKGROUND SET ABS SIN COS TAN LOG FRE CURSOR PIXEL WINDOW RWINDOW LINE BOX CIRCLE ELLIPSE PALETTE RESTORE DATA ERR$ ER EL CURSOR ON OFF" ?## RW$(1)RW$(1)" VAL SCRATCH RETURN RND STOP BANK TI DO OR ST IF EL ER ON TO PEN GET END INT NOT DS RUN USING DOT " #F RW$(2)" APPEND ATN AUTO BACKUP BLOAD BOOT BSAVE BUMP BVERIFY CATALOG CHANGE CHAR CMD COLLISION COLOR CONCAT CONT COPY WPOKE WPEEK SETBIT CLRBIT " q$G RW$(3)" DCLEAR DEFFN DELETE FN DIR DISK DLOAD DMA DMODE DPAT DSAVE DVERIFY EDMA ENVELOPE ERASE EXIT EXP FAST FILTER FIND GO64 HEADER HELP HIGHLIGHT " $H RW$(4)" JOY LIST LOAD LOCATE LPEN MOD MONITOR MOUSE MOVSPR NEW PAINT PLAY POINTER POLYGON POS POT PUDEF " q%I RW$(5)" RCOLOR RDOT READ RECORD REM RENAME RESUME RGR RMOUSE RPLAY RREG RSPCOLOR RSPPOS RSPRITE SAVE SCNCLR SLEEP SLOW SOUND SPC SPRCOLOR " %K RW$(6)" SPRITE SPRSAV SYS TAB TEMPO TROFF TRON TYPE USR VERIFY VOL XOR KEY VSYNC RCURSOR T@& C@& RGRAPHIC FREAD POINTER " @&U DC$" BLOAD BSAVE DLOAD TO SAVE DIR COLLECT DOPEN DCLOSE BACKUP FREAD GET " Z&Z 7020:  GET FILENAME k&d 128: 0,65 &n PF$(0)"":PF$(1)"%":PF$(2)"$":PF$(3)"&" &o  B(16) :  BIT SHIFTER'S FAST BINARY CONVERSION. THANKS A LOT! 'p B(0)1: I1  16:B(I)B(I1)B(I1): I U's  LN%(1000)             :  SRC FILE LINE NR <-> INTERNAL IDX MAPPING 'x  LI$(1000)             :  POST PROCESSED LINES 'y  EC(4)                 :  ELEMENT COUNT PER TYPE 'z  VT$(4,200)            :  VARIABLE TABLE PER TYPE -({  DF$(200)              :  DEFINE VALUES TABLE a(}  LB$(200),LL(200):LC0 :  LABEL TABLE & COUNT (~  AL$(32)               :  ARGUMENT LIST (  SN$(30),SK$(30)       :  STRUCT NAMES, FIELDS )  SV$(30)               :  STRUCT VADX% > LASTGROUPIDX THEN LASTGROUPIDX = PIDX%      GOTO PDENDLOOP    BEND    'IF VAL& = $FF THEN GROUPFLAG& = 1 : GOTO PDENDLOOP    'IF VAL& = $FE THEN GROUPFLAG& = 0 : SLEEP .02 : GOTO PDENDLOOP    X = VAL& AND $7F    IF VER=2 THEN BEGIN      X = VAL&      VAL& = LDATA&(PIDX%)      PIDX% = PIDX% + 1      X = X + (VAL& AND $7F) * 256    BEND    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% + 1    IF VER=2 THEN BEGIN      DO WHILE X-OFFS > 78        GOSUB SCROLLCANVASRIGHT        PRINT "";CHR$(27);"QOFFS=";OFFS;      LOOP    BEND    XX = X-OFFS : YY = Y: CURSOR XX, YY : GOSUB DRAWCHAR    IF DEBUG=1 THEN GET KEY Z$    IF Z$="X" THEN GOSUB DELETECHAR    IF Z$="<" THEN PIDX%=PIDX%-6    IF Z$="H" THEN PIDX%=0:GOTO PLAYDATA    IF Z$="T" THEN DIDX%=PIDX%      'PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)      'GET KEY A$    IF GROUPFLAG& = 0 THEN SLEEP .02.PDENDLOOP  LOOP  X = X-OFFS  RETURN'-----------.DELETECHAR'-----------  DIDX% = DIDX% - 3  PIDX% = PIDX% - 3  FOR K = PIDX% TO DIDX%    LDATA&(K) = LDATA&(K+3)    LDATA&(K+1) = LDATA&(K+4)    LDATA&(K+2) = LDATA&(K+5)  NEXT K  RETURN'--------------.SETGROUPFLAG'--------------  IF GROUPFLAG& = 0 THEN BEGIN    ' GROUPFLAG& = 1    LDATA&(DIDX%) = $FF    POKE $D020, (PEEK($D020)+1) AND 15    GOSUB DRAWFONTGUIDELINES  BEND:ELSE BEGIN  '  GROUPFLAG& = 0  '  LDATA&(DIDX%) = $FE  '  POKE $D020, $00  BEND  DIDX% = DIDX% + 1  RETURN'---------.LOADFILE'---------  INPUT "LOAD NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  GOSUB INIT  DOPEN #2,(FNAME$),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) = RS (EACH ENTRY HAS STRING OF VARS) W) SS0                      :  INDEX TO NEXT FREE STRUCT DEFINITION ]) : )  ------------------------- PASS 1 ------------------------------------ ) : ) NL  0 ) WH$(32)(160)"	" :  WHITESPACE *  CLEANUP TEMPORARY FILES '* SL0 :  SOURCE CODE LINE COUNTER =*  "PASS 1 ";:RL0 d*  TI:  KEEP START TIME FOR TIMING * CB$8030000:CACB:TL(CA)256(CA1):CACA2 *   RLTL :  UNTIL TARGET LINES IS REACHED *    9500: READ NEXT LINE INTO CL$ +  CT(CL$,"'"):  CT0 580 .+   (CL$,(34))0 540 9+  CT0 d+  0:L(P)1:A(P1)256(P2):1 +  R.L:C(AR):CHQ(Q1):ՋCYQ0CTR1:R999 +   +   CT CL$(CL$,CT1) +0   STRIP WHITESPACE FROM END +D  S$CL$:2050:CL$S$ ,I   CL$""  5,J    DL0 :  DELETE LINE FLAG S,N     VB  ">>"LN;SL;CL$ ,X     (CL$,1)"." NL1:1500:  LABEL ,Y     (CL$,1)"#"  ,Z      CC1 ,[       (CL$,"IFDEF")2  S$(CL$,8): 9210:DL1 	-\ "      (CL$,"ENDIF")2  SH0:DL1 8-]       (CL$,"DEFINE")2 DF1:1000:DF0 c-^       (CL$,"DECLARE")2 DF0:1000 -_       (CL$,"OUTPUT")2 1200 -`       (CL$,"STRUCT")2  9300:DL1 -     -     SH1   750 	.     (CL z A B C" D, EA FN 
GO 
HS IW ZX Z[ F\ A_ Z_ ` Za Za Za Za Zb Zb  Zb !c !Zd !Ye !Af !B_ A` Ba C                                                                                                                                                               
 
	 	     	  1: !	 A$""C. 47:CC#OUTPUT "STARFIELD"' 4 EMORY USAGE' ------------------' 4.0000 -' 4.0020 VAR INTERFACE TO ASSEMBLY'        0020: PTR TO DEFAULTRED&'        0022: PTR TO DEFAULTGREEN&'        0024: PTR TO DEFAULTBLUE&'        0026: PTR TO CURRRED &'        0028: PTR TO CURRGREEN&'        002A: PTR TO CURRBLUE&'        002C: PTR TO DATAADDR%'        002E: PTR TO CDATAADDR%'        0030: PTR TO SCRADDR%'        0032: PTR TO CLRADDR%'        0034: PTR TO INC%'        0036: PTR TO STARX%!'        0038: PTR TO STARVX%' 4.0800  ' 4.2000   FOR  LOGO' 5 EMORY USAGE' ------------------' 5.0000 SCREEN BUFFER FOR DRAWPETSCIIFRAME' 5.1000 COLOR RAM BUFFER FOR DRAWPETSCIIFRAME' 5.2000 SCREEN BUFFER2 "FOR 'ANATHEMA' LAYER' 5.4000 COLOR RAM BUFFER2 FOR 'ANATHEMA' LAYER' 5.3000 SCREEN BUFFER3 FOR 'THE SILENT ENIGMA' LAYER' 5.4000 COLOR RAM BUFFER3 FOR 'THE SILENT ENIGMA' LAYER'--------.DECLARES'--------#DECLARE STARX%(20), STARY(20), STARVX%(20#$,4)"DATA"  (CL$,5)"BEGIN"  NL1 .     DL0  5.       VB0  "."; F.      S$CL$ t.      3007: REPLACE VARS & LABELS IN S$ .      9600: CHECK FOR CREATION OF STRUCT OBJECT .       (L$,1)"_"  L$(L$,(L$)1):NL0:CN1: $CN0 #/       9800: SAFE ADD L$+S$ TO CURRENT OR NEXT LI$(LN) f/       (S$,4)"BEND"  (S$,6)"RETURN"  (S$,2)"IF" NL1 /     :  ENDIF DL=0 /   :  ENDIF C$<>"" /  SLSL1 :  INCREASE SOURCE CODE LINE (FOR ERROR MSGS...) / %  VB   "SL=";SL: Z$ / 0 L$"" LI$(LN)L$:LNLN1 '0 1 H07150:  SET OUTPUT FILENAME g0 "11TEMP": "11TOKENIZED" 0 ------------------------- PASS 2 ------------------------------------ 0: 0 1,1,5,"11TEMP,S,W" 0 (13)&  V = SEQCHUNK(SEQPTR)    V1$ = STR$(V)    IF LEFT$(V1$,1) = " " THEN V1$=MID$(V1$,2)    PRINT "CHUNK#: ";ٯ;"^";V1$;ٯ;"_";    INPUT "", V    SEQCHUNK(SEQPTR) = V  BEND  IF SSCOL = 1 THEN BEGIN    V = SEQEXTRA(SEQPTR)    'V1$ = STR$(V)    IF LEFT$(V1$,1) = " " THEN V1$=MID$(V1$,2)    PRINT "EXTRA#: ";ٯ;"^";V1$;ٯ;"_";    INPUT "", V    SEQEXTRA(SEQPTR) = V  BEND  RETURN.EDITCHUNKCMD'--------------  V = -SEQCHUNK(SEQPTR)  PRINT ٯ;   FOR ROW = 1 TO į - 1    PRINT ROW;":"; SEQCMDNAME$(ROW)  NEXT ROW  PRINT  INPUT "CMD: ", V  IF V > 0 THEN SEQCHUNK(SEQPTR) = -V  RETURN.INSERTCHUNKTOSEQ'-------------------  SEQCNT = SEQCNT + 1  ' MOVE ALL HIGHER CHUNK SEQUENCES URRDIR = ү      IF FILTDIR(FSEL) = ү THEN CURRFREQ = FILTFREQ(FSEL)    BEND    RETURN  BEND  RETURN.APPLYSELECTEDFILTER'---------------------  IF FSEL = -1 THEN RETURN  CURRFREQ = FILTFREQ(FSEL)  CURRDIR = ү  IF   FILTDIR(FSEL) = ү _    OR FILTDIR(FSEL) = ү THEN BEGIN    CURRFREQ = FILTMIN(FSEL)    CURRDIR = ү  BEND  IF FILTDIR(FSEL) = ү THEN BEGIN    CURRDIR = ү  BEND  FILTER 1, FILTFREQ(FSEL), FILTLP(FSEL), _          FILTBP(FSEL), FILTHP(FSEL), FILTRES(FSEL)  FILTER 2, FILTFREQ(FSEL), FILTLP(FSEL), _          FILTBP(FSEL), FILTHP(FSEL), FILTRES(FSEL)  RETURN.CHANGEENVNAME'---------------  V$=""  INPUT "NEW NAME: ",V$  IF V$<>"" THEN ENVSNAME$(SROW) = V$  RETURN.EDITENVFIELD'--------------  IF SCOL = 0 THEN GOSUB CHANGEENVNAME : RETURN  IF SCOL = 6 THEN BEGIN    V$=""    INPUT "NEW VALUE: ",V$    V = VAL(V$)    IF V > 4095 THEN V = 4095    IF V < 0 THEN V = 0    ENVSPW(SROW) = V    RETURN  BEND  IF A$="+" THEN DELTA=1 : GOSUB INCRVAL  IF A$="-" THEN DELTA=1 : GOSUB DECRVAL  RETURN.EDITFILTERFIELD'-----------------  IF FSCOL = 2 THEN V=FILTLP(FSROW):V=MOD(V+1,2):FILTLP(FSROW)=V:RETURN  IF FSCOL = 3 THEN V=FILTBP(FSROW):V=MOD(V+1,2):FILTBP(FSROW)=V:RETURN  IF FSCOL = 4 THEN V=FILTHP(FSROW):V=MOD(V+1,2):FILTHP(FSROW)=V:RETURN  IF FSCOL = 6 THEN V=FILTDIR(FSROW):V=MOD(V+1,4):FILTDIR(FSROW)=V:RETURN  V$=""  INPUT "NEW VALUE: ",V$  IF V$<>"" THEN BEGIN    IF FSCOL = 0 THEN FILTNAME$(FSROW) = V$    IF FSCOL = 1 THEN BEGIN      V = VAL(V$)      IF V > 2047 THEN V = 2047      IF V < 0 THEN V = 0      FILTFREQ(FSROW) = V    BEND    IF FSCOL = 5 THEN BEGIN      V = VAL(V$)      IF V > 15 THEN V = 15      IF V < 0 THEN V = 0      FILTRES(FSROW) = V    BEND    IF FSCOL = 6 THEN BEGIN      V = VAL(V$)      IF V > 3 THEN V = 3      IF V < 0 THEN V = 0      FILTDIR(FSROW) = V    BEND    IF FSCOL = 7 THEN BEGIN      V = VAL(V$)   	   IF V > 2047 THEN V = 2047      IF V < 0 THEN V = 0      FILTMIN(FSROW) = V    BEND    IF FSCOL = 8 THEN BEGIN      V = VAL(V$)      IF V > 2047 THEN V = 2047      IF V < 0 THEN V = 0      FILTSWEEP(FSROW) = V    BEND  BEND.CHECKPIANOKE
YS'----------------  ' APPLY FILTER  PSTR$ = "X0"  IF FSEL <> -1 THEN PSTR$ = "X1"  ' DECIDE NOTE LENGTH  PSTR$ = PSTR$ + DUR$(SDUR, )  ' DECIDE OCTAVE  PSTR$ = PSTR$ + "O" + STR$(OCT)  ' WHICH NOTE TO PLAY  FOR K = 0 TO 11    IF A$ = KEYSIN$(K) THEN PSTR$ = PSTR$ + KEYSOUT$(K)  NEXT K  IF LEN(PSTR$)>0 THEN BEGIN    PLAY "T"+STR$(SROW)+PSTR$  BEND  RETURN.INCRVAL'--------  GOSUB GETVAL  MAXV = 15  IF SCOL = 5 THEN MAXV = 4  IF SCOL = 6 THEN MAXV = 4095  V = V + DELTA  IF V > MAXV THEN V = MAXV  GOSUB APPLYVAL  RETURN.DECRVAL'--------  GOSUB GETVAL  V = V - DELTA  IF V < 0 THEN V = 0  GOSUB APPLYVAL  RETURN.INCRFVAL'---------  IF FSCOL = 1 THEN BEGIN    V = FILTFREQ(FSROW) + DELTA    IF V > 2047 THEN V = 2047    FILTFREQ(FSROW) = V  BEND  IF FSCOL = 2 THEN FILTLP(FSROW) = 1  IF FSCOL = 3 THEN FILTBP(FSROW) = 1  IF FSCOL = 4 THEN FILTHP(FSROW) = 1  IF FSCOL = 5 THEN BEGIN    V = FILTRES(FSROW) + DELTA    IF V > 15 THEN V = 15    FILTRES(FSROW) = V  BEND  IF FSCOL=6 AND FILTDIR(FSROW) < 3 THEN FILTDIR(FSROW) = FILTDIR(FSROW) + 1  IF FSCOL=7 AND FILTMIN(FSROW) < 2047 THEN BEGIN    V = FILTMIN(FSROW) + DELTA    IF V > 2047 THEN V = 2047    FILTMIN(FSROW) = V  BEND      IF FSCOL=8 AND FILTSWEEP(FSROW) < 2047 THEN BEGIN    V = FILTSWEEP(FSROW) + DELTA    IF V > 2047 THEN V = 2047    FILTSWEEP(FSROW) = V  BEND  GOSUB APPLYSELECTEDFILTER  RETURN.DECRFVAL'---------  IF FSCOL = 1 THEN BEGIN    V = FILTFREQ(FSROW) - DELTA    IF V < 0 THEN V = 0    FILTFREQ(FSROW) = V  BEND  IF FSCOL = 2 THEN FILTLP(FSROW) = 0  IF FSCOL = 3 THEN FILTBP(FSROW) = 0  IF FSCOL = 4 THEN FILTHP(FSROW) = 0  IF FSCOL = 5 THEN BEGIN    V = FILTRES(FSROW) - DELTA    IF V < 0 THEN V = 0    FILTRES(FSROW) = V  BEND  IF FSCOL=6 AND FILTDIR(FSROW) > 0 THEN FILTDIR(FSROW) = FILTDIR(FSROW) - 1  IF FSCOL=7 AND FILTMIN(FSROW) > 0 THEN BEGIN    V = FILTMIN(FSROW) - DELTA    IF V < 0 THEN V = 0    FILTMIN(FSROW) = V  BEND  IF FSCOL=8 AND FILTSWEEP(FSROW) > 0 THEN BEGIN    V = FILTSWEEP(FSROW) - DELTA    IF V < 0 THEN V = 0    FILTSWEEP(FSROW) = V  BEND  GOSUB APPLYSELECTEDFILTER  RETURN.APPLYVAL'---------  IF SCOL=0 THEN ENVSNAME$(SROW) = V$  IF SCOL=1 THEN ENVSATTACK(SROW) = V  IF SCOL=2 THEN ENVSDECAY(SROW) = V  IF SCOL=3 THEN ENVSSUSTAIN(SROW) = V  IF SCOL=4 THEN ENVSRELEASE(SROW) = V  IF SCOL=5 THEN ENVSWAVEFORM(SROW) = V  IF SCOL=6 THEN ENVSPW(SROW) = V  ROW = SROW  GOSUB SETENV  RETURN.SETENV'-------  ENVELOPE ROW, ENVSATTACK(ROW), ENVSDECAY(ROW), ENVSSUSTAIN(ROW), ENVSRELEASE(ROW), ENVSWAVEFORM(ROW), ENVSPW(ROW)  RETURN.RUNSTOPTRAPPER'---------------  IF ER=30 THEN RESUME  ' IGNORE RUN/STOP  TRAP  PRINT ERR$(ER);" ERROR"  PRINT " IN LINE";EL  KEY ON  END.CHUNKSEQUENCER'---------------  DO WHILE 1    GOSUB DRAWSEQUENCE    GOSUB GETUSERINPUTFORSEQUENCE    IF A$ = ٯ THEN EXIT  LOOP  RETURN.DRAWSEQUENCE'-------------  PRINT "SEQUENCE EDITOR"  PRINT "---------------"  PRINT ")DD )NSERT )ELETE, DIT=, LAYLL=+, LAY= - SEQCNT = ";SEQCNT  PRINT ": EDIT , : STOP MUSIC, +: EXIT"  PRINT " MD            XTRA"           PRINT " ---            -----"  IF INT((SEQCNT-1)/43) > 1 AND (INT(SEQOFFS/43)+1) < INT((SEQCNT-1)/43) THEN BEGIN    'IF INT((SEQCNT-1) / 43) * 43 > SEQOFFS THEN BEGIN      CURSOR 75, 5:PRINT "--->"    'BEND  BEND  IF SEQOFFS > 0 THEN BEGIN    CURSOR 70, 5:PRINT "<---"  BEND  K = SEQOFFS  DO WHILE K < SEQCNT    IF K > (SEQOFFS + 43 * 2 - 1) THEN K=SEQCNT:GOTO NXT    IF (K-SEQOFFS) >= 43 THEN CURSOR 40,6+(K-SEQOFFS-43)    IF PLYPTR = K THEN PRINT ">";:ELSE PRINT " ";    S=0:GOSUB HIGHLIGHTSELECTEDSEQCOLUMN    ' CHUNK IS A SPECIAL į*?    IF SEQCHUNK(K) < 0 AND ABS(SEQCHUNK(K)) < į THEN BEGIN      V$ = SEQCMDNAME$(ABS(SEQCHUNK(K)))      S = 10-LEN(V$)      PRINT V$;      DO WHILE S >= 0        PRINT " ";        S = S - 1      LOOP    BEND:ELSE BEGIN      PRINT SEQCHUNK(K);ٯ;    BEND    S=1:GOSUB HIGHLIGHTSELECTEDSEQCOLUMN    HANDLED = 0    IF SEQCHUNK(K) = į THEN BEGIN      HANDLED = 1      IF SEQEXTRA(K) = -1 THEN PRINT ٯ;"<NONE>":ELSE BEGIN        PRINT ٯ;FILTNAME$(SEQEXTRA(K))      BEND    BEND    IF HANDLED=0 AND SEQCHUNK(K) = į THEN BEGIN      HANDLED = 1      PRINT ٯ;SEQEXTRA(K)    BEND    '     IF HANDLED = 0 THEN BEGIN       PRINT ٯ;SEQEXTRA(K)    BEND    PRINT ٯ֯;.NXT    K = K + 1  LOOP    RETURN.HIGHLIGHTSELECTEDSEQCOLUMN'-----------------------------  IF SEQPTR = K AND SSCOL=S THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  RETURN.GETUSERINPUTFORSEQUENCE'---------------------------  GOSUB READKEYLOOP  IF A$="A" THEN GOSUB ADDCHUNKTOSEQ  IF A$="I" THEN GOSUB INSERTCHUNKTOSEQ  ' IF A$="E" THEN GOSUB EDITCHUNKSEQ  IF A$="D" THEN GOSUB DELETECHUNKSEQ  IF A$=ٯ AND SEQPTR > 0 THEN SEQPTR = SEQPTR - 1  IF A$=ٯ AND SEQPTR < SEQCNT-1 THEN SEQPTR = SEQPTR + 1   IF A$=ٯ THEN BEGIN    IF SSCOL = 1 THEN BEGIN      SSCOL = 0    BEND:ELSE BEGIN      IF (SEQPTR-43)>=0 THEN BEGIN        SSCOL = 1        SEQPTR = SEQPTR - 43      BEND    BEND  BEND  IF A$=ٯ THEN BEGIN    IF SSCOL = 0 THEN BEGIN      SSCOL = 1    BEND:ELSE BEGIN      IF (SEQPTR+43) < SEQCNT THEN BEGIN        SSCOL = 0        SEQPTR = SEQPTR + 43      BEND    BEND   BEND  IF A$=ٯԯ THEN BEGIN    PLYPTR = 0    PLYFLAG = 1    CHUNKRPT = 0    PLAY    GOSUB SETALLENV    TEMPO TMPO%  BEND  IF A$=ٯ THEN BEGIN    PLYPTR = SEQPTR    PLYFLAG = 1    CHUNKRPT = 0    PLAY    GOSUB SETA!LLENV    TEMPO TMPO%  BEND  IF A$=ٯ THEN GOSUB EDITCHUNKCELL  IF A$="C" THEN GOSUB EDITCHUNKCMD  IF A$=ٯ THEN GOSUB STOPALLMUSIC  IF A$=ٯ THEN SEQPTR = 0  IF A$=ٯ THEN SEQPTR = SEQCNT-1  ' FINALLY, ADJUST SE"QOFFS IF NEEDBE  IF (INT(SEQPTR / 43) * 43) < SEQOFFS THEN SEQOFFS = SEQOFFS - 43  IF (INT(SEQPTR / 43) * 43) > (SEQOFFS+43) THEN SEQOFFS = SEQOFFS + 43  RETURN.STOPALLMUSIC'--------------  PLYPTR = -1  PLYFLAG = 0  PLAY  GOSUB SETAL#LENV  TEMPO TMPO%  GOSUB APPLYSELECTEDFILTER  RETURN.DELETECHUNKSEQ'----------------  IF SEQCNT = 0 THEN RETURN  K = SEQPTR  DO WHILE K < SEQCNT - 1    SEQCHUNK(K) = SEQCHUNK(K + 1)    SEQEXTRA(K) = SEQEXTRA(K + 1)    K = K + 1  LO$OP  SEQCNT = SEQCNT - 1  IF SEQPTR = SEQCNT AND SEQPTR>0 THEN SEQPTR = SEQPTR - 1  RETURN.EDITCHUNKSEQ'--------------  IF SEQCNT = 0 THEN RETURN  PRINT ٯ;ٯ;ٯ;ٯ;"Q";  V=0:INPUT "CHUNK#: ", V  SEQCHUNK(SEQPTR) = %V  PRINT ٯ;ٯ;ٯ;ٯ;"Q";  V=-1:INPUT "EXTRA#: ", V  SEQEXTRA(SEQPTR) = V  RETURN.EDITCHUNKCELL'---------------  IF SEQCNT = 0 THEN RETURN  PRINT ٯ;ٯ;ٯ;ٯ;"Q";  IF SSCOL = 0 THEN BEGIN  &'       ( WILL INTERNALLY NEED A READ PRIOR TO THE WRITE)  ' ?  COULDN'T DO  $415 (IT BECAME 868691 = $4153 ?!)  WPOKE 54293, (CURRFREQ AND 7) + ((CURRFREQ >> 3) * 256)  WPOKE 54357, (CURRFREQ AND 7) + ((CURRFREQ >> 3) * 256)  'IF CURRDIR = ү THEN BEGIN    CURRFREQ = CURRFREQ + FILTSWEEP(FSEL)    IF CURRFREQ > FILTFREQ(FSEL) THEN BEGIN      CURRFREQ = FILTFREQ(FSEL)      IF FILTDIR(FSEL) = ү THEN CURRDIR = ү      IF FILTDIR(FSEL) = ү THEN  CURRFREQ = FILTMIN(FSEL)    BEND    RETURN  BEND  IF CURRDIR = ү THEN BEGIN    CURRFREQ = CURRFREQ - FILTSWEEP(FSEL)    IF CURRFREQ < FILTMIN(FSEL) THEN BEGIN      CURRFREQ = FILTMIN(FSEL)      IF FILTDIR(FSEL) = ү THEN C    TEMPO TMPO% : PLAY V1$  BEND  IF KEY$="," THEN DELTA = -1 : GOSUB TRANSPOSEOCTAVE  IF KEY$="." THEN DELTA = 1  : GOSUB TRANSPOSEOCTAVE  IF KEY$="I" THEN GOSUB INSERTCHUNK  KEY$ = ""  RETURN.COPYALLVOICESTOCLIPBOARD'----------------------------  FOR Y = 0 TO 5    CP$(Y) = V$(Y, CHUNKIDX)  NEXT Y  RETURN.PASTEALLVOICESFROMCLIPBOARD'-------------------------------  FOR Y = 0 TO 5    V$(Y, CHUNKIDX) = CP$(Y)  NEXT Y  RETURN.INSERTCHUNK'------------  FOR K = CHUNKMAX-1 TO CHUNKIDX + 1 STEP -1    FOR Y = 0 TO 5      V$(Y, K) = V$(Y, K-1)    NEXT Y  NEXT K  FOR Y = 0 TO 5    V$(Y, CHUNKIDX) = ""  NEXT Y  ' REPAIR ITEMS IN THE SEQUENCE THAT ARE AFFECTED  FOR K = 0 TO 100    IF SEQCHUNK(K) >= CHUNKIDX THEN SEQCHUNK(K) = SEQCHUNK(K) + 1  NEXT K  RETURN.TRANSPOSEOCTAVE'----------------  V1$ = V$(CURSORY, CHUNKIDX)  LIMIT = 0  IF DELTA = 1 THEN LIMIT = 6  RET% = 0  GOSUB CANTRANSPOSEOCTAVE  IF RET% = 0 THEN PRINT ٯ; : RETURN  K = 0  DO WHILE K < LEN(V1$)    V2$ = MID$(V1$,K+1,1)    IF V2$ = "O" AND (K + 1) < LEN(V1$) THEN BEGIN      V2$ = STR$(VAL(MID$(V1$,K+2,1)) + DELTA)      V2$ = MID$(V2$,2)      V1$ = LEFT$(V1$,K+1) + V2$ + MID$(V1$, K+3)    BEND    K = K + 1  LOOP  V$(CURSORY, CHUNKIDX) = V1$  RETURN.CANTRANSPOSEOCTAVE'--------------------  RET% = 1  K = 0  DO WHILE K < LEN(V1$)    V2$ = MID$(V1$,K+1,1)    IF V2$ = "O" AND (K+1) < LEN(V1$) THEN BEGIN      V2$ = MID$(V1$,K+2,1)      IF VAL(V2$) = LIMIT THEN RET% = 0 : RETURN    BEND    K = K + 1  LOOP  RETURN.PLAYCHUNKIDX'--------------  V1$ = V$(0,CHUNKIDX)  V2$ = V$(1,CHUNKIDX)  V3$ = V$(2,CHUNKIDX)  V4$ = V$(3,CHUNKIDX)  V5$ = V$(4,CHUNKIDX)  V6$ = V$(5,CHUNKIDX)  IF ECHODELAY = 1 THEN BEGIN    PLAY V1$    SLEEP (ECHOSZ)    PLAY ,V2$    SLEEP (ECHOSZ)    PLAY ,,V3$    SLEEP (ECHOSZ)    PLAY ,,,V4$    SLEEP (ECHOSZ)    PLAY ,,,,V5$    SLEEP (ECHOSZ)    PLAY ,,,,,V6$    SLEEP (ECHOSZ)    RE	TURN  BEND  IF ECHOM = 0 AND ECHOB = 0 THEN BEGIN    PLAY V1$, V2$, V3$, V4$, V5$, V6$    RETURN  BEND  IF ECHOM = 1 AND ECHOB = 0 THEN BEGIN    PLAY V1$, V2$, V3$,    , V5$, V6$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$  BEND  IF E
CHOM = 1 AND ECHOB = 1 THEN BEGIN    PLAY V1$, V2$, V3$,    , V5$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$,    , V3$  BEND  IF ECHOM = 2 AND ECHOB = 0 THEN BEGIN    PLAY V1$,    , V3$,    ,    , V6$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$    SLEEP (ECHOSZ)    PLAY    , V1$    SLEEP (ECHOSZ)    PLAY    ,    ,    ,    , V1$  BEND  IF ECHOM = 2 AND ECHOB = 1 THEN BEGIN    PLAY V1$,    , V3$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$    SLEEP (ECHOSZ)    PLAY    , V1$,    ,    ,    , V3$    SLEEP (ECHOSZ)    PLAY    ,    ,    ,    , V1$  BEND  RETURN.ENVELOPEEDITOR'---------------  DO WHILE 1    GOSUB DRAWTABLE    GOSUB GETUSERINPUTFORTABLE    ' ALT+Q TO EXIT    IF A$ = ٯ THEN EXIT  LOOP  RETURN.DRAWTABLE'----------  PRINT "ENV EDITOR";ٯ;DUR$(SDUR, );ٯ;"OCTAVE";OCT  PRINT "----------"  PRINT "-/+: DECR/INCR, </>: OCTAVE, : EDIT, : FOCUS ENV/FILTER, +: EXIT"  PRINT  PRINT "   ";ٯ;ٯ;"";ٯ;"";ٯ;"";ٯ;"";ٯ;  PRINT "";ٯ;""  FOR ROW = 0 TO 9    IF SROW = ROW THEN PRINT ">";:ELSE PRINT " ";    PRINT ROW;": ";    COL = 0 : V$ = ENVSNAME$(ROW)    GOSUB SHOWCELL    COL = 1 : V = ENVSATTACK(ROW)    GOSUB SHOWCELL    COL = 2 : V = ENVSDECAY(ROW)    GOSUB SHOWCELL    COL = 3 : V = ENVSSUSTAIN(ROW)    GOSUB SHOWCELL    COL = 4 : V = ENVSRELEASE(ROW)    GOSUB SHOWCELL    COL = 5 : V = ENVSWAVEFORM(ROW)    GOSUB SHOWCELL    COL = 6 : V = ENVSPW(ROW)    GOSUB SHOWCELL    PRINT  NEXT ROW  PRINT  PRINT "FILTER EDITOR"  PRINT "-------------";  PRINT ٯ;"FREQ";ٯ;"LP";ٯ;"BP";ٯ;"HP";ٯ;"RES";  PRINT ٯ;"DIR";ٯ;"MIN";ٯ;"SWEEP"  FOR FPRESET = 0 TO 10    GOSUB SHOWFILTER  NEXT FPRESET  RETURN.SHOWFILTER'-----------  IF FSEL = FPRESET THEN PRINT ">";:ELSE PRINT " ";  K = 0 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTNAME$(FPRESET);"  ";ٯ;  K = 1 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTFREQ(FPRESET);ٯ;  K = 2 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSTATENAME$(FILTLP(FPRESET));ٯ;  K = 3 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSTATENAME$(FILTBP(FPRESET));ٯ;  K = 4 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSTATENAME$(FILTHP(FPRESET));ٯ;  K = 5 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTRES(FPRESET);ٯ;  K = 6 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT DIRNAME$(FILTDIR(FPRESET));ٯ;  K = 7 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTMIN(FPRESET);ٯ;  K = 8 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSWEEP(FPRESET);  PRINT ٯ֯  RETURN.CHECKSHOWFILTERHIGHLIGHT'---------------------------  IF FSROW = FPRESET AND FFOCUS = 1 AND FSCOL = K THEN _    PRINT ٯ֯; : ELSE PRINT ٯ֯;  RETURN.GETVAL'-------  IF SCOL = 0 THEN V$ = ENVSNAME$(SROW)  IF SCOL = 1 THEN V = ENVSATTACK(SROW)  IF SCOL = 2 THEN V = ENVSDECAY(SROW)  IF SCOL = 3 THEN V = ENVSSUSTAIN(SROW)  IF SCOL = 4 THEN V = ENVSRELEASE(SROW)  IF SCOL = 5 THEN V = ENVSWAVEFORM(SROW)  IF SCOL = 6 THEN V = ENVSPW(SROW)  RETURN.SHOWCELL'---------  IF SROW=ROW AND SCOL = COL AND FFOCUS=0 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  IF COL = 0 THEN BEGIN    PRINT V$;ٯ;"";    RETURN  BEND  IF COL = 5 THEN BEGIN    PRINT WNAME$(V);ٯ;ٯ֯;    RETURN  BEND  ' ELSE  PRINT V;;ٯ֯;  RETURN.GETUSERINPUTFORTABLE'------------------------  ' GET KEY A$  GOSUB READKEYLOOP  IF A$ = ٯ AND SCOL > 0 THEN SCOL = SCOL - 1  IF A$ = ٯ AND SCOL < 6 THEN SCOL = SCOL + 1  IF A$ = ٯ AND SROW > 0 THEN SROW = SROW - 1  IF A$ = ٯ AND SROW < 9 THEN SROW = SROW + 1  IF A$ = "+" OR A$="=" THEN DELTA=1 : GOSUB INCRVAL  IF A$ = "-" THEN DELTA=1 : GOSUB DECRVAL  IF A$ = ٯԯ THEN DELTA=100 : GOSUB INCRVAL  IF A$ = ٯԯ THEN DELTA=100 : GOSUB DECRVAL  IF A$ = ٯ THEN A$ = "+" : GOSUB EDITENVFIELD  IF A$ = ٯԯ THEN A$ = "-" : GOSUB EDITENVFIELD  IF A$ = ٯ THEN FFOCUS = 1 : GOSUB GETUSERINPUTFORFILTERS  GOSUB CHECKDURATIONCHANGE  GOSUB CHECKPIANOKEYS  RETURN.GETUSERINPUTFORFILTERS'--------------------------  DO WHILE 1    GOSUB DRAWTABLE    ' GET KEY A$    GOSUB READKEYLOOP    IF A$ = ٯ AND FSCOL > 0 THEN FSCOL = FSCOL - 1    IF A$ = ٯ AND FSCOL < 8 THEN FSCOL = FSCOL + 1    IF A$ = ٯ AND FSROW > 0 THEN FSROW = FSROW - 1    IF A$ = ٯ AND FSROW < 10 THEN FSROW = FSROW + 1    IF A$ = "+" OR A$="=" THEN DELTA=1 : GOSUB INCRFVAL    IF A$ = "-" THEN DELTA=1 : GOSUB DECRFVAL    IF A$ = ٯԯ THEN DELTA = 100 : GOSUB INCRFVAL    IF A$ = ٯԯ THEN DELTA = 100 : GOSUB DECRFVAL    IF A$ = " " THEN BEGIN      IF FSEL = FSROW THEN FSEL = -1:ELSE FSEL = FSROW      GOSUB APPLYSELECTEDFILTER    BEND    IF A$ = ٯ THEN GOSUB EDITFILTERFIELD:GOSUB APPLYSELECTEDFILTER    IF A$ = ٯ OR A$ = ٯ THEN EXIT    GOSUB CHECKDURATIONCHANGE    GOSUB CHECKPIANOKEYS  LOOP  FFOCUS = 0  RETURN.READKEYLOOP'-------------  A$ = ""  DO WHILE A$=""    GET A$    IF FSEL <> -1 THEN BEGIN      GOSUB UPDATESELECTEDFILTER    BEND    IF PLYFLAG = 1 THEN BEGIN      IF RPLAY(1) = 0 THEN GOSUB PARSECURRENTSEQPTR    BEND  LOOP  RETURN.PARSECURRENTSEQPTR'----------------- ---  K = SEQCHUNK(PLYPTR)    IF K >= 0 THEN BEGIN    CHUNKIDX = K    IF CHUNKRPT <= 0 THEN CHUNKRPT = SEQEXTRA(PLYPTR)    GOSUB PLAYCHUNKIDX    SLEEP .1    GOSUB DRAWSEQUENCE  BEND  IF K = į THEN BEGIN    K = SEQEXTRA(PLYPTR)!    TEMPO (K)    TMPO% = K  BEND  IF K = į THEN BEGIN    K = SEQEXTRA(PLYPTR)    FSROW = K    FSEL = K    GOSUB APPLYSELECTEDFILTER  BEND  IF K = įϯ1 THEN ECHOM = 1 : ECHODELAY = 0  IF K = įϯ2 THEN ECHOM = 2 : ECH"ODELAY = 0  IF K = įϯ  THEN ECHOB = 1 : ECHODELAY = 0  IF K = įϯ THEN ECHOM = 0 : ECHOB = 0  IF K = įϯ THEN ECHOSZ = SEQEXTRA(PLYPTR)  IF K = į THEN ECHODELAY = 1 : ECHOM = 0 : ECHOB = 0  IF K = į #THEN V = SEQEXTRA(PLYPTR) : VOL V, V  IF CHUNKRPT > 0 THEN CHUNKRPT = CHUNKRPT - 1  IF CHUNKRPT <= 0 THEN PLYPTR = PLYPTR + 1  IF K = į THEN PLYPTR = 0  IF PLYPTR >= SEQCNT THEN PLYFLAG = 0 : PLYPTR = -1  RETURN.CHECKDURATIONCHAN$GE'---------------------  FOR K = į TO į    IF A$ = DUR$(K, ) THEN SDUR = K  NEXT K  ' CHECK OCTAVE TOO  IF A$ = ">" AND OCT < 6 THEN OCT = OCT + 1  IF A$ = "<" AND OCT > 0 THEN OCT = OCT - 1  RETURN.UPDATESELECTEDFILTE%R'----------------------  IF FSEL = -1 THEN RETURN  IF CURRDIR = ү THEN RETURN  PRINT "";ٯ;ٯ;ٯ;ٯ;ٯ;CHR$(27);"QCURRFREQ=";CURRFREQ;    ' : AN'T USE  FOR  REGISTERS AS THE REGS ARE WRITE-ONLY  &KEY$ = ٯԯ THEN BEGIN    TEMPO TMPO%    GOSUB PLAYCHUNKIDX  BEND  IF KEY$ = ٯ THEN BEGIN    V1$ = V$(CURSORY, CHUNKIDX)    V1$ = LEFT$(V1$,CURSORX) + MID$(V1$,CURSORX+2)    V$(CURSORY, CHUNKIDX) = V1$  BEND  GOSUB C'HECKVALIDKEY  RETURN.CHECKALTKEYINPUTS'--------------------  ALTKEY = PEEK($D611) AND 16  IF ALTKEY = 0 THEN RETURN  IF KEY$="X" THEN CLIP$=V$(CURSORY, CHUNKIDX) : V$(CURSORY, CHUNKIDX) = ""  IF KEY$="C" THEN CLIP$=V$(CURSORY, CHUNK IDX)  IF KEY$="V" THEN V$(CURSORY, CHUNKIDX) = CLIP$  IF KEY$="" THEN GOSUB COPYALLVOICESTOCLIPBOARD  IF KEY$="" THEN GOSUB PASTEALLVOICESFROMCLIPBOARD  IF KEY$=ٯ THEN BEGIN    V1$ = MID$(V$(CURSORY, CHUNKIDX), CURSORX + 1)FREQ, CURRDIR#DECLARE HANDLED#DECLARE PLYPTR = -1, PLYFLAG.DURATION'--------#DEFINE  = 0#DEFINE  = 1#DEFINE   = 2#DEFINE į = 0#DEFINE į = 1#DEFINE į = 2#DEFINE į = 3#DEFINE į = 4#DECLARE SDUR = 2#DECLARE DUR$(5,2)DUR$(į, ) = "WHOLE"DUR$(į, ) = "W"DUR$(į, )  = "1"DUR$(į, ) = "HALF"DUR$(į, ) = "H"DUR$(į, )  = "2"DUR$(į, ) = "QUARTER"DUR$(į, ) = "Q"DUR$(į, )  = "3"DUR$(į, ) = "EIGHTH"DUR$(į, ) = "I"DUR$(į, )  = "4"DUR$(į, ) = "SIXTEENTH"DUR$(į, ) = "S"DUR$(į, )  = "5"#DECLARE CLIP$, ALTKEY, LIMIT, RET%, Y, CP$(6).KEYS'----#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = " "#DEFINE ٯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ = ""#DEFINE ٯ1 = ""#DEFINE ٯ3 = ""#DEFINE ٯ4 = ""#DEFINE ٯ7 = ""#DEFINE ٯ8 = ""#DEFINE ٯ9 = CHR$(16)#DEFINE ٯ = CHR$(13)#DEFINE ٯ = CHR$(27)#DEFINE ٯԯ = CHR$(141)#DEFINE ٯԯ = ""#DEFINE ٯԯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ = CHR$(9)#DEFINE ٯ = ""#DEFINE ٯ  = ""#DEFINE ٯ = CHR$(14)#DEFINE ٯ = CHR$(142)#DEFINE ٯ = CHR$(7)#DEFINE  = ""#DEFINE ٯ  = "".INIT'----PRINT "";ٯ;ٯ;"5";PLAY : PLAY ""BACKGROUND 0 : BORDER 0COLOR 5.MAIN'----  KEY OFF  GOSUB DRAWEDITORSCREEN  GOSUB USERINPUT  GOTO MAIN.DRAWEDITORSCREEN'------------------  CURSOR 0,0:PRINT "PLAYMAKER V0.5 - BY GURCE ISIKYILDIZ"  PRINT "---------"  PRINT "<: PREV CHUNK, >: NEXT CHUNK, -/+ TEMPO, 7=ENV EDITOR, 9/-=SEQ EDITOR"  PRINT ": PLAY CURR VOICE, +: PLAY ALL VOICE, 1=LOAD, 3=SAVE, +=QUI	T"  PRINT "-//: ROW CUT/COPY/PASTE, -: STOP MUSIC, -: PLAY FROM CURSOR"  PRINT  GOSUB DRAWCURRENTCHUNK  RETURN.DRAWCURRENTCHUNK'------------------  PRINT "TEMPO: "; TMPO%  PRINT "CHUNKIDX: "; CHUNKIDX       FOR VIDX=0 
TO 5    IF CURSORY <> VIDX THEN BEGIN      CURSOR 0,9+VIDX*2:PRINT CHR$(27);"Q";"V";VIDX+1;": ";V$(VIDX,CHUNKIDX);    BEND:ELSE BEGIN      CURSOR 0,9+VIDX*2:PRINT CHR$(27);"Q";"V";VIDX+1;": ";      FOR IDX=1 TO LEN(V$(VIDX,CHUNKIDX))        IF CURSORX = IDX-1 THEN BEGIN          PRINT "";MID$(V$(VIDX,CHUNKIDX),IDX,1);"";        BEND:ELSE BEGIN          PRINT MID$(V$(VIDX,CHUNKIDX),IDX,1);        BEND      NEXT IDX      IF LEN(V$(VIDX,CHUNKIDX)) = 0 OR CURSORX=LEN(V$(VIDX,CHUNKIDX)) THEN PRINT " ";    BEND  NEXT VIDX  RETURN.CHECKVALIDKEY'---------------  FOR IDX=1 TO LEN(VALID$)    VAL$=MID$(VALID$,IDX,1)    IF KEY$= VAL$ THEN BEGIN      IF CURSORX < LEN(V$(CURSORY,CHUNKIDX)) THEN BEGIN        V$(CURSORY,CHUNKIDX) = LEFT$(V$(CURSORY,CHUNKIDX),CURSORX) _          + VAL$ + MID$(V$(CURSORY,CHUNKIDX),CURSORX+1)        CURSORX=CURSORX+1        RETURN      BEND      V$(CURSORY,CHUNKIDX)=V$(CURSORY,CHUNKIDX)+VAL$      CURSORX=CURSORX+1      RETURN    BEND  NEXT IDX  RETURN.FORWARDWORD'------------  IF CURSORX = LEN(V$(CURSORY,CHUNKIDX)) THEN RETURN  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) <> " "    CURSORX=CURSORX+1    IF CURSORX = LEN(V$(CURSORY,CHUNKIDX)) THEN RETURN  LOOP  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) = " "    CURSORX=CURSORX+1    IF CURSORX = LEN(V$(CURSORY,CHUNKIDX)) THEN RETURN  LOOP  RETURN.PREVIOUSWORD'-------------  IF CURSORX = 0 THEN RETURN  IF CURSORX = 1 THEN CURSORX = 0: RETURN  CURSORX = CURSORX - 1  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) = " "    CURSORX=CURSORX-1    IF CURSORX = 0 THEN RETURN  LOOP  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) <> " "    CURSORX=CURSORX-1    IF CURSORX = 0 THEN RETURN  LOOP  CURSORX=CURSORX+1  RETURN.SETALLENV'-----------  FOR ROW = 0 TO 9    GOSUB SETENV  NEXT ROW  RETURN.LOAD'----  INPUT "LOAD NAME: ";KEY$  IF KEY$="" THEN RETURN  DOPEN #2,(KEY$),R,U8  ' LOAD MELODY CHUNKS  ' ------------------  INPUT #2, CHUNKCNT  FOR CHUNKIDX = 0 TO CHUNKCNT - 1    FOR VIDX=0 TO 5      INPUT #2,V$(VIDX, CHUNKIDX)    NEXT VIDX  NEXT CHUNKIDX  INPUT #2,TMPO%' #IFDEF     ' LOAD ENVELOPES  ' --------------  FOR ROW = 0 TO 9    INPUT #2, ENVSNAME$(ROW)    INPUT #2, ENVSATTACK(ROW)    INPUT #2, ENVSDECAY(ROW)    INPUT #2, ENVSSUSTAIN(ROW)    INPUT #2, ENVSRELEASE(ROW)    INPUT #2, ENVSWAVEFORM(ROW)    INPUT #2, ENVSPW(ROW)    GOSUB SETENV  NEXT ROW  PRINT  ' LOAD FILTER PRESETS  ' -------------------  FOR ROW = 0 TO 10    INPUT #2, FILTNAME$(ROW)    INPUT #2, FILTFREQ(ROW)    INPUT #2, FILTLP(ROW)    INPUT #2, FILTBP(ROW)    INPUT #2, FILTHP(ROW)    INPUT #2, FILTRES(ROW)    INPUT #2, FILTDIR(ROW)    INPUT #2, FILTMIN(ROW)    INPUT #2, FILTSWEEP(ROW)  NEXT ROW  ' LOAD SEQUENCE  ' -------------  SEQCNT = 0  INPUT #2, SEQCNT  ROW = 0  DO WHILE ROW < SEQCNT    INPUT #2, SEQCHUNK(ROW)    INPUT #2, SEQEXTRA(ROW)    ROW = ROW + 1  LOOP' #ENDIF  DCLOSE #2  CHUNKIDX = 0  RETURN.GETCHUNKCNT'-------------  CHUNKCNT = 0  FOR K = 0 TO CHUNKMAX    IF V$(0,K)<>"" OR V$(1,K)<>"" OR V$(2,K)<>"" OR V$(3,K)<>"" OR V$(4,K)<>"" OR V$(5,K)<>"" THEN BEGIN      CHUNKCNT = K + 1    BEND  NEXT K  RETURN.SAVE'----  INPUT "SAVE NAME: ";KEY$  IF KEY$="" THEN RETURN    DELETE (KEY$)  DOPEN #2,(KEY$),W,U8  TMP = CHUNKIDX  ' SAVE MELODY CHUNKS  ' ------------------  GOSUB GETCHUNKCNT  PRINT #2, CHUNKCNT  FOR CHUNKIDX = 0 TO CHUNKCNT - 1    FOR VIDX=0 TO 5      PRINT #2,V$(VIDX, CHUNKIDX)    NEXT VIDX  NEXT CHUNKIDX  PRINT #2,TMPO%  ' SAVE ENVELOPES  ' --------------  FOR ROW = 0 TO 9    PRINT #2, ENVSNAME$(ROW)    PRINT #2, ENVSATTACK(ROW)    PRINT #2, ENVSDECAY(ROW)    PRINT #2, ENVSSUSTAIN(ROW)    PRINT #2, ENVSRELEASE(ROW)    PRINT #2, ENVSWAVEFORM(ROW)    PRINT #2, ENVSPW(ROW)  NEXT ROW  ' SAVE FILTER PRESETS  ' -------------------  FOR ROW = 0 TO 10    PRINT #2, FILTNAME$(ROW)    PRINT #2, FILTFREQ(ROW)    PRINT #2, FILTLP(ROW)    PRINT #2, FILTBP(ROW)    PRINT #2, FILTHP(ROW)    PRINT #2, FILTRES(ROW)    PRINT #2, FILTDIR(ROW)    PRINT #2, FILTMIN(ROW)    PRINT #2, FILTSWEEP(ROW)  NEXT ROW  ' SAVE SEQUENCE  ' -------------  PRINT #2, SEQCNT  ROW = 0  DO WHILE ROW < SEQCNT    PRINT #2, SEQCHUNK(ROW)    PRINT #2, SEQEXTRA(ROW)    ROW = ROW + 1  LOOP  DCLOSE #2  CHUNKIDX = TMP  RETURN.SAVEASTEXT'------------  INPUT "SAVE (AS TEXT) NAME: ";KEY$  IF KEY$="" THEN RETURN  DELETE (KEY$)      DOPEN #2,(KEY$),W,U8  FOR CHUNKIDX = 0 TO CHUNKMAX    FOR VIDX=0 TO 5      PRINT #2, "V";CHR$(49+VIDX);"$(";STR$(CHUNKIDX);")=";      PRINT #2, CHR$(34);V$(VIDX, CHUNKIDX);CHR$(34)    NEXT VIDX      PRINT #2, ""  NEXT CHUNKIDX  DCLOSE #2  CHUNKIDX = 0  RETURN.USERINPUT'----------  ' GETKEY KEY$  GOSUB READKEYLOOP  KEY$ = A$  GOSUB CHECKALTKEYINPUTS  ' DOWN ARROW?  IF KEY$ = ٯ AND CURSORY<5 THEN BEGIN    CURSORY = CURSORY + 1    IF CURSORX > LEN(V$(CURSORY,CHUNKIDX)) THEN CURSORX = _      LEN(V$(CURSORY,CHUNKIDX))  BEND  ' UP ARROW?  IF KEY$ = ٯ AND CURSORY>0 THEN BEGIN    CURSORY = CURSORY - 1    IF CURSORX > LEN(V$(CURSORY,CHUNKIDX)) THEN _      CURSORX = LEN(V$(CURSORY,CHUNKIDX))  BEND  ' RIGHT ARROW?  IF KEY$ = ٯ AND CURSORX < LEN(V$(CURSORY,CHUNKIDX)) THEN BEGIN    CURSORX=CURSORX+1  BEND  ' LEFT ARROW?  IF KEY$ =  ٯ AND CURSORX > 0 THEN CURSORX=CURSORX-1  ' BACKSPACE (INST/DEL)?  IF KEY$ = ٯ AND CURSORX > 0 THEN BEGIN    V$(CURSORY,CHUNKIDX)=LEFT$(V$(CURSORY,CHUNKIDX),CURSORX-1) _      + MID$(V$(CURSORY,CHUNKIDX),CURSORX+1)    CURSO!RX=CURSORX-1  BEND  IF ESCFLAG% THEN BEGIN    ESCFLAG%=0    IF KEY$ = "J" THEN BEGIN:CURSORX=0:BEND    IF KEY$ = "K" THEN BEGIN:CURSORX=LEN(V$(CURSORY,CHUNKIDX)):BEND    IF KEY$=ٯ THEN GOSUB STOPALLMUSIC    KEY$=""  BEND  IF" KEY$ = ٯ THEN ESCFLAG%=ABS(ESCFLAG%-1)  ' CTRL-W = FORWARD ONE WORD  IF KEY$ = ٯ̯ THEN GOSUB FORWARDWORD  ' CTRL-U = BACK ONE WORD  IF KEY$ = ٯ̯ THEN GOSUB PREVIOUSWORD  ' < / > = PREVIOUS/NEXT CHUNK  IF KEY$ = "<" #AND CHUNKIDX>0 THEN BEGIN    CHUNKIDX=CHUNKIDX-1    CURSORX=0  BEND  IF KEY$ = ">" AND CHUNKIDX<CHUNKMAX THEN BEGIN    CHUNKIDX=CHUNKIDX+1    CURSORX=0  BEND  ' +/- = TEMPO CHANGE  IF KEY$="-" THEN TMPO%=TMPO%-1  IF KEY$="+" THEN TMPO$%=TMPO%+1  ' MEGA-Q = EXIT  IF KEY$ = ٯ THEN BEGIN    PRINT "ARE YOU SURE? (Y/N)"    GET KEY A$    IF A$="Y" THEN KEY ON:END  BEND  IF KEY$ = ٯ1 THEN GOSUB LOAD  IF KEY$ = ٯ3 THEN GOSUB SAVE  IF KEY$ = ٯ7 THEN GOSUB ENVELO%PEEDITOR  IF KEY$ = ٯ9 THEN GOSUB CHUNKSEQUENCER  ' 4 = SAVE AS TEXT  IF KEY$ = ٯ4 THEN GOSUB SAVEASTEXT  ' RETURN=PLAY ROW  IF KEY$ = ٯ THEN TEMPO TMPO% : PLAY V$(CURSORY,CHUNKIDX)  ' SHIFT+RETURN=PLAY ALL CHANNELS  IF &$(8) = "ϯ"SEQCMDNAME$(9) = ""SEQCMDNAME$(10) = ""#DECLARE SEQCNT, SEQPTR#DECLARE ROW, COL, SROW, SCOL, A$, V, MAXV, V$#STRUCT ٯ IN$, OUT$ٯ KEYS(11) = [ _  [ "A", "C", ], _  [ "W", "#C", ], _  [ "S", "D", ], _  '[ "E", "#D", ], _  [ "D", "E", ], _  [ "F", "F", ], _  [ "T", "#F", ], _  [ "G", "G", ], _  [ "Y", "#G", ], _  [ "H", "A", ], _  [ "U", "#A", ], _  [ "J", "B", ] _]#DECLARE PSTR$, K, DELTA#DECLARE WNAME$(4)WNAME$(0) = ""WNAME$(1) = " "WNAME$(2) = ""WNAME$(3) = ""WNAME$(4) = ""#DECLARE FILTSTATENAME$(2)FILTSTATENAME$(0) = ""FILTSTATENAME$(1) = ""#DECLARE FPRESET = 1#DECLARE FSCOL = 0, FSROW = 0, FFOCUS = 0, FSEL = -1#DECLARE OCT = 5#DECLARE CURR#OUTPUT PLAYMAKER' EYS:' ----'    P ARROW = OVE TO PREVIOUS VOICE'  OWN ARROW = OVE TO NEXT VOICE'  EFT ARROW = OVE LEFT WITHIN CURRRENT VOICE STRING' IGHT ARROW = OVE RIGHT WITHIN CURRENT VOICE STRING'    / = ELETE CHAR IN CURRENT VOICE STRING'       , = OVE TO START OF CURRENT VOICE STRING'       , = OVE TO END OF CURRENT VOICE STRING'      + = OVE FORWARD ONE WORD IN CURRENT VOICE STRING'      + = OVE BACK ONE WORD IN CURRENT VOICE STRING'          #OUTPUT "BASLOGO"' 4 EMORY USAGE' ------------------' 4.0000 -' 4.0020 VAR INTERFACE TO ASSEMBLY'        0020: PTR TO DEFAULTRED&'        0022: PTR TO DEFAULTGREEN&'        0024: PTR TO DEFAULTBLUE&'        0026: PTR TO CURRRED&'        0028: PTR TO CURRGREEN&'        002A: PTR TO CURRBLUE&'        002C: PTR TO DATAADDR%'        002E: PTR TO CDATAADDR%'        0030: PTR TO SCRADDR%'        0032: PTR TO CLRADDR%'        0034: PTR TO INC%' 4.0800  ' 4.2000  ' 5 EMORY USAGE' ------------------' 5.0000 SCREEN BUFFER' 5.1000 COLOR RAM BUFFER.DEFINES#DECLARE K, PTR, TMP, MAXFRAMES, FRMIDX, FRMW, FRMH, SZ#DECLARE FRAMEADDR%(25), SRCADDR, DESTADDR, LENGTH, TRANSP#DECLARE FRAME  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=FRMY(2)  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  RETURN'------------------.DRAWPETSCIIFRAME'------------------  POKE $4000B, $04  ' ASSURE SOURCE BANK 4 (FOR ORIGINAL FRAME DATA)  IF MIRROR = 1 THEN SETBIT $40006, 5:ELSE CLRBIT $40006, 5  DATAADDR% = FRAMEADDR%(FRAMEIDX)  BANK 4  FRMX = PEEK(DATAADDR% + ͯԯ)  FRMY = PEEK(DATAADDR% + ͯԯ)  FRMW = PEEK(DATAADDR% + ͯԯ)  FRMH = PEEK(DATAADDR% + ͯԯ)  BANK 128  IF FX<>-999 THEN FRMX = FX ' OVERRIDE POSITION  IF FY<>-999 THEN FRMY = FY  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  SCRADDR% = $0000 + FRMX + (FRMY+FRMH-1) * 80  CLRADDR% = $1000 + FRMX + (FRMY+FRMH-1) * 80  	IF MIRROR = 1 THEN CLRADDR% = CLRADDR% + FRMW - 1  DATAADDR% = DATAADDR% + ͯԯ  CDATAADDR% = DATAADDR% + FRMW * FRMH  INC% = INC(FRAMEIDX) * 256  ' ASM: DRAWPETSCIIFRAME  BANK 0:SYS $7E09, MOD(FRMY+256,256), MOD(FRMY1+256,256), F
RMW  RETURN'---------------.TRANSPARENTDMA'---------------  WPOKE $40009, SRCADDR  WPOKE $4000C, DESTADDR  WPOKE $40007, LENGTH  POKE  $40004, TRANSP  POKE $D702, 4 ' DMA LIST IN BANK 4  POKE $D701, $00 ' DMA LIST MSB  POKE $D705, $00 ' DMA LIST LSB  RETURN'---------.PAGEFLIP'---------  EDMA 0, $FA0, $50000, $40800  EDMA 0, $FA0, $51000, $FF80000  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32, $50000  EDMA 3, $FA0, 0, $51000  RETURN.FADETOWHITE'-------------  FOR FADEVAL=0 TO 128    ' FADECOLOURSTOWHITE    BANK 0:VSYNC 10:SYS $7E00, FADEVAL:BANK 128  NEXT FADEVAL  RETURN.STOREDEFAULTCOLOURS'---------------------  FOR K = 0 TO 31    DEFAULTRED&(K)=PEEK($D100+K)    DEFAULTGREEN&(K)=PEEK($D200+K)    DEFAULTBLUE&(K)=PEEK($D300+K)  NEXT K  RETURN.STORECURRCOLOURS'------------------  FOR K = 0 TO 31    CURRRED&(K)=PEEK($D100+K)    CURRGREEN&(K)=PEEK($D200+K)    CURRBLUE&(K)=PEEK($D300+K)  NEXT K  RETURN.CYCLEALTPALETTELOOP'----------------------  FOR M = 0 TO 32*4    ' GOSUB CYCLEALTPALETTE    ' GOSUB POLLPLAY    ' GOSUB ANIMDRAWSUBTEXT  NEXT M  RETURN'------------------------.SETPALETTEFORBACKDROP'------------------------#DEFINE 1 = $DA ' 218#DEFIN.CHKREV'-------  IF REVFLAG& = 1 THEN PRINT "";:ELSE PRINT "";  RETURN'---------.PLAYDATA'---------  PRINT "";  IF VER = 3 THEN GOSUB DRAWFONTGUIDELINES  OFFS=0  PIDX% = 0  IF LASTFLAG = 1 THEN PIDX% = LASTGROUPIDX : LASTFLAG = 0  DO WHILE PIDX% < DIDX%    CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& = LDATA&(PIDX%) : PIDX% = PIDX% + 1    IF VER=3 AND VAL& = $FF THEN BEGIN      GOSUB DRAWFONTGUIDELINES      IF PI < = HOW PREVIOUS SONG CHUNK'           > = HOW NEXT SONG CHUNK'           - = ECREASE TEMPO'           + = NCREASE TEMPO'      + = UIT PROGRAM / XIT NV DITOR'          1 = OAD'          3 = AVE'          7 = NVELOPE EDITOR'          8 = ILTER EDITOR'   9/- = HUNK SEQUENCERTRAP RUNSTOPTRAPPER.DECLARATIONS'------------#DECLARE CHUNKIDX = 0#DECLARE CHUNKCNT = 0#DEFINE CHUNKMAX = 50#DECLARE VIDX, IDX#DECLARE CURSORX = 0#DECLARE CURSORY = 0#DECLARE V$(5,CHUNKMAX)#DECLARE KEY$#DECLARE VALID$="CDEFGAB0123456789 #$.HIQRSWOTUXMPL"#DECLARE VAL$#DECLARE TMPO% = 12#DECLARE ESCFLAG% = 0#STRUCT  NAME$, ATTACK, DECAY, SUSTAIN, RELEASE, WAVEFORM, PW ENVS(9) = [ _  [ "IANO",       0,  9,  0,  0,  2, 1536 ], _  [ "CCORDION",  12,  0, 12,  0,  1,    0 ], _  [ "ALLIOPE",    0,  0, 15,  0,  0,    0 ], _  [ "RUM",        0,  5,  5,  0,  3,    0 ], _  [ "LUTE",       9,  4,  4,  0,  0,    0 ], _  [ "UITAR",      0,  9,  2,  1,  1,    0 ], _  [ "ARPSICRD",   0,  9,  0,  0,  2,  512 ], _  [ "RGAN",       0,  9,  9,  0,  2, 2048 ], _  [ "RUMPET",     8,  9,  4,  1,  2,  512 ], _  [ "YLOPHONE",   0,  9,  0,  0,  0,    0 ]  _]#DEFINE ү = 0#DEFINE ү   = 1#DEFINE ү = 2#DEFINE ү  = 3#DECLARE DIRNAME$(3)DIRNAME$(0) = ""DIRNAME$(1) = ""DIRNAME$(2) = ""DIRNAME$(3) = ""#DEFINE Ư = 0#DEFINE Ư  = 1#STRUCT  NAME$, FREQ, LP, BP, HP, RES, DIR, MIN, SWEEP FILT(10) = [ _  [ "LOWPUP",    1000, Ư,  Ư, Ư, 15, ү,   100, 10 ], _  [ "LOWPDOWN",  1000, Ư,  Ư, Ư, 15, ү, 100, 10 ], _  [ "LOWPOSC",   1000, Ư,  Ư, Ư, 15, ү,  100, 10 ], __  [ "BANDPUP",   E 1 = $89 ' 137#DEFINE 1 = $00 ' 0#DEFINE 2 = $1B ' 27#DEFINE 2 = $42 ' 66#DEFINE 2 = $0B ' 11  FOR K = 12 TO 21    FLIPVAR = 1 + (2-1) * (K-12)/9    GOSUB FLIPNIBBLE    DEFAULTRED&(K) = FLIPVAR    DEFAULTRED&(43-K) = FLIPVAR    FLIPVAR = 1 + (2-1) * (K-12)/9    GOSUB FLIPNIBBLE    DEFAULTGREEN&(K) = FLIPVAR    DEFAULTGREEN&(43-K) = FLIPVAR    FLIPVAR = 1 + (2-1) * (K-12)/9    GOSUB FLIPNIBBLE    DEFAULTBLUE&(K) = FLIPVAR    DEFAULTBLUE&(43-K) = FLIPVAR  NEXT K  RETURN'-----------.FLIPNIBBLE'-----------  LOWERNIBBLE = FLIPVAR AND $0F  UPPERNIBBLE = (FLIPVAR >> 4) AND $0F  FLIPVAR = (LOWERNIBBLE << 4) + UPPERNIBBLE  RETURN.ANIMDRAWSUBTEXT'-----------------  IF M = 330 THEN BEGIN    SUBTEXTIDX = 1    PLEN = 0    EDMA 3,80,32,$40800+80*46  BEND  IF PLEN < LEN(SUBTEXT$(SUBTEXTIDX)) THEN BEGIN    PLEN = PLEN + .25    RAINBOWSTR$=LEFT$(SUBTEXT$(SUBTEXTIDX),PLEN)  "----------"  RETURN'---------.DRAWCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN'--------------------.CHECKALTKEYINPUTS'--------------------  ALTKEY = PEEK($D611) AND 16  IF ALTKEY = 0 THEN RETURN  IF A$=ٯ THEN GOSUB SCROLLCANVASLEFT  IF A$=ٯ THEN GOSUB SCROLLCANVASRIGHT  A$=""  RETURN'---------.DRAWINFO'---------  PRINT "";CHR$(27);"QFNAME=";FNAME$;"  DIDX%=";DIDX%;  RETURN'-------4   IF SUBTEXTIDX = 0 THEN RAINBOWX = 35:ELSE RAINBOWX = 33    RAINBOWY = 46    GOSUB PRINTRAINBOWSTR  BEND  RETURN.PRINTRAINBOWSTR'-----------------  CURSOR RAINBOWX, RAINBOWY  FOR RAINIDX=1 TO LEN(RAINBOWSTR$)    FOREGROUND MOD(RAIN%IDX, FX, FY, MIRROR, DATAADDR%, FRMX, FRMY#DECLARE FRMX1, FRMY1, SCRADDR%, CLRADDR%, CDATAADDR%, YY#DECLARE INC(3), INCDIR(3), A$, X, Y#DECLARE TEMPR, TEMPG, TEMPB, M#DECLARE LOGOSTATE#DECLARE FLIPVAR, UPPERNIBBLE, LOWERNIBBLE#DECLARE CLR1,  1000, Ư, Ư,  Ư, 15, ү,   100, 10 ], _  [ "BANDPDOWN", 1000, Ư, Ư,  Ư, 15, ү, 100, 10 ], _  [ "BANDPOSC",  1000, Ư, Ư,  Ư, 15, ү,  100, 10 ], __  [ "HIGHPUP",   1000, Ư, Ư, Ư,  15, ү!,   100, 10 ], _  [ "HIGHPDOWN", 1000, Ư, Ư, Ư,  15, ү, 100, 10 ], _  [ "HIGHPOSC",  1000, Ư, Ư, Ư,  15, ү,  100, 10 ], __  [ "SPARE1",    0,    Ư, Ư, Ư, 0,  ү, 0,   0  ], _  [ "SPARE2",    "0,    Ư, Ư, Ư, 0,  ү, 0,   0  ], __]#DECLARE SEQCHUNK(200), SEQEXTRA(200)#DECLARE ECHOM, ECHOB, ECHOSZ = .05, CHUNKRPT, ECHODELAY#DECLARE V1$, V2$, V3$, V4$, V5$, V6$#DECLARE TMP#DECLARE SSCOL, S, SEQOFFS#DEFINE Я# = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE  = $D060#DEFINE  = $D061#DEFINE  = $D062.CMDS#DEFINE į = -1#DEFINE į = -2#DEFINE į = -3#DEFINE įϯ1 = -4   '$ ECHO MELODY: VOICE 1 ON VOICE 4#DEFINE įϯ2 = -5   ' ECHO MELODY: VOICE 1 ON VOICE 2 + 4 + 5#DEFINE įϯ  = -6   ' ECHO BASS:   VOICE 3 ON VOICE 6#DEFINE įϯ = -7#DEFINE įϯ = -8#DEFINE į = -9#DEFINE į =% -10#DEFINE į = 11#DECLARE SEQCMDNAME$(10)SEQCMDNAME$(1) = ""SEQCMDNAME$(2) = ""SEQCMDNAME$(3) = ""SEQCMDNAME$(4) = "ϯ1"SEQCMDNAME$(5) = "ϯ2"SEQCMDNAME$(6) = "ϯ"SEQCMDNAME$(7) = "ϯ"SEQCMDNAME&CLR2, TSTART#DECLARE BASSTATE = 0#DECLARE FRMY(3), ORIGFRMY(3), FINISHCNT, BCNT#DECLARE LOC, INC%  #DECLARE RAINIDX, PLEN, RAINBOWSTR$, RAINBOWX, RAINBOWY  #DECLARE SUBTEXT$(2)  #DECLARE SUBTEXTIDX = 0  SUBTEXT$(0) = "PRESENTS..."  SUBTEX'T$(1) = "A SONG BY..."#DEFINE ͯ = 0#DEFINE ͯ = 1#DEFINE ͯ = 2#DEFINE ͯ = 3#DECLARE ǯ7 = $D05D#DEFINE  = $D060#DEFINE  = $D062  ' PALETTE  ' -------  #DECLARE DEFAULTRED&(32)  #DECLARE DEFAULTGREEN&(32)  #DECLARE DEFAULTBLUE&(32)  #DECLARE CURRRED&(32)  #DECLARE CURRGREEN&(32)  #DECLARE CURRBLUE&(32)  #DECLARE FADEVAL, TEMPVAL.OFFSETS#DEFINE ԯ  = 0#DEFINE ԯͯ = 2#DEFINE ԯ0     = 3#DEMOD(PTR,65536)    FRMX = PEEK(PTR + ͯԯ)    FRMY = PEEK(PTR + ͯԯ)    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    FRMX1=FRMX+FRMW-1    FRMY1=FRMY+FRMH-1    DATAADDR% = MOD(PTR, 65536)    DATAADDR% = DATAADDR% + ͯԯ    CDATAADDR% = DATAADDR% + FRMW * FRMH    BANK 4    FOR Y = 0 TO FRMY1-FRMY      FOR X = 0 TO FRMX1-FRMX        IF PEEK(DATAADDR% + X + Y * FRMW) = 102 THEN BEGIN          POKE (CDATAADDR% + X + Y * FRMW), $FF        BEND      NEXT X    NEXT Y    BANK 128        'PRINT "PTR=";HEX$(PTR);", IDX=";FRMIDX;", W=";FRMW;", H=";FRMH    PTR = PTR + ͯԯ + FRMW * FRMH * 2    'PRINT "FRMIDX=";FRMIDX    FRMIDX = FRMIDX + 1  LOOP  PTR = TMP  RETURN'---------------------------.INCREMENTPTRTONEXTFREE'---------------------------  PTR = TMP  SZ = WPEEK(PTR + ԯ)  'PRINT  'PRINT "INC SZ = ";SZ  'PRINT "PTR = ";HEX$(PTR + ԯ)  PTR = PTR + SZ  'GET KEY A$  RETURN'--------.DRAWBAS'--------  FRAMEIDX = ͯ  FX=-999 : FY = -999  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=FRMY(0)  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=FRMY(1) 0 TO 128        ' FADECOLOURSTODEFAULTS        BANK 0:VSYNC 10:SYS $7E03, FADEVAL:BANK 128        FADEVAL = FADEVAL + 1      NEXT FADEVAL      LOGOSTATE = ԯ    BEND  BEND  IF LOGOSTATE = ԯ THEN BEGIN    PRINT "ANATHEMA!";  BEND  DO  LOOP WHILE (TI-TSTART) < .03  GOTO STATELOOP  RETURN'----------.INIT80X50'----------  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $FD  ' SWITCH TO 80X50  ' SETBIT ǯ7, 7  ' POKE $D031, $E8 ' 1110 1000 = 640,,,400  PRINT CHR$(27);"5";  ' WPOKE , $0800  ' POKE , $04  RETURN'-------------.DRAWBACKDROP'-------------    FRAMEIDX = ͯ    FX=-999 : FY = -999    MIRROR = 0    GOSUB DRAWPETSCIIFRAME 	   RETURN'------------.ANIMATELOGO'------------  IF BASSTATE = 0 THEN BEGIN    ORIGFRMY(0) = 6    ORIGFRMY(1) = 23    ORIGFRMY(2) = 6    FRMY(0) = -44    FRMY(1) = -69    FRMY(2) = -107    BASSTATE = 1    INCDIR(0) = 1    INC(0) =
 1    INCDIR(1) = 1    INC(1) = 1    INCDIR(2) = 1    INC(2) = 1    INCDIR(3) = 1    INC(3) = 1  BEND  IF BASSTATE = 1 THEN BEGIN    FINISHCNT = 0    FOR K = 0 TO 2      IF FRMY(K) < ORIGFRMY(K) THEN BEGIN        FRMY(K) = FRMY(K) + 2        IF FRMY(K) > ORIGFRMY(K) THEN FRMY(K) = ORIGFRMY(K)      BEND      IF FRMY(K) = ORIGFRMY(K) THEN FINISHCNT = FINISHCNT OR 2^K    NEXT K  BEND  GOSUB DRAWBAS  GOSUB PAGEFLIP  FOR FRAMEIDX = 0 TO 2    IF FINISHCNT AND 2^FRAMEIDX AND BCNT(FRAMEIDX)<3 THEN BEGIN      INC(FRAMEIDX) = INC(FRAMEIDX) + .2 * INCDIR(FRAMEIDX)      IF INC(FRAMEIDX) < .6 THEN BEGIN        INCDIR(FRAMEIDX) = 1        BCNT(FRAMEIDX)=BCNT(FRAMEIDX)+1      BEND      IF INC(FRAMEIDX) > 2.9 THEN BEGد֯ = 236#DECLARE دǯ̯ = 127#DECLARE دǯ̯ = 255#DECLARE دů = 98#DECLARE دů = 226#DECLARE دů = 97#DECLARE دů = 225#DECLARE د = 32#DECLARE د = 160#DECLARE IN        INCDIR(FRAMEIDX) = -1        BCNT(FRAMEIDX)=BCNT(FRAMEIDX)+1      BEND      IF BCNT(FRAMEIDX) = 2 AND INC(FRAMEIDX) > 1 THEN BEGIN        INC(FRAMEIDX) = 1        BCNT(FRAMEIDX)=BCNT(FRAMEIDX)+1      BEND    BEND    BEND  NEXT FRAM!EIDX    RETURN'----.INIT'----  BANK 0:BLOAD "ASMHELPER":BANK 128  LOGOSTATE = 0  GOSUB STOREDEFAULTCOLOURS  INCDIR(3) = -1  INC(3) = 1  ' CLEAR DMA LIST AREA  FOR K = 0 TO 20    POKE $40000+K, 0  NEXT K  POKE $40000, $81 ' OPT = x*X ACAC1:I(AC):AD3,I:ACAC1:AG204:!3,AG,.,AD4:AGHI2:!0,AG,AC,AD20:ACACAG:ADAD20AG:AEAE20AG:AF:AD327680:AD0,AE ~*Y  *Z "SAVE NAME: ";C$:C$"" *[ D327680(3276800):(C$):(C$),P(327680)P(D): -+\ AE(3276800):D3276803:AF.E1:H(D2):I(D3):AEAEHI:DD20HI2:AF: X+] "SAVE NAME (OPTIMISED): ";C$:C$"" +^ (C$):#2,(C$",P"),W,U8:2,(1);:2,(2);: 92:2,((AE,256)); ,_ 2,((AE256));:2,(E);:D3276803:F.E1:B(D0):C(D1):H(D2):I(D3):2,(B);(C);(H);(I); W,` AF.15:2,((D4AF));:AF:SD20:TD20HI:AF.HI1:Y(TAF) k,a (SAF)102 x,b Y255: ,c 2,(Y);:AF:DD20HI2:F:#2: -d 264192NO80,J:267911168NO80,K:264192PQ80,L:267911168PQ80,M:E(3276802): 143:D327680G:AS1 -e  102: F-f D0,N:D1,O:D2,BN1:D3,CO1 Q-g AS m-h AG204:!3,AG,.,D4: -i DD20:VOC:UNB:D,(264192UV80):DD1:U:V:VOC:UNB:D,(267911168UV80):DD1:U:V -j AS .k 3276800,D327680:3276802,E1: Z.l A.,49:A$;"FRAME COUNT=";(3276802);:", NEXT-FREE=$";(D);:A.,.:AS.: {.m "";A$;:"FRAME#";R: 124: .n  117:AAD:EE1:3276802,E: 115 .o RE .p RR1 .q :: 116: .r  124: ,/s  122:ABD:H(AB2):I(AB3):AE(3276800):AEAE(20HI2):3276800,AE: u/t  122:ABD:H(AB2):I(AB3):ZAB20HI2:AGAAZ1:!0,AG,Z,AB: /u E(3276802):D3276803:F. /v FE /w A.,.:A$;"INVALID BLOCK#!": /x  /y F.E1:H(D2):I(D3):DD20HI2:F: (0z E(3276802):D3276803:F.E:FR T0{ H(D2):I(D3):DD20HI2:F:D.: u0| E(3276802):D3276803:F. 0} FE 0~ A.,.:A$;"INVALID BLOCK#!": 0  0  122:D."NOT FOUND!": @1 B(D0):C(D1):H(D2):I(D3):PBH1:QCI1:"";A$;:"X=";B;", Y=";C;", W=";H;", H=";I;:", PTR=$";(D); 1 "";(27);"J";A$;"FRAME=";R;:", NXT=$";(D20HI2);:SD20:TD20HI:W264192BC80:X267911168BC80:VCQ:!0,H,S,W 1 !0,H,T,X:SSH:TTH:WW80:XX80:V: 1 AR0 %2 264192BC80,J:267911168BC80,K X2 ::264192BC80,L:267911168BC80,M: ^2  2 264192BC80,43:267911168BC80,1: 2 A.,49:A$;"FRAME COUNT=";(3276802);", NEXT-FREE=$";:(D);: 2 AR0 3 J(264192BC80):K(267911168BC80):NB:OC O3 ::L(264192BC80):M(267911168BC80):PB:QC: U3  p3 A.:AR0:B.:C.:R.: 3 E(3276802):F.:D3276803:1 3 FE 3 GD327680: 3  3 H(D2):I(D3):DD20HI2:FF1:: 
4 (393214)71(393215)73 i4 393214,18759:"";A$;:"MAGIC SIGNATURE APPLIED. RESET FRAME COUNT TO ZERO? (Y/N)";:B$ x4 B$"Y" 4 3276800,.:3276802,.: 4 "";A$;: 4  4 (393212)1 5 393212,.:R(393213): 122:N(D0):O(D1):BN(D2)1:CO(D3)1:AS.: 102 &5  124: ,5  5 53280,(53280)1: 81:D
(A&(.)):AGAKAI1:CAJAL:!0,AG,264192AIC80,D:DDAG:C 5 D
(B&(.)):CAJAL:!0,AG,267911168AIC80,D:DDAG:C:APAKAI1:AQALAJ1:53280,(53280)1: j6 AIB:AJC:AKBAP1:ALCAQ1:D
(A&(.)):AGAKAI1:CAJAL:!0,AG,D,264192AIC80:DDAG:C:D
(B&(.)):CAJAL 6 !0,AG,D,267911168AIC80:DDAG:C: 102: 122:N(D0):O(D1):BN(D2)1 6 CO(D3)1:AS.: 102: 6  CURRENTFRAME = :A: 7  X = :B: 7  Y = :C: "7  PTR = :D: :7  FRAMECOUNT = :E: M7  FRMIDX = :F: d7  BYTESUSED = :G: u7  FRMW = :H: 7  FRMH = :I: 7  STARTCHAR = :J: 7  STARTCOLOR = :K: 7  ENDCHAR = :L: 7  ENDCOLOR = :M: 7  STARTX = :N: 8  STARTY = :O: 8  ENDX = :P: (8  ENDY = :Q: ?8  CURRFRAME = :R: X8  SRCCHARPTR = :S: p8  SRCCLRPTR = :T: 8  XIDX = :U: 8  YIDX = :V: 8  DESTCHARPTR = :W: 8  DESTCLRPTR = :X: 8  CVAL = :Y: 8  STARTPTR = :Z: 9  ENDPTR = :AA: 9  CURRPTR = :AB: ,9  SRCPTR = :AC: B9  DESTPTR = :AD: R9  SZ = :AE: a9  K = :AF: q9  LN = :AG: 9  B = :AH: 9  X1 = :AI: 9  Y1 = :AJ: 9  X2 = :AK: 9  Y2 = :AL: 9  HBSE L = :AM: 9  HBMODE = :AN: 9  IDX = :AO: :  CLIPW = :AP:  :  CLIPH = :AQ: 9:  STORESTATE = :AR: U:  NEWFRAMEFLAG = :AS: j:  BXOFFS = :AT: x:   = :AU: :   = :A%: :  CLRLINERIGHT$ = :A$: :  A$ = :B$: :  FNAME$ = :C$: : V   = :D$: :  CLIPBOARDCHAR& = :A&: ;  CLIPBOARDCLR& = :B&: ;   = :C&:                                                                                                                                                                            " DEST ADDR  SELECTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $0#0 '  LSB =   WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C, $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    '  MSB (IGNORE)  WPOKE $40010, $0000 '$ MODULO (IGNORE)  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32, $50000  EDMA 3, $FA0, 0, $51000  ' INIT VAR INTERFACE TO ASSEMBLY  LOC = $40020  PTR = POINTER(DEFAULTRED&(0))  GOSUB STOREPTR  PTR = POINTER(DEFAULTGREEN&(0))  GOSUB STORE%PTR  PTR = POINTER(DEFAULTBLUE&(0))  GOSUB STOREPTR  PTR = POINTER(CURRRED&(0))  GOSUB STOREPTR  PTR = POINTER(CURRGREEN&(0))  GOSUB STOREPTR  PTR = POINTER(CURRBLUE&(0))  GOSUB STOREPTR  PTR = POINTER(DATAADDR%)  GOSUB STOREPTR&  PTR = POINTER(CDATAADDR%)  GOSUB STOREPTR  PTR = POINTER(SCRADDR%)  GOSUB STOREPTR  PTR = POINTER(CLRADDR%)  GOSUB STOREPTR  PTR = POINTER(INC%)  GOSUB STOREPTR  RETURN'---------.STOREPTR'---------  WPOKE LOC, PTR  LOC = LOC +' 2  RETURN'---------.LOADDATA'---------  PTR = $42000    BLOAD "BAS.BIN",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  RETURN'-------------------.INITPETSCIIFRAMES'-------------------  TMP = PTR  MAXFRAMES =  PEEK(PTR + ԯͯ)  'PRINT  'PRINT "PTR=";HEX$(PTR + ԯͯ)  PTR = PTR + ԯ0  'PRINT  'PRINT "- MXFRM=";MAXFRAMES;": "  FRMIDX = 0  DO WHILE FRMIDX < MAXFRAMES    'PRINT FRMIDX;    FRAMEADDR%(FRMIDX) = IN    GOSUB FADETOWHITE    LOGOSTATE = ԯׯЯ  BEND    IF LOGOSTATE = ԯׯЯ THEN BEGIN    BANK 128    POKE $D020, 1, 1    GOSUB INIT80X50    GOSUB DRAWBACKDROP    GOSUB PAGEFLIP    GOSUB STORECURRCOLOURS    GOSUB SETPALETTEFORBACKDROP    FADEVAL=0    M=0    LOGOSTATE = ԯůϯ  BEND    IF LOGOSTATE = ԯůϯ THEN BEGIN    IF FADEVAL <= 128 THEN BEGIN      ' FADECOLOURSTODEFAULTS      BANK 0:VSYNC 10:SYS $7E03, FADEVAL:BANK 128      FADEVAL = FADEVAL + 1    BEND    ' CYCLEALTPALETTE    BANK 0:SYS $7E06:BANK 128    M = M + 1    IF M = 130 THEN LOGOSTATE = ԯЯί  BEND  IF LOGOSTATE = ԯЯί THEN BEGIN    GOSUB ANIMATELOGO    ' CYCLEALTPALETTE    BANK 0:SYS $7E06:BANK 128    M = M + 1    IF M > 250 THEN LOGOSTATE = ԯ:FADEVAL = 0  BEND  IF LOGOSTATE = ԯ THEN BEGIN    GOSUB ANIMDRAWSUBTEXT    ' CYCLEALTPALETTE    BANK 0:SYS $7E06:BANK 128    M = M + 1    IF M > 360 THEN BEGIN      ' FADE TO BLACK      BANK 0:SYS $7E0C, FADEVAL:BANK 128      FADEVAL = FADEVAL + 1    BEND    IF FADEVAL = 128 THEN BEGIN      POKE $D020, 0, 0      PRINT "";      GOSUB STORECURRCOLOURS      FOR FADEVAL = ;  A$(27)"Q": AH(50,3):AM0: A&(8050): B&(8050): i   AT(3):AT(.)4:AT(1)8:AT(2)12:AT(3)16   $:53280,11,14: 142: 148: 154: 143: 137   1: 138: 136: 18: 5:   A.,49:A$;   AR0   (27)"QX=";B;", Y=";C;: ! AR1 A!	 (27)"QX=";N;", Y=";O;:", W=";BN1;", H=";CO1;: L!
 A$;: v! 1: 138: 136:B$:B$(13) 132 ! B$""B.BB1 ! B$""B79BB1 ! B$""C.CC1 ! B$""C49CC1 ! B$(13) ! :  " B$:B$" " 132 " B$""B.BB1 -" B$""B79BB1 C" B$""C.CC1 Z" B$""C49CC1 l" B$"D" 110 ~" B$"Y" 158 " B$"P" 160 " B$"C" " "";:R.: 124: " B$"-"R. " RR1: 124: " B$"="R(327682)1 	# RR1: 124: #  B$" " '#! ARAR1 4#" AR2 C##  100:: J#$  \#% B$"L" 109 k#& B$"X" }#' A.,.::: #( B$"E" #) A.,40:393212,1:393213,R::: #* B$"" 85 #+ B$"" 90 #, B$"" 93 #- B$"" 47 
#.  $/ AN0:1: 61: 55: 72 8$0 B$"X"B$(27)B$"" P$1 (147);: 124:: X$2 : u$3 (264192BC80)32 $4 AFAF128 $5 ::267911168BC80,1: $6 264192BC80,AF: %7  124: 122:AO.3:AI(DAT(AO)):AJ(DAT(AO)1):AK(DAT(AO)2):AL(DAT(AO)3) 6%8 (AI.AJ.AK.AL.) %9 BAI:CAJ:AF112: 51:BAK:CAJ:AF110: 51:BAI:CAL:AF109: 51:BAK:CAL:AF125: 51 %: BAI1AK1:CAJ:AF64: 51:CAL:AF64: 51:B:CAJ1AL1:BAI:AF93: 51 %; BAK:AF93: 51:C: &< AO: )&=  122:ABD:AM."";:ՙ""; f&> A40,40:(27);"Q  HEAD: ";:AF4: 84:AM1"";:ՙ""; &? A40,41:(27);"Q TORSO: ";:AF8: 84:AM2"";:ՙ""; &@ A40,42:(27);"Q  FEET: ";:AF12: 84:AM3"";:ՙ""; 'A A40,43:(27);"QATTACK: ";:AF16: 84:"";: 71: ('B AM.AF4 7'C AM1AF8 G'D AM2AF12 W'E AM3AF16 ]'F  m'G  66: 83: 'H B$:B$""AM.AMAM1 'I B$""AM3AMAM1 'J B$"-"R. 'K RR1: 124: 'L B$"="R(327682)1 'M RR1: 124: (N B$(13) J(O  81: 66:ABAF,AI:ABAF1,AJ:ABAF2,AK:ABAF3,AL: P(P  (Q BAI:CAJ:AR0: 11:AIB:AJC:AR1: 11:AKB:ALC:264192NO80,J:267911168NO80,K:264192PQ80,L (R 267911168PQ80,M: )S AI(ABAF):AJ(ABAF1):AK(ABAF2):AL(ABAF3): 7)T  83:AI;",";AJ;",";AK;",";AL;: V)U "LOAD NAME: ";C$:C$"" m)V (C$),P(327680): )W AC270336:AD327680:E(AC):AD2,E:ACAC1:ADAD3:AE3:AF.E1:AD0,(AC):ACAC1:AD1,(AC):ACAC1:H(AC):AD2,H                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )&                                                                                                                                                                                                                                                                                                                                                                                                                                                       ?                                        @@@@@@@@@@@@             @@@@@@@@        AAAAAAAAAAAAAAAAAAAAAAAA      AAAAAAAAAAAAAAAAA      BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB    CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC   DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD  EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE  FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF   GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG  HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII  JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ  LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL   MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM  NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN  OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB    BBBBBBBBBBBBBBBBBBBB   CCCCCCCCCCCCCC                            CCCCCCCCC    DD  DDD              =                                                                                                                                                                                                        TE  ' -------  #DECLARE DEFAULTRED&(32)  #DECLARE DEFAULTGREEN&(32)  #DECLARE DEFAULTBLUE&(32)  #DECLARE CURRRED&(32)  #DECLARE CURRGREEN&(32)  #DECLARE CURRBLUE&(32)  #DECLARE FADEVAL, TEMPVAL.OFFSETS#DEFINE ԯ  = 0#DEFI NE ԯͯ = 2#DEFINE ԯ0     = 3#DEFINE ͯԯ          = 0#DEFINE ͯԯ          = 1#DEFINE ͯԯ          = 2#DEFINE ͯԯ          = 3#DEFINE ͯԯ   = 4#DEFINE ͯԯ¯  !  = 4#DEFINE ͯԯ¯   = 8#DEFINE ͯԯ¯    = 12#DEFINE ͯԯ¯  = 16#DEFINE ͯԯ       = 20'----.MAIN'----  GOSUB INIT  GOSUB LOADDATA  GOSUB STATELOOP  GOSUB ANIMATELOGO  END#DEFINE  ԯůϯ = 0#DEFINE ԯׯЯ = 1#DEFINE ԯůϯ = 2#DEFINE ԯЯί = 3#DEFINE ԯ = 4#DEFINE ԯ = 5'----------.STATELOOP'----------  TSTART = TI  IF LOGOSTATE = ԯůϯ THEN BEG# "----------"  RETURN'---------.DRAWCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN'--------------------.CHECKALTKEYINPUTS'--------------------  ALTKEY = PEEK($D611) AND 16 $ IF ALTKEY = 0 THEN RETURN  IF A$=ٯ THEN GOSUB SCROLLCANVASLEFT  IF A$=ٯ THEN GOSUB SCROLLCANVASRIGHT  A$=""  RETURN'---------.DRAWINFO'---------  PRINT "";CHR$(27);"QFNAME=";FNAME$;"  DIDX%=";DIDX%;  RETURN'-------%.CHKREV'-------  IF REVFLAG& = 1 THEN PRINT "";:ELSE PRINT "";  RETURN'---------.PLAYDATA'---------  PRINT "";  IF VER = 3 THEN GOSUB DRAWFONTGUIDELINES  OFFS=0  PIDX% = 0  IF LASTFLAG = 1 THEN PIDX% = LASTGROUPIDX : LASTFLAG = 0&  DO WHILE PIDX% < DIDX%    CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& = LDATA&(PIDX%) : PIDX% = PIDX% + 1    IF VER<>2 AND VAL& = $FF THEN BEGIN      GOSUB DRAWFONTGUIDELINES      IF P'IDX% > LASTGROUPIDX THEN LASTGROUPIDX = PIDX%      GOTO PDENDLOOP    BEND    'IF VAL& = $FF THEN GROUPFLAG& = 1 : GOTO PDENDLOOP    'IF VAL& = $FE THEN GROUPFLAG& = 0 : SLEEP .02 : GOTO PDENDLOOP    X = VAL& AND $7F    IF VER=2 THEN BEGIN      X = VAL&      VAL& = LDATA&(PIDX%)      PIDX% = PIDX% + 1      X = X + (VAL& AND $7F) * 256    BEND    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% +0      POKE $50000 + ԯͯ, 0    BEND    PRINT "";CLRLINERIGHT$;  BEND  RETURN'---------------.CHECKEDITFLAG'---------------  IF PEEK($5FFFC) = 1 THEN BEGIN ' EDITING?    POKE $5FFFC, 0    CURRFRAME = PEEK($5FFFD)    GOSUB GETCURRFRAMEPTR    STARTX = PEEK(PTR + ͯԯ)    STARTY = PEEK(PTR + ͯԯ)    X = STARTX + PEEK(PTR + ͯԯ) - 1    Y = STARTY + PEEK(PTR + ͯԯ) - 1    NEWFRAMEFLAG = 0    GOSUB SAVEFRAMETOMEMORYATPTR    GOSUB DRAWCURRFRAME  BEND  RETURN'--------------.YANKSELECTION'--------------  POKE $D020, PEEK($D020) + 1  ' SELECT A REGION WITH CURSOR MOVEMENT  GOSUB GETSELECTEDCOORDSINTOX1Y1X2Y2  ' COPY IT INTO A BASIC VAR  PTR = POINTER(CLIPBOARDCHAR&(0))  LN = X2-X1+1  FOR Y = Y1 TO Y2    EDMA Я, LN, $40800+X1+Y*80, PTR    PTR = PTR + LN  NEXT Y  PTR = POINTER(CLIPBOARDCLR&(0))  FOR Y = Y1 TO Y2    EDMA Я, LN, $FF80000+X1+Y*80, PTR    PTR = PTR + LN  NEXT Y  CLIPW = X2-X1+1  CLIPH = Y2-Y1+1  POKE $D020, PEEK($D020) - 1  RETURN'-----.PASTE'-----  ' COPY SELECTION FROM VARS ONTO SCREEN AT CURRENT CURSOR POSITION  X1 = X  Y1 = Y  X2 = X + CLIPW - 1  Y2 = Y + CLIPH - 1  PTR = POINTER(CLIPBOARDCHAR&(0))  LN = X2-X1+1  FOR Y = Y1 TO Y2    EDMA Я, LN, PTR, $40800+X1+Y*80    PTR = PTR + LN  NEXT Y  PTR = POINTER(CLIPBOARDCLR&(0))  FOR Y = Y1 TO Y2    EDMA Я, LN, PTR, $FF80000+X1+Y*80    PTR = PTR + LN  NEXT Y  ' : RE-SAVE CURRENT FRAME  GOSUB SAVEFRAMETOMEMORYATPTR  GOSUB GETCURRFRAMEPTR  STARTX = PEEK(PTR + ͯԯ)  STARTY = PEEK(PTR + ͯԯ)  X = STARTX + PEEK(PTR + ͯԯ) - 1  Y = STARTY + PEEK(PTR + ͯԯ) - 1  NEWFRAMEFLAG = 1 0  GOSUB SAVEFRAMETOMEMORYATPTR  RETURN                                                                                                                                                                                                              	@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA     BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB      CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC      DDDDDDDDDDDDDDDDDD
DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD       EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE      FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF     GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG     HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII    JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ    KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK    LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL     MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM    MMMMMMMMMMMMMMMMMMMM        NNNNNNNNNNNNNN                                NNNNNNNNN           NN  NNN                                                                             $                                                                                                                                                                                                                                                              
&                                                                                                                                                                  ------------------------  POKE PTR + ͯԯ, STARTX  POKE PTR + ͯԯ, STARTY  POKE PTR + ͯԯ, X - STARTX + 1  POKE PTR + ͯԯ, Y - STARTY + 1  IF NEWFRAMEFLAG THEN BEGIN    LN = ͯԯ - ͯԯ    EDMA Я, LN, 0, PTR + ͯԯ  BEND  PTR = PTR + ͯԯ  FOR YIDX = STARTY TO Y    FOR XIDX = STARTX TO X     POKE PTR, PEEK($40800 + XIDX + YIDX * 80)     PTR = PTR + 1    NEXT XIDX  NEXT YIDX  FOR YIDX = STARTY TO Y    FOR XIDX = STARTX TO X     POKE PTR, PEEK($FF80000 + XIDX + YIDX * 80)     PTR = PTR + 1    NEXT XIDX  NEXT YIDX  IF NEWFRAMEFLAG THEN BEGIN    WPOKE $50000 + ԯ, PTR - $50000    POKE $50000 + ԯͯ, FRAMECOUNT + 1  BEND  CURSOR 0,49  PRINT CLRLINERIGHT$;"FRAME COUNT=";PEEK($50000 + ԯͯ);  PRINT ", NEXT-FREE=$";HEX$(PTR);  CURSOR 0,0  NEWFRAMEFLAG = 0  RETURN'----------.LOADFRAME'----------  PRINT "";CLRLINERIGHT$;  INPUT "FRAME#";CURRFRAME  GOSUB DRAWCURRFRAME  RETURN'------------.DELETEFRAME'------------  GOSUB GETENDPTR  ENDPTR = PTR  ' DECREMENT FRAME COUNT  FRAMECOUNT = FRAMECOUNT - 1  POKE $50000 + ԯͯ, FRAMECOUNT  GOSUB DELETEFRAMESIZEFROMTOTAL  IF CURRFRAME = FRAMECOUNT THEN BEGIN    CURRFRAME = CURRFRAME - 1  BEND : ELSE BEGIN    GOSUB SHIFTREMAININGFRAMESALONG  BEND  GOSUB DRAWCURRFRAME  RETURN'----------------------------.DELETEFRAMESIZEFROMTOTAL'----------------------------  GOSUB GETCURRFRAMEPTR  CURRPTR = PTR  FRMW = PEEK(CURRPTR + ͯԯ)  FRMH = PEEK(CURRPTR + ͯԯ)  SZ = WPEEK($50000 + ԯ)  SZ = SZ - (ͯԯ + FRMW * FRMH * 2)  WPOKE $50000 + ԯ, SZ  RETURN'----------------------------.SHIFTREMAININGFRAMESALONG'----------------------------  GOSUB GETCURRFRAMEPTR  CURRPTR = PTR  FRMW = PEEK(CURRPTR + ͯԯ)  FRMH = PEEK(CURRPTR + ͯԯ)  STARTPTR = CURRPTR + ͯԯ + FRMW * FRMH * 2  LN = ENDPTR - STARTPTR + 1  ' PRINT "CURRPTR = ";HEX$(CURRPTR)  ' PRINT "STARTPTR = ";HEX$(STARTPTR)  ' PRINT "ENDPTR = ";HEX$(ENDPTR)  ' PRINT "LN = ";HEX$(LN)  ' GET KEY A$  ' A$=""  EDMA Я, LN, STARTPTR, CURRPTR    RETURN'-----------.GETENDPTR'-----------  FRAMECOUNT = PEEK($50000 + ԯͯ)  PTR = $50000 + ԯ0  FRMIDX = 0  IF FRMIDX >= FRAMECOUNT THEN BEGIN    CURSOR 0,0    PRINT CLRLINERIGHT$;"INVALID BLOCK#!"    RETURN  BEND  ' TRAVERSE TO FIND BLOCK  FOR FRMIDX = 0 TO FRAMECOUNT - 1    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT FRMIDX  RETURN'------------------.GETCURRFRAMEPTR'------------------  FRAMECOUNT = PEEK($50000 + ԯͯ)  ' TRAVERSE TO FIND BLOCK  PTR = $50000 + ԯ0  FOR FRMIDX = 0 TO FRAMECOUNT    IF FRMIDX = CURRFRAME THEN RETURN    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT FRMIDX  PTR = 0  RETURN'---------------.DRAWCURRFRAME'---------------  FRAMECOUNT = PEEK($50000 + ԯͯ)  PTR = $50000 + ԯ0  FRMIDX = 0  IF FRMIDX >= FRAMECOUNT THEN BEGIN    CURSOR 0,0    PRINT CLRLINERIGHT$;"INVALID BLOCK#!"    RETURN  BEND  GOSUB GETCURRFRAMEPTR  IF PTR = 0 THEN PRINT "NOT FOUND!" : RETURN    X = PEEK(PTR + ͯԯ)  Y = PEEK(PTR + ͯԯ)  FRMW = PEEK(PTR + ͯԯ)  FRMH = PEEK(PTR + ͯԯ)  ENDX = X + FRMW - 1  ENDY = Y + FRMH - 1  PRINT "";CLRLINERIGHT$;  PRINT "X=";X;", Y=";Y;", W=";FRMW;", H=";FRMH;  PRINT ", PTR=$";HEX$(PTR);  PRINT "";CHR$(27);"J";CLRLINERIGHT$;"FRAME=";CURRFRAME;  PRINT ", NXT=$";HEX$(PTR + ͯԯ + FRMW * FRMH * 2);  SRCCHARPTR = PTR + ͯԯ  SRCCLRPTR = PTR + ͯԯ + FRMW * FRMH  DESTCHAR PTR =$40800 + X + Y * 80  DESTCLRPTR = $FF80000 + X + Y * 80  FOR YIDX = Y TO ENDY    EDMA Я, FRMW, SRCCHARPTR, DESTCHARPTR    EDMA Я, FRMW, SRCCLRPTR, DESTCLRPTR    SRCCHARPTR = SRCCHARPTR + FRMW    SRCCLRPTR = SRCCLR!PTR + FRMW    DESTCHARPTR = DESTCHARPTR + 80    DESTCLRPTR = DESTCLRPTR + 80  NEXT YIDX  RETURN'-------------------------.RESTORECHARUNDERCURSOR'-------------------------  IF STORESTATE = ůԯ THEN BEGIN    POKE $40800" + X + Y * 80, STARTCHAR    POKE $FF80000 + X + Y * 80, STARTCOLOR  BEND:ELSE BEGIN  ' ůį    POKE $40800 + X + Y * 80, ENDCHAR    POKE $FF80000 + X + Y * 80, ENDCOLOR        BEND  RETURN'-----------.DRAWCURSOR'-----------  POK#E $40800 + X + Y * 80, 43  POKE $FF80000 + X + Y * 80, 1  RETURN'-----------.DRAWFOOTER'-----------  CURSOR 0,49  PRINT CLRLINERIGHT$;"FRAME COUNT=";PEEK($50000 + ԯͯ);", NEXT-FREE=$";  PRINT HEX$(PTR);  RETURN'-------------$---.STORESTATEINFO'----------------  IF STORESTATE = ůԯ THEN BEGIN    STARTCHAR = PEEK($40800 + X + Y * 80)    STARTCOLOR = PEEK($FF80000 + X + Y * 80)    STARTX = X    STARTY = Y  BEND:ELSE BEGIN ' ůį    ENDCHAR = %PEEK($40800 + X + Y * 80)    ENDCOLOR = PEEK($FF80000 + X + Y * 80)    ENDX = X    ENDY = Y  BEND  RETURN'---------.INITVARS'---------  CURRENTFRAME = 0  STORESTATE = ůԯ  X = 0  Y = 0  CURRFRAME = 0  RETURN  '-------&--------------.LOCATENEXTFREEBYTE'---------------------  FRAMECOUNT = PEEK($50000 + ԯͯ)  FRMIDX = 0  PTR = $50000 + ԯ0  DO WHILE 1    IF FRMIDX = FRAMECOUNT THEN BEGIN      BYTESUSED = PTR-$50000      RETURN  '  BEND    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PTR = PTR + ͯԯ + FRMW * FRMH * 2    FRMIDX = FRMIDX + 1  LOOP  RETURN'---------------------.CHECKMAGICSIGNATURE'---------------------  IF PEEK( $5FFFE) <> 71 OR PEEK($5FFFF) <> 73 THEN BEGIN    WPOKE $5FFFE, $4947    PRINT "";CLRLINERIGHT$;    PRINT "MAGIC SIGNATURE APPLIED. RESET FRAME COUNT TO ZERO? (Y/N)";    GET KEY A$    IF A$ = "Y" THEN BEGIN      WPOKE $50000 + ԯ, 80000 + ENDX + ENDY * 80, ENDCOLOR  RETURN'----------------------------------.PEEKSELECTEDCOORDSINTOX1Y1X2Y2'----------------------------------  X1 = PEEK(CURRPTR + K)  Y1 = PEEK(CURRPTR + K + 1)  X2 = PEEK(CURRPTR + K + 2)  Y2 = PEEK(CURRPTR + K + 3)  RETURN'------------------.SHOWHITBOXCOORDS'------------------  GOSUB PEEKSELECTEDCOORDSINTOX1Y1X2Y2  PRINT X1;",";Y1;",";X2;",";Y2;  RETURN'--------.LOADBIN'--------  INPUT "LOAD NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  BLOAD (FNAME$),P($50000)  ' GOSUB ONEOFFREPAIR  RETURN'--------------.ONEOFFREPAIR'--------------  ' INJECT SPACES WHERE NEEDED  SRCPTR = $42000  DESTPTR = $50000  FRAMECOUNT = PEEK(SRCPTR)  POKE DESTPTR + ԯͯ, FRAMECOUNT  SRCPTR = SRCPTR + 1  DESTPTR = DESTPTR + ԯ0  SZ = ԯ0  FOR K = 0 TO FRAMECOUNT - 1    POKE DESTPTR + ͯԯ, PEEK(SRCPTR)    SRCPTR = SRCPTR + 1    POKE DESTPTR + ͯԯ, PEEK(SRCPTR)    SRCPTR = SRCPTR + 1    FRMW = PEEK(SRCPTR)    POKE DESTPTR + ͯԯ, FRMW    SRCPTR = SRCPTR + 1    FRMH = PEEK(SRCPTR)    POKE DESTPTR + ͯԯ, FRMH    SRCPTR = SRCPTR + 1    LN = ͯԯ - ͯԯ    EDMA Я, LN, 0, DESTPTR + ͯԯ    LN = FRMW * FRMH * 2    EDMA Я, LN, SRCPTR, DESTPTR + ͯԯ    SRCPTR = SRCPTR + LN    DESTPTR = DESTPTR + ͯԯ + LN    SZ = SZ + ͯԯ + LN      NEXT K  DESTPTR = $50000  WPOKE DESTPTR + ԯ, SZ  RETURN'--------.SAVEBIN'--------  INPUT "SAVE NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  PTR = $50000 + WPEEK($50000 + ԯ)  DELETE (FNAME$)  BSAVE (FNAME$),P($50000) TO P(PTR)  RETURN'-------------------------------------.CALCULATEOPTIMISEDDATASIZEINTOSZ'-------------------------------------  SZ = WPEEK($50000 + ԯ)  PTR = $50000 + ԯ0  FOR K = 0 TO FRAMECOUNT - 1 	   FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    SZ = SZ - FRMW * FRMH    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT K  RETURN'--------------.SAVEOPTIMISED'--------------  INPUT "SAVE NAME (OPTIMISED): ";FNAME
$  IF FNAME$ = "" THEN RETURN  DELETE (FNAME$)  DOPEN #2,(FNAME$ + ",P"),W,U8  PRINT #2, CHR$(1);  PRINT #2, CHR$(2);  ' DUMMY ADDRESS  GOSUB CALCULATEOPTIMISEDDATASIZEINTOSZ    PRINT #2, CHR$(MOD(SZ, 256));  PRINT #2, CHR$(INT(SZ / 256));  PRINT #2, CHR$(FRAMECOUNT);  PTR = $50000 + ԯ0  FOR FRMIDX = 0 TO FRAMECOUNT - 1    X = PEEK(PTR + ͯԯ)    Y = PEEK(PTR + ͯԯ)    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PRINT #2, CHR$(X);CHR$(Y);CHR$(FRMW);CHR$(FRMH);    FOR K=0 TO 15      PRINT #2, CHR$(PEEK(PTR + ͯԯ + K));    NEXT K    SRCCHARPTR = PTR + ͯԯ    SRCCLRPTR = PTR + ͯԯ + FRMW * FRMH        FOR K = 0 TO FRMW * FRMH - 1      CVAL = PEEK(SRCCLRPTR + K)      IF PEEK(SRCCHARPTR + K) = 102 THEN BEGIN        CVAL = $FF      BEND      PRINT #2, CHR$(CVAL);    NEXT K    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT FRMIDX  DCLOSE #2  RETURN'------------------------.SAVENEWFRAMETOMEMORY'------------------------  POKE $40800 + STARTX + STARTY * 80, STARTCHAR  POKE $FF80000 + STARTX + STARTY * 80, STARTCOLOR  POKE $40800 + ENDX + ENDY * 80, ENDCHAR  POKE $FF80000 + ENDX + ENDY * 80, ENDCOLOR  FRAMECOUNT = PEEK($50000 + ԯͯ)  GOSUB LOCATENEXTFREEBYTE  PTR = $50000 + BYTESUSED  NEWFRAMEFLAG = 1  GOSUB SAVEFRAMETOMEMORYATPTR  RETURN'---------------------------.SAVEFRAMETOMEMORYATPTR'-------.MAIN'----  KEY OFF  POKE $D020, 11, 14  GOSUB INITVARS  GOSUB CHECKMAGICSIGNATURE  GOSUB CHECKEDITFLAG  GOSUB LOCATENEXTFREEBYTE  GOSUB DRAWFOOTER  DO WHILE 1    GOSUB STORESTATEINFO    GOSUB DRAWCURSOR    GOSUB GETUSERINPUT    GOSUB SHOWCOORDS  LOOP'-----------.SHOWCOORDS'-----------  CURSOR 0, 49  PRINT CLRLINERIGHT$;  IF STORESTATE = ůԯ THEN BEGIN    PRINT CHR$(27)+"QX=";X;", Y=";Y;  BEND  IF STORESTATE = ůį THEN BEGIN    PRINT CHR$(27)+"QX=";STARTX;", Y=";STARTY;    PRINT ", W=";X-STARTX+1;", H=";Y-STARTY+1;  BEND  PRINT CLRLINERIGHT$;  RETURN'-----------.ENTERCOORD'-----------  DO WHILE 1    GOSUB STORESTATEINFO    GOSUB DRAWCURSOR    GET KEY A$    IF A$ <> ٯ THEN GOSUB RESTORECHARUNDERCURSOR    IF A$ = ٯ AND X > 0 THEN X = X - 1    IF A$ = ٯ AND X < 79 THEN X = X + 1    IF A$ = ٯ AND Y > 0 THEN Y = Y - 1    IF A$ = ٯ AND Y < 49 THEN Y = Y + 1    IF A$=ٯ THEN EXIT  LOOP  RETURN'--------------.GETUSERINPUT'--------------  GETKEY A$  IF A$ <> " " THEN GOSUB RESTORECHARUNDERCURSOR  IF A$ = ٯ AND X > 0 THEN X = X - 1  IF A$ = ٯ AND X < 79 THEN X = X + 1  IF A$ = ٯ AND Y > 0 THEN Y = Y - 1  IF A$ = ٯ AND Y < 49 THEN Y = Y + 1  IF A$ = "D" THEN GOSUB DELETEFRAME  IF A$ = "Y" THEN GOSUB YANKSELECTION  IF A$ = "P" THEN GOSUB PASTE  IF A$ = "C" THEN BEGIN    PRINT "";    CURRFRAME = 0    GOSUB DRAWCURRFRAME  BEND  IF A$="-" AND CURRFRAME > 0 THEN BEGIN    CURRFRAME = CURRFRAME - 1    GOSUB DRAWCURRFRAME  BEND  IF A$="=" AND CURRFRAME < PEEK($50002)-1 THEN BEGIN    CURRFRAME = CURRFRAME + 1    GOSUB DRAWCURRFRAME  BEND  IF A$=" " THEN BEGIN    STORESTATE = STORESTATE + 1    IF STORESTATE = 2 THEN BEGIN      GOSUB SAVENEWFRAMETOMEMORY      END    BEND  BEND  IF A$="L" THEN GOSUB LOADFRAME  IF A$="X" THEN BEGIN    CURSOR 0,0    KEY ON    END  BEND  IF A$="E" THEN BEGIN    CURSOR 0,40    POKE $5FFFC, 1  ' EDIT FLAG ON    POKE $5FFFD, CURRFRAME    KEY ON    END  BEND  IF A$ = ٯ1 THEN GOSUB LOADBIN  IF A$ = ٯ3 THEN GOSUB SAVEBIN  IF A$ = ٯ5 THEN GOSUB SAVEOPTIMISED  IF A$ = ٯ7 THEN GOSUB EDITHITBOXES  RETURN'--------------.EDITHITBOXES'--------------  HBMODE = ¯ů  DO WHILE 1    GOSUB SHOWHITBOXTABLE    GOSUB DRAWHITBOXES    GOSUB ¯GETUSERINPUT    IF A$="X" OR A$=ٯ OR A$=ٯ7 THEN BEGIN      PRINT CHR$(147);      GOSUB DRAWCURRFRAME      EXIT    BEND  LOOP  RETURN#DEFINE үد = 112#DEFINE үد = 110#DEFINE үد = 109#DEFINE үد = 125#DEFINE ү   = 64#DEFINE ү   = 93#DEFINE ү  = 32'---------.DRAWCHAR'---------  IF PEEK($40800 + X + Y * 80) <> ү THEN BEGIN    K = K + 128  BEND:ELSE BEGIN    POKE $FF80000 + X + Y * 80, 1  BEND  POKE $40800 + X + Y * 80, K  RETURN'-------------.DRAWHITBOXES'-------------  GOSUB DRAWCURRFRAME  GOSUB GETCURRFRAMEPTR  FOR IDX = 0 TO 3    X1 = PEEK(PTR + BXOFFS(IDX))    Y1 = PEEK(PTR + BXOFFS(IDX) + 1)    X2 = PEEK(PTR + BXOFFS(IDX) + 2)    Y2 = PEEK(PTR + BXOFFS(IDX) + 3)    IF NOT (X1=0 AND Y1=0 AND X2=0 AND Y2=0) THEN BEGIN      ' DRAW CORNERS      ' ------------      X = X1 : Y = Y1 : K = үد : GOSUB DRAWCHAR      X = X2 : Y = Y1 : K = үد : GOSUB DRAWCHAR      X = X1 : Y = Y2 : K = үد : GOSUB DRAWCHAR      X = X2 : Y = Y2 : K = үد : GOSUB DRAWCHAR      ' DRAW HORIZONTALS      ' ----------------      FOR X = X1+1 TO X2-1        Y = Y1 : K = ү : GOSUB DRAWCHAR        Y = Y2 : K = ү : GOSUB DRAWCHAR      NEXT X      ' DRAW VERTICALS      ' --------------      FOR Y = Y1+1 TO Y2-1        X = X1 : K = ү : GOSUB DRAWCHAR        X = X2 : K = ү : GOSUB DRAWCHAR      NEXT Y    BEND  NEXT IDX  RETURN'-----------------.SHOWHITBOXTABLE '-----------------  GOSUB GETCURRFRAMEPTR  CURRPTR = PTR  IF HBSEL = 0 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,40:PRINT ٯ;"Q  HEAD: ";  K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  IF HBSEL = 1 THEN PRINT ٯ!֯;:ELSE PRINT ٯ֯;  CURSOR 40,41:PRINT ٯ;"Q TORSO: ";  K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  IF HBSEL = 2 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,42:PRINT ٯ;"Q  FEET: ";   K = ͯԯ¯":GOSUB SHOWHITBOXCOORDS  IF HBSEL = 3 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,43:PRINT ٯ;"QATTACK: ";  K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  PRINT ٯ֯;  GOSUB GETSELECTEDCOORDS  RETURN'------#--------------------.GETSELECTEDOFFSETINTOK'--------------------------  IF HBSEL = 0 THEN K = ͯԯ¯  IF HBSEL = 1 THEN K = ͯԯ¯  IF HBSEL = 2 THEN K = ͯԯ¯  IF HBSEL = 3 THEN K = ͯԯ¯$  RETURN'-------------------.GETSELECTEDCOORDS'-------------------  GOSUB GETSELECTEDOFFSETINTOK  GOSUB PEEKSELECTEDCOORDSINTOX1Y1X2Y2  RETURN  '-----------------.¯GETUSERINPUT'-----------------  GET KEY A$  IF A$=ٯ AN%D HBSEL > 0 THEN HBSEL = HBSEL - 1  IF A$=ٯ AND HBSEL < 3 THEN HBSEL = HBSEL + 1  IF A$="-" AND CURRFRAME > 0 THEN BEGIN    CURRFRAME = CURRFRAME - 1    GOSUB DRAWCURRFRAME  BEND  IF A$="=" AND CURRFRAME < PEEK($50002)-1 THEN BE&GIN    CURRFRAME = CURRFRAME + 1    GOSUB DRAWCURRFRAME  BEND  IF A$=ٯ THEN BEGIN    GOSUB GETSELECTEDCOORDSINTOX1Y1X2Y2    GOSUB GETSELECTEDOFFSETINTOK    POKE CURRPTR + K    , X1    POKE CURRPTR + K + 1, Y1    POKE CU'RRPTR + K + 2, X2    POKE CURRPTR + K + 3, Y2  BEND  RETURN'---------------------------------.GETSELECTEDCOORDSINTOX1Y1X2Y2'---------------------------------  ' COORD1  X = X1 : Y = Y1  STORESTATE = ůԯ  GOSUB ENTERCOORD   X1 = X  Y1 = Y  ' COORD2  STORESTATE = ůį  GOSUB ENTERCOORD  X2 = X  Y2 = Y  POKE $40800 + STARTX + STARTY * 80, STARTCHAR  POKE $FF80000 + STARTX + STARTY * 80, STARTCOLOR  POKE $40800 + ENDX + ENDY * 80, ENDCHAR  POKE $FF'----.DOCS'----' RABBER OOL - PORTED TO LEVEN (FOR EASIER MAINTENANCE)' ============'' SAGE:' -----' - RESS 'SPACE' KEY ON TOP-LEFT POINT' - HEN USE CURSOR KEYS TO MOVE TO BOTTOM-RIGHT POINT & PRESS 'SPACE'' - RESS '-' AND '+' KEYS TO MOVE BETWEEN PREVIOUS AND NEXT FRAMES' - RESS 'C' TO REDRAW CURRENT FRAME' - RESS 'Y' TO YANK/COPY A SELECTED REGION' - RESS 'P' TO PASTE A SELECTED REGION TO CURRENT CURSOR LOCATION' - RESS 'E' TO EDIT CURRENT FRAME' - RESS 'D' TO DELETE THE CURRENT FRAME' - RESS 'L' THEN A FRAME# TO LOAD THAT FRAME' - RESS 'X' TO EXIT PROGRAM' - 1 = LOAD CHAR+COLOR .BIN FILE' - 3 = SAVE CHAR+COLOR .BIN FILE' - 5 = SAVE OPTIMIZED+REPAIRED .BIN FILE' - 7 = EDIT HIT BOXES#OUTPUT "GRABBER"' HAR+OLOR ILE ORMAT (1/3 KEYS)' ======================' : PROG-ADDRESS (IGNORED)' : SIZE OF DATA (INCLUDING THIS  AND ONWARDS)' : # OF FRAMES' '  #0' --------'   : X'   : Y'   : W'   : H'   : HEAD BOX (X1,Y1,X2,Y2)'   : TORSO BOX (X1,Y1,X2,Y2)'   : FEET BOX (X1,Y1,X2,Y2)'   : ATTACK BOX (X1,Y1,X2,Y2)'   [W*H]: CHAR DATA'   [W*H]: COLOR DATA''  #1' --------'   (AS BEFORE...)''  #N' --------'   (AS BEFORE...)' OLOR-ONLY ILE ORMAT (5 KEY)' ======================' : PROG-ADDRESS (IGNORED)' : SIZE OF DATA (INCLUDING THIS  AND ONWARDS)' : # OF FRAMES' '  #0' --------'   : X'   : Y'   : W'   : H'   : HEAD BOX (X1,Y1,X2,Y2)'   : TORSO BOX (X1,Y1,X2,Y2)'   : FEET BOX (X1,Y1,X2,Y2)'   : ATTACK BOX (X1,Y1,X2,Y2)'   [W*H]: COLOR DATA''  #1' --------'   (AS BEFORE...)''  #N' --------'   (AS BEFORE...)'--------.DECLARES'--------#DECLARE CLRLINERIGHT$ = CHR$(27)+"Q"   ' OLD CL$#DECLARE CURRENTFRAME  ' OLD FF#DECLARE X, Y  ' CURSOR POSITION#DECLARE PTR  ' POINTER TO DATA BYTES IN MEMORY#DECLARE FRAMECOUNT#DECLARE FRMIDX#DECLARE BYTESUSED  ' OLD L#DEC	LARE FRMW, FRMH#DECLARE STARTCHAR, STARTCOLOR, ENDCHAR, ENDCOLOR#DECLARE STARTX, STARTY, ENDX, ENDY#DECLARE CURRFRAME#DECLARE SRCCHARPTR, SRCCLRPTR#DECLARE A$, XIDX, YIDX#DECLARE DESTCHARPTR, DESTCLRPTR#DECLARE FNAME$#DECLARE CVAL#D
ECLARE STARTPTR, ENDPTR, CURRPTR, SRCPTR, DESTPTR, SZ, K, LN#DECLARE B(50,3)  ' HITBOXES#DECLARE X1, Y1, X2, Y2#DECLARE HBSEL = 0, HBMODE, IDX#DECLARE CLIPBOARDCHAR&(80*50)#DECLARE CLIPBOARDCLR&(80*50)#DECLARE CLIPW, CLIPH#DEFINE ůԯ = 0#DEFINE ůį = 1#DECLARE STORESTATE  ' ARE WE STORING START/END POS CHAR/COLOUR DETAILS#DECLARE NEWFRAMEFLAG#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ1 = ""#DEFINE ٯ3 = ""#DEFINE ٯ4 = ""#DEFINE ٯ5 = ""#DEFINE ٯ7 = ""#DEFINE ٯ8 = ""#DEFINE ٯ = CHR$(27)#DEFINE ٯ֯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ = CHR$(13)#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE ¯ů     = 0#DEFINE ¯ů̯1 = 1#DEFINE ¯ů̯2 = 2#DEFINE ¯ů   = 3.OFFSETS#DEFINE ԯ  = 0#DEFINE ԯͯ = 2#DEFINE ԯ0     = 3#DEFINE ͯԯ          = 0#DEFINE ͯԯ          = 1#DEFINE ͯԯ          = 2#DEFINE ͯԯ          = 3#DEFINE ͯԯ   = 4#DEFINE ͯԯ¯    = 4#DEFINE ͯԯ¯   = 8#DEFINE ͯԯ¯    = 12#DEFINE ͯԯ¯  = 16#DEFINE ͯԯ       = 20#DECLARE BXOFFS(3)BXOFFS(0) = ͯԯ¯BXOFFS(1) = ͯԯ¯BXOFFS(2) = ͯԯ¯BXOFFS(3) = ͯԯ¯'ԯ)  STARTPTR = CURRPTR + ͯԯ + FRMW * FRMH * 2  LN = ENDPTR - STARTPTR + 1  ' PRINT "CURRPTR = ";HEX$(CURRPTR)  ' PRINT "STARTPTR = ";HEX$(STARTPTR)  ' PRINT "ENDPTR = ";HEX$(ENDPTR)  ' PRINT "LN = ";HEX$(LN)  ' GET KEY A$  ' A$=""  EDMA Я, LN, STARTPTR, CURRPTR    RETURN'-----------.GETENDPTR'-----------  FRAMECOUNT = PEEK($50000 + ԯͯ)  PTR = $50000 + ԯ0  FRMIDX = 0  IF FRMIDX >= FRAMECOUNT THEN BEGIN    CURSOR 0,0    PRINT CLRLINERIGHT$;"INVALID BLOCK#!"    RETURN  BEND  ' TRAVERSE TO FIND BLOCK  FOR FRMIDX = 0 TO FRAMECOUNT - 1    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT FRMIDX  RETURN'------------------.GETCURRFRAMEPTR'------------------  FRAMECOUNT = PEEK($50000 + ԯͯ)  ' TRAVERSE TO FIND BLOCK  PTR = $50000 + ԯ0  FOR FRMIDX = 0 TO FRAMECOUNT    IF FRMIDX = CURRFRAME THEN RETURN    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT FRMIDX  PTR = 0  RETURN'---------------.DRAWCURRFRAME'---------------  FRAMECOUNT = PEEK($50000 + ԯ)  PTR = $50000 + ԯ0  FRMIDX = 0  IF FRMIDX >= FRAMECOUNT THEN BEGIN    CURSOR 0,0    PRINT CLRLINERIGHT$;"INVALID BLOCK#!"    RETURN  BEND  GOSUB GETCURRFRAMEPTR  IF PTR = 0 THEN PRINT "NOT FOUND!" : RETURN    X = PEEK(PTR + ͯԯ)  Y = PEEK(PTR + ͯԯ)  FRMW = PEEK(PTR + ͯԯ)  FRMH = PEEK(PTR + ͯԯ)  ENDX = X + FRMW - 1  ENDY = Y + FRMH - 1  PRINT "";CLRLINERIGHT$;  PRINT "X=";X;", Y=";Y;", W=";FRMW;", H=";FRMH;  PRINT ", PTR=$";HEX$(PTR);  PRINT "";CHR$(27);"J";CLRLINERIGHT$;"FRAME=";CURRFRAME;  PRINT ", NXT=$";HEX$(PTR + ͯԯ + FRMW * FRMH * 2);  SRCCHARPTR = PTR + ͯԯ  SRCCLRPTR = PTR + ͯԯ + FRMW * FRMH  DESTCHARPTR =$40800 + X + Y * 80  DESTCLRPTR = $FF80000 + X + Y * 80  FOR YIDX = Y TO ENDY    EDMA Я, FRMW, SRCCHARPTR, DESTCHARPTR    EDMA Я, FRMW, SRCCLRPTR, DESTCLRPTR    SRCCHARPTR = SRCCHARPTR + FRMW    SRCCLRPTR = SRCCLRPTR + FRMW    DESTCHARPTR = DESTCHARPTR + 80    DESTCLRPTR = DESTCLRPTR + 80  NEXT YIDX  RETURN'-------------------------.RESTORECHARUNDERCURSOR'-------------------------  IF STORESTATE = ůԯ THEN BEGIN    POKE $40800 + X + Y * 80, STARTCHAR    POKE $FF80000 + X + Y * 80, STARTCOLOR  BEND:ELSE BEGIN  ' ůį    POKE $40800 + X + Y * 80, ENDCHAR    POKE $FF80000 + X + Y * 80, ENDCOLOR        BEND  RETURN'-----------.DRAWCURSOR'-----------  POKE $40800 + X + Y * 80, 43  POKE $FF80000 + X + Y * 80, 1  RETURN'-----------.DRAWFOOTER'-----------  CURSOR 0,49  PRINT CLRLINERIGHT$;"FRAME COUNT=";PEEK($50000 + ԯͯ);", NEXT-FREE=$";  PRINT HEX$(PTR);  RETURN'----------------.STORESTATEINFO'----------------  IF STORESTATE = ůԯ THEN BEGIN    STARTCHAR = PEEK($40800 + X + Y * 80)    STARTCOLOR = PEEK($FF80000 + X + Y * 80)    STARTX = X    STARTY = Y  BEND:ELSE BEGIN ' ůį    ENDCHAR = PEEK($40800 + X + Y * 80)    ENDCOLOR = PEEK($FF80000 + X + Y * 80)    ENDX = X    ENDY = Y  BEND  RETURN'---------.INITVARS'---------  CURRENTFRAME = 0  STORESTATE = ůԯ  X = 0  Y = 0  CURRFRAME = 0  RETURN  '---------------------.LOCATENEXTFREEBYTE'---------------------  FRAMECOUNT = PEEK($50000 + ԯͯ)  FRMIDX = 0  PTR = $50000 + ԯ0  DO WHILE 1    IF FRMIDX = FRAMECOUNT THEN BEGIN      BYTESUSED = PTR-$50000      RETURN    BEND    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PTR = PTR + ͯԯ + FRMW * FRMH * 2    FRMIDX = FRMIDX + 1  LOOP  RETURN'---------------------.CHECKMAGICSIGNATURE'---------------------  IF PEEK($ 5FFFE) <> 71 OR PEEK($5FFFF) <> 73 THEN BEGIN    WPOKE $5FFFE, $4947    PRINT "";CLRLINERIGHT$;    PRINT "MAGIC SIGNATURE APPLIED. RESET FRAME COUNT TO ZERO? (Y/N)";    GET KEY A$    IF A$ = "Y" THEN BEGIN      WPOKE $50000 + ԯ, 0!      POKE $50000 + ԯͯ, 0    BEND    PRINT "";CLRLINERIGHT$;  BEND  RETURN'---------------.CHECKEDITFLAG'---------------  IF PEEK($5FFFC) = 1 THEN BEGIN ' EDITING?    POKE $5FFFC, 0    CURRFRAME = PEEK($5FFFD)    GOSUB "GETCURRFRAMEPTR    STARTX = PEEK(PTR + ͯԯ)    STARTY = PEEK(PTR + ͯԯ)    X = STARTX + PEEK(PTR + ͯԯ) - 1    Y = STARTY + PEEK(PTR + ͯԯ) - 1    NEWFRAMEFLAG = 0    GOSUB SAVEFRAMETOMEMORYATPTR    G#OSUB DRAWCURRFRAME  BEND  RETURN'--------------.YANKSELECTION'--------------  POKE $D020, PEEK($D020) + 1  ' SELECT A REGION WITH CURSOR MOVEMENT  GOSUB GETSELECTEDCOORDSINTOX1Y1X2Y2  ' COPY IT INTO A BASIC VAR  PTR = POINTER(CLIPBOAR$DCHAR&(0))  LN = X2-X1+1  FOR Y = Y1 TO Y2    EDMA Я, LN, $40800+X1+Y*80, PTR    PTR = PTR + LN  NEXT Y  PTR = POINTER(CLIPBOARDCLR&(0))  FOR Y = Y1 TO Y2    EDMA Я, LN, $FF80000+X1+Y*80, PTR    PTR = PTR + LN  NEXT Y  CLIPW = %X2-X1+1  CLIPH = Y2-Y1+1  POKE $D020, PEEK($D020) - 1  RETURN'-----.PASTE'-----  ' COPY SELECTION FROM VARS ONTO SCREEN AT CURRENT CURSOR POSITION  X1 = X  Y1 = Y  X2 = X + CLIPW - 1  Y2 = Y + CLIPH - 1  PTR = POINTER(CLIPBOARDCHAR&(0))&  LN = X2-X1+1  FOR Y = Y1 TO Y2    EDMA Я, LN, PTR, $40800+X1+Y*80    PTR = PTR + LN  NEXT Y  PTR = POINTER(CLIPBOARDCLR&(0))  FOR Y = Y1 TO Y2    EDMA Я, LN, PTR, $FF80000+X1+Y*80    PTR = PTR + LN  NEXT Y  ' : RE-SAVE CURR'ENT FRAME  GOSUB SAVEFRAMETOMEMORYATPTR  GOSUB GETCURRFRAMEPTR  STARTX = PEEK(PTR + ͯԯ)  STARTY = PEEK(PTR + ͯԯ)  X = STARTX + PEEK(PTR + ͯԯ) - 1  Y = STARTY + PEEK(PTR + ͯԯ) - 1  NEWFRAMEFLAG =  00  GOSUB SAVEFRAMETOMEMORYATPTR  RETURN                                                                                                                                                                                                               ffaffafffbbbbfffffbbbbbbbbbbbffffbbbbbbfffffffbbblbffffffffffffffffffffffffffffffffbbbbfffffffffffff~fffffffffffffffffffffffffffffffffffffffffffffff                                                                                                                                                     @@@@@@@@@@@@@@@@, CHR$(X);CHR$(Y);CHR$(FRMW);CHR$(FRMH);    FOR K=0 TO 15      PRINT #2, CHR$(PEEK(PTR + ͯԯ + K));    NEXT K    SRCCHARPTR = PTR + ͯԯ    SRCCLRPTR = PTR + ͯԯ + FRMW * FRMH        FOR K = 0 TO FRMW * FRMH - 1      CVAL = PEEK(SRCCLRPTR + K)      IF PEEK(SRCCHARPTR + K) = 32 THEN BEGIN        CVAL = $FF      BEND      PRINT #2, CHR$(CVAL);    NEXT K    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT FRMIDX  DCLOSE #2  RETURN'------------------------.SAVENEWFRAMETOMEMORY'------------------------  POKE $40800 + STARTX + STARTY * 80, STARTCHAR  POKE $FF80000 + STARTX + STARTY * 80, STARTCOLOR  POKE $40800 + ENDX + ENDY * 80, ENDCHAR  POKE $FF80000 + ENDX + ENDY * 80, ENDCOLOR  FRAMECOUNT = PEEK($50000 + ԯͯ)  GOSUB LOCATENEXTFREEBYTE  PTR = $50000 + BYTESUSED  NEWFRAMEFLAG = 1  GOSUB SAVEFRAMETOMEMORYATPTR  RETURN'---------------------------.SAVEFRAMETOMEMORYATPTR'---------------------------  POKE PTR + ͯԯ, STARTX  POKE PTR + ͯԯ, STARTY  POKE PTR + ͯԯ, X - STARTX + 1  POKE PTR + ͯԯ, Y - STARTY + 1  IF NEWFRAMEFLAG THEN BEGIN    LN = ͯԯ - ͯԯ	    EDMA Я, LN, 0, PTR + ͯԯ  BEND  PTR = PTR + ͯԯ  FOR YIDX = STARTY TO Y    FOR XIDX = STARTX TO X     POKE PTR, PEEK($40800 + XIDX + YIDX * 80)     PTR = PTR + 1    NEXT XIDX  NEXT YIDX  FOR YIDX = STARTY
 TO Y    FOR XIDX = STARTX TO X     POKE PTR, PEEK($FF80000 + XIDX + YIDX * 80)     PTR = PTR + 1    NEXT XIDX  NEXT YIDX  IF NEWFRAMEFLAG THEN BEGIN    WPOKE $50000 + ԯ, PTR - $50000    POKE $50000 + ԯͯ, FRAMECOUNT + 1  BEND  CURSOR 0,49  PRINT CLRLINERIGHT$;"FRAME COUNT=";PEEK($50000 + ԯͯ);  PRINT ", NEXT-FREE=$";HEX$(PTR);  CURSOR 0,0  NEWFRAMEFLAG = 0  RETURN'----------.LOADFRAME'----------  PRINT "";CLRLINERIGHT$;  INPUT "FRAME#";CURRFRAME  GOSUB DRAWCURRFRAME  RETURN'------------.DELETEFRAME'------------  GOSUB GETENDPTR  ENDPTR = PTR  ' DECREMENT FRAME COUNT  FRAMECOUNT = FRAMECOUNT - 1  POKE $50000 + ԯͯ, FRAMECOUNT  GOSUB DELETEFRAMESIZEFROMTOTAL  IF CURRFRAME = FRAMECOUNT THEN BEGIN    CURRFRAME = CURRFRAME - 1  BEND : ELSE BEGIN    GOSUB SHIFTREMAININGFRAMESALONG  BEND  GOSUB DRAWCURRFRAME  RETURN'----------------------------.DELETEFRAMESIZEFROMTOTAL'----------------------------  GOSUB GETCURRFRAMEPTR  CURRPTR = PTR  FRMW = PEEK(CURRPTR + ͯԯ)  FRMH = PEEK(CURRPTR + ͯԯ)  SZ = WPEEK($50000 + ԯ)  SZ = SZ - (ͯԯ + FRMW * FRMH * 2)  WPOKE $50000 + ԯ, SZ  RETURN'----------------------------.SHIFTREMAININGFRAMESALONG'----------------------------  GOSUB GETCURRFRAMEPTR  CURRPTR = PTR  FRMW = PEEK(CURRPTR + ͯԯ)  FRMH = PEEK(CURRPTR + ͯGIN    CURRFRAME = CURRFRAME + 1    GOSUB DRAWCURRFRAME  BEND  IF A$=ٯ THEN BEGIN    GOSUB GETSELECTEDCOORDSINTOX1Y1X2Y2    GOSUB GETSELECTEDOFFSETINTOK    POKE CURRPTR + K    , X1    POKE CURRPTR + K + 1, Y1    POKE CURRPTR + K + 2, X2    POKE CURRPTR + K + 3, Y2  BEND  RETURN'---------------------------------.GETSELECTEDCOORDSINTOX1Y1X2Y2'---------------------------------  ' COORD1  X = X1 : Y = Y1  STORESTATE = ůԯ  GOSUB ENTERCOORD  X1 = X  Y1 = Y  ' COORD2  STORESTATE = ůį  GOSUB ENTERCOORD  X2 = X  Y2 = Y  POKE $40800 + STARTX + STARTY * 80, STARTCHAR  POKE $FF80000 + STARTX + STARTY * 80, STARTCOLOR  POKE $40800 + ENDX + ENDY * 80, ENDCHAR  POKE $FF80000 + ENDX + ENDY * 80, ENDCOLOR  RETURN'----------------------------------.PEEKSELECTEDCOORDSINTOX1Y1X2Y2'----------------------------------  X1 = PEEK(CURRPTR + K)  Y1 = PEEK(CURRPTR + K + 1)  X2 = PEEK(CURRPTR + K + 2)  Y2 = PEEK(CURRPTR + K + 3)  RETURN'------------------.SHOWHITBOXCOORDS'------------------  GOSUB PEEKSELECTEDCOORDSINTOX1Y1X2Y2  PRINT X1;",";Y1;",";X2;",";Y2;  RETURN'--------.LOADBIN'--------  INPUT "LOAD NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  BLOAD (FNAME$),P($50000)  ' GOSUB ONEOFFREPAIR  RETURN'--------------.ONEOFFREPAIR'--------------  ' INJECT SPACES WHERE NEEDED  SRCPTR = $42000  DESTPTR = $50000  FRAMECOUNT = PEEK(SRCPTR)  POKE DESTPTR + ԯͯ, FRAMECOUNT  SRCPTR = SRCPTR + 1  DESTPTR = DESTPTR + ԯ0  SZ = ԯ0  FOR K = 0 TO FRAMECOUNT - 1    POKE DESTPTR + ͯԯ, PEEK(SRCPTR)    SRCPTR = SRCPTR + 1    POKE DESTPTR + ͯԯ, PEEK(SRCPTR)    SRCPTR = SRCPTR + 1    FRMW = PEEK(SRCPTR)    POKE DESTPTR + ͯԯ, FRMW    SRCPTR = SRCPTR + 1    FRMH = PEEK(SRCPTR)    POKE DESTPTR + ͯԯ, FRMH    SRCPTR = SRCPTR + 1    LN = ͯԯ - ͯԯ    EDMA Я, LN, 0, DESTPTR + ͯԯ    LN = FRMW * FRMH * 2    EDMA Я, LN, SRCPTR, DESTPTR + ͯԯ    SRCPTR = SRCPTR + LN    DESTPTR = DESTPTR + ͯԯ + LN    SZ = SZ + ͯԯ + LN      NEXT K  DESTPTR = $50000  WPOKE DESTPTR + ԯ, SZ  RETURN'--------.SAVEBIN'--------  INPUT "SAVE NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  PTR = $50000 + WPEEK($50000 + ԯ)  DELETE (FNAME$)  BSAVE (FNAME$),P($50000) TO P(PTR)  RETURN'-------------------------------------.CALCULATEOPTIMISEDDATASIZEINTOSZ'-------------------------------------  SZ = WPEEK($50000 + ԯ)  PTR = $50000 + ԯ0  FOR K = 0 TO FRAMECOUNT - 1    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    SZ = SZ - FRMW * FRMH    PTR = PTR + ͯԯ + FRMW * FRMH * 2  NEXT K  RETURN'--------------.SAVEOPTIMISED'--------------  INPUT "SAVE NAME (OPTIMISED): ";FNAME$  IF FNAME$ = "" THEN RETURN  DELETE (FNAME$)  DOPEN #2,(FNAME$ + ",P"),W,U8  PRINT #2, CHR$(1);  PRINT #2, CHR$(2);  ' DUMMY ADDRESS  GOSUB CALCULATEOPTIMISEDDATASIZEINTOSZ    PRINT #2, CHR$(MOD(SZ, 256));  PRINT #2, CHR$(INT(SZ / 256));  PRINT #2, CHR$(FRAMECOUNT);  PTR = $50000 + ԯ0  FOR FRMIDX = 0 TO FRAMECOUNT - 1    X = PEEK(PTR + ͯԯ)    Y = PEEK(PTR + ͯԯ)    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    PRINT #2   afffLb                  lafff~       bo      ffff|      lw{  obfffff     l~     |afffff|       .R   a~ffffff       / C  v堠fffffff       T  YG gffffffff      H   t uffffffff    a  MoK  atfffffffffa   |{     lffffffffff    |b  b~ |afffffffffffe    |~   BfffffffffffG              KfffffffffffJRR           wIfffffffffffY          FRRFKfffffffffff.C    obbo     afffffffffffN   l{   fffffffffff  l    {  ffffffffffa          affffffffl  /wwM  e  ffffffff j  Pj  a  vtffffffl j   j  a  vffffff    v  M  /  a  vfffff~     {  ww  l   vffff      |{    b~   fff       |~   l{ff        xx    ll|afo            olf!a                                                                                                                                                                     "                                                                                                                                                                #                                                                                                                                                                                  $                                                                                                                                                            %                                    ?                fffffffffffbbbbbbbbbbbbffffffffffffffffffbbbbbbbbfffffffffffffffffffffb⠠bbbffffflbb⠠b{fffffffffffff⠠~|b{ffffffff&|{fffffᠠ|{ffffᠠffffaafffa'l~fffᠠffffᠠl~ffffaffff afffᠠaffl~affaffa IF A$=" " THEN BEGIN    STORESTATE = STORESTATE + 1    IF STORESTATE = 2 THEN BEGIN      GOSUB SAVENEWFRAMETOMEMORY      END    BEND  BEND  IF A$="L" THEN GOSUB LOADFRAME  IF A$="X" THEN BEGIN    CURSOR 0,0    KEY ON    END  BEND  IF A$="E" THEN BEGIN    CURSOR 0,40    POKE $5FFFC, 1  ' EDIT FLAG ON    POKE $5FFFD, CURRFRAME    KEY ON    END  BEND  IF A$ = ٯ1 THEN GOSUB LOADBIN  IF A$ = ٯ3 THEN GOSUB SAVEBIN  IF A$ = ٯ5 THEN GOSUB SAVEOPTIMISED  IF A$ = ٯ7 THEN GOSUB EDITHITBOXES  RETURN'--------------.EDITHITBOXES'--------------  HBMODE = ¯ů  DO WHILE 1    GOSUB SHOWHITBOXTABLE    GOSUB DRAWHITBOXES    GOSUB ¯GETUSERINPUT    IF A$="X" OR A$=ٯ OR A$=ٯ7 THEN BEGIN      PRINT CHR$(147);      GOSUB DRAWCURRFRAME      EXIT    BEND  LOOP  RETURN#DEFINE үد = 112#DEFINE үد = 110#DEFINE үد = 109#DEFINE үد = 125#DEFINE ү   = 64#DEFINE ү   = 93#DEFINE ү  = 32'---------.DRAWCHAR'---------  IF PEEK($40800 + X + Y * 80) <> ү THEN BEGIN    K = K + 128  BEND:ELSE BEGIN    POKE $FF80000 + X + Y * 80, 1  BEND  POKE $40800 + X + Y * 80, K  RETURN'-------------.DRAWHITBOXES'-------------  GOSUB DRAWCURRFRAME  GOSUB GETCURRFRAMEPTR  FOR IDX = 0 TO 3    X1 = PEEK(PTR + BXOFFS(IDX))    Y1 = PEEK(PTR + BXOFFS(IDX) + 1)    X2 = PEEK(PTR + BXOFFS(IDX) + 2)    Y2 = PEEK(PTR + BXOFFS(IDX) + 3)    IF NOT (X1=0 AND Y1=0 AND X2=0 AND Y2=0) THEN BEGIN      ' DRAW CORNERS      ' ------------      X = X1 : Y = Y1 : K = үد : GOSUB DRAWCHAR      X = X2 : Y = Y1 : K = үد : GOSUB DRAWCHAR      X = X1 : Y = Y2 : K = үد : GOSUB DRAWCHAR      X = X2 : Y = Y2 : K = үد : GOSUB DRAWCHAR      ' DRAW HORIZONTALS      ' ----------------      FOR X = X1+1 TO X2-1        Y = Y1 : K = ү : GOSUB DRAWCHAR        Y = Y2 : K = ү : GOSUB DRAWCHAR      NEXT X 	     ' DRAW VERTICALS      ' --------------      FOR Y = Y1+1 TO Y2-1        X = X1 : K = ү : GOSUB DRAWCHAR        X = X2 : K = ү : GOSUB DRAWCHAR      NEXT Y    BEND  NEXT IDX  RETURN'-----------------.SHOWHITBOXTABLE
'-----------------  GOSUB GETCURRFRAMEPTR  CURRPTR = PTR  IF HBSEL = 0 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,40:PRINT ٯ;"Q  HEAD: ";  K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  IF HBSEL = 1 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,41:PRINT ٯ;"Q TORSO: ";  K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  IF HBSEL = 2 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,42:PRINT ٯ;"Q  FEET: ";   K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  IF HBSEL = 3 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  CURSOR 40,43:PRINT ٯ;"QATTACK: ";  K = ͯԯ¯:GOSUB SHOWHITBOXCOORDS  PRINT ٯ֯;  GOSUB GETSELECTEDCOORDS  RETURN'--------------------------.GETSELECTEDOFFSETINTOK'--------------------------  IF HBSEL = 0 THEN K = ͯԯ¯  IF HBSEL = 1 THEN K = ͯԯ¯  IF HBSEL = 2 THEN K = ͯԯ¯  IF HBSEL = 3 THEN K = ͯԯ¯  RETURN'-------------------.GETSELECTEDCOORDS'-------------------  GOSUB GETSELECTEDOFFSETINTOK  GOSUB PEEKSELECTEDCOORDSINTOX1Y1X2Y2  RETURN  '-----------------.¯GETUSERINPUT'-----------------  GET KEY A$  IF A$=ٯ AND HBSEL > 0 THEN HBSEL = HBSEL - 1  IF A$=ٯ AND HBSEL < 3 THEN HBSEL = HBSEL + 1  IF A$="-" AND CURRFRAME > 0 THEN BEGIN    CURRFRAME = CURRFRAME - 1    GOSUB DRAWCURRFRAME  BEND  IF A$="=" AND CURRFRAME < PEEK($50002)-1 THEN BE  
&                fffff RCR  ffffffffffffffffffff oCw///PDFofffffffffffffffflCE 'c.E '   wDFoffffffffffffbo           wDCRfffffffffa  wxbb            wECRfffff       bb            wMfff           bbb       ttefffa               bb  BGMBfffa                   Gfff                     |~ff         b㠠b       |ffffa       ~  |       ~ffff                  fffff     l  lCC{ |      uffffffa      K -{ t    fffffff    a g   GT u    afffffff     |I  U  t   ffffffff|{    { |CC~ l    fffffffffa    |     l~    afffffffff     |boo~    ffffffffff|{     |~     afffffffffffa               ffffffffffffB              bffffffffffffB           cx~ffffffffffffUC    obb      |affffffffffffg     CRR/IffffffffffffBccl~      .MJffffffffffffe  ~      a  P Iffffffffff    UEEI     aJffffffffffa  a  e'Pv  e  {Mffffffff   a v   v  e    Ifffffffa     M  N   `  |{Jffffff     {  ww        tfffffa     |o    l      |{Bffff       |bb~       vffffa                  {tff                      tff~f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ff/DCCRoooffffffffffffffff'///U    wwEDDCRffffffff|xbbbbb  :':Mffffffff          bMfffffff{               ffffffffa               ffffffff                afffffff|a               ffffffffED        |{fffffff              afffffff    .RRo        ffffff~   /,C  M       |{fffff   //     M       fffffa  gj      g       ffffl~  HH     t       afff   YH     T       fff   g|{ a    t       fff    MJR|bR'N         afgt    Docco/          fᠠ{     EE             a~                                                                                                                                                                                                                                                                                                                                                                               )&                fffffffffffffffffRECFofffffffffffffffffffRCECECo wED{fffffffffffoCw   EC   obfffffffffoCw        lbffffffoCw        lb~   |afffRDw        bb~       tffv T      lb~          fffH tt/ lb             fffBtBb                 PRINT CHR$(27)+"QX=";STARTX;", Y=";STARTY;    PRINT ", W=";X-STARTX+1;", H=";Y-STARTY+1;  BEND  PRINT CLRLINERIGHT$;  RETURN'-----------.ENTERCOORD'-----------  DO WHILE 1    GOSUB STORESTATEINFO    GOSUB DRAWCURSOR    GET KEY A$    IF A$ <> ٯ THEN GOSUB RESTORECHARUNDERCURSOR    IF A$ = ٯ AND X > 0 THEN X = X - 1    IF A$ = ٯ AND X < 79 THEN X = X + 1    IF A$ = ٯ AND Y > 0 THEN Y = Y - 1    IF A$ = ٯ AND Y < 49 THEN Y = Y + 1    IF &A$=ٯ THEN EXIT  LOOP  RETURN'--------------.GETUSERINPUT'--------------  GETKEY A$  IF A$ <> " " THEN GOSUB RESTORECHARUNDERCURSOR  IF A$ = ٯ AND X > 0 THEN X = X - 1  IF A$ = ٯ AND X < 79 THEN X = X + 1  IF A$ =!;  K = :A: ;  MENUSELECTION = :B: ;  M = :C: <  C = :D: <   = :E: )<  M0% = :A%: :<  M1% = :B%: J<  X% = :C%: Z<  Y% = :D%: j<  W% = :E%: z<  H% = :F%: <  X2% = :G%: <  Y2% = :H%: <  MX% = :I%: <  MY% = :J%: <  M"B% = :K%: <  MBOLD% = :L%: <  RET% = :M%: =  LASTCOLOUR% = :N%: .=  SELECTEDCOLOUR% = :O%: O=  OLDMENUSELECTION% = :P%: b=  YMIN% = :Q%: u=  YMAX% = :R%: =  IDX% = :S%: =  PIDX% = :T%: =  PX% = :U%: =  REV% = :V%: =  #Y0% = :W%: =  Y1% = :X%: =  X0% = :Y%: >  X1% = :Z%: >  TMP% = :AA%: %>  I% = :AB%: 6>  J% = :AC%: M>  SWAPPED% = :AD%: g>  LOADSTATE% = :AE%: >  FILLSTATE% = :AF%: >  LINESTATE% = :AG%: >  LX0% = :AH%: >  LY0% = :AI%: $>  CIRCLESTATE% = :AJ%: >  CX0% = :AK%: ?  CY0% = :AL%: ?  RADIUS% = :AM%: 6?  ELLIPSESTATE% = :AN%: I?  EX0% = :AO%: \?  EY0% = :AP%: s?  XRADIUS% = :AQ%: ?  YRADIUS% = :AR%: ?  BOXSTATE% = :AS%: ?  BX0% = :AT%: ?  BY0%% = :AU%: ?  POLYSTATE% = :AV%: ?  POLYIDX% = :AW%: @  POLYX% = :AX%: '@  POLYY% = :AY%: ?@  VECDATA% = :AZ%: W@  VECSIZE% = :BA%: k@  STOR% = :BB%: @  STORCNT% = :BC%: @  BTNSX% = :BD%: @ BTNSY% = :BE%: @ BTNSW%  = :BF%: @ BTNSH% = :BG%: @ BTNSTYPE% = :BH%: A BTNSSTATE% = :BI%: A  = :BJ%: /A KEY$ = :A$: ?A A$ = :B$: WA	 BTNSTEXT$ = :C$: eA
  = :D$: sA  = :A&:                                                                         ' ٯ AND Y > 0 THEN Y = Y - 1  IF A$ = ٯ AND Y < 49 THEN Y = Y + 1  IF A$ = "D" THEN GOSUB DELETEFRAME  IF A$ = "Y" THEN GOSUB YANKSELECTION  IF A$ = "P" THEN GOSUB PASTE  IF A$ = "C" THEN BEGIN    PRINT "";    CURRFRAME = 0    GOS UB DRAWCURRFRAME  BEND  IF A$="-" AND CURRFRAME > 0 THEN BEGIN    CURRFRAME = CURRFRAME - 1    GOSUB DRAWCURRFRAME  BEND  IF A$="=" AND CURRFRAME < PEEK($50002)-1 THEN BEGIN    CURRFRAME = CURRFRAME + 1    GOSUB DRAWCURRFRAME  BEND >": Q~(9);G$(V(AN)): Q QAX.U(AN)1 QAX1:(9);V(AN): QAX. R(9);V(AN): R""; (RANAN1:: FRAGANACAD"";:ՙ""; LR dR 210:O$"A" 443 vRO$"I" 442 RO$"D" 426 RO$""AG.AGAG1 RO$""AGAF1AGAG1 RO$"" RAC1 RAC. R:  S(AG43). SAC1:AGAG43: S #S 2SO$"" ?SAC. HSAC1 SS: fS(AG43)AF {SAC.:AGAG43: S S SO$(141) SAY.:AZ1:Z.:: 52:A%: SO$" " SAYAG:AZ1:Z.:: 52:A%: TO$(13) 431 TO$"C" 440 )TO$(27) 425 :TO$""AG. NTO$""AGAF1 mT((AG43)43)AEAEAE43 T((AG43)43)(AE43)AEAE43 T TAY1:AZ.:: 52:A%: 261: TAF. UANAG:ANAF1:U(AN)U(AN1):V(AN)V(AN1):ANAN1::AFAF1:AGAFAG.AGAG1 #U /UAF. U"";(9);(9);(27);"Q";:AL.:"CHUNK#: ",AL:U(AG)AL:"";(9);(9);(27);"Q";:AL1:"EXTRA#: ",AL:V(AG)AL: UAF. U"";(9);(9);(27);"Q"; UAC. 	VALU(AG):H$(AL):(H$,1)" "H$(H$,2) DV"CHUNK#: ";(27);"^";H$;(27);"_";:"",AL:U(AG)AL: QVAC1 VALV(AG):H$(AL):(H$,1)" "H$(H$,2) V"EXTRA#: ";(27);"^";H$;(27);"_";:"",AL:V(AG)AL: V WALU(AG):"";:AH1111:AH;":";N$(AH):AH::"CMD: ",AL:AL.U(AG)AL W kWAFAF1:ANAF2:ANAG:U(AN1)U(AN):V(AN1)V(AN):ANAN1::U(AG).:V(AG).: WAGAF:AFAF1:U(AG).:V(AG).: W CHUNKIDX = :A: W CHUNKCNT = :B: W VIDX = :C: W IDX = :D: W CURSORX = :E: X CURSORY = :F: X ENVSATTACK = :G: 5X ENVSDECAY = :H: NX ENVSSUSTAIN = :I: gX ENVSRELEASE = :J: X ENVSWAVEFORM = :K: X ENVSPW = :L: X FILTFREQ = :M: X FILTLP = :N: X FILTBP = :O: X FILTHP = :P: X FILTRES = :Q: Y FILTDIR = :R: &Y FILTMIN = :S: =Y FILTSWEEP = :T: SY SEQCHUNK = :U: iY SEQEXTRA = :V: |Y ECHOM = :W: Y ECHOB = 	:X: Y ECHOSZ = :Y: Y CHUNKRPT = :Z: Y ECHODELAY = :AA: Y TMP = :AB: Y SSCOL = :AC: Z S = :AD: Z SEQOFFS = :AE: .Z SEQCNT = :AF: BZ SEQPTR = :AG: SZ ROW = :AH: dZ COL = :AI: vZ SROW = :AJ: Z SCOL = :AK: 
Z V = :AL: Z MAXV = :AM: Z K = :AN: Z DELTA = :AO: Z FPRESET = :AP: Z FSCOL = :AQ: [ FSROW = :AR: [ FFOCUS = :AS: ,[ FSEL = :AT: =[ OCT = :AU: T[ CURRFREQ = :AV: j[ CURRDIR = :AW: [ HANDLED = :AX: [ PLYPTR = :AY: [ PLYFLAG = :AZ: [ SDUR = :BA: [ ALTKEY = :BB: [ LIMIT = :BC: [ Y = :BD: [  = :BE: \ TMPO% = :A%: )\ ESCFLAG% = :B%: ;\ RET% = :C%: I\  = :D%: Y\ V$ = :A$: k\ KEY$ = :B$: \ VALID$ = :C$: \ VAL$ = :D$: \ ENVSNAME$ = :E$: \ DIRNAME$ = :F$: \ FILTNAME$ = :G$: \  V1$ = :H$: \ V2$ = :I$: ] V3$ = :J$: ] V4$ = :K$: -] V5$ = :L$: >] V6$ = :M$: X] SEQCMDNAME$ = :N$: h] A$ = :O$: x] V$ = :P$: ]	 KEYS IN$ = :Q$: ]
 KEYSOUT$ = :R$: ] PSTR$ = :S$: ] WNAME$ = :T$: ] FILTSTATENAME$ = :U$: ] DUR$ = :V$: ^ CLIP$ = :W$:  ^ CP$ = :X$: .^  = :Y$: <^  = :A&:                                                                       v)( BB%(.)364BI%(5):BB%(1)AT%255:BB%(2)AT%S8:BB%(3)AU%255:BB%(4)AU%S8:BB%(5)I%255:BB%(6)I%S8:BB%(7)J%255:BB%(8)J%S8 )) BC%8: 22: )* AS%. )+  19:AT%I%:AU%J%:AS%1 ), :ՋAS%1:AT%,AU%,I%,J%,BI%(5): 40:AS%.: )-  )*. Q%AY%(.):R%AY%(.):S%.AW%1:AY%(S%)Q%Q%AY%(S%) D*/ AY%(S%)R%R%AY%(S%) N*0 S%: *1 M%.:V%.:W%AY%(S%1):X%AY%(S%):W%X%AA%W%:W%X%:X%AA%:V%1 *2 W%D%D%X%M%1 *3  *4  49:M%. *5 Y%AX%(S%1):Z%AX%(S%):V%1AA%Y%:Y%Z%:Z%AA% +6 Y%Z%C%Y%:M%1: C+7 C(X%W%)(Z%Y%):DW%CY%:C%(D%D)C:M%1: +8 T%.:AX%(AW%)AX%(.):AY%(AW%)AY%(.):S%1AW%: 52:M%1U%(T%)C%:T%T%1 +9 S%: +: AB%.T%2:AD%.:AC%.T%AB%2 +; U%(AC%)U%(AC%1) ,< AA%U%(AC%):U%(AC%)U%(AC%1):U%(AC%1)AA%:AD%1: -,= AC%:AD%.AB%T% 8,> AB%: p,?  56: 58:S%.T%12:U%(S%),D%,U%(S%1),D%:S%: ,@  46:D%Q%R%: 63:D%: "-A BB%(.)464BI%(5):BB%(1)AW%:BC%1:A.AW%1:I%AX%(A):J%AY%(A):BC%BC%1:BB%(BC%)I%255:BC%BC%1:BB%(BC%)I%S8:BC%BC%1:BB%(BC%)J%255 I-B BC%BC%1:BB%(BC%)J%S8:A: 22: W-C AV%. o-D  19:AV%1:AW%.: }-E AW%. -F AX%(AW%1)I%AY%(AW%1)J% -G I%,J%,AX%(.),AY%(.): 65:AV%.:BI%(5)1 64 -H  -I  -J  .K AX%(AW%)I%:AY%(AW%)J% .L AW%. .M LI%,J% I.N ::AX%(AW%1),AY%(AW%1),I%,J%: Y.O AW%AW%1: z.P BI%(5).BI%(5)1:BI%(5). .Q  .R <3: #2,"@TEST.V",W,U8:A.BA%1:2,(AZ%(A));:A:#2: .S <2:AE%4: .T M%.:A("V") /U #2,A:A;:A("E") /V #2,A:A;:A("C") 5/W M%1:BA%3:AE%1: l/X AE%4: #2,"TEST.V",R,U8::#2,A:"RD=";A;:ST {/Y AE%4 /Z "CHECKVEC ";: 84 /[ M%. 83::Չ 123 /\  /] AE%1 /^ "NEWCMD ";:AF%(A64)64:BI%(5)AF%:AA63:AE%A: 
0_ AE%63 f0` "COLOUR ";:#2,A:A;:3.,A:AZ%(BA%)63:BA%BA%1:AZ%(BA%)A:BA%BA%1:N%A:O%A:AE%1 s0a  123: 0b AE%0 0c "LINE ";:#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AH%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; o1d AI%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:I%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; 1e J%A%(B%R8):AH%,AI%,I%,J%: 23:AE%1 1f  123: 1g AE%1 .2h "CIRCLE ";:#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AK%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; 2i AL%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AM%A%(B%R8):AK%,AL%,AM%,BI%(5): 29:AE%1 2j  123: 2k AE%2 /3l "ELLIPSE ";:#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AO%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; 3m AP%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AQ%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; 3n AR%A%(B%R8):0AO%,AP%,AQ%,AR%,BI%(5): 34:AE%1 3o  123: 3p AE%3 p4q "BOX ";:#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AT%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; 4r AU%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:I%A%(B%R8):#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%; 5s J%A%(B%R8):AT%,AU%,I%,J%,BI%(5): 40:AE%1 *5t  123: 85u AE%4 5v "POLY ";:#2,A:AA255:AW%A:A.AW%1:#2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AX%(A)A%(B%R8) 6w #2,A%:A%A%255:A%;:#2,B%:B%B%255:B%;:AY%(A)A%(B%R8):(A.)AX%(A1),AY%(A1),AX%(A),AY%(A) H6x A:AX%(AW%1),AY%(AW%1),AX%(.),AY%(.):BI%(5)1 64 X6y  65:AE%1 e6z  123: r6{ :#2: 6| AE%4:AF%.:AG%.:AJ%.:AN%.:AS%.:AV%.: 6} B0 25 6~ B1 30 6 B2 36 6 B3 42 6 B4 67 6  6 .,I%,J%: 7 B$(144)O%. %7 B$(5)O%1 87 B$(28)O%2 L7 B$(159)O%3 `7 B$(156)O%4 s7 B$(30)O%5 7 B$(31)O%6 7 B$(158)O%7 7 B$(129)O%8 7 B$(149)O%9 7 B$(150)O%10 7 B$(151)O%11 8 B$(152)O%12 8 B$(153)O%13 +8 B$(154)O%14 @8 B$(155)O%15 8 3.,O%:.,1,O%:I%(.,.):J%(.,1):B$(157)I%I%1: 131 8 B$(29)I%I%1: 131 8 B$(145)J%J%1: 131 8 B$(17)J%J%1: 131 8 B$(13) 154: 125 8  #9 ?I%,J%,K%:I%(I%24)2:J%(J%50)2: 59 B$:B$"X" E9  132: 154 Y9 K%128L%. j9 L%128: 165 w9 M%1 9  124:B8.: 9 :: 125: 9  9 L%128K%.L%. 9  155 : M%.:A.91:C%BD%(A)8:D%BE%(A)8:E%BF%(A)8:F%BG%(A)8:G%C%E%:H%D%F% ?: C%I%I%G%D%J%J%H% L: P%B:BA X: B5 f:  80:BP% {: :ՋB6: 82 : :ՋB7: 88: : M%1: 11:A91: : A: : .:>$: : 25 5,0,0 : 254,0,0 : 252,0,0 : 248,0,0 ; 252,0,0 ; 238,0,0 ; 199,0,0 ,; 131,128,0 9; 1,192,0 F; 0,224,0 S; 0,112,0 _; 0,56,0 k; 0,28,0 w; 0,14,0 ; 0,7,0 ; 0,3,128 ; 0,1,0 ; 0,0,0 ; 0,0,0 ; 0,0,0 ; 0,0,0 !L2047AL2047 I*AL.AL. I+S(AR)AL: I,AQ8 J-AL(A$):AL2047AL2047 J.AL.AL. #J/T(AR)AL: *J0 FJ1S$"X0":AT1S$"X1" J2S$S$V$(BA,1):S$S$"O"(AU):AN.11:O$Q$(AN)S$S$R$(AN) J3AN J4(S$). J5""T"(AJ)S$: J6 J7 168:AM15:AK5AM4 J8AK6AM4095 K9ALALAO:ALAMALAM K: 351: /K; 168:ALALAO:AL.AL. ;K< 351: HK=AQ1 iK>ALM(AR)AO:AL2047AL2047 yK?M(AR)AL: K@AQ2N(AR)1 KAAQ3O(AR)1 KBAQ4#P(AR)1 KCAQ5 KDALQ(AR)AO:AL15AL15 KEQ(AR)AL: 	LFAQ6R(AR)3R(AR)R(AR)1 !LGAQ7S(AR)2047 BLHALS(AR)AO:AL2047AL2047 RLIS(AR)AL: jLJAQ8T(AR)2047 LKALT(AR)AO:AL2047AL2047 LLT(AR)AL: LM 261:$ LNAQ1 LOALM(AR)AO:AL.AL. LPM(AR)AL: LQAQ2N(AR). MRAQ3O(AR). MSAQ4P(AR). "MTAQ5 =MUALQ(AR)AO:AL.AL. MMVQ(AR)AL: mMWAQ6R(AR).R(AR)R(AR)1 MXAQ7S(AR). MYALS(AR)AO:AL.AL. MZS(%AR)AL: M[AQ8T(AR). M\ALT(AR)AO:AL.AL. M]T(AR)AL: M^ 261: N_AK.E$(AJ)A$  N`AK1G(AJ)AL 3NaAK2H(AJ)AL FNbAK3I(AJ)AL YNcAK4J(AJ)AL lNdAK5K(AJ)AL NeAK6L(AJ)AL NfAHAJ: 359: Ng
AH,G(AH),H&(AH),I(AH),J(AH),K(AH),L(AH): NhER30 Ni:(ER);" ERROR":" IN LINE";EL:: Oj1: 364: 392:O$"" Ok: Ol"SEQUENCE EDITOR":"---------------":")DD )NSERT )ELETE, DIT=, LAYLL=+, LAY= - SEQCNT = ";AF Om": E'DIT , : STOP MUSIC, +: EXIT":" MD            XTRA":" ---            -----" *Pn((AF1)43)1((AE43)1)((AF1)43) @PoA75,5:"--->": MPpAE. cPqA70,5:"<---": uPrANAE:ANAF PsAN(AE4321)ANAF: 389 Pt(AN AE)43A40,6(ANAE43) PuAYAN">";:ՙ" "; PvAD.: 390 PwU(AN).(U(AN))11 8QxA$N$((U(AN))):AD10(A$):A$;:AD.:" ";:ADAD1: SQy::U(AN);(9);: gQzAD1: 390:AX. xQ{U(AN)2 Q|AX1 Q}V(AN)1(9);"<NONE":V$(3,0)"EIGHTH" O* V$(3,1)"I":V$(3,2)"4":V$(4,0)"SIXTEENTH":V$(4,1)"S":V$(4,2)"5": X$(6): |* "";(14);(27);"5";::"":;.:<.:5 * $: 22: 70 *  20 '+ A.,.:"PLAYMAKER V0.5 - BY GURCE ISIKYILDIZ":"---------":"<: PREV CHUNK, >: NEXT CHUNK, -/+ TEMPO, 7=ENV EDITOR, 9/-=SEQ EDITOR" |+ ": PLAY CURR VOICE, +: PLAY ALL VOICE, 1=LOAD, 3=SAVE, +=QUIT" + "-//: ROW CUT/COPY/PASTE, -: STOP MUSIC, -: PLAY FROM CURSOR":: 25: , "TEMPO: ";A%:"CHUNKIDX: ";A:C.5 , FC @, A.,9C2:(27);"Q";"V";C1;": ";A$(C,A); ~, ::A.,9C2:(27);"Q";"V";C1;": ";:D1(A$(C,A)) , ED1 , "";(A$(C,A),D,1);""; , ::(A$(C,A),D,1);: ,  D:(A$(C,A)).E(A$(C,A))" "; ,!  -" C: -# D1(C$):D$(C$,D,1) ,-$ B$D$ A-% E(A$(F,A)) t-& A$(F,A)(A$(F,A),E)D$(A$(F,A),E1):EE1: {-'  -( A$(F,A)A$(F,A)D$:EE1: -)  -* D: -+ E(A$(F,A)) -, (A$(F,A),E1,1)" ":EE1:E(A$(F,A)) #.- :(A$(F,A),E1,1)" ":EE1:E(A$(F,A)) +.. : 6./ E. E.0 E1E.: s.1 EE1:(A$(F,A),E1,1)" ":EE1:E. .2 :(A$(F,A),E1,1)" ":EE1:E. .3 :EE1: .4 AH.9: 359:AH: .5 "LOAD NAME: ";B$:B$"" O/6 #2,(B$),R,U8:2,B:A.B1:C.5:2,A$(C,A):C:A:2,A%:AH.9:2,E$(AH):2,G(AH):2,H(AH):2,I(AH) /7 2,J(AH):2,K(AH):2,L(AH): 359:AH::AH.10:2,G$(AH):2,M(AH):2,N(AH):2,O(AH):2,P(AH) 08 2,Q(AH):2,R(AH):2,S(AH):2,T(AH):AH:AF.:2,AF:AH.:AHAF:2,U(AH):2,V(AH):AHAH1::#2:A.  09  10: B.:AN.50 0; A$(.,AN)""A$(1,AN)""A$(2,AN)""A$(3,AN)""A$(4,AN)""A$(5,AN)"" 0< BAN1: 0= AN: 0> "SAVE NAME: ";B$:B$"" 1? (B$):#2,(B$),W,U8:ABA: 58:2,B:A.B1:C.5:2,A$(C,A):C:A:2,A%:AH.9:2,E$(AH) 1@ 2,G(AH):2,H(AH):2,I(AH):2,J(AH):2,K(AH):2,L(AH):AH:AH.10:2,G$(AH):2,M(AH):2,N(AH) 1A 2,O(AH):2,P(AH):2,Q(AH):2,R(AH):2,S(AH):2,T(AH):AH:2,AF:AH.:AHAF:2,U(AH)	:2,V(AH):AHAH1 1B :#2:AAB: (2C "SAVE (AS TEXT) NAME: ";B$:B$"" 2D (B$):#2,(B$),W,U8:A.50:C.5:2,"V";(49C);"$(";(A);")=";:2,(34);A$(C,A);(34):C:2,"":A 2E #2:A.: 2F  210:B$O$: 108 2G B$""F5 2H FF1:E(
A$(F,A))E(A$(F,A)): 3I B$""F. -3J FF1:E(A$(F,A))E(A$(F,A)): I3K B$""E(A$(F,A)) V3L EE1: l3M B$""E.EE1 3N B$""E. 3O A$(F,A)(A$(F,A),E1)(A$(F,A),E1):EE1: 3P B% 3Q B%.:B$"J":E.: 3R B$"K":E(A$(F,A)): 4S B$(27) 425 4T B$"": 14U B$(27)B%(B%1) B4V B$"" 43 S4W B$"" 47 f4X B$"<"A. w4Y AA1:E.: 4Z B$">"A50 4[ AA1:E.: 4\ B$"-"A%A%1 4] B$"+"A%A%1 4^ B$""  5_ "ARE YOU SURE? (Y/N)":O$:O$"Y": 5`  5a B$"" 53 )5b B$"" 62 ;5c B$"" 151 O5d B$(16) 362 `5e B$"" 67 }5f B$(13)A%:A$(F,A) 5g B$(141) 5h A%: 135: 5i B$"" 5j H$A$(F,A):H$(H$,E)(H$,E2):A$(F,A)H$: 5k  35: 6l BB(54801)16:BB. *6m B$"X"W$A$(F,A):A$(F,A)"" A6n B$"C"W$A$(F,A) X6o B$"V"A$(F,A)W$ j6p B$"" 120 |6q B$"" 121 6r B$(13) 6s H$(A$(F,A),E1):A%:H$: 6t B$","AO1: 124 6u B$"."AO1: 124 6v B$"I" 122 6w B$"": 7x BD.5:X$(BD)A$(BD,A):BD: A7y BD.5:A$(BD,A)X$(BD):BD: 7z AN501A11:BD.5:A$(BD,AN)A$(BD,AN1):BD:AN:BD.5:A$(BD,A)"":BD:AN.100:U(AN)AU(AN)U(AN)1 7{ AN: 7| H$A$(F,A):BC.:AO1BC6 7} C%.: 130:C%.(7);:  8~ AN.:AN(H$):I$(H$,AN1,1) <8 I$"O"(AN1)(H$) 8 I$(((H$,AN2,1))AO):I$(I$,2):H$(H$,AN1)I$(H$,AN3): 8 ANAN1::A$(F,A)H$: 8 C%1:AN.:AN(H$):I$(H$,AN1,1) 8 I$"O"(AN1)(H$) 9 I$(H$,AN2,1):(I$)BCC%.: 9  9 ANAN1:: e9 H$A$(.,A):I$A$(1,A):J$A$(2,A):K$A$(3,A):L$A$(4,A):M$A$(5,A) r9 AA1 9 H$:(Y):,I$:(Y):,,J$:(Y):,,,K$:(Y):,,,,L$:(Y):,,,,,M$:(Y): 9  9 W.X. 9 H$,I$,J$,K$,L$,M$: :  : W1X. 8: H$,I$,J$,,L$,M$:(Y):,,,H$: H: W1X1 p: H$,I$,J$,,L$:(Y):,,,H$,,J$: : W2X. : H$,,J$,,,M$:(Y):,,,H$:(Y):,H$:(Y):,,,,H$: : W2X1 ; H$,,J$:(Y):,,,H$:(Y):,H$,,,,J$:(Y):,,,,H$: ;  1; 1: 153: 184:O$"" 9; : y; "ENV EDITOR";(9);V$(BA,0);(9);"OCTAVE";AU:"----------" ; "-/+: DECR/INCR, </>: OCTAVE, : EDIT, : FOCUS ENV/FILTER, +: EXIT": F< "   ";(9);(9);"";(9);"";(9);"";(9);"";(9);:"";(9);"":AH.9 ^< AJAH">";:ՙ" "; < AH;": ";:AI.:A$E$(AH): 176:AI1:ALG(AH): 176:AI2:ALH(AH): 176:AI3:ALI(AH): 176 = AI4:ALJ(AH): 176:AI5:ALK(AH): 176:AI6:ALL(AH): 176::AH::"FILTER EDITOR" = "-------------";:(9);"FREQ";(9);"LP";(9);"BP";(9);"HP";(9);"RES";:(9);"DIR";(9);"MIN";(9);"SWEEP" = AP.10: 161:AP: = ATAP">";:ՙ" "; = AN.: 167:G$(AP);"  ";(9);:AN1: 167:M(AP);(9); .> AN2: 167:U$(N(AP));(9);:AN3: 167:U$(O(AP));(9); f> AN4: 167:U$(P(AP));(9);:AN5: 167:Q(AP);(9); > AN6: 167:F$(R(AP));(9);:AN7: 167:S(AP);(9); > AN8: 167:T(AP);:"": > ARAPAS1AQAN"";:ՙ"";: > AK.A$E$(AJ) ? AK1ALG(AJ) ? AK2ALH(AJ) .? AK3ALI(AJ) A? AK4ALJ(AJ) T? AK5ALK(AJ) g? AK6ALL(AJ) m?  ? AJAHAKAIAS."";:ՙ""; ? AI. ? A$;(9);"";: ?  ? AI5 ? T$(AL);(9);"";: ?  ? AL;(9);"";: @  210:O$""AK.AKAK1 0@ O$""AK6AKAK1 I@ O$""AJ.AJAJ1 b@ O$""AJ9AJAJ1 @ O$"+"O$"="AO1: 311 @ O$"-"AO1: 315 @ O$""AO100: 311 @ O$""AO100: 315 @ O$(13)O$"+": 268  A O$(141)O$"-": 268 A O$(9)AS1: 196 *A  237: 305: SA 1: 153: 210:O$""AQ.AQAQ1 lA O$""AQ8AQAQ1 A O$""AR.ARAR1 A O$""AR10ARAR1 A O$"+"O$"="AO1: 317 A O$"-"AO1: 334 A O$""AO100: 317 B O$""AO100: 334 B O$" " -B ATARAT1:ATAR :B  261: TB O$(13) 277: 261 jB O$(9)O$"" B  237: 305::AS.: B O$"":O$"":O$ B AT1 B  241: B AZ1 B (1). 217 B  B : B ANU(AY) B AN. C AAN:Z.ZV(AY) .C  135:.1: 364: <C AN1 YC ANV(AY):(AN):A%AN: gC AN2 C ANV(AY):ARAN:ATAN: 261: C AN4W1:AA. C AN5W2:AA. C AN6X1:AA. C AN7W.:X. C AN8YV(AY) D AN10AA1:W.:X. D AN9ALV(AY):AL,AL .D Z.ZZ1 @D Z.AYAY1 PD AN3AY. gD AYAFAZ.:AY1 mD  D AN04:O$V$(AN,2)BAAN D AN:O$">"AU6AUAU1 D O$"<"AU.AUAU1 D  D AT1 D AW0 UE "";(9);(9);(9);(9);(9);(27);"QCURRFREQ=";AV;:54293,(AV7)((AVS3)256):54357,(AV7)((AVS3)256) bE AW1 rE AVAVT(AT) E AVM(AT) E AVM(AT):R(AT)3AW2 E R(AT)1AVS(AT) E  E  E  E AW2 E AVAVT(AT) E AVS(AT) F AVS(AT):R(AT)3AW1 'F R(AT)2AVM(AT) .F 4F ;F AF NFAT1 FAVM(AT):AW0:R(AT)1R(AT)3:AVS(AT):AW1: FR(AT)2 FAW2: F	1,M(AT),N(AT),O(AT),P(AT),Q(AT):2,M(AT),N(AT),O(AT),P(AT),Q(AT): G
A$"":"NEW NAME: ",A$:A$""E$(AJ)A$ G 0GAK. 266: =GAK6 sGA$"":"NEW VALUE: ",A$:AL(A$):AL4095AL4095 GAL.AL. GL(AJ)AL: G GO$"+"AO1: 311 GO$"-"AO1: 315 G GAQ2ALN(AR):AL(AL1,2):N(AR)AL: $HAQ3ALO(AR):AL(AL1,2):O(AR)AL: PHAQ4ALP(AR):AL(AL1,2):P(AR)AL: |HAQ6ALR(AR):AL(AL1,4):R(AR)AL: HA$"":"NEW VALUE: ",A$ HA$"" HA Q.G$(AR)A$ HAQ1 HAL(A$):AL2047AL2047 HAL.AL. IM(AR)AL: I AQ5 ,I!AL(A$):AL15AL15 ;I"AL.AL. KI#Q(AR)AL: XI$AQ6 pI%AL(A$):AL3AL3 I&AL.AL. I'R(AR)AL: I(AQ7 I)AL(A$):A!.:E$(6)"ARPSICRD":G(6).:H(6)9:I(6).:J(6).:K(6)2:L(6)512:E$(7)"RGAN":G(7).:H(7)9:I(7)9:J(7).:K(7)2 # L(7)2048:E$(8)"RUMPET":G(8)8:H(8)9:I(8)4:J(8)1:K(8)2:L(8)512:E$(9)"YLOPHONE":G(9).:H(9)9:I(9).:J(9).:K(9).:L(9).: F$(3"):F$(.)"" # F$(1)"":F$(2)"":F$(3)"": G$(10): M(10): N(10): O(10): P(10): Q(10): R(10): S(10): T(10):G$(.)"LOWPUP":M(.)1000 .$ N(.)1:O(.)0:P(.)0:Q(.)15:R(.)1:S(.)100:T(.)10:G$(1)"LOWPDOWN":M(1)1000:N(1)1:O(1)0:P#(1)0:Q(1)15:R(1)2:S(1)100:T(1)10:G$(2)"LOWPOSC" $ M(2)1000:N(2)1:O(2)0:P(2)0:Q(2)15:R(2)3:S(2)100:T(2)10:G$(3)"BANDPUP":M(3)1000:N(3)0:O(3)1:P(3)0:Q(3)15:R(3)1:S(3)100:T(3)10 `%	 G$(4)"BANDPDOWN":M(4)1000:N(4)0:O(4)1:P(4)$0:Q(4)15:R(4)2:S(4)100:T(4)10:G$(5)"BANDPOSC":M(5)1000:N(5)0:O(5)1:P(5)0:Q(5)15:R(5)3:S(5)100 %
 T(5)10:G$(6)"HIGHPUP":M(6)1000:N(6)0:O(6)0:P(6)1:Q(6)15:R(6)1:S(6)100:T(6)10:G$(7)"HIGHPDOWN":M(7)1000:N(7)0:O(7)0:P(7)1:Q(7)%15:R(7)2 & S(7)100:T(7)10:G$(8)"HIGHPOSC":M(8)1000:N(8)0:O(8)0:P(8)1:Q(8)15:R(8)3:S(8)100:T(8)10:G$(9)"SPARE1":M(9).:N(9)0:O(9)0:P(9)0:Q(9).:R(9)0 ' S(9).:T(9).:G$(10)"SPARE2":M(10).:N(10)0:O(10)0:P(10)0:Q(10).:R(10)0:S&(10).:T(10).: U(200): V(200):Y.05: '  N$(10):N$(1)"":N$(2)"":N$(3)"":N$(4)"ϯ1":N$(5)"ϯ2":N$(6)"ϯ":N$(7)"ϯ":N$(8)"ϯ":N$(9)"" A( N$(10)"": Q$(11): R$(11):Q$(.)"A":R$(.)"C":Q$(1)"W":'R$(1)"#C":Q$(2)"S":R$(2)"D":Q$(3)"E":R$(3)"#D":Q$(4)"D":R$(4)"E":Q$(5)"F" ( R$(5)"F":Q$(6)"T":R$(6)"#F":Q$(7)"G":R$(7)"G":Q$(8)"Y":R$(8)"#G":Q$(9)"H":R$(9)"A":Q$(10)"U":R$(10)"#A":Q$(11)"J":R$(11)"B": T$(4): a) T$(.)"":T$(1) "":T$(2)"":T$(3)"":T$(4)"": U$(2):U$(.)"":U$(1)"":AP1:AQ0:AR0:AS0:AT1:AU5:AY1: ) BA2: V$(5,2):V$(0,0)"WHOLE":V$(0,1)"W":V$(0,2)"1":V$(1,0)"HALF":V$(1,1)"H":V$(1,2)"2":V$(2,0)"QUARTER":V$(2,1)"Q":V$(2,2)"3CE WE HAVE THE "LOAD AT ADDRESS" COMMAND O.( (UNLESS FOLKS START WHINING ABOUT COMPATIBLITY WITH THE FIVE .2 ALREADY EXISTING BASIC10 PROGRAMS AGAIN...) .<: .F 128 .P 208,2     :  NO OF CHARS IN KEYBOARD BUFFER .Z 688,13,13 :  RETURN .d /n --- CHAIN LOAD PREFS f/x"EDMA 0,$1FFF,$8020000,$2001:NEW RESTORE":"RUN";: LOAD '11.SETTINGS' FROM ATTIC CACHE q/ 128 / 208,2      :  NO OF CHARS IN KEYBOARD BUFFER / 688,13,13  :  RETURN / / --- ATTIC RAM CHECK /HA&1:TA$8000000 0 T0  32 0RATA(T$1000) &0O(RA) 40 RA,T15 N0 (RA)T15  HA&0 Y0 RA,O a0 T n0 HA&  |0< 0:; 0 0 "ERROR: 11 NEEDS AT LEAST " 0" "128KB OF ATTIC RAM INSTALLED. 0, "SORRY FOR THE INCONVENIENCE." 06: 0@: +1J --- QUICK AND DIRTY ATTIC RAM SANITY CHECK N1T "CHECKING ATTIC RAM SANITY"; f1^A$30000:B$8000000 z1h! 0,$10000,A,B 1r C0  $FFFE  7 1| (AC)(BC)   1710:  FAIL 1 (C,$400)0  "."; 1 2: "ATTIC RAM SEEMS STABLE. PHEW." 2 <2"ATTIC RAM SANITY TEST FAILURE"(27)"O" B2 2"ELEVEN'S INITIAL TEST HAS DETERMINED THAT ATTIC RAM SEEMS TO BE ON THE FRITZ 2"(AGAIN). PLEASE INSTALL THE MOST RECENT STABLE MEGA65 CORE ON YOUR MACHINE.     IF THE PROBLEM "; .3"PERSISTS, PLEASE CONTACT THE MEGA65 TEAM." E3"ERROR DETAIL:" z3"EXPECTED $";((AC));" AT ADDRESS $";(BC); 3 " BUT GOT $";((BC)) 3"SORRY FOR THE INCONVENIENCE" 3: 4 SUB --- CHECK FOR AUTOLOAD, RETURN FILENAME IN AL$ --- 4I0:AL$"":AA0 Q4 (2048I)64(("AUTOLOAD",I1,1))  AA0:AL$"": h4II1: I8  2020 4A(2048I): A34  I20  II1: 2040 4 A34  AA0: 4II1: I40  AL$"":AA0: 4A(2048I): A34  2100 5  A1  A26  AA64 5*AL$AL$(A): 2060 <54 (AL$)16  AL$"":AA0 G5>AA1: p5 SUB --- INJECT AUTOLOD INTO $4FF10 5 AA0   5 $4FF07, ($4FF07)  1 : I  0 5 K1  (AL$) 5   $4FF10I, ((AL$,K,1 1)) 5  II1 5 K 5 $4FF10I,0 6                                                                                                                                                                                                                 
'----.DOCS'----' RABBER OOL - PORTED TO LEVEN (FOR EASIER MAINTENANCE)' ============'' SAGE:' -----' - RESS 'SPACE' KEY ON TOP-LEFT POINT' - HEN USE CURSOR KEYS TO MOVE TO BOTTOM-RIGHT POINT & PRESS 'SPACE'' - RESS '-' AND '+' KEYS TO MOVE BETWEEN PREVIOUS AND NEXT FRAMES' - RESS 'C' TO REDRAW CURRENT FRAME' - RESS 'Y' TO YANK/COPY A SELECTED REGION' - RESS 'P' TO PASTE A SELECTED REGION TO CURRENT CURSOR LOCATION' - RESS 'E' TO EDIT CURRENT FRAME' - RESS 'D' TO DELETE THE CURRENT FRAME' - RESS 'L' THEN A FRAME# TO LOAD THAT FRAME' - RESS 'X' TO EXIT PROGRAM' - 1 = LOAD CHAR+COLOR .BIN FILE' - 3 = SAVE CHAR+COLOR .BIN FILE' - 5 = SAVE OPTIMIZED+REPAIRED .BIN FILE' - 7 = EDIT HIT BOXES#OUTPUT "GRABBER"' HAR+OLOR ILE ORMAT (1/3 KEYS)' ======================' : PROG-ADDRESS (IGNORED)' : SIZE OF DATA (INCLUDING THIS  AND ONWARDS)' : # OF FRAMES' '  #0' --------'   : X'   : Y'   : W'   : H'   : HEAD BOX (X1,Y1,X2,Y2)'   : TORSO BOX (X1,Y1,X2,Y2)'   : FEET BOX (X1,Y1,X2,Y2)'   : ATTACK BOX (X1,Y1,X2,Y2)'   [W*H]: CHAR DATA'   [W*H]: COLOR DATA''  #1' --------'   (AS BEFORE...)''  #N' --------'   (AS BEFORE...)' OLOR-ONLY ILE ORMAT (5 KEY)' ======================' : PROG-ADDRESS (IGNORED)' : SIZE OF DATA (INCLUDING THIS  AND ONWARDS)' : # OF FRAMES' '  #0' --------'   : X'   : Y'   : W'   : H'   : HEAD BOX (X1,Y1,X2,Y2)'   : TORSO BOX (X1,Y1,X2,Y2)'   : FEET BOX (X1,Y1,X2,Y2)'   : ATTACK BOX (X1,Y1,X2,Y2)'   [W*H]: COLOR DATA''  #1' --------'   (AS BEFORE...)''  #N' --------'   (AS BEFORE...)'--------.DECLARES'--------#DECLARE CLRLINERIGHT$ = CHR$(27)+"Q"   ' OLD CL$#DECLARE CURRENTFRAME  ' OLD FF#DECLARE X, Y  ' CURSOR POSITION#DECLARE PTR  ' POINTER TO DATA BYTES IN MEMORY#DECLARE FRAMECOUNT#DECLARE FRMIDX#DECLARE BYTESUSED  ' OLD L#DECLARE FRMW, FRMH#DECLARE STARTCHAR, STARTCOLOR, ENDCHAR, ENDCOLOR#DECLARE STARTX, STARTY, ENDX, ENDY#DECLARE CURRFRAME#DECLARE SRCCHARPTR, SRCCLRPTR#DECLARE A$, XIDX, YIDX#DECLARE DESTCHARPTR, DESTCLRPTR#DECLARE FNAME$#DECLARE CVAL#DECLARE STARTPTR, ENDPTR, CURRPTR, SRCPTR, DESTPTR, SZ, K, LN#DECLARE B(50,3)  ' HITBOXES#DECLARE X1, Y1, X2, Y2#DECLARE HBSEL = 0, HBMODE, IDX#DECLARE CLIPBOARDCHAR&(80*50)#DECLARE CLIPBOARDCLR&(80*50)#DECLARE CLIPW, CLIPH#DEFINE ůԯ = 0#DEFINE ůį = 1#DECLARE STORESTATE  ' ARE WE STORING START/END POS CHAR/COLOUR DETAILS#DECLARE NEWFRAMEFLAG#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ1 = ""#DEFINE ٯ3 = ""#DEFINE ٯ4 = ""#DEFINE ٯ5 = ""#DEFINE ٯ7 = ""#DEFINE ٯ8 = ""#DEFINE ٯ = CHR$(27)#DEFINE ٯ֯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ = CHR$(13)#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE ¯ů     = 0#DEFINE ¯ů̯1 = 1#DEFINE ¯ů̯2 = 2#DEFINE ¯ů   = 3.OFFSETS#DEFINE ԯ  = 0#DEFINE ԯͯ = 2#DEFINE ԯ0     = 3#DEFINE ͯԯ          = 0#DEFINE ͯԯ          = 1#DEFINE ͯԯ          = 2#DEFINE ͯԯ          = 3#DEFINE ͯԯ   = 4#DEFINE ͯԯ¯    = 4#DEFINE ͯԯ¯   = 8#DEFINDR%(25), SRCADDR, DESTADDR, LENGTH, TRANSP#DECLARE FRAMEIDX, FX, FY, MIRROR, DATAADDR%, FRMX, FRMY#DECLARE FRMX1, FRMY1, SCRADDR%, CLRADDR%, CDATAADDR%, YY#DECLARE INC(3), INCDIR(3), A$, X, Y#DECLARE TEMPR, TEMPG, TEMPB, M#DECLARE LOGOSTATE#DECLARE FLIPVAR, UPPERNIBBLE, LOWERNIBBLE#DECLARE CLR1, CLR2, TSTART#DECLARE BASSTATE = 0#DECLARE FRMY(3), ORIGFRMY(3), FINISHCNT, BCNT#DECLARE LOC, INC%  #DECLARE RAINIDX, PLEN, RAINBOWSTR$, RAINBOWX, RAINBOWY  #DECLARE SUBTEXT$(2)  #DECLARE SUBTEXTIDX = 0  SUBTEXT$(0) = "PRESENTS..."  SUBTEXT$(1) = "A SONG BY..."#DEFINE ͯ = 0#DEFINE ͯ = 1#DEFINE ͯ = 2#DEFINE ͯ = 3#DECLARE ǯ7 = $D05D#DEFINE  = $D060#DEFINE  = $D062  ' PALETE ͯԯ¯    = 12#DEFINE ͯԯ¯  = 16#DEFINE ͯԯ       = 20#DECLARE BXOFFS(3)BXOFFS(0) = ͯԯ¯BXOFFS(1) = ͯԯ¯BXOFFS(2) = ͯԯ¯BXOFFS(3) = ͯԯ¯'----.MAIN'----  KEY OFF  POKE $D020, 11, 14  GOSUB INITVARS  GOSUB CHECKMAGICSIGNATURE  GOSUB CHECKEDITFLAG  GOSUB LOCATENEXTFREEBYTE  GOSUB DRAWFOOTER  DO WHILE 1    GOSUB STORESTATEINFO    GOSUB DRAWCURSOR    GOSUB GETUSERINPUT    GOSUB SHOWCOORDS  LOOP'-----------.SHOWCOORDS'-----------  CURSOR 0, 49  PRINT CLRLINERIGHT$;  IF STORESTATE = ůԯ THEN BEGIN    PRINT CHR$(27)+"QX=";X;", Y=";Y;  BEND  IF STORESTATE = ůį THEN BEGIN    B1:N%1:O%1:P%1: U%(20):AE%4:AF%0:AW%0: AX%(250): AY%(250): AZ%(12000):AZ%(.)("V"):AZ%(1)("E"):AZ%(2)("C"):BA%3: !  BB%(1000): BD%(9): BE%(9): BF%(9): BG%(9): BH%(9): BI%(9): C$(9):BD%(.).:BE%(.).:BF%(.).:BG%(.).:     360   A0:B0:E0:F0: A$(5,50):C$"CDEFGAB0123456789 #$.HIQRSWOTUXMPL":A%12:B%0:B%0: E$(9): G(9): H(9): I(9): J(9): K(9): L(9): 1! E$(.)"IANO":G(.).:H(.)9:I(.).:J(.).:K(.)2:L(.)1536:E$(1)"CCORDION":G(1)12:H(1).:I(1)12: J(1).:K(1)1:L(1).:E$(2)"ALLIOPE":G(2).:H(2). ! I(2)15:J(2).:K(2).:L(2).:E$(3)"RUM":G(3).:H(3)5:I(3)5:J(3).:K(3)3:L(3).:E$(4)"LUTE":G(4)9:H(4)4:I(4)4:J(4).:K(4).:L(4).:E$(5)"UITAR" m" G(5).:H(5)9:I(5)2:J(5)1:K(5)1:L(5)!BH%(.)0:BI%(.).:C$(.)"LINE" ! BD%(1).:BE%(1).:BF%(1).:BG%(1).:BH%(1)0:BI%(1).:C$(1)"CIRCLE":BD%(2).:BE%(2).:BF%(2).:BG%(2).:BH%(2)0:BI%(2).:C$(2)"ELLIPSE":BD%(3).:BE%(3). X" BF%(3).:BG%(3).:BH%(3)0:BI%(3).:C$(3)"BOX":BD%(4).:B"E%(4).:BF%(4).:BG%(4).:BH%(4)0:BI%(4).:C$(4)"POLY":BD%(5).:BE%(5).:BF%(5).:BG%(5). " BH%(5)1:BI%(5).:C$(5)"FILL":BD%(6).:BE%(6).:BF%(6).:BG%(6).:BH%(6)0:BI%(6).:C$(6)"SAVE":BD%(7).:BE%(7).:BF%(7).:BG%(7).:BH%(7)0:BI%(7). H# C#$(7)"LOAD":BD%(8).:BE%(8).:BF%(8).:BG%(8).:BH%(8)0:BI%(8).:C$(8)"EXIT" # BF%(.)(C$(.))2:BG%(.)3:A191:BD%(A)BD%(A1)BF%(A1):BF%(A)(C$(A))2:BG%(A)3:A #  9: 11: 155: 174:  $	 ..,640,400,4:A.62:C%:1536A,C%:A:>,1,.:$.,1,1: +$
 A.7:!3,6402,.,262144A16384:A: {$  10:3.,1:A.91:C%BD%(A):D%BE%(A):E%(C%BF%(A)):F%(D%BG%(A)):3.,1 $ BABH%(A)1 $ C%8,D%8,E%8,F%8,1:3.,. $ ::C%8,D%8,E%8,F%8 $ BH%(A)1BI%(A). % 3.,%3:C%8,D%8,E%8,F%8,1:3.,.: %  V% C%1,D%84,2,1,2,C$(A):3.,1:A:3.,O%:.,1,O%: e% N%O% % AZ%(BA%)63:BA%BA%1:AZ%(BA%)O%:BA%BA%1:N%O%: %  % A.BC%:AZ%(BA%)BB%(A):BA%BA%1:A: W& BB%(.)064BI%(5):BB%(1)AH%2&55:BB%(2)AH%S8:BB%(3)AI%255:BB%(4)AI%S8:BB%(5)I%255:BB%(6)I%S8:BB%(7)J%255:BB%(8)J%S8 h& BC%8: 22: v& AG%. &  19:AH%I%:AI%J%:LI%,J%:AG%1 & :ՋAG%1:AH%,AI%,I%,J%: 23:AG%.: &  K' BB%(.)164BI%(5):BB%(1)AK%'255:BB%(2)AK%S8:BB%(3)AL%255:BB%(4)AL%S8:BB%(5)AM%255:BB%(6)AM%S8:BC%6: 22: Y' AJ%. v'  19:AK%I%:AL%J%:AJ%1 '  :ՋAJ%1:AM%((I%AK%)2(J%AL%)2):AK%,AL%,AM%,BI%(5): 29:AJ%.: '!  X(" BB%(.)264BI%(5):BB%(1)AO%255:BB%(2)AO%S8:BB%(3)AP%255:BB%(4)AP%S8:BB%(5)AQ%255:BB%(6)AQ%S8:BB%(7)AR%255:BB%(8)AR%S8 i(# BC%8: 22: w($ AN%. (%  19:AO%I%:AP%J%:AN%1 (& :ՋAN%1:AQ%(I%AO%):AR%(J%AP%):0AO%,AP%,AQ%,AR%,BI%(5): 34:AN%.: ('  A$=ٯ1 THEN GOSUB LOADFILE : RETURN  IF A$=ٯ3 THEN GOSUB SAVEFILE : RETURN  IF A$=ٯ7 THEN GOSUB SETGROUPFLAG : RETURN  IF A$=ٯ9 THEN GOSUB TOGGLEVERSION  IF A$=ٯ5 THEN GOSUB PLAYDATA : RETURN  IF A$=ٯ6 THEN LASTFLAG=1:GOSUB PLAYDATA : RETURN  IF A$=ٯ֯ THEN REVFLAG& = 1 : RETURN  IF A$=ٯ֯ THEN REVFLAG& = 0 : RETURN  IF A$=ٯ10 THEN INPUT K, V:LDATA&(K) = V  IF A$="" THEN DEBUG=MOD(DEBUG+1,2):A$="":CURSOR 0,0:PRINT CHR$(27);"QDEBUG=";DEBUG  IF A$<>"" THEN BEGIN    CURSOR X, Y    GOSUB RESTORECHAR    GOSUB CHKREV    XX = X : YY = Y    GOSUB DRAWCHAR    GOSUB SAVECHAR  BEND  RETURN'--------------.TOGGLEVERSION'--------------  VER = VER + 1  IF VER = 4 THEN VER = 1  PRINT """;CHR$(27);"QVERSION";VER;  A$=""  IF VER = 3 THEN GOSUB DRAWFONTGUIDELINES  RETURN'---------------------.DRAWFONTGUIDELINES'---------------------  PRINT "----------"  PRINT  PRINT  PRINT ".........."  PRINT  PRINT  PRINT  PRINT#OUTPUT "LINE"' EYS:' ----'  P/OWN/EFT/IGHT = OVE CURSOR POSITION'  +9/0 = ET REVERSE ON/OFF'  1 = LOAD FILE'  3 = SAVE FILE'  5 = PLAY DATA'  7 = TOGGLE GROUP FLAG'       - ADDS $FF (START) OR $FE (STOP) TO DATA STREAM'        ' N EXPERIMENT TO DROP 5 (OR 6) SPRITES (EACH 64X200) OVER THE 320X200 SCREEN' TO ACT LIKE AN OVERLAY THAT  CAN DRAW LINES ON TOP OF' ACH SPRITE WILL CONSUME 1.6KB ($640 IN HEX)' ILL NEED A ROUTINE THAT TAKES VECTOR COORDS FOR LINES (MAYBE FROM VART)' AND DRAWS THEM ONTO THIS MULTI-SPRITE OVERLAY#OUTPUT "SPRITELINE"' 4 EMORY USAGE' ------------------' 4.0000  0 ' 4.0640  1 ' 4.120  2 ' 4.1900  3 ' 4.140  4 ' 4.2580  5   d  ================= 1 n  ELEVEN BOOTLOADER I x  ================= i }  2000: CHECK FOR AUTOLOAD o  :    	(2)80  (27)"X";   "": 0,65    4:CF$((("FF00")))((("FF01")))   CB  CF$"SK" :  CB=1 IF COLD BOOTING ! L	P0 :  LOAD PREFS FLAG <! MV920371  :  MINIMUM ROM VERSION b!  CHECK CORRECT ROM VERSION FIRST !  2: I0  5:V$V$((("17")I)): ! V(V$) !  VMV 940:  VERSION MISMATCH ! BD$"24-JUN-2022" ! VN$"0.5.0" !DF$"11.DEFAULTS" 
"X$(27)(27) " 128 ;""900:  CHECK FOR 'P' KEYPRESS z", 248,(248)26    :  DISABLE SCREEN EDITOR LINE LINKING "6< 6: ; 6:9 1:""(142) "@W6 "J S0  W "TA79(W2)(S2)9,S "^"        "; "hL0(12S2):" ";:L #r S #| 1020 #9 1 ?#"ELEVEN DEVELOPMENT ENVIRONMENT" ^#"VERSION ";VN$;3);BD$ #"WRITTEN BY STEPHAN KLEINERT" #"COPYRIGHT (C) 2021-2022 7 TURTLES SOFTWARE" # 1450:  CHECK ATTIC RAM $ CB   "** COLD BOOT * THE INTENT IS TO DRAW SUCH GROUPS IN ONE HIT'         (RATHER THAN CHAR BY CHAR)'  9 = TOGGLE BETWEEN VERSION 1 OR 2 OF FILE FORMAT (DEFAULT VER2)'  +EFT/IGHT = SCROLL CANVAS LEFT/RIGHT.DECLARES'--------#DECLARE A$, Z$, LOC, K, V, DEBUG=0#DECLARE X=0, Y=0, XX, YY#DECLARE T0=0#DECLARE MODIFIED%=0#DECLARE OLDX, OLDY, OLDOFFS#DECLARE FNAME$, ALTKEY#DECLARE LDATA&(12288), DIDX%=0, PIDX%=0#DECLARE GROUPFLAG&, VAL&, REVFLAG& = 0#DECLARE OFFS, VER=2#DECLARE LASTFLAG, LASTGROUPIDX.DEFINES'-------#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE ԯ = 32#DEFINE ï = 16.KEYS'----#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = " "#DEFINE ٯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ = ""#DEFINE ٯ1 = ""#DEFINE ٯ3 = ""#DEFINE ٯ4 = ""#DEFINE ٯ5 = ""#DEFINE ٯ6 = ""#DEFINE ٯ7 = ""#DEFINE ٯ8 = ""#DEFINE ٯ9 = ""#DEFINE ٯ10 = ""#DEFINE ٯ = CHR$(13)#DEFINE ٯ = CHR$(27)#DEFINE ٯԯ = CHR$(141)#DEFINE ٯԯ = ""#DEFINE ٯԯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ = CHR$(9)#DEFINE ٯ = ""#DEFINE ٯ  = ""#DEFINE ٯ = CHR$(14)#DEFINE ٯ = CHR$(142)#DEFINE ٯ = CHR$(7)#DEFINE ٯ = ""#DEFINE ٯ  = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""GOSUB INIT.MAINGOSUB CHECKINPUTGOSUB SHOWCURSORGOTO MAIN'----.INIT'----  KEY OFF  ' SWITCH BACK TO UPPER-CASE  ' POKE $D018, PEEK($D018) AND $FD  OLDX = -1 : OLDY = -1 : OLDOFFS = 0  DIDX% = 0  GROUPFLAG& = 0 : REVFLAG& = 0  PRINT "";  POKE $D020, 11  POKE $D021, 0  OFFS = 0  RETURN'-----------.CHECKINPUT'-----------  GET A$  GOSUB CHECKALTKEYINPUTS  IF A$<>"" THEN GOSUB DRAWINFO  IF A$=ٯ AND X>0 THEN GOSUB RESTORECHAR : X=X-1 : RETURN  IF A$=ٯ AND X<78 THEN GOSUB RESTORECHAR : X=X+1 : RETURN  IF A$=ٯ AND Y>0 THEN GOSUB RESTORECHAR : Y=Y-1 : RETURN            IF A$=ٯ AND Y<49 THEN GOSUB RESTORECHAR : Y=Y+1 : RETURN  IF A$=ٯ1 THEN GOSUB LOADFILE : RETURN  IF A$=ٯ3 THEN GOSUB SAVEFILE : RETURN  IF A$=ٯ7 THEN GOSUB SETGROUPFLAG : RETURN  IF A$=ٯ9 THEN GOSUB TOGGLEVERSION  IF A$=ٯ5 THEN GOSUB PLAYDATA : RETURN  IF A$=ٯ6 THEN LASTFLAG=1:GOSUB PLAYDATA : RETURN  IF A$=ٯ֯ THEN REVFLAG& = 1 : RETURN  IF A$=ٯ֯ THEN REVFLAG& = 0 : RETURN  IF A$=ٯ10 THEN INPUT K, V:LDATA&(K) = V  IF A$="" THEN DEBUG=MOD(DEBUG+1,2):A$="":CURSOR 0,0:PRINT CHR$(27);"QDEBUG=";DEBUG  IF A$<>"" THEN BEGIN    CURSOR X, Y    GOSUB RESTORECHAR    GOSUB CHKREV    XX = X : YY = Y    GOSUB DRAWCHAR    GOSUB SAVECHAR  BEND  RETURN'--------------.TOGGLEVERSION'--------------  VER = VER + 1  IF VER = 4 THEN VER = 1  PRINT "";CHR$(27);"QVERSION";VER;  A$=""  IF VER = 3 THEN GOSUB DRAWFONTGUIDELINES  RETURN'---------------------.DRAWFONTGUIDELINES'---------------------  PRINT "----------"  PRINT  PRINT  PRINT ".........."  PRINT  PRINT  PRINT  PRINT*": 1610:  CHECK ATTIC RAM STATE #$ TI W$ "PRESS 'P' DURING BOOT TO SET PREFERENCES" $ "PRESS 'C' DURING BOOT TO FORCE COLD BOOT" $ $ "CLEANING UP" $ "11TEMP": "11TOKENIZED" $900 $ "LOADING DEFAULTS" : 640 !% $4FF70,0,0 :  FORCE LOAD FROM DISC ON STARTUP V%& $4FF08,0   :  CLEAR EXTERNAL ERROR ON STARTUP _%0900 %: LP0 TBTI::900:  TITB.1 %D 0 %N:T$:T$"" %X 1110:  LOAD MODULES )&b :16,"EDMA 0,$D400,$8000000,$2001:NEW RESTORE"(13)"RUN"(13): LOAD '11.EDIT' FROM ATTIC CACHE G&l128: $D61A,($D61A)16 &q SM   (27)"5";: SWITCH TO 80X50 IF SETTINGS SAY SO &v LP0   1250:   1390:  LOAD EDITOR OR PREFS & --- LOAD SETTINGS TO MAILBOX RAM 'T$(($4FF00))(($4FF01)) 4' T$"SK"   830 :  SETTINGS ALREADY LOADED ='890 X' (DF$),B(4),P($FF00) ^' ' DS0  "COULD NOT LOAD DEFAULTS" ' 4:T$((("FF00")))((("FF01"))) 'RT0 ' T$"SK"  (BG0:FG5:BO6:HL2:SB14 :  STANDARD COLOURS (CF$"" : BU1 : RT1 ?( $4FF00,("S"): $4FF01,("K") c( $4FF00,("S"): $4FF01,("K") ( $4FF02,BO :  $4FF03,BG :  $4FF04,FG ( $4FF05,HL :  $4FF06,SB (  $4FF10,0  :  FILENAME (* (4 RT1  )9 2200: INJECT AUTOLOAD INTO $4FF10 ()>TF$"":I$4FF10:  (I)0 D)HTF$TF$((I)):II1: o)RBO($4FF02):BG($4FF03):FG($4FF04) )\HL($4FF05):SB($4FF06) )aSM  ($4FF07)25 )fCF$TF$: 128 )p )zւ )T0400:T$ )T$"P"LP1 )T$"C"CB1 *T: * --- VERSION MISMATCH J* "ROM VERSION TOO OLD"(27)(27) }* "ROM VERSION >= ";: "######";MV;: " "; * "REQUIRED, BUT VERSION ";V$;" INSTALLED!" * "SORRY FOR THE INCONVENIENCE. PLEASE UPDATE "; +  "YOUR MEGA65 AND TRY AGAIN." +: + (+ --- PALETTE 6+ R0  7 R+4  16R,15,15(R2),R Z+ R t+$ 1:BA$FF80000:A80 +. R0  7 +8! 3,80,R64,BA(RA) +B +L +V --- LOAD MODULES +` CB   +j"INSTALLING EDITOR...'" ,t "11.EDIT",P($8000000) ",~"INSTALLING PARSER..." @, "11.PARSE",P($8010000) [,"INSTALLING PREFS..." |, "11.SETTINGS",P($8020000) ,"INSTALLING TOKENIZER..." , "11.TOKENIZE",P($8022000) ,"INSTALLING POST COMPILER..." ,IM-FANDANGO/MEGAPLOT/BLOB/MASTER/MEGAPLOT.A'--------.DECLARES'--------#DECLARE د = 126#DECLARE د = 124#DECLARE د = 123#DECLARE د = 108#DECLARE د֯ = 254#DECLARE د֯ = 252#DECLARE د֯ = 251#DECLARE #د֯ = 236#DECLARE دǯ̯ = 127#DECLARE دǯ̯ = 255#DECLARE دů = 98#DECLARE دů = 226#DECLARE دů = 97#DECLARE دů = 225#DECLARE د = 32#DECLARE د = 160#DECLARE  = 3.141592654269'----.VARS'----#DECLARE X1, Y1, X2, Y2#DECLARE DX, DY, MX, MY, CX, CY#DECLARE CURCHAR, PIX#DECLARE DIFFX, DIFFY, DELTAX, DELTAY, TANVAL, ANGLE#DECLARE A$, ANG, LINELENGTH, K, DEBUG#DECLARE CENTREX, CENTREY, CENTREZ#DECLARE P%#OUTPUT "BASLOGO"' 4 EMORY USAGE' ------------------' 4.0000 -' 4.0020 VAR INTERFACE TO ASSEMBLY'        0020: PTR TO DEFAULTRED&'        0022: PTR TO DEFAULTGREEN&'        0024: PTR TO DEFAULTBLUE&'        0026: PTR TO CURRRED&&'        0028: PTR TO CURRGREEN&'        002A: PTR TO CURRBLUE&'        002C: PTR TO DATAADDR%'        002E: PTR TO CDATAADDR%'        0030: PTR TO SCRADDR%'        0032: PTR TO CLRADDR%'        0034: PTR TO INC%' 4.0800  ' 4.2000   FOR  LOGO' 5 EMORY USAGE' ------------------' 5.0000 SCREEN BUFFER FOR DRAWPETSCIIFRAME' 5.1000 COLOR RAM BUFFER FOR DRAWPETSCIIFRAME.DEFINES#DECLARE K, PTR, TMP, MAXFRAMES, FRMIDX, FRMW, FRMH, SZ#DECLARE FRAMEAD  "11.POST",P($8024000) - 	- %- --- CHAIN LOAD EDITOR +-: -"EDMA 0,$D400,$8000000,$2001:NEW RESTORE":"RUN";: LOAD '11.EDIT' FROM ATTIC CACHE -  128 -
: - HACK: LOAD NEXT MODULE IN DIRECT MODE . THIS WILL GO AWAY ONRUN/STOP  TRAP  PRINT ERR$(ER);" ERROR"  PRINT " IN LINE";EL  KEY ON  END.CHUNKSEQUENCER'---------------  DO WHILE 1    GOSUB DRAWSEQUENCE    GOSUB GETUSERINPUTFORSEQUENCE    IF A$ = ٯ THEN EXIT  LOOP  RETURN.DRAWSEQUENCE'-------------  PRINT "SEQUENCE EDITOR"  PRINT "---------------"  PRINT ")DD )NSERT )ELETE, DIT=, LAYLL=+, LAY= - SEQCNT = ";SEQCNT  PRINT ": EDIT , : STOP MUSIC, +: EXIT"  PRINT " MD            XTRA"           PRINT " ---            -----"  IF INT((SEQCNT-1)/43) > 1 AND (INT(SEQOFFS/43)+1) < INT((SEQCNT-1)/43) THEN BEGIN    'IF INT((SEQCNT-1) / 43) * 43 > SEQOFFS THEN BEGIN      CURSOR 75, 5:PRINT "--->"    'BEND  BEND  IF SEQOFFS > 0 THEN BEGIN    CURSOR 70, 5:PRINT "<---"  BEND  K = SEQOFFS  DO WHILE K < SEQCNT    IF K > (SEQOFFS + 43 * 2 - 1) THEN K=SEQCNT:GOTO NXT    IF (K-SEQOFFS) >= 43 THEN CURSOR 40,6+(K-SEQOFFS-43)    IF PLYPTR = K THEN PRINT ">";:ELSE PRINT " ";    S=0:GOSUB HIGHLIGHTSELECTEDSEQCOLUMN    ' CHUNK IS A SPECIAL į*?    IF SEQCHUNK(K) < 0 AND ABS(SEQCHUNK(K)) < į THEN BEGIN      V$ = SEQCMDNAME$(ABS(SEQCHUNK(K)))      S = 10-LEN(V$)      PRINT V$;      DO WHILE S >= 0        PRINT " ";        S = S - 1      LOOP    BEND:ELSE BEGIN      PRINT SEQCHUNK(K);ٯ;    BEND    S=1:GOSUB HIGHLIGHTSELECTEDSEQCOLUMN    HANDLED = 0    IF SEQCHUNK(K) = į THEN BEGIN      HANDLED = 1      IF SEQEXTRA(K) = -1 THEN PRINT ٯ;"<NONE>":ELSE BEGIN        PRINT ٯ;FILTNAME$(SEQEXTRA(K))      BEND    BEND    IF HANDLED=0 AND SEQCHUNK(K) = į THEN BEGIN      HANDLED = 1      PRINT ٯ;SEQEXTRA(K)    BEND    '     IF HANDLED = 0 THEN BEGIN       PRINT ٯ;SEQEXTRA(K)    BEND    PRINT ٯ֯;.NXT    K = K + 1  LOOP    RETURN.HIGHLIGHTSELECTEDSEQCOLUMN'-----------------------------  IF SEQPTR = K AND SSCOL=S THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  RETURN.GETU	SERINPUTFORSEQUENCE'---------------------------  GOSUB READKEYLOOP  IF A$="A" THEN GOSUB ADDCHUNKTOSEQ  IF A$="I" THEN GOSUB INSERTCHUNKTOSEQ  ' IF A$="E" THEN GOSUB EDITCHUNKSEQ  IF A$="D" THEN GOSUB DELETECHUNKSEQ  IF A$=ٯ 
AND SEQPTR > 0 THEN SEQPTR = SEQPTR - 1  IF A$=ٯ AND SEQPTR < SEQCNT-1 THEN SEQPTR = SEQPTR + 1   IF A$=ٯ THEN BEGIN    IF SSCOL = 1 THEN BEGIN      SSCOL = 0    BEND:ELSE BEGIN      IF (SEQPTR-43)>=0 THEN BEGIN        SSCOL = 1        SEQPTR = SEQPTR - 43      BEND    BEND  BEND  IF A$=ٯ THEN BEGIN    IF SSCOL = 0 THEN BEGIN      SSCOL = 1    BEND:ELSE BEGIN      IF (SEQPTR+43) < SEQCNT THEN BEGIN        SSCOL = 0        SEQPTR = SEQPTR + 43      BEND    BEND  BEND  IF A$=ٯԯ THEN BEGIN    PLYPTR = 0    PLYFLAG = 1    CHUNKRPT = 0    PLAY    GOSUB SETALLENV    TEMPO TMPO%  BEND  IF A$=ٯ THEN BEGIN    PLYPTR = SEQPTR    PLYFLAG = 1    CHUNKRPT = 0    PLAY    GOSUB SETALLENV    TEMPO TMPO%  BEND  IF A$=ٯ THEN GOSUB EDITCHUNKCELL  IF A$="C" THEN GOSUB EDITCHUNKCMD  IF A$=ٯ THEN GOSUB STOPALLMUSIC  IF A$=ٯ THEN SEQPTR = 0  IF A$=ٯ THEN SEQPTR = SEQCNT-1  ' FINALLY, ADJUST SEQOFFS IF NEEDBE  IF (INT(SEQPTR / 43) * 43) < SEQOFFS THEN SEQOFFS = SEQOFFS - 43  IF (INT(SEQPTR / 43) * 43) > (SEQOFFS+43) THEN SEQOFFS = SEQOFFS + 43  RETURN.STOPALLMUSIC'--------------  PLYPTR = -1  PLYFLAG = 0  PLAY  GOSUB SETALLENV  TEMPO TMPO%  GOSUB APPLYSELECTEDFILTER  RETURN.DELETECHUNKSEQ'----------------  IF SEQCNT = 0 THEN RETURN  K = SEQPTR  DO WHILE K < SEQCNT - 1    SEQCHUNK(K) = SEQCHUNK(K + 1)    SEQEXTRA(K) = SEQEXTRA(K + 1)    K = K + 1  LOOP  SEQCNT = SEQCNT - 1  IF SEQPTR = SEQCNT AND SEQPTR>0 THEN SEQPTR = SEQPTR - 1  RETURN.EDITCHUNKSEQ'--------------  IF SEQCNT = 0 THEN RETURN  PRINT ٯ;ٯ;ٯ;ٯ;"Q";  V=0:INPUT "CHUNK#: ", V  SEQCHUNK(SEQPTR) = V  PRINT ٯ;ٯ;ٯ;ٯ;"Q";  V=-1:INPUT "EXTRA#: ", V  SEQEXTRA(SEQPTR) = V  RETURN.EDITCHUNKCELL'---------------  IF SEQCNT = 0 THEN RETURN  PRINT ٯ;ٯ;ٯ;ٯ;"Q";  IF SSCOL = 0 THEN BEGIN    V = SEQCHUNK(SEQPTR)    V1$ = STR$(V)    IF LEFT$(V1$,1) = " " THEN V1$=MID$(V1$,2)    PRINT "CHUNK#: ";ٯ;"^";V1$;ٯ;"_";    INPUT "", V    SEQCHUNK(SEQPTR) = V  BEND  IF SSCOL = 1 THEN BEGIN    V = SEQEXTRA(SEQPTR)    V1$ = STR$(V)    IF LEFT$(V1$,1) = " " THEN V1$=MID$(V1$,2)    PRINT "EXTRA#: ";ٯ;"^";V1$;ٯ;"_";    INPUT "", V    SEQEXTRA(SEQPTR) = V  BEND  RETURN.EDITCHUNKCMD'--------------  V = -SEQCHUNK(SEQPTR)  PRINT ٯ;  FOR ROW = 1 TO į - 1    PRINT ROW;":"; SEQCMDNAME$(ROW)  NEXT ROW  PRINT  INPUT "CMD: ", V  IF V > 0 THEN SEQCHUNK(SEQPTR) = -V  RETURN.INSERTCHUNKTOSEQ'-------------------  SEQCNT = SEQCNT + 1  ' MOVE ALL HIGHER CHUNK SEQUENCES UP ONE  K = SEQCNT - 2  DO WHILE K >= SEQPTR    SEQCHUNK(K+1) = SEQCHUNK(K)    SEQEXTRA(K+1) = SEQEXTRA(K)    K = K - 1  LOOP  SEQCHUNK(SEQPTR) = 0  SEQEXTRA(SEQPTR) = 0  RETURN.ADDCHUNKTOSEQ'----------------  SEQPTR = SEQCNT  SE LQCNT = SEQCNT + 1  SEQCHUNK(SEQPTR) = 0  SEQEXTRA(SEQPTR) = 0  RETURN                                                                                                                                                                                     
 
  $    "BOOT MENU:" J   "(USE SHIFT TO LOAD COMPILED BINARY)" P (  _ 2  "ELEVEN" n <  "======"  F  "1) LINE.EL (TRY LOAD 'ANA.LN')"  P  "2) ROTATE.EL"  Z  "3) SPRITELINE.EL"  d  "4) MELODY.EL (TRY LOAD 'ENIGMA.P')" !n  "5) VART.#OUTPUT "LINE"' EYS:' ----'  P/OWN/EFT/IGHT = OVE CURSOR POSITION'  +9/0 = ET REVERSE ON/OFF'  1 = LOAD FILE'  3 = SAVE FILE'  5 = PLAY DATA'  7 = TOGGLE GROUP FLAG'       - ADDS $FF (START) OR $FE (STOP) TO DATA STREAM'         THE INTENT IS TO DRAW SUCH GROUPS IN ONE HIT'         (RATHER THAN CHAR BY CHAR)'  9 = TOGGLE BETWEEN VERSION 1 OR 2 OF FILE FORMAT (DEFAULT VER2)'  +EFT/IGHT = SCROLL CANVAS LEFT/RIGHT.DECLARES'--------#DECLARE A$, Z$, LOC, K, V, DEBUG=0#DECLARE X=0, Y=0, XX, YY#DECLARE T0=0#DECLARE MODIFIED%=0#DECLARE OLDX, OLDY, OLDOFFS#DECLARE FNAME$, ALTKEY#DECLARE LDATA&(12288), DIDX%=0, PIDX%=0#DECLARE GROUPFLAG&, VAL&, REVFLAG& = 0#DECLARE OFFS, VER=2#DECLARE LASTFLAG, LASTGROUPIDX.DEFINES'-------#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE ԯ = 32#DEFINE ï = 16.KEYS'----#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = " "#DEFINE ٯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ = ""#DEFINE ٯ1 = ""#DEFINE ٯ3 = ""#DEFINE ٯ4 = ""#DEFINE ٯ5 = ""#DEFINE ٯ6 = ""#DEFINE ٯ7 = ""#DEFINE ٯ8 = ""#DEFINE ٯ9 = ""#DEFINE ٯ10 = ""#DEFINE ٯ = CHR$(13)#DEFINE ٯ = CHR$(27)#DEFINE ٯԯ = CHR$(141)#DEFINE ٯԯ = ""#DEFINE ٯԯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ = CHR$(9)#DEFINE ٯ = ""#DEFINE ٯ  = ""#DEFINE ٯ = CHR$(14)#DEFINE ٯ = CHR$(142)#DEFINE ٯ = CHR$(7)#DEFINE ٯ = ""#DEFINE ٯ  = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""GOSUB INIT.MAINGOSUB CHECKINPUTGOSUB SHOWCURSORGOTO MAIN'----.INIT'----  KEY OFF  ' SWITCH BACK TO UPPER-CASE  ' POKE $D018, PEEK($D018) AND $FD  OLDX = -1 : OLDY = -1 : OLDOFFS '= 0  DIDX% = 0  GROUPFLAG& = 0 : REVFLAG& = 0  PRINT "";  POKE $D020, 11  POKE $D021, 0  OFFS = 0  RETURN'-----------.CHECKINPUT'-----------  GET A$  GOSUB CHECKALTKEYINPUTS  IF A$<>"" THEN GOSUB DRAWINFO  IF A$=ٯ AND X>0 !EL" !x  "6) GRABBER.EL" *!  "7) FOOT.EL" @!  "8) BASLOGO.EL" U!  "9) WRITER.EL" k!  "A) PETLINE.EL" !  "B) STARFIELD.EL" !  !  "MEGA ASSEMBLER" !  "==============" !  "Z) ROTATE.ASM" !   A$ !  A$"1"  Z$"LINE.EL": 390 ""  A$"2"  Z$"ROTATE.EL": 390 F"  A$"3"  Z$"SPRITELINE.EL": 390 j"  A$"4"  Z$"MELODY.EL": 390 "  A$"5"  Z$"VART.EL": 390 "  A$"6"  Z$"GRABBER.EL": 390 "  A$"7"  Z$"FOOT.EL": 390 " A$"8"  Z$"BASLOGO.EL": 390 ## A$"9"  Z$"WRITER.EL": 390 A# A$"A"  Z$"PETLINE.EL": 390 h# A$"B"  Z$"STARFIELD.EL": 390 # A$"Z"  : "AUTOLOAD ";(34);"ROTATE.ASM";(34): "MEGA ASSEMBLER" #" A$"!"   (27);"5";:: "LINE" #, A$(34)  : "ROTATE4$" $6 A$"#"  : "SPRITELINE" 8$@ A$"$"  : "PLAYMAKER" R$J A$"%"  : "VART" |$T A$"&"  : (27);"5";: "GRABBER" $^ A$"'"  : "FOOT" $h A$"("  : "BASLOGO" $r A$")"  : "WRITER" $w A$""  : "PETLINE" %x A$&#OUTPUT "PETLINE"' DRAW LINES IN 80X50 WITH PETSCII BLOCK CHARS' GIVING A FULL RESOLUTION OF 160X100' : HEN  LATER WANT TO MOVE THE LOGIC INTO ASSEMBLY,' CONSIDER REFERENCING GRIM FANDANGO'S  ASSEMBLY SOURCE:' - HTTPS://GITHUB.COM/GR!#OUTPUT "PETLINE"' DRAW LINES IN 80X50 WITH PETSCII BLOCK CHARS' GIVING A FULL RESOLUTION OF 160X100' : HEN  LATER WANT TO MOVE THE LOGIC INTO ASSEMBLY,' CONSIDER REFERENCING GRIM FANDANGO'S  ASSEMBLY SOURCE:' - HTTPS://GITHUB.COM/GR"IM-FANDANGO/MEGAPLOT/BLOB/MASTER/MEGAPLOT.A'--------.DECLARES'--------#DECLARE د = 126#DECLARE د = 124#DECLARE د = 123#DECLARE د = 108#DECLARE د֯ = 254#DECLARE د֯ = 252#DECLARE د֯ = 251#DECLARE  THEN GOSUB RESTORECHAR : X=X-1 : RETURN  IF A$=ٯ AND X<78 THEN GOSUB RESTORECHAR : X=X+1 : RETURN  IF A$=ٯ AND Y>0 THEN GOSUB RESTORECHAR : Y=Y-1 : RETURN            IF A$=ٯ AND Y<49 THEN GOSUB RESTORECHAR : Y=Y+1 : RETURN  IFLTERHIGHLIGHT'---------------------------  IF FSROW = FPRESET AND FFOCUS = 1 AND FSCOL = K THEN _    PRINT ٯ֯; : ELSE PRINT ٯ֯;  RETURN.GETVAL'-------  IF SCOL = 0 THEN V$ = ENVSNAME$(SROW)  IF SCOL = 1 THEN V = ENVSATTACK(SROW)  IF SCOL = 2 THEN V = ENVSDECAY(SROW)  IF SCOL = 3 THEN V = ENVSSUSTAIN(SROW)  IF SCOL = 4 THEN V = ENVSRELEASE(SROW)  IF SCOL = 5 THEN V = ENVSWAVEFORM(SROW)  IF SCOL = 6 THEN V = ENVSPW(SROW)  RETURN.SHOWCELL'---------  IF SROW=ROW AND SCOL = COL AND FFOCUS=0 THEN PRINT ٯ֯;:ELSE PRINT ٯ֯;  IF COL = 0 THEN BEGIN    PRINT V$;ٯ;"";    RETURN  BEND  IF COL = 5 THEN BEGIN    PRINT WNAME$(V);ٯ;ٯ֯;    RETURN  BEND  ' ELSE  PRINT V;;ٯ֯;  RETURN.GETUSERINPUTFORTABLE'------------------------  ' GET KEY A$  GOSUB READKEYLOOP  IF A$ = ٯ AND SCOL > 0 THEN SCOL = SCOL - 1  IF A$ = ٯ AND SCOL < 6 THEN SCOL = SCOL + 1  IF A$ = ٯ AND SROW > 0 THEN SROW = SROW - 1  IF A$ = ٯ AND SROW < 9 THEN SROW = SROW + 1  IF A$ = "+" OR A$="=" THEN DELTA=1 : GOSUB INCRVAL  IF A$ = "-" THEN DELTA=1 : GOSUB DECRVAL  IF A$ = ٯԯ THEN DELTA=100 : GOSUB INCRVAL  IF A$ = ٯԯ THEN DELTA=100 : GOSUB DECRVAL  IF A$ = ٯ THEN A$ = "+" : GOSUB EDITENVFIELD  IF A$ = ٯԯ THEN A$ = "-" : GOSUB EDITENVFIELD  IF A$ = ٯ THEN FFOCUS = 1 : GOSUB GETUSERINPUTFORFILTERS  GOSUB CHECKDURATIONCHANGE  GOSUB CHECKPIANOKEYS  RETURN.GETUSERINPUTFORFILTERS'--------------------------  DO WHILE 1    GOSUB DRAWTABLE    ' GET KEY A$    GOSUB READKEYLOOP    IF A$ = ٯ AND FSCOL > 0 THEN FSCOL = FSCOL - 1    IF A$ = ٯ AND FSCOL < 8 THEN FSCOL = FSCOL + 1    IF A$ = ٯ AND FSROW > 0 THEN FSROW = FSROW - 1    IF A$ = ٯ AND FSROW < 10 THEN FSROW = FSROW + 1    IF A$ = "+" OR A$="=" THEN DELTA=1 : GOSUB INCRFVAL    IF A$ = "-" THEN DELTA=1 : GOSUB DECRFVAL 	   IF A$ = ٯԯ THEN DELTA = 100 : GOSUB INCRFVAL    IF A$ = ٯԯ THEN DELTA = 100 : GOSUB DECRFVAL    IF A$ = " " THEN BEGIN      IF FSEL = FSROW THEN FSEL = -1:ELSE FSEL = FSROW      GOSUB APPLYSELECTEDFILTER    BEND   
 IF A$ = ٯ THEN GOSUB EDITFILTERFIELD:GOSUB APPLYSELECTEDFILTER    IF A$ = ٯ OR A$ = ٯ THEN EXIT    GOSUB CHECKDURATIONCHANGE    GOSUB CHECKPIANOKEYS  LOOP  FFOCUS = 0  RETURN.READKEYLOOP'-------------  A$ = ""  DO WHILE A$=""    GET A$    IF FSEL <> -1 THEN BEGIN      GOSUB UPDATESELECTEDFILTER    BEND    IF PLYFLAG = 1 THEN BEGIN      IF RPLAY(1) = 0 THEN GOSUB PARSECURRENTSEQPTR    BEND  LOOP  RETURN.PARSECURRENTSEQPTR'--------------------  K = SEQCHUNK(PLYPTR)    IF K >= 0 THEN BEGIN    CHUNKIDX = K    IF CHUNKRPT <= 0 THEN CHUNKRPT = SEQEXTRA(PLYPTR)    GOSUB PLAYCHUNKIDX    SLEEP .1    GOSUB DRAWSEQUENCE  BEND  IF K = į THEN BEGIN    K = SEQEXTRA(PLYPTR)    TEMPO (K)    TMPO% = K  BEND  IF K = į THEN BEGIN    K = SEQEXTRA(PLYPTR)    FSROW = K    FSEL = K    GOSUB APPLYSELECTEDFILTER  BEND  IF K = įϯ1 THEN ECHOM = 1 : ECHODELAY = 0  IF K = įϯ2 THEN ECHOM = 2 : ECHODELAY = 0  IF K = įϯ  THEN ECHOB = 1 : ECHODELAY = 0  IF K = įϯ THEN ECHOM = 0 : ECHOB = 0  IF K = įϯ THEN ECHOSZ = SEQEXTRA(PLYPTR)  IF K = į THEN ECHODELAY = 1 : ECHOM = 0 : ECHOB = 0  IF K = į THEN V = SEQEXTRA(PLYPTR) : VOL V, V  IF CHUNKRPT > 0 THEN CHUNKRPT = CHUNKRPT - 1  IF CHUNKRPT <= 0 THEN PLYPTR = PLYPTR + 1  IF K = į THEN PLYPTR = 0  IF PLYPTR >= SEQCNT THEN PLYFLAG = 0 : PLYPTR = -1  RETURN.CHECKDURATIONCHANGE'---------------------  FOR K = į TO į    IF A$ = DUR$(K, ) THEN SDUR = K  NEXT K  ' CHECK OCTAVE TOO  IF A$ = ">" AND OCT < 6 THEN OCT = OCT + 1  IF A$ = "<" AND OCT > 0 THEN OCT = OCT - 1  RETURN.UPDATESELECTEDFILTER'----------------------  IF FSEL = -1 THEN RETURN  IF CURRDIR = ү THEN RETURN  PRINT "";ٯ;ٯ;ٯ;ٯ;ٯ;CHR$(27);"QCURRFREQ=";CURRFREQ;    ' : AN'T USE  FOR  REGISTERS AS THE REGS ARE WRITE-ONLY  '       ( WILL INTERNALLY NEED A READ PRIOR TO THE WRITE)  ' ?  COULDN'T DO  $415 (IT BECAME 868691 = $4153 ?!)  WPOKE 54293, (CURRFREQ AND 7) + ((CURRFREQ >> 3) * 256)  WPOKE 54357, (CURRFREQ AND 7) + ((CURRFREQ >> 3) * 256)  IF CURRDIR = ү THEN BEGIN    CURRFREQ = CURRFREQ + FILTSWEEP(FSEL)    IF CURRFREQ > FILTFREQ(FSEL) THEN BEGIN      CURRFREQ = FILTFREQ(FSEL)      IF FILTDIR(FSEL) = ү THEN CURRDIR = ү      IF FILTDIR(FSEL) = ү THEN CURRFREQ = FILTMIN(FSEL)    BEND    RETURN  BEND  IF CURRDIR = ү THEN BEGIN    CURRFREQ = CURRFREQ - FILTSWEEP(FSEL)    IF CURRFREQ < FILTMIN(FSEL) THEN BEGIN      CURRFREQ = FILTMIN(FSEL)      IF FILTDIR(FSEL) = ү THEN CURRDIR = ү      IF FILTDIR(FSEL) = ү THEN CURRFREQ = FILTFREQ(FSEL)    BEND    RETURN  BEND  RETURN.APPLYSELECTEDFILTER'---------------------  IF FSEL = -1 THEN RETURN  CURRFREQ = FILTFREQ(FSEL)  CURRDIR = ү  IF   FILTDIR(FSEL) = ү _    OR FILTDIR(FSEL) = ү THEN BEGIN    CURRFREQ = FILTMIN(FSEL)    CURRDIR = ү  BEND  IF FILTDIR(FSEL) = ү THEN BEGIN    CURRDIR = ү  BEND  FILTER 1, FILTFREQ(FSEL), FILTLP(FSEL), _          FILTBP(FSEL), FILTHP(FSEL), FILTRES(FSEL)  FILTER 2, FILTFREQ(FSEL), FILTLP(FSEL), _          FILTBP(FSEL), FILTHP(FSEL), FILTRES(FSEL)  RETURN.CHANGEENVNAME'---------------  V$=""  INPUT "NEW NAME: ",V$  IF V$<>"" THEN ENVSNAME$(SROW) = V$  RETURN.EDITENVFIELD'--------------  IF SCOL = 0 THEN GOSUB CHANGEENVNAME : RETURN  IF SCOL = 6 THEN BEGIN    V$=""    INPUT "NEW VALUE: ",V$    V = VAL(V$)    IF V > 4095 THEN V = 4095    IF V < 0 THEN V = 0    ENVSPW(SROW) = V    RETURN  BEND  IF A$="+" THEN DELTA=1 : GOSUB INCRVAL  IF A$="-" THEN DELTA=1 : GOSUB DECRVAL  RETURN.EDITFILTERFIELD'-----------------  IF FSCOL = 2 THEN V=FILTLP(FSROW):V=MOD(V+1,2):FILTLP(FSROW)=V:RETURN  IF FSCOL = 3 THEN V=FILTBP(FSROW):V=MOD(V+1,2):FILTBP(FSROW)=V:RETURN  IF FSCOL = 4 THEN V=FILTHP(FSROW):V=MOD(V+1,2):FILTHP(FSROW)=V:RETURN  IF FSCOL = 6 THEN V=FILTDIR(FSROW):V=MOD(V+1,4):FILTDIR(FSROW)=V:RETURN  V$=""  INPUT "NEW VALUE: ",V$  IF V$<>"" THEN BEGIN    IF FSCOL = 0 THEN FILTNAME$(FSROW) = V$    IF FSCOL = 1 THEN BEGIN      V = VAL(V$)      IF V > 2047 THEN V = 2047      IF V < 0 THEN V = 0      FILTFREQ(FSROW) = V    BEND    IF FSCOL = 5 THEN BEGIN      V = VAL(V$)      IF V > 15 THEN V = 15      IF V < 0 THEN V = 0      FILTRES(FSROW) = V    BEND    IF FSCOL = 6 THEN BEGIN      V = VAL(V$)      IF V > 3 THEN V = 3      IF V < 0 THEN V = 0      FILTDIR(FSROW) = V    BEND    IF FSCOL = 7 THEN BEGIN      V = VAL(V$)      IF V > 2047 THEN V = 2047      IF V < 0 THEN V = 0      FILTMIN(FSROW) = V    BEND    IF FSCOL = 8 THEN BEGIN      V = VAL(V$)      IF V > 2047 THEN V = 2047      IF V < 0 THEN V = 0      FILTSWEEP(FSROW) = V    BEND  BEND.CHECKPIANOKEYS'----------------  ' APPLY FILTER  PSTR$ = "X0"  IF FSEL <> -1 THEN PSTR$ = "X1"  ' DECIDE NOTE LENGTH  PSTR$ = PSTR$ + DUR$(SDUR, )  ' DECIDE OCTAVE  PSTR$ = PSTR$ + "O" + STR$(OCT)  ' WHICH NOTE TO PLAY  FOR K = 0 TO 11    IF A$ = KEYSIN$(K) THEN PSTR$ = PSTR$ + KEYSOUT$(K)  NEXT K  IF LEN(PSTR$)>0 THEN BEGIN    PLAY "T"+STR$(SROW)+PSTR$  BEND  RETURN.INCRVAL'--------  GOSUB GETVAL  MAXV = 15  IF SCOL = 5 THEN MAXV = 4  IF SCOL = 6 THEN MAXV = 4095  V = V + DEL TA  IF V > MAXV THEN V = MAXV  GOSUB APPLYVAL  RETURN.DECRVAL'--------  GOSUB GETVAL  V = V - DELTA  IF V < 0 THEN V = 0  GOSUB APPLYVAL  RETURN.INCRFVAL'---------  IF FSCOL = 1 THEN BEGIN    V = FILTFREQ(FSROW) + DELTA    IF V !> 2047 THEN V = 2047    FILTFREQ(FSROW) = V  BEND  IF FSCOL = 2 THEN FILTLP(FSROW) = 1  IF FSCOL = 3 THEN FILTBP(FSROW) = 1  IF FSCOL = 4 THEN FILTHP(FSROW) = 1  IF FSCOL = 5 THEN BEGIN    V = FILTRES(FSROW) + DELTA    IF V > 15 THEN V = 1"5    FILTRES(FSROW) = V  BEND  IF FSCOL=6 AND FILTDIR(FSROW) < 3 THEN FILTDIR(FSROW) = FILTDIR(FSROW) + 1  IF FSCOL=7 AND FILTMIN(FSROW) < 2047 THEN BEGIN    V = FILTMIN(FSROW) + DELTA    IF V > 2047 THEN V = 2047    FILTMIN(FSROW) = V  #BEND      IF FSCOL=8 AND FILTSWEEP(FSROW) < 2047 THEN BEGIN    V = FILTSWEEP(FSROW) + DELTA    IF V > 2047 THEN V = 2047    FILTSWEEP(FSROW) = V  BEND  GOSUB APPLYSELECTEDFILTER  RETURN.DECRFVAL'---------  IF FSCOL = 1 THEN BEGIN    $V = FILTFREQ(FSROW) - DELTA    IF V < 0 THEN V = 0    FILTFREQ(FSROW) = V  BEND  IF FSCOL = 2 THEN FILTLP(FSROW) = 0  IF FSCOL = 3 THEN FILTBP(FSROW) = 0  IF FSCOL = 4 THEN FILTHP(FSROW) = 0  IF FSCOL = 5 THEN BEGIN    V = FILTRES(FSROW) %- DELTA    IF V < 0 THEN V = 0    FILTRES(FSROW) = V  BEND  IF FSCOL=6 AND FILTDIR(FSROW) > 0 THEN FILTDIR(FSROW) = FILTDIR(FSROW) - 1  IF FSCOL=7 AND FILTMIN(FSROW) > 0 THEN BEGIN    V = FILTMIN(FSROW) - DELTA    IF V < 0 THEN V = 0    F&ILTMIN(FSROW) = V  BEND  IF FSCOL=8 AND FILTSWEEP(FSROW) > 0 THEN BEGIN    V = FILTSWEEP(FSROW) - DELTA    IF V < 0 THEN V = 0    FILTSWEEP(FSROW) = V  BEND  GOSUB APPLYSELECTEDFILTER  RETURN.APPLYVAL'---------  IF SCOL=0 THEN ENVS'NAME$(SROW) = V$  IF SCOL=1 THEN ENVSATTACK(SROW) = V  IF SCOL=2 THEN ENVSDECAY(SROW) = V  IF SCOL=3 THEN ENVSSUSTAIN(SROW) = V  IF SCOL=4 THEN ENVSRELEASE(SROW) = V  IF SCOL=5 THEN ENVSWAVEFORM(SROW) = V  IF SCOL=6 THEN ENVSPW(SROW) = V  R OW = SROW  GOSUB SETENV  RETURN.SETENV'-------  ENVELOPE ROW, ENVSATTACK(ROW), ENVSDECAY(ROW), ENVSSUSTAIN(ROW), ENVSRELEASE(ROW), ENVSWAVEFORM(ROW), ENVSPW(ROW)  RETURN.RUNSTOPTRAPPER'---------------  IF ER=30 THEN RESUME  ' IGNORE  W)    INPUT #2, FILTDIR(ROW)    INPUT #2, FILTMIN(ROW)    INPUT #2, FILTSWEEP(ROW)  NEXT ROW  ' LOAD SEQUENCE  ' -------------  SEQCNT = 0  INPUT #2, SEQCNT  ROW = 0  DO WHILE ROW < SEQCNT    INPUT #2, SEQCHUNK(ROW)    INPUT #2, SEQEXTR A(ROW)    ROW = ROW + 1  LOOP' #ENDIF  DCLOSE #2  CHUNKIDX = 0  RETURN.GETCHUNKCNT'-------------  CHUNKCNT = 0  FOR K = 0 TO CHUNKMAX    IF V$(0,K)<>"" OR V$(1,K)<>"" OR V$(2,K)<>"" OR V$(3,K)<>"" OR V$(4,K)<>"" OR V$(5,K)<>"" THEN BE GIN      CHUNKCNT = K + 1    BEND  NEXT K  RETURN.SAVE'----  INPUT "SAVE NAME: ";KEY$  IF KEY$="" THEN RETURN    DELETE (KEY$)  DOPEN #2,(KEY$),W,U8  TMP = CHUNKIDX  ' SAVE MELODY CHUNKS  ' ------------------  GOSUB GETCHUNKCNT  P RINT #2, CHUNKCNT  FOR CHUNKIDX = 0 TO CHUNKCNT - 1    FOR VIDX=0 TO 5      PRINT #2,V$(VIDX, CHUNKIDX)    NEXT VIDX  NEXT CHUNKIDX  PRINT #2,TMPO%  ' SAVE ENVELOPES  ' --------------  FOR ROW = 0 TO 9    PRINT #2, ENVSNAME$(ROW)    PRI NT #2, ENVSATTACK(ROW)    PRINT #2, ENVSDECAY(ROW)    PRINT #2, ENVSSUSTAIN(ROW)    PRINT #2, ENVSRELEASE(ROW)    PRINT #2, ENVSWAVEFORM(ROW)    PRINT #2, ENVSPW(ROW)  NEXT ROW  ' SAVE FILTER PRESETS  ' -------------------  FOR ROW = 0 TO  10    PRINT #2, FILTNAME$(ROW)    PRINT #2, FILTFREQ(ROW)    PRINT #2, FILTLP(ROW)    PRINT #2, FILTBP(ROW)    PRINT #2, FILTHP(ROW)    PRINT #2, FILTRES(ROW)    PRINT #2, FILTDIR(ROW)    PRINT #2, FILTMIN(ROW)    PRINT #2, FILTSWEEP(R OW)  NEXT ROW  ' SAVE SEQUENCE  ' -------------  PRINT #2, SEQCNT  ROW = 0  DO WHILE ROW < SEQCNT    PRINT #2, SEQCHUNK(ROW)    PRINT #2, SEQEXTRA(ROW)    ROW = ROW + 1  LOOP  DCLOSE #2  CHUNKIDX = TMP  RETURN.SAVEASTEXT'--------- ---  INPUT "SAVE (AS TEXT) NAME: ";KEY$  IF KEY$="" THEN RETURN  DELETE (KEY$)      DOPEN #2,(KEY$),W,U8  FOR CHUNKIDX = 0 TO CHUNKMAX    FOR VIDX=0 TO 5      PRINT #2, "V";CHR$(49+VIDX);"$(";STR$(CHUNKIDX);")=";      PRINT #2, CHR$(34);V$(V 	IDX, CHUNKIDX);CHR$(34)    NEXT VIDX      PRINT #2, ""  NEXT CHUNKIDX  DCLOSE #2  CHUNKIDX = 0  RETURN.USERINPUT'----------  ' GETKEY KEY$  GOSUB READKEYLOOP  KEY$ = A$  GOSUB CHECKALTKEYINPUTS  ' DOWN ARROW?  IF KEY$ = ٯ 
 AND CURSORY<5 THEN BEGIN    CURSORY = CURSORY + 1    IF CURSORX > LEN(V$(CURSORY,CHUNKIDX)) THEN CURSORX = _      LEN(V$(CURSORY,CHUNKIDX))  BEND  ' UP ARROW?  IF KEY$ = ٯ AND CURSORY>0 THEN BEGIN    CURSORY = CURSORY - 1     IF CURSORX > LEN(V$(CURSORY,CHUNKIDX)) THEN _      CURSORX = LEN(V$(CURSORY,CHUNKIDX))  BEND  ' RIGHT ARROW?  IF KEY$ = ٯ AND CURSORX < LEN(V$(CURSORY,CHUNKIDX)) THEN BEGIN    CURSORX=CURSORX+1  BEND  ' LEFT ARROW?  IF KEY$ =  ٯ AND CURSORX > 0 THEN CURSORX=CURSORX-1  ' BACKSPACE (INST/DEL)?  IF KEY$ = ٯ AND CURSORX > 0 THEN BEGIN    V$(CURSORY,CHUNKIDX)=LEFT$(V$(CURSORY,CHUNKIDX),CURSORX-1) _      + MID$(V$(CURSORY,CHUNKIDX),CURSORX+1)    CURSO RX=CURSORX-1  BEND  IF ESCFLAG% THEN BEGIN    ESCFLAG%=0    IF KEY$ = "J" THEN BEGIN:CURSORX=0:BEND    IF KEY$ = "K" THEN BEGIN:CURSORX=LEN(V$(CURSORY,CHUNKIDX)):BEND    IF KEY$=ٯ THEN GOSUB STOPALLMUSIC    KEY$=""  BEND  IF  KEY$ = ٯ THEN ESCFLAG%=ABS(ESCFLAG%-1)  ' CTRL-W = FORWARD ONE WORD  IF KEY$ = ٯ̯ THEN GOSUB FORWARDWORD  ' CTRL-U = BACK ONE WORD  IF KEY$ = ٯ̯ THEN GOSUB PREVIOUSWORD  ' < / > = PREVIOUS/NEXT CHUNK  IF KEY$ = "<"  AND CHUNKIDX>0 THEN BEGIN    CHUNKIDX=CHUNKIDX-1    CURSORX=0  BEND  IF KEY$ = ">" AND CHUNKIDX<CHUNKMAX THEN BEGIN    CHUNKIDX=CHUNKIDX+1    CURSORX=0  BEND  ' +/- = TEMPO CHANGE  IF KEY$="-" THEN TMPO%=TMPO%-1  IF KEY$="+" THEN TMPO %=TMPO%+1  ' MEGA-Q = EXIT  IF KEY$ = ٯ THEN BEGIN    PRINT "ARE YOU SURE? (Y/N)"    GET KEY A$    IF A$="Y" THEN KEY ON:END  BEND  IF KEY$ = ٯ1 THEN GOSUB LOAD  IF KEY$ = ٯ3 THEN GOSUB SAVE  IF KEY$ = ٯ7 THEN GOSUB ENVELO PEEDITOR  IF KEY$ = ٯ9 THEN GOSUB CHUNKSEQUENCER  ' 4 = SAVE AS TEXT  IF KEY$ = ٯ4 THEN GOSUB SAVEASTEXT  ' RETURN=PLAY ROW  IF KEY$ = ٯ THEN TEMPO TMPO% : PLAY V$(CURSORY,CHUNKIDX)  ' SHIFT+RETURN=PLAY ALL CHANNELS  IF  KEY$ = ٯԯ THEN BEGIN    TEMPO TMPO%    GOSUB PLAYCHUNKIDX  BEND  IF KEY$ = ٯ THEN BEGIN    V1$ = V$(CURSORY, CHUNKIDX)    V1$ = LEFT$(V1$,CURSORX) + MID$(V1$,CURSORX+2)    V$(CURSORY, CHUNKIDX) = V1$  BEND  GOSUB C HECKVALIDKEY  RETURN.CHECKALTKEYINPUTS'--------------------  ALTKEY = PEEK($D611) AND 16  IF ALTKEY = 0 THEN RETURN  IF KEY$="X" THEN CLIP$=V$(CURSORY, CHUNKIDX) : V$(CURSORY, CHUNKIDX) = ""  IF KEY$="C" THEN CLIP$=V$(CURSORY, CHUNK IDX)  IF KEY$="V" THEN V$(CURSORY, CHUNKIDX) = CLIP$  IF KEY$="" THEN GOSUB COPYALLVOICESTOCLIPBOARD  IF KEY$="" THEN GOSUB PASTEALLVOICESFROMCLIPBOARD  IF KEY$=ٯ THEN BEGIN    V1$ = MID$(V$(CURSORY, CHUNKIDX), CURSORX + 1)     TEMPO TMPO% : PLAY V1$  BEND  IF KEY$="," THEN DELTA = -1 : GOSUB TRANSPOSEOCTAVE  IF KEY$="." THEN DELTA = 1  : GOSUB TRANSPOSEOCTAVE  IF KEY$="I" THEN GOSUB INSERTCHUNK  KEY$ = ""  RETURN.COPYALLVOICESTOCLIPBOARD'---------------- ------------  FOR Y = 0 TO 5    CP$(Y) = V$(Y, CHUNKIDX)  NEXT Y  RETURN.PASTEALLVOICESFROMCLIPBOARD'-------------------------------  FOR Y = 0 TO 5    V$(Y, CHUNKIDX) = CP$(Y)  NEXT Y  RETURN.INSERTCHUNK'------------  FOR K = CHUNK MAX-1 TO CHUNKIDX + 1 STEP -1    FOR Y = 0 TO 5      V$(Y, K) = V$(Y, K-1)    NEXT Y  NEXT K  FOR Y = 0 TO 5    V$(Y, CHUNKIDX) = ""  NEXT Y  ' REPAIR ITEMS IN THE SEQUENCE THAT ARE AFFECTED  FOR K = 0 TO 100    IF SEQCHUNK(K) >= CHUNKID X THEN SEQCHUNK(K) = SEQCHUNK(K) + 1  NEXT K  RETURN.TRANSPOSEOCTAVE'----------------  V1$ = V$(CURSORY, CHUNKIDX)  LIMIT = 0  IF DELTA = 1 THEN LIMIT = 6  RET% = 0  GOSUB CANTRANSPOSEOCTAVE  IF RET% = 0 THEN PRINT ٯ; : RETUR N  K = 0  DO WHILE K < LEN(V1$)    V2$ = MID$(V1$,K+1,1)    IF V2$ = "O" AND (K + 1) < LEN(V1$) THEN BEGIN      V2$ = STR$(VAL(MID$(V1$,K+2,1)) + DELTA)      V2$ = MID$(V2$,2)      V1$ = LEFT$(V1$,K+1) + V2$ + MID$(V1$, K+3)    BEND    K = K +  1  LOOP  V$(CURSORY, CHUNKIDX) = V1$  RETURN.CANTRANSPOSEOCTAVE'--------------------  RET% = 1  K = 0  DO WHILE K < LEN(V1$)    V2$ = MID$(V1$,K+1,1)    IF V2$ = "O" AND (K+1) < LEN(V1$) THEN BEGIN      V2$ = MID$(V1$,K+2,1)      IF V AL(V2$) = LIMIT THEN RET% = 0 : RETURN    BEND    K = K + 1  LOOP  RETURN.PLAYCHUNKIDX'--------------  V1$ = V$(0,CHUNKIDX)  V2$ = V$(1,CHUNKIDX)  V3$ = V$(2,CHUNKIDX)  V4$ = V$(3,CHUNKIDX)  V5$ = V$(4,CHUNKIDX)  V6$ = V$(5,CHUNKID X)  IF ECHODELAY = 1 THEN BEGIN    PLAY V1$    SLEEP (ECHOSZ)    PLAY ,V2$    SLEEP (ECHOSZ)    PLAY ,,V3$    SLEEP (ECHOSZ)    PLAY ,,,V4$    SLEEP (ECHOSZ)    PLAY ,,,,V5$    SLEEP (ECHOSZ)    PLAY ,,,,,V6$    SLEEP (ECHOSZ)    RE TURN  BEND  IF ECHOM = 0 AND ECHOB = 0 THEN BEGIN    PLAY V1$, V2$, V3$, V4$, V5$, V6$    RETURN  BEND  IF ECHOM = 1 AND ECHOB = 0 THEN BEGIN    PLAY V1$, V2$, V3$,    , V5$, V6$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$  BEND  IF E CHOM = 1 AND ECHOB = 1 THEN BEGIN    PLAY V1$, V2$, V3$,    , V5$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$,    , V3$  BEND  IF ECHOM = 2 AND ECHOB = 0 THEN BEGIN    PLAY V1$,    , V3$,    ,    , V6$    SLEEP (ECHOSZ)    PLAY    ,    ,     , V1$    SLEEP (ECHOSZ)    PLAY    , V1$    SLEEP (ECHOSZ)    PLAY    ,    ,    ,    , V1$  BEND  IF ECHOM = 2 AND ECHOB = 1 THEN BEGIN    PLAY V1$,    , V3$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$    SLEEP (ECHOSZ)    PLAY    ,   V1$,    ,    ,    , V3$    SLEEP (ECHOSZ)    PLAY    ,    ,    ,    , V1$  BEND  RETURN.ENVELOPEEDITOR'---------------  DO WHILE 1    GOSUB DRAWTABLE    GOSUB GETUSERINPUTFORTABLE    ' ALT+Q TO EXIT    IF A$ = ٯ THEN EXIT  ! LOOP  RETURN.DRAWTABLE'----------  PRINT "ENV EDITOR";ٯ;DUR$(SDUR, );ٯ;"OCTAVE";OCT  PRINT "----------"  PRINT "-/+: DECR/INCR, </>: OCTAVE, : EDIT, : FOCUS ENV/FILTER, +: EXIT"  PRINT  PRINT "   ";ٯ; "ٯ;"";ٯ;"";ٯ;"";ٯ;"";ٯ;  PRINT "";ٯ;""  FOR ROW = 0 TO 9    IF SROW = ROW THEN PRINT ">";:ELSE PRINT " ";    PRINT ROW;": ";    COL = 0 : V$ = ENVSNAME$(ROW)    GOSUB SHOW #CELL    COL = 1 : V = ENVSATTACK(ROW)    GOSUB SHOWCELL    COL = 2 : V = ENVSDECAY(ROW)    GOSUB SHOWCELL    COL = 3 : V = ENVSSUSTAIN(ROW)    GOSUB SHOWCELL    COL = 4 : V = ENVSRELEASE(ROW)    GOSUB SHOWCELL    COL = 5 : V = ENVSWAVE $FORM(ROW)    GOSUB SHOWCELL    COL = 6 : V = ENVSPW(ROW)    GOSUB SHOWCELL    PRINT  NEXT ROW  PRINT  PRINT "FILTER EDITOR"  PRINT "-------------";  PRINT ٯ;"FREQ";ٯ;"LP";ٯ;"BP";ٯ;"HP";ٯ;"RES";  PRINT ٯ;" %DIR";ٯ;"MIN";ٯ;"SWEEP"  FOR FPRESET = 0 TO 10    GOSUB SHOWFILTER  NEXT FPRESET  RETURN.SHOWFILTER'-----------  IF FSEL = FPRESET THEN PRINT ">";:ELSE PRINT " ";  K = 0 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTNAME$(FPR &ESET);"  ";ٯ;  K = 1 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTFREQ(FPRESET);ٯ;  K = 2 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSTATENAME$(FILTLP(FPRESET));ٯ;  K = 3 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FIL 'TSTATENAME$(FILTBP(FPRESET));ٯ;  K = 4 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSTATENAME$(FILTHP(FPRESET));ٯ;  K = 5 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTRES(FPRESET);ٯ;  K = 6 : GOSUB CHECKSHOWFILTERH IGHLIGHT  PRINT DIRNAME$(FILTDIR(FPRESET));ٯ;  K = 7 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTMIN(FPRESET);ٯ;  K = 8 : GOSUB CHECKSHOWFILTERHIGHLIGHT  PRINT FILTSWEEP(FPRESET);  PRINT ٯ֯  RETURN.CHECKSHOWFI!'     //  'Ĝ //!,!"$%&()*+ +,-123-6-789:;<=>?@AB,C'CC@?.>/>>>'?@ A B CDEF ,G'HI'HEDDGHJ-KKKJ/IHGFDCBA@?>+=<;::;<= =/<8/7789:;<=@ABDEFHILM                                                                                          !#OUTPUT PLAYMAKER' EYS:' ----'    P ARROW = OVE TO PREVIOUS VOICE'  OWN ARROW = OVE TO NEXT VOICE'  EFT ARROW = OVE LEFT WITHIN CURRRENT VOICE STRING' IGHT ARROW = OVE RIGHT WITHIN CURRENT VOICE STRING'    / = ELETE CHAR IN CURRE!NT VOICE STRING'       , = OVE TO START OF CURRENT VOICE STRING'       , = OVE TO END OF CURRENT VOICE STRING'      + = OVE FORWARD ONE WORD IN CURRENT VOICE STRING'      + = OVE BACK ONE WORD IN CURRENT VOICE STRING'          ! < = HOW PREVIOUS SONG CHUNK'           > = HOW NEXT SONG CHUNK'           - = ECREASE TEMPO'           + = NCREASE TEMPO'      + = UIT PROGRAM / XIT NV DITOR'          1 = OAD'          3 = AVE'          7 = NVELOPE EDITOR'   !       8 = ILTER EDITOR'   9/- = HUNK SEQUENCERTRAP RUNSTOPTRAPPER.DECLARATIONS'------------#DECLARE CHUNKIDX = 0#DECLARE CHUNKCNT = 0#DEFINE CHUNKMAX = 50#DECLARE VIDX, IDX#DECLARE CURSORX = 0#DECLARE CURSORY = 0#DECLARE V$!(5,CHUNKMAX)#DECLARE KEY$#DECLARE VALID$="CDEFGAB0123456789 #$.HIQRSWOTUXMPL"#DECLARE VAL$#DECLARE TMPO% = 12#DECLARE ESCFLAG% = 0#STRUCT  NAME$, ATTACK, DECAY, SUSTAIN, RELEASE, WAVEFORM, PW ENVS(9) = [ _  [ "IANO",       0,!  9,  0,  0,  2, 1536 ], _  [ "CCORDION",  12,  0, 12,  0,  1,    0 ], _  [ "ALLIOPE",    0,  0, 15,  0,  0,    0 ], _  [ "RUM",        0,  5,  5,  0,  3,    0 ], _  [ "LUTE",       9,  4,  4,  0,  0,    0 ], _  [ "UITAR",      0,  9,  2,  1,  !	1,    0 ], _  [ "ARPSICRD",   0,  9,  0,  0,  2,  512 ], _  [ "RGAN",       0,  9,  9,  0,  2, 2048 ], _  [ "RUMPET",     8,  9,  4,  1,  2,  512 ], _  [ "YLOPHONE",   0,  9,  0,  0,  0,    0 ]  _]#DEFINE ү = 0#DEFINE ү   = 1#DEF!
INE ү = 2#DEFINE ү  = 3#DECLARE DIRNAME$(3)DIRNAME$(0) = ""DIRNAME$(1) = ""DIRNAME$(2) = ""DIRNAME$(3) = ""#DEFINE Ư = 0#DEFINE Ư  = 1#STRUCT  NAME$, FREQ, LP, BP, HP, RES, DIR, MIN, SWEEP! FILT(10) = [ _  [ "LOWPUP",    1000, Ư,  Ư, Ư, 15, ү,   100, 10 ], _  [ "LOWPDOWN",  1000, Ư,  Ư, Ư, 15, ү, 100, 10 ], _  [ "LOWPOSC",   1000, Ư,  Ư, Ư, 15, ү,  100, 10 ], __  [ "BANDPUP",   !1000, Ư, Ư,  Ư, 15, ү,   100, 10 ], _  [ "BANDPDOWN", 1000, Ư, Ư,  Ư, 15, ү, 100, 10 ], _  [ "BANDPOSC",  1000, Ư, Ư,  Ư, 15, ү,  100, 10 ], __  [ "HIGHPUP",   1000, Ư, Ư, Ư,  15, ү!,   100, 10 ], _  [ "HIGHPDOWN", 1000, Ư, Ư, Ư,  15, ү, 100, 10 ], _  [ "HIGHPOSC",  1000, Ư, Ư, Ư,  15, ү,  100, 10 ], __  [ "SPARE1",    0,    Ư, Ư, Ư, 0,  ү, 0,   0  ], _  [ "SPARE2",    !0,    Ư, Ư, Ư, 0,  ү, 0,   0  ], __]#DECLARE SEQCHUNK(200), SEQEXTRA(200)#DECLARE ECHOM, ECHOB, ECHOSZ = .05, CHUNKRPT, ECHODELAY#DECLARE V1$, V2$, V3$, V4$, V5$, V6$#DECLARE TMP#DECLARE SSCOL, S, SEQOFFS#DEFINE Я! = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DEFINE  = $D060#DEFINE  = $D061#DEFINE  = $D062.CMDS#DEFINE į = -1#DEFINE į = -2#DEFINE į = -3#DEFINE įϯ1 = -4   '! ECHO MELODY: VOICE 1 ON VOICE 4#DEFINE įϯ2 = -5   ' ECHO MELODY: VOICE 1 ON VOICE 2 + 4 + 5#DEFINE įϯ  = -6   ' ECHO BASS:   VOICE 3 ON VOICE 6#DEFINE įϯ = -7#DEFINE įϯ = -8#DEFINE į = -9#DEFINE į =! -10#DEFINE į = 11#DECLARE SEQCMDNAME$(10)SEQCMDNAME$(1) = ""SEQCMDNAME$(2) = ""SEQCMDNAME$(3) = ""SEQCMDNAME$(4) = "ϯ1"SEQCMDNAME$(5) = "ϯ2"SEQCMDNAME$(6) = "ϯ"SEQCMDNAME$(7) = "ϯ"SEQCMDNAME!$(8) = "ϯ"SEQCMDNAME$(9) = ""SEQCMDNAME$(10) = ""#DECLARE SEQCNT, SEQPTR#DECLARE ROW, COL, SROW, SCOL, A$, V, MAXV, V$#STRUCT ٯ IN$, OUT$ٯ KEYS(11) = [ _  [ "A", "C", ], _  [ "W", "#C", ], _  [ "S", "D", ], _  ![ "E", "#D", ], _  [ "D", "E", ], _  [ "F", "F", ], _  [ "T", "#F", ], _  [ "G", "G", ], _  [ "Y", "#G", ], _  [ "H", "A", ], _  [ "U", "#A", ], _  [ "J", "B", ] _]#DECLARE PSTR$, K, DELTA#DECLARE WNAME$(4)WNAME$(0) = ""WNAME$(1) = "!"WNAME$(2) = ""WNAME$(3) = ""WNAME$(4) = ""#DECLARE FILTSTATENAME$(2)FILTSTATENAME$(0) = ""FILTSTATENAME$(1) = ""#DECLARE FPRESET = 1#DECLARE FSCOL = 0, FSROW = 0, FFOCUS = 0, FSEL = -1#DECLARE OCT = 5#DECLARE CURR!FREQ, CURRDIR#DECLARE HANDLED#DECLARE PLYPTR = -1, PLYFLAG.DURATION'--------#DEFINE  = 0#DEFINE  = 1#DEFINE   = 2#DEFINE į = 0#DEFINE į = 1#DEFINE į = 2#DEFINE į = 3#DEFINE į = 4#DECLARE !SDUR = 2#DECLARE DUR$(5,2)DUR$(į, ) = "WHOLE"DUR$(į, ) = "W"DUR$(į, )  = "1"DUR$(į, ) = "HALF"DUR$(į, ) = "H"DUR$(į, )  = "2"DUR$(į, ) = "QUARTER"DUR$(į, ) != "Q"DUR$(į, )  = "3"DUR$(į, ) = "EIGHTH"DUR$(į, ) = "I"DUR$(į, )  = "4"DUR$(į, ) = "SIXTEENTH"DUR$(į, ) = "S"DUR$(į, )  = "5"#DECLARE CLIP$, ALTKEY, L!IMIT, RET%, Y, CP$(6).KEYS'----#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = ""#DEFINE ٯ = " "#DEFINE ٯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ̯ = ""#DEFINE ٯ = ""#DEFINE! ٯ1 = ""#DEFINE ٯ3 = ""#DEFINE ٯ4 = ""#DEFINE ٯ7 = ""#DEFINE ٯ8 = ""#DEFINE ٯ9 = CHR$(16)#DEFINE ٯ = CHR$(13)#DEFINE ٯ = CHR$(27)#DEFINE ٯԯ = CHR$(141)#DEFINE ٯԯ = ""#DEF!INE ٯԯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ֯ = ""#DEFINE ٯ = CHR$(9)#DEFINE ٯ = ""#DEFINE ٯ  = ""#DEFINE ٯ = CHR$(14)#DEFINE ٯ = CHR$(142)#DEFINE ٯ = CHR$(7)#DEFINE ! = ""#DEFINE ٯ  = "".INIT'----PRINT "";ٯ;ٯ;"5";PLAY : PLAY ""BACKGROUND 0 : BORDER 0COLOR 5.MAIN'----  KEY OFF  GOSUB DRAWEDITORSCREEN  GOSUB USERINPUT  GOTO MAIN.DRAWEDITORSCREEN'----------------!--  CURSOR 0,0:PRINT "PLAYMAKER V0.5 - BY GURCE ISIKYILDIZ"  PRINT "---------"  PRINT "<: PREV CHUNK, >: NEXT CHUNK, -/+ TEMPO, 7=ENV EDITOR, 9/-=SEQ EDITOR"  PRINT ": PLAY CURR VOICE, +: PLAY ALL VOICE, 1=LOAD, 3=SAVE, +=QUI!T"  PRINT "-//: ROW CUT/COPY/PASTE, -: STOP MUSIC, -: PLAY FROM CURSOR"  PRINT  GOSUB DRAWCURRENTCHUNK  RETURN.DRAWCURRENTCHUNK'------------------  PRINT "TEMPO: "; TMPO%  PRINT "CHUNKIDX: "; CHUNKIDX       FOR VIDX=0 !TO 5    IF CURSORY <> VIDX THEN BEGIN      CURSOR 0,9+VIDX*2:PRINT CHR$(27);"Q";"V";VIDX+1;": ";V$(VIDX,CHUNKIDX);    BEND:ELSE BEGIN      CURSOR 0,9+VIDX*2:PRINT CHR$(27);"Q";"V";VIDX+1;": ";      FOR IDX=1 TO LEN(V$(VIDX,CHUNKIDX))        IF C!URSORX = IDX-1 THEN BEGIN          PRINT "";MID$(V$(VIDX,CHUNKIDX),IDX,1);"";        BEND:ELSE BEGIN          PRINT MID$(V$(VIDX,CHUNKIDX),IDX,1);        BEND      NEXT IDX      IF LEN(V$(VIDX,CHUNKIDX)) = 0 OR CURSORX=LEN(V$(VIDX,CHUNKIDX)! ) THEN PRINT " ";    BEND  NEXT VIDX  RETURN.CHECKVALIDKEY'---------------  FOR IDX=1 TO LEN(VALID$)    VAL$=MID$(VALID$,IDX,1)    IF KEY$= VAL$ THEN BEGIN      IF CURSORX < LEN(V$(CURSORY,CHUNKIDX)) THEN BEGIN        V$(CURSORY,CHUNK!!IDX) = LEFT$(V$(CURSORY,CHUNKIDX),CURSORX) _          + VAL$ + MID$(V$(CURSORY,CHUNKIDX),CURSORX+1)        CURSORX=CURSORX+1        RETURN      BEND      V$(CURSORY,CHUNKIDX)=V$(CURSORY,CHUNKIDX)+VAL$      CURSORX=CURSORX+1      RETU!"RN    BEND  NEXT IDX  RETURN.FORWARDWORD'------------  IF CURSORX = LEN(V$(CURSORY,CHUNKIDX)) THEN RETURN  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) <> " "    CURSORX=CURSORX+1    IF CURSORX = LEN(V$(CURSORY,CHUNKIDX)) THEN R!#ETURN  LOOP  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) = " "    CURSORX=CURSORX+1    IF CURSORX = LEN(V$(CURSORY,CHUNKIDX)) THEN RETURN  LOOP  RETURN.PREVIOUSWORD'-------------  IF CURSORX = 0 THEN RETURN  IF CURSORX = 1 THEN!$ CURSORX = 0: RETURN  CURSORX = CURSORX - 1  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) = " "    CURSORX=CURSORX-1    IF CURSORX = 0 THEN RETURN  LOOP  DO WHILE MID$(V$(CURSORY,CHUNKIDX),CURSORX+1,1) <> " "    CURSORX=CURSORX-1!%    IF CURSORX = 0 THEN RETURN  LOOP  CURSORX=CURSORX+1  RETURN.SETALLENV'-----------  FOR ROW = 0 TO 9    GOSUB SETENV  NEXT ROW  RETURN.LOAD'----  INPUT "LOAD NAME: ";KEY$  IF KEY$="" THEN RETURN  DOPEN #2,(KEY$),R,U8  ' LOAD!& MELODY CHUNKS  ' ------------------  INPUT #2, CHUNKCNT  FOR CHUNKIDX = 0 TO CHUNKCNT - 1    FOR VIDX=0 TO 5      INPUT #2,V$(VIDX, CHUNKIDX)    NEXT VIDX  NEXT CHUNKIDX  INPUT #2,TMPO%' #IFDEF     ' LOAD ENVELOPES  ' ------------!'--  FOR ROW = 0 TO 9    INPUT #2, ENVSNAME$(ROW)    INPUT #2, ENVSATTACK(ROW)    INPUT #2, ENVSDECAY(ROW)    INPUT #2, ENVSSUSTAIN(ROW)    INPUT #2, ENVSRELEASE(ROW)    INPUT #2, ENVSWAVEFORM(ROW)    INPUT #2, ENVSPW(ROW)    GOSUB SETENV    NEXT ROW  PRINT  ' LOAD FILTER PRESETS  ' -------------------  FOR ROW = 0 TO 10    INPUT #2, FILTNAME$(ROW)    INPUT #2, FILTFREQ(ROW)    INPUT #2, FILTLP(ROW)    INPUT #2, FILTBP(ROW)    INPUT #2, FILTHP(ROW)    INPUT #2, FILTRES(RO"5100: } 31200: E   }BV: 16700 } } INDIRECT ADDRESSING }L$(L$,2): 16000 }AM13 }OP$OP$(II,AM):AM$AM$(AM): OP$""  31100  } 15600: XC   6} L$")"  17000 n~ V0  V65535  EM$"DATA OUT OF RANGE": 15100:" ~ 31200: E   ~ 31300 ~ ,~ INDIRECT Z-INDEXED ADDRESSING 6~L$(L$,2): 16000 @~AM12 	J~OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 T~ 15600: XC   EY~ (OP$,2,1)"Q"  L$")"  17000 o^~ (OP$,2,1)"Q"  L$"),Z"  17"000 h~ V0  V255  EM$"DATA OUT OF RANGE": 15100: r~ 31200: E   |~BV: 16700 ~ ~ BASE PAGE AND RELATIVE ADDRESSING ~AM14 ~ 15600:V1V: XC   6~ (L$,1)","  17000 B~ 16200 W~ 15600: XC   ~ V10  V125"5  EM$"DATA OUT OF RANGE": 15100: ~ PA1  V0: VV(AD3) ~ V128  V127  EM$"BRANCH OUT OF RANGE": 15100: ~OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 ,~ 31200: E   =~BV1: 16700 SBV  255: 16700 Y X SP-INDEX"ED INDIRECT Y-INDEXED ADDRESSING bL$(L$,2): 16000 lAM16 vOP$OP$(II,AM):AM$AM$(AM): OP$""  31100  15600: XC   	 L$",SP),Y"  17000 ? V0  V255  EM$"DATA OUT OF RANGE": 15100: S 31200: E   cBV: 16700 i"  INDIRECT FLAT MEMORY Z-INDEXED ADDRESSING L$(L$,2): 16000 AM18 OP$OP$(II,AM):AM$AM$(AM): OP$""  31100  15600: XC    (OP$,1)"Z"  32745 = L$"],Z"  17000:  32760 d (OP$,2,1)"Q"  L$"]"  17000"  (OP$,2,1)"Q"  L$"],Z"  17000  V0  V255  EM$"DATA OUT OF RANGE": 15100:  31200: E   BV: 16700  @: J 2T ******************** PROJECT ******************** 8^ >: k SUB ----- USE N$ AS PROJECT N"AME ----- q:  FI$""  EM$"FILE NEEDS TO BE SAVED FIRST": 15100:EA2:PR$"": ̜ PR$N$  PF$FI$   ֜PF$FI$:LB0: N$PR$  LB1 	 INIT PROJECT PR$N$:ES0 6#1,(PR$".PRJ"",S"),R H DS  #1: `1,S$: ST  #1:"	  S$PR$  EM$"PROJECT NAME MISMATCH": 15100:EA2:PR$"":#1: &1,S$ 0 ESME  EM$"EXTERNAL SYMBOL TABLE FULL": 15100:EA2:PR$"":#1: :ESES1:ES$(ES)S$ %D ST0  40230 .N#1 WXO$"EXTERNAL SYMBOLS LOADED": 16600 |l "
LOAD BINARY FILES FROM PROJECT v LB0  ES0   EF$""  EI1  ES :   (ES$(EI),1)"*"  40400 :   (ES$(EI),3)"---"  40400 ):  F$(ES$(EI),2):B((F$,3)):F$(F$,(F$)8) A:   F$FI$  40400 l:   (F$,4)".ASM"  "F$(F$,(F$)4) :  F$F$".BIN" :   (F$),B (B) Ɲ:  O$"BINARY FILE "F$" LOADED INTO BANK"(B): 16600 Н EI ڝ 4: %> SUB ----- FILL SYMBOL TABLE WITH EXTERNAL SYMBOLS ----- +H: ;REI0:EF$"" L\ EIES   fEIEI1:" (ES$(EI),1)"*"  EF$(ES$(EI),2):EF$(EF$,(EF$)8): 40540 k EF$FI$  40540 pI(ES$(EI),"=") zSN$(ES$(EI),I1):SV((ES$(EI),I1)) EF1: 15200:EF0 򎞉 40540 : _ SUB ----- WRITE EXTERNAL SYMBOLS & BINARY TO PROJECT FIL"E ----- e: v PR$""   $#1,("@"PR$".PRJ"",S"),W . DS0  EM$"DISK ERROR: "DS$: 15100:EA2:#1:PR$"": 81,PR$ BEF$"": ES0  40820 L X1  ES JV:   (ES$(X),1)"*"  EF$(ES$(X),2):EF$(EF$,(EF$)8) h`:   EF"$FI$  1,ES$(X) pj X t RA  S$((1000RB),3): S$"---" y1,"*";FI$;"@BANK";S$ ~ NS0  40870 󈟁 X1  NS  :   SE%(X)2  1,SN$(X)"="(SV(X))  X #1 CO$"PROJECT FILE "PR$".PRJ UPDATED": 16600 u RA  O$"N"EXT FREE BYTE AT $"(AD): 16600 ( SAVE BINARY FILE OF ASSEMBLED PROGRAM - RA0  41050 2F$FI$: (F$,4)".ASM"  F$(F$,(F$)4) <F$(F$,12)".BIN" !F ("@"F$),P (RA)  P (AD),B (RB) KPO$"BINARY FILE "F$" SAVED": 16600 ]ZO$ "": 16600 cd                                                                                                                                                                                                                                             "' ROTATE SCREEN CONTENTS#OUTPUT "ROTATE"' 4.0000 = 96X96 CLRBOX CANVAS (9216 BYTES)' 4.2400 = FREE.DEFINES'-------#DEFINE Я = 0#DEFINE Я  = 1#DEFINE Я = 2#DEFINE Я = 3#DECLARE ǯ7 = $D05D#DECLARE  = $D0"60#DECLARE  = $D062#DECLARE T, X, Y, COLR, ANG, XINC, YINC, TX, TY, TXINC, TYINC#DECLARE Y1ADD#DECLARE XFRAC, YFRAC#DECLARE BOXANG, CX, CY, HYP#DEFINE  = 3.1415926535#DECLARE PLRAD, PLANG, PLDIR, PLCLR#DECLARE A$#DECLARE STATE".MAIN'----  GOSUB INIT  GOSUB DUMMYCONTENT.MNLOOP  GOSUB ROTATELOGIC  GOSUB DRAWCONTENT  GOTO MNLOOP.INIT'----  ^^BLOAD "ASMROTATE",B0  ' PRINT CHR$(27);"5";CHR$(147);  ANG = 2* + .1  STATE = 0  PLRAD = 0  PLANG = 0  PLDIR =" 0  PLCLR = 0  ' SWITCH TO 80X50  BANK 128  SETBIT ǯ7, 7  POKE $D031, $E8 ' 1110 1000 = 640,,,400  ' MOVE  TO BANK4 - $8000  WPOKE , $8000  POKE ,$04  ' CLEAR 80X50 CHARS AND COLOUR RAM  EDMA 3, 40"00, 160, $48000  EDMA 3, 4000, 6, $FF80000  ' FOR IDX=0 TO 3999:POKE $48000+IDX,160:POKE $FF80000+IDX,6:NEXT IDX  RETURN.DUMMYCONTENT'-------------  EDMA Я, 96*96, 0, $40000  'POKE $40000 + 48*96, 1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5",6,6,6,6  'FOR T = 0 TO 50  '  COLR = INT(RND(1)*16)  '  X = INT(RND(1)*96)  '  Y = INT(RND(1)*96)  '  POKE $40000 + X + Y * 96, COLR  'NEXT T  'FOR Y = 0 TO 96  '  FOR X = 0 TO 95  '    POKE $40000 + X + Y * 96, MOD(Y, 16)  '  NEXT X  'NEXT" Y  RETURN.ROTATELOGIC'------------  ANG = ANG - .1  IF ANG < 0 THEN ANG = ANG + (2 * )  HYP = SQR(25*25+40*40) * 65536  XINC = COS(ANG) * 65536  YINC = SIN(ANG) * 65536  TXINC = COS(ANG+/2) * 65536  TYINC = SIN(ANG+/2) * 65536  BOX"ANG = ATN(-25/-40)+  +ANG  IF BOXANG < 0 THEN BOXANG = BOXANG + (2 * )  TX = HYP * COS(BOXANG) + 48 * 65536  TY = HYP * SIN(BOXANG) + 48 * 65536  CX = TX  CY = TY  XFRAC = 0  YFRAC = 0  Y1ADD = 0  RETURN.DRAWCONTENT'------------  "GOSUB PLOTITERATION  GOSUB PLOTITERATION  GOSUB ASMROTATION  ' GOSUB BASICROTATION  'CURSOR 0,0:PRINT CHR$(27);"Q TX=";TX;", TY=";TY;  'CURSOR 0,1:PRINT CHR$(27);"Q ANG=";ANG;", HYP=";HYP;  'CURSOR 0,2:PRINT CHR$(27);"Q XINC=";XINC;", YINC=";Y"INC;  'CURSOR 0,3:PRINT CHR$(27);"Q TXINC=";TXINC;", TYINC=";TYINC;  'GET KEY A$  RETURN.PLOTITERATION'--------------  X = 48 + COS(PLANG) * PLRAD  Y = 48 + SIN(PLANG) * PLRAD  POKE $40000 + X + INT(Y) * 96, PLCLR + 64  PLANG = PLAN"G + .025  IF PLANG > 2 *  THEN PLANG = PLANG - 2 *   PLRAD = PLRAD + .05  IF PLRAD > 30 THEN BEGIN    PLRAD=0    PLCLR = PLCLR + 1    IF PLCLR = 16 THEN STATE = STATE + 1    PLANG = .3926 * PLCLR  BEND  RETURN.ASMROTATION'"------------  '  VERSION  IF XINC < 0 THEN XINC = XINC + 4294967296  IF YINC < 0 THEN YINC = YINC + 4294967296  IF TXINC < 0 THEN TXINC = TXINC + 4294967296  IF TYINC < 0 THEN TYINC = TYINC + 4294967296  WPOKE $1A00, MOD(TX,65536)  WPOKE "$1A02, TX/65536  WPOKE $1A04, MOD(TY, 65536)  WPOKE $1A06, TY/65536  WPOKE $1A08, MOD(XINC,65536)  WPOKE $1A0A, XINC/65536  WPOKE $1A0C, MOD(YINC, 65536)  WPOKE $1A0E, YINC/65536  WPOKE $1A10, MOD(TXINC, 65536)  WPOKE $1A12, TXINC/65536  WP"OKE $1A14, MOD(TYINC, 65536)  WPOKE $1A16, TYINC/65536  BANK 0:SYS $1800:BANK 128  RETURN.BASICROTATION'--------------  '  VERSION  FOR Y = 0 TO 49    CX = TX    CY = TY    FOR X = 0 TO 79      POKE $FF80000 + X + Y1ADD, PEEK($40000  + CX/65536 + INT(CY/65536) * 96)      CX = CX + XINC      CY = CY + YINC    NEXT X    TX = TX + TXINC    TY = TY + TYINC    Y1ADD = Y1ADD + 80  NEXT Y  GET KEY A$  RETURN                                                                      "  "#$%      !  e e '( )!*')L));'+(,)-*.+m'',m((-m)).m**;)e*e e &  e eee &m	m
mmmmm  m!!Pm  mmmmmmmPm m2E"#$%X`          ""  
	    !!!!!  	.
 !"#$%&'()*+,'-..--,+'+*)((()**)(+'&%$.#"#!/ /Ϛ  .= ! " # $ % & ''''&%$#"! ֟  !"#ɤ #$'%'&''', ') * +*,"$)ū,ħ &''().*/+/,/. / 010 12 **-/.//011..//0'1'2' 3 465786544 456,7'8'99/:/;<"%; <=>??@@? = >?@/A,BBA/C ABAB'CDE/GHHIJJ FEFFG'H K LKLJ'KL/M,MLKJIHGFEDCBA"&@?>=<;:98,7/77789</<<;::;<]=>?@/A/C/DEFGHIJJJJ/GFEDDE/FGHHGFDCBA@?>===?@ACC,B@?><;':9'86 6543210-,"'*)('&%$#"!!"#$%'&''&&%$#"! .  ,/   .. !".#$%'()((*+,/---,+*)('%$#"! ! 	/
''''''''''/'   '                        #0 nUI$".LONG": 15500: F  23700 
xUI$".PROJECT": 15500: F  23800 .yUI$".LIMIT": 15500: F  23930 :U 30000 @U: jU ----- ASSEMBLER DIRECTIVE: *= ----- pV: 	VSX0: DO NOT SKIP EXPRESSION EVALUATION FOR *= ON ANY PASS V 15600 #V XC  EM$"CAN NOT SET *": 15100:EA2: +"V V0  V65535  EM$"INVALID ADDRESS": 15100:XC1: 22040 5,VADXV D1V PA1   Y2V L$""  22070 u3V OF$""  #1:OF$"" {4V 6V (L$,1)","   17000: ;V 16200: (L$,1)"'"   17#000: <VL$(L$,2) @V OF$""  #1 EVOF$"" 2JVC$(L$,1): C$""  C$"'"  OF$OF$C$:L$(L$,2): 22090 SOV C$"'"  OF$"": 17000: {TV 16200: L$""  OF$"": 17000: YV OF$""  (OF$)16  EM$"INVALID FILE NAME": 15100:EA#2:OF$"": ^V#1,("@"OF$",P"),W cV DS0  EM$"DISK ERROR: "DS$: 15100:EA2:#1:OF$"": 7hV1,((((AD),2))); UiV1,(((((AD),4),2))); [rV a¸V: V ----- ASSEMBLER DIRECTIVE: .END ----- V: VEA1: END ASSEMBLY V W: #&W ----- ASSEMBLER DIRECTIVE: .PRINT ----- 0W: 5WH0 :W 15600 DW XC   ,NW H  T$(V)" ": T$(V) ;SWEO$EO$T$ bXW 16100: C$","   16200: 22330 w]W C$""  17000 }bW ÀW: ÊW ----- ASSEMBLER DIRECTIVE: .PRINTHEX ----- #ÔW: ÞWH1: 22330 W: W ----- ASSEMBLER DIRECTIVE: .BYTE ----- W: X 15600 X XC   RX V0  V255  EM$"BYTE OUT OF RANGE": 15100: bXBV: 16700  X 16100: C$","   16200: 22530 *X HX: RX ----- ASSEMBLER DIRECTIV#E: .WORD ----- \X: fX 15600 pX XC   zX V0  V65535  EM$"WORD OUT OF RANGE": 15100: 1XB(V,256): 16700 HŀXB(V256): 16700 ońX 16100: C$","   16200: 22630 uŎX {ŬX: ŶX ----- ASSEMBLER DIRECTIVE: .TEXT ----- X: #X (L$,1)"'"  EM$"NO TEXT FOUND": 15100: XL$(L$,2) %X L$""  EM$"CLOSING QUOTES MISSING": 15100: ?X (L$,1)"'"  22780 XXB((L$,1)): 16700 dX 22740 zX (L$)1  17000 Y Y: Y ----- ASSEMBLER DIRECTIVE: .RUN ---#	-- $Y: .YI$"CLEAR": 15500: F  RFRF  1: 22860 8YI$"WAIT": 15500: F  RFRF  2: 22860 C9YI$"AUTO": 15500: F  RFRF  4: 22860 s=Y L$""  EM$"UNKNOWN RUN FLAG": 15100: yBY LY (L$,1)","  22890 VY L$""  17000 `Y#
 jYL$(L$,2): 16000: 22830 tY:  ~Y ----- ASSEMBLER DIRECTIVE: .BANK ----- ȈY: ȒY 15600 :ȜY XC  EM$"BANK MISSING": 15100: OȦY L$""  17000 ȰY V0  V255  EM$"INVALID BANK": 15100: ȺYBKV Y Y: Y ----- ASSEMBLER #DIRECTIVE: .BASIC ----- Y: Y (L$,1)"'"   17000:EA2:  ZL$(L$,2) 
Z OF$""  #1 ZOF$"" ^ZC$(L$,1): C$""  C$"'"  OF$OF$C$:L$(L$,2): 23070 (Z C$"'"  OF$"": 17000:EA2: 2Z 16200: L$""  OF$"": 17000#:EA2: <Z OF$""  (OF$)16  EM$"INVALID FILE NAME": 15100:EA2:OF$"": FZ#1,("@"OF$",P"),W TPZ DS0  EM$"DISK ERROR: "DS$: 15100:EA2:#1:OF$"": eUZ C4  23271 VZ CREATE HEADER FOR MEGA65 ZZAD$2001 dZ1,(AD  255);(#(AD256)); nZ "10 BANK 0:SYS 8228:REM MEGA ASSEMBLER" ,xZ 2000 00 22 20 0A 00 FE 02 20 30 3A 9E 20 38 32 32 38 ........0:. 8228 x˂Z 2010 3A 8F 20 4D 45 47 41 20 41 53 53 45 4D 42 4C 45 :. MEGA ASSEMBLE ˌZ 2020 52 00 00 00                       #              R... ˖Z1,($22);($20);($A);(0);($FE);(2); ˠZ1," 0:"; ̪Z1,($9E); ̴Z1," 8228:"; "̾Z1,($8F); <Z1," MEGA ASSEMBLER"; SZ1,(0);(0);(0); _ZAD8228 eZ Z CREATE HEADER FOR C64 ZAD$801 Z1,(AD  255);(#(AD256)); Z "10 SYS 2079:REM MEGA ASSEMBLER" !Z 0800 00 0D 08 0A 00 9E 20 32 30 37 39 3A 8F 20 4D 45 ...0:. 2079:. ME lZ 0810 47 41 20 41 53 53 45 4D 42 4C 45 52 00 00 00    GA ASSEMBLER... Z1,($D);(8);($A);(0); Z1,($9E); Z1,"# 2079:"; Z1,($8F); Z1," MEGA ASSEMBLER"; Z1,(0);(0);(0); ZAD2079 Z [: /[ ----- ASSEMBLER DIRECTIVE: .6502 ----- 5[: J"[ L$""  17000 S,[TA1 Y6[ _h[: r[ ----- ASSEMBLER DIRECTIVE: .4510 ----- |[: Ά[ L$"" # 17000 ΐ[TA2 Κ[ [: [ ----- ASSEMBLER DIRECTIVE: .45GS02 ----- [: [ L$""  17000 [TA3 [ 0\: I:\ ----- ASSEMBLER DIRECTIVE: .PAUSE ----- OD\: ^I\ PA1   N\ "PAUSING ASSEMBLY, PRESS ESC TO ABORT OR ANY OTHER KEY T#O CONTINUE..." X\ K$ b\ "";(SP$,70);"" l\ K$(27)  EA2 v\ ϔ\: О\ ----- ASSEMBLER DIRECTIVE: .LONG ----- IУ\ CAUTION: HANDLES ONLY UP TO 28 BITS! OШ\: [в\ 15600 hм\ XC   \ V0  V$FFFFFFF  EM$"LONG OUT OF RANGE": #15100: \B(V,256): 16700 \B((V$100),256): 16700 \B((V$10000),256): 16700 !\B((V$1000000),256): 16700 H\ 16100: C$","   16200: 23730 N\ T\: ] ----- ASSEMBLER DIRECTIVE: .PROJECT ----- ]: ] PA2   #] (L$,1)"'"  PR$"": 17000:EA2:  ]L$(L$,2) 4]N$"" >]C$(L$,1): C$""  C$"'"  N$N$C$:L$(L$,2): 23870 CH] C$"'"  PR$"": 17000:EA2: pR] 16200: L$""  PR$"": 17000:EA2: \] N$""  (N$)12  EM$"INVALID F#ILE NAME": 15100:EA2:PR$"": f] 40100: EA2   p] 40500: z]: {] ----- ASSEMBLER DIRECTIVE: .LIMIT ----- |]: +}] 15600: XC   6~]LIV: <0u: g:u ----- ASSEMBLE CPU INSTRUCTION ----- mDu: Nu READ MNEMONIC XuMN$"" buC$(#L$,1) lu C$""  C$""  C$((C$)128) vu C$"A"  C$"Z"  MN$MN$C$:L$(L$,2): 30050 @{u C$"0"  C$"9"  (MN$)0  MN$MN$C$:L$(L$,2): 30050 sԀu MN$""  EM$"INVALID INSTRUCTION": 15100: Ԋu 16000 Ԕu FIND MNEMONIC #IN INSTRUCTION TABLE ԞuIISI((MN$)65): II=INSTRUCTION INDEX, AI=ADDRESSING MODE INDEX ըu MN$MN$(II)  IIII1: IINI  30120 Tղu IINI  EM$"UNKNOWN INSTRUCTION: "MN$: 15100: pu CHECK ADDRESSING MODE v L$""  L$"A"  L$"Q"  3#1000 v (L$,1)"#"  31400 v (L$,1)"("  (L$,3)",X)"  32000 v (L$,1)"("  (L$,6)",SP),Y"  32600 1 v (L$,1)"("  (L$,3)"),Y"  32100 [%v (L$,1)"("  (L$,3)"),Z"  32300 &v (L$,1)"("  (L$,1)")"  (OP$(II,12),2,1)#"Q"  32300 'v (L$,1)"["  (L$,3)"],Z"  32700 (v (L$,1)"["  (L$,1)"]"  32700 *v (L$,1)"("  (L$,1)")"  32200 04v (L$,2)",X"  31800 K>v (L$,2)",Y"  31900 sHv OP$(II,14)""  32400: BP & REL Rv 31500 ״x NO VALID# ADDRESSING MODE FOUND ׾xEM$"INVALID ADDRESSING MODE": 15100 x y IMPLIED ADDRESSING OR ACCUMULATOR/Q yAM0 7"yOP$OP$(II,AM):AM$AM$(AM): L$"A"  31040 L#y L$"Q"  31070 a'y OP$""  31100 u,y 31200: E   {6y @yAM$"ACCUMUL#ATOR": (OP$,1)"^"  (OP$,2,1)"Q"  31100 JyOP$(OP$,(OP$)1) Ty 31015 $^yAM$"Q PSEUDO REGISTER": (OP$,1)"^"  (OP$,2,1)"Q"  31100 <hyOP$(OP$,(OP$)1) Hry 31015 l|y ADDRESSING MODE NOT AVAILABLE نyEM$AM$" ADDRESSING MODE# NOT AVAILABLE": 15100 ِy y SUB WRITE OPCODE TO OUTPUT IF AVAILABLE FOR TARGET y RETURN E=1 IF NOT AVAILABLE yE0:X1 'y (OP$,1)"@"  X2 @y (OP$,1)"\"  X3 Yy X1  OP$(OP$,2) y TAX  E1:EM$"NOT AVAILABLE FOR SPECIF#IED TARGET CPU": 15100: y (OP$,1)"Q"  31210 yOP$(OP$,2) yB$42: 16700: 16700 y (OP$)2   yB((OP$,2)): 16700 .yOP$(OP$,3): 31210 iDz SUB WRITE ABSOLUTE VALUE V (LOW/HIGH BYTE) TO OUTPUT Iz WORKS ALSO FOR NEGATIV#E NUMBERS NzB(((V),2)): 16700 XzB((((V),4),2)): 16700 bz ۨz IMMEDIATE ADDRESSING OR IMMEDIATE WORD ܲzAM1: OP$(II,17)""  AM17 OܼzOP$OP$(II,AM):AM$AM$(AM): OP$""  31100 fzL$(L$,2): 16000 {z 15600: XC   z L$#""  17000 z AM1  31460 z V0  V65535  EM$"DATA OUT OF RANGE": 15100: z 31470 z V0  V255  EM$"DATA OUT OF RANGE": 15100: 1z 31200: E   Oz AM17   31300: 31490 _zBV: 16700 e{ { ABSOLUTE, BASE PAGE OR#  RELATIVE ADDRESSING {FA0: (L$,1)"!"  L$(L$,2): 16000:FA1 { OP$(II,4)""  OP$(II,5)""  31700 { 15600: XC    { L$""  17000 U*{ V0  V65535  EM$"DATA OUT OF RANGE": 15100: 4{ FA0  US0  V255  OP$(II,2)""#!  AM2: AM3 >{OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 H{ 31200: E   R{ AM2  ZPZP1:BV: 16700: \{ 31300: 0{ RELATIVE ADDRESSING OR 16 BIT RELATIVE E{ 15600: XC   Z{ L$""  17000 { V0  V65535  EM$"DATA OUT#" OF RANGE": 15100: { FA1  AM5: AM4 { AM4  OP$(II,4)""  OP$(II,5)""  AM5 | PA1  V0: 31747 |VV(AD2): IF AM=5 THEN V=V-1 I|OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 o| AM4  (V128  V127)  31785 | 31200:## E   | AM5   31300: |BV  255: 16700 $| )|EM$"BRANCH OUT OF RANGE" &*| TA1  OP$(II,5)""  EM$EM$" (TRY USING '!' OR LB.. FOR 16 BIT BRANCH)" 4+| 15100: d8| X-INDEXED ABSOLUTE OR BASEPAGE ADDRESSING =|FA0: (L$,1)"!#$"  L$(L$,2): 16000:FA1 B| 15600: XC   L| L$",X"  17000 V| V0  V65535  EM$"DATA OUT OF RANGE": 15100: 2`| FA0  US0  V255  OP$(II,5)""  AM6: AM8 bj|OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 vt| 31200: E   #%~| AM6  ZPZP1:BV: 16700: | 31300: | Y-INDEXED ABSOLUTE OR BASEPAGE ADDRESSING |FA0: (L$,1)"!"  L$(L$,2): 16000:FA1 | 15600: XC   4| L$",Y"  17000 l| V0  V65535  EM$"DATA OUT OF RANGE": 15100: | FA#&0  US0  V255  OP$(II,6)""  AM7: AM9 |OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 | 31200: E   | AM7  ZPZP1:BV: 16700: | 31300: L } X-INDEXED INDIRECT ADDRESSING (8 OR 16 BIT) c
}L$(L$,2): 16000 } TA1  OP$#'(II,15)""  AM15: AM10 }OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 (} 15600: XC   2} L$",X)"  17000 $7} V0  V65535  EM$"DATA OUT OF RANGE": 15100: \<} AM10  V255  EM$"DATA OUT OF RANGE": 15100: pF} 31200: E   " K} AM15   31300: P}BV: 16700 Z} d} INDIRECT Y-INDEXED ADDRESSING n}L$(L$,2): 16000 x}AM11 }OP$OP$(II,AM):AM$AM$(AM): OP$""  31100 (} 15600: XC   @} L$"),Y"  17000 v} V0  V255  EM$"DATA OUT OF RANGE": 1$R OF THE ALPHABET j*5 0,9,38,48,54,0,0,0,57,63,0,65,81,82,84,86,0,97,112,131,0,0,0,0,0,0 p:: v: : *************** ASSEMBLER UTILITY FUNCTIONS *************** : ė:: ; SUB ----- PUT ERROR MESSAGE EM$ IN BUFFER -----  ;: ; EB10 $ 15140 E; EB9  EM$"ERROR MESSAGE BUFFER OVERFLOW" Q;EBEB1 r; AL0  EB$(EB)EM$: 15140 ;EB$(EB)"ERROR IN LINE"(AL)": "EM$ $;NENE1 .; `;: j; SUB ----- ADD SYMBOL/VALUE SN$/SV TO SYMBOL TABLE ----- 5o; EF=1/2 FLAGS EXTER$NAL SYMBOLS (1=IMPORTED 2=TO BE EXPORTED) ;t;: \u;C$(SN$,1): C$"."  15223 v;  ((C$"A"  C$"Z")  (C$""  C$""))  15227 w;T$(SN$,2) x; T$""  15230 ֙y;C$(T$,1):T$(T$,2) -z; (C$"A"  C$"Z")  (C$""  C$"")  ($C$"0"  C$"9")  C$"."  15224 S{;EM$"INVALID SYMBOL NAME": 15100 Y|; ~; NSMS  EM$"SYMBOL TABLE FULL": 15100: ;N$SN$: 17300: I0  15290 ܚ;EM$"SYMBOL "SN$ " ALREADY DEFINED": 15100 ⚰; ;NSNS1:SN$(NS)SN$:SV(NS)SV:SE%$(NS)EF: 17200 ; #;: Y; SUB ----- FIND SYMBOL SN$ IN SYMBOL TABLE ----- ;           RETURN VALUE V, RC=1 IF NOT FOUND ;           DO NOT THROW ERROR WHEN NV=1 ;           RETURN 0 FOR UNKNOWN SYMBOLS IN IGNORE MODE (IG=1) 8; FIND$S GLOBAL SYMBOLS OR SYMBOLS IN CURRENT SECTION CS$ >;: g; (SN$,1)"."  N$CS$SN$: N$SN$ ;RC0: 17300: I0  15375 
<VSV(I): Ӝ< IG  V0:O$"WARNING: SYMBOL "N$" IGNORED": 16600: < NV0  EM$"SYMBOL "N$" NOT FOUND": 151$00 <RC1:V0: (<: T2< SUB ----- DISPLAY ERROR MESSAGES FROM BUFFER ----- Z<<: iF< EB0   xP< X1  EB Z<   O$""EB$(X)"": 16600 d< X n<EB0 o< EH   p< "ESC=ABORT   N=CONTINUE TO NEXT ERROR   ANY OTHER KEY=CONTINUE TO E$ND" q< K$ .r< K$(27)  EA2: 15480 Cs< K$"N"  15480 Tt<EH1: 15480 lx< "";(SP$,70);"" r< x<: < SUB ----- CHECK L$ FOR INSTRUCTION I$, RETURN F=1 IF FOUND ----- <           AND REMOVE FROM L$ INCL. LEADING SPACES <: $	<I1:  (L$,I,1)" ":II1: 8< (L$,I$)I  15555 B<F0: r<C$(L$,(I$)I,1): C$""  C$" "  15560 < (C$"A"  C$"Z")  (C$""  C$"")  15550 ʟ< C$"0"  C$"9"  15550 ߟ<L$(L$,(I$)I)  <  (L$,1)" ":L$(L$,2)$
: 
<F1: <: P< SUB ----- EVALUATE EXPRESSION IN L$, RETURN VALUE V ----- <           AND REMOVE FROM L$ INCL. LEADING SPACES  =           XC<>0 INDICATES AN ERROR =           SX=1 SKIPS EVALUATION OF YET UNKNOWN SYMBOLS ON PASS 1 =$=           AND RETURNS US=1 / V=0 IF UNKNOWN SYMBOL ENCOUNTERED C=: f	=US0:NV0: SX1  PA1  NV1 =XC0: (L$)0  15633 =EM$"MISSING EXPRESSION": 15100:XC1 =V0: = EXPRESSION VARIABLES: XS/XE START/END INDEX, XC=CANCEL EVAL. $= XV=VALUE, XL=LEVEL OF RECURSION 4=XS1:XL0: 15800 f= XC  EM$"INVALID EXPRESSION": 15100:V0: =L$(L$,XE1): 16000 = US  XV0 =VXV: ֢"= SUB EVALUATE COMPONENT OF EXPRESSION, STARTING AT XS #= RETURN XV, XE (VALUE, LAST $INDEX OF EXPRESSION) $=XV0 B,=C$(L$,XS,1): C$" "  XSXS1: 15660 W-= C$"("  15730 u.= C$"<"  C$">"  15720 /= C$"*"  15710 0= ("$%0123456789-",C$)  15680 1= (C$"A"  C$"Z")  (C$""  C$"")  C$"."  15690 2= $C$"'"  15700 6=XC1:XV0:: ERROR 1@= NUMBER LITERAL DA= 16300:XVV: QJ= SYMBOL bK=SN$C$:XEXS vL=C$(L$,XE1,1) M= (C$"A"  C$"Z")  (C$""  C$"")  (C$"0"  C$"9")  C$"."  SN$SN$C$:XEXE1: 15692 N=V0: US0  $ 15300: RC  US1: 15696 O=XVV: 1P=XV0: NV0  XC1 7Q= UT= CHARACTER LITERAL ('C') uU= (L$,XS2,1)"'"  15670 V=XV((L$,XS1,1)):XEXS2: ^= ADDRESS (*) _=XEXS:XVAD: ԥh= LOW/HIGH BYTE < / > ߥi=XC$C$ j=XSXS1: 1565$0: XC   )k= XC$"<"  XV(XV,256): XV(XV256) /l= Jr= BRACKETED EXPRESSION Vs=XSXS1 t= XL10  XC1:EM$"TOO MANY NESTED EXPRESSIONS": 15100: u=XLXL1 v=XS(XL)XS:XC$(XL)XC$ w=PS(XL)PS:PF(XL)PF:PP(XL)PP:PO$(XL)PO$ |= $15800: XC   ,=PSPS(XL):PFPF(XL):PPPP(XL):PO$PO$(XL) F=XSXS(XL):XC$XC$(XL) R=XLXL1 }=XEXE1:C$(L$,XE,1): C$" "  15750 = C$")"  XC1:EM$"CLOSING BRACKET MISSING": 15100: = 駸= SUB EVALUATE SUM OF PRODUCTS AT XS =$ RETURN XV, XE, XC C= USE PS=SUM PP=PROD PF=1/-1 FOR PLUS/MINUS PO$=*/% OPERATION = THIS WILL ALSO EVALUATE LOGICAL OPERATORS &=AND .=OR :=EOR = WITH SAME PRIORITY AS *, / AND % =PS0:PF1 ʨ=PP1:PO$"*" = 15650: GET NEXT VALUE AT X$S AS XV =XSXE1: XC   4= US0   15830: COMBINE WITH PRODUCT a=C$(L$,XS,1): C$" "  XSXS1: 15815 = ("*/%&.:",C$)  PO$C$:XSXS1: 15812 =PSPSPFPP: COMBINE WITH SUM ݩ= C$"+"  PO$C$:PF1:XSXS1: 15811 	= C$"-"$  PO$C$:PF1:XSXS1: 15811 = END OF TERM -=XEXS1:XVPS 3= i= SUB COMBINE XV WITH PRODUCT / LOGICAL OPERATORS = PO$"*"  PPPPXV: = PO$"&"  PPPP  XV: = PO$"."  PPPP  XV: ۪= PO$":"  PPPP  XV: = XV0 $ XC1:EM$"DIVISION BY ZERO": 15100: ,= PO$"/"  PP(PPXV): K= PO$"%"  PP(PP,XV): V=XC1: \>: > SUB ----- REMOVE LEADING SPACES FROM L$ ----- >: >  (L$,1)" ":L$(L$,2): > ë>: > SUB ----- PREVIEW FIRST CHAR$ACTER FROM LINE IN C$ ----- >: ?C$(L$,1): H?: \R? SUB ----- CONSUME FIRST CHARACTER FROM LINE IN C$ ----- ~W?           AND REMOVE SPACES \?: f?C$(L$,1) p?L$(L$,2): 16000 z? ?: ? SUB ----- READ NUMBER LITERAL IN BIN/DE$C/HEX, RETURN VALUE IN V ----- H?           READ FROM L$ AT POSITION XS, RETURN XE=LAST CHARACTER N?: z?IXS: (L$,I,1)"-"  S1:II1: S1 ?V0:C$(L$,I,1): C$""  16380 ? C$"$"  16450 ɭ? C$"%"  16550 ? ("0123456789",C$)$  16390 ?EM$"INVALID NUMBER": 15100:V0:XC1: +@ DECIMAL NUMBER L@C$(L$,I,1): C$""  16420 @ ("0123456789",C$)  V10V(C$):II1: 16400 $@VVS:XEI1: B@ HEXADECIMAL NUMBER ծL@II1:C$(L$,I,1): C$""  16500 V@X("0$123456789ABCDEF",C$): X0  16500 `@ X16  XX6 2j@V16VX1: 16460 Et@VVS:XEI1: Y@ BINARY NUMBER @II1:C$(L$,I,1): C$""  16590 @X("01",C$): X0  16590 @V2VX1: 16560 ȯ@VVS:XEI1: ί@: @ SUB -----$ OUTPUT LINE O$ TO ASSEMBLY LISTING ----- @: @ O$  A "<A: VFA SUB ----- OUTPUT BYTE B TO MACHINE CODE ----- \PA: ZA NBMB  EM$"TOO MANY BYTES IN LINE": 15100: dANBNB1:BY(NB)B: A: 갪A SUB ----- OUTPUT MACHINE CODE TO MEMORY$ OR FILE ----- A           BYTE B IS WRITTEN TO ADDRESS AD  A: ;A OF$""  1,(B);: LA BK: AD,B RA XhB: rB ----- DISPLAY SYNTAX ERROR AND RETURN ----- |B: BEM$"SYNTAX ERROR": 15100 B B: B SUB ----- HIGHLIGHT COMM$ENTS IN OL$ AFTER ;; YELLOW ----- B: BI(OL$,";;"): I0   CBOL$(OL$,I1)""(OL$,I2)"" IB O0C: :C SUB ----- ADD LATEST SYMBOL TO B-TREE ----- DC: NCI1:BL%(NS)0:BG%(NS)0: NS1   ˲XC SN$(NS)SN$(I)  17270 bC BG%(I)$  IBG%(I): 17240 lCBG%(I)NS: vC BL%(I)  IBL%(I): 17240 +CBL%(I)NS: 1C: eC SUB ----- FIND SYMBOL N$ THROUGH B-TREE ----- C --> INDEX I 0=NOT FOUND C: CI1: NS0  I0 C I0   C SN$(I)N$   C N$SN$(I)  IB$L%(I): IBG%(I) C 17350  N: 0*N SUB ********** RUN ASSEMBLER PASS (PA) ********** 64N: j9NADDA:BKDB: START AT DEFAULT ADDRESS AND BANK :NZP0: COUNT ZERO PAGE ACCESSES ;NTA3: TARGET 1=6502 2=4510 3=45GS02 Դ<NCS$"": CURRENT SECTION$ >NAL0: ASSEMBLY LINE NUMBER HNALAL1: ALNL  20100 RNL$L$(AL) *\N 21000 =fN EA0  20040 CN IR: pR SUB ----- ASSEMBLE LINE L$ ----- vR: R K$: K$(27)  EA2 е RSX0: DO NOT SKIP EXPRESSION EVALUATION ON PASS 1 FOR NOW $ !REO$"": NO EXTRA OUTPUT UNTIL NOW &ROL$L$: SAVE ORIGINAL LINE #'R 17100 P+RNB0:EB0: CLEAR BYTES AND ERROR BUFFER y0R STRIP COMMENTS AND TRAILING SPACES :RI(L$,";"): I  L$(L$,I1): 7100 DR L$""   21500 lR LINE IS ASSEMBL$!ED, DISPLAY OUTPUT AND WRITE DATA qR PA1  ADADNB 2vR PA1  EB0  O$OL$: 16600: 21200 A{R PA1   o|R NB0  O$(SP$,20)OL$: 16600: 21190 RO$(AD):I0:F0 R X1  NB R   BBY(X):T$((B),3):O$O$" "T$ 緕R    16800: $"WRITE MACHINE CODE OUTPUT 1R    RA0  OF$""  RAAD:RBBK: SAVE START ADDRESS/BANK OF PROGRAM @R   ADAD1 MR   II1 fR    I8  XNB   {R       F0   R          (O$)19  O$O$(SP$,19(O$)) ʸR         O$O$" "OL$:F1 $#R       R       16600:O$(AD):I0  R    R X 'R EO$""  O$EO$: 16600 LR 15400: DISPLAY ERROR MESSAGES RR XS: S SUB ----- ASSEMBLE NON-EMPTY LINE L$ ----- S: T EXTRACT LABEL ɹTEF0: (L$,7)"EXPORT "  21540 $$TL$(L$,8): 16000:EF2 $TC$(L$,1) 	.T C$" "  21600 &8TI(L$," "):I2(L$,"=") @9T I0  I20  21570 a:T I0  I20  II2: 21570 ;T I0  I20  I2I  II2 BT I  SN$(L$,I1): SN$L$ LTL$(L$,(SN$)1): 16000 MT $%(L$,1)"="  SVAD: 21585 NTL$(L$,2): 16000 OTS2$SN$: 15600:SVV:SN$S2$ :QT (SN$,1)"."  CS$SN$ wVT PA1  21600: ADD TO SYMBOL TABLE ONLY DURING PASS 1 XT (SN$,1)"."  SN$CS$SN$ YT 15200 `T REMOVE LEADING SPACES jT$&  (L$,1)" ":L$(L$,2): tT L$""   "T ----- CHECK FOR ASSEMBLER DIRECTIVES ----- `TSX1: SKIP EXPRESSION EVALUATION ON PASS 1 STARTING HERE oTC$(L$,1) T C$"*"  C$"."  21990 T (L$,2)"*="  L$(L$,3): 16000: 22000 T$'I$".END": 15500: F  22200 TI$".PRINTHEX": 15500: F  22400 , UI$".PRINT": 15500: F  22300 O
UI$".BYTE": 15500: F  22500 rUI$".WORD": 15500: F  22600 UI$".TEXT": 15500: F  22700 (UI$".RUN": 15500: F  22800 ڽ2UI$".B# ANK": 15500: F  22900 <UI$".BASIC64": 15500: F  C41: 23000 2AUI$".BASIC": 15500: F  C40: 23000 UFUI$".6502": 15500: F  23300 xPUI$".4510": 15500: F  23400 ZUI$".45GS02": 15500: F  23500 dUI$".PAUSE": 15500: F  2360% THE WHOLE PROJECT WHILE WORKING ON A SINGLE FILE." o& "THE NEXT AVAILABLE ADDRESS, PRINTED OUT AFTER ASSEMBLY OF EACH FILE, WILL" (p& "HELP YOU TO ORGANIZE YOUR ASSEMBLY DESTINATION ADDRESSES." p& "TIPP: START EACH FILE WITH A JMP TO THE MAIN %PROGRAM, SO YOU CAN QUICKLY TEST" p& "DIRECTLY FROM MEGA ASSEMBLER, NO MATTER WHICH FILE YOU ARE CURRENTLY EDITING." %q& "USE IGNORE MODE TO REBUILD A PROJECT FILE IF YOU HAVE CROSS-REFERENCES." Bq'"PRESS ANY KEY";: K$ Lq' 300 Rq': Xq' q$%' ******************** ASSEMBLER ******************** q.' qt': q~' ----- INITIALIZE ASSEMBLER ----- q': q' ""; r'O$"MEGA ASSEMBLER V"VN$" BY THOMAS GRUBER": 16600 &r' 7700: SE  300 8r'O$"": 16600 Ir' AI  10190 jr' CREATE SYM%BOL TABLE ARRAYS r'MS200: MAXIMUM SYMBOL TABLE SIZE r' SN$(MS),SV(MS),SE%(MS),BL%(MS),BG%(MS): SYMBOL NAME, VALUE, EXTERNAL (1=IMPORTED 2=EXPORTED) 3s'ME200: MAXIMUM EXTERNAL SYMBOLS FOR MULTI-FILE PROJECTS us' ES$(ME):ES0: EXTERNAL SYMBOL%S, NUMBER OF SYMBOLS IN ARRAY s'MB80: MAX NUMBER OF OUTPUT BYTES PER LINE s' BY(MB): BYTES FROM ASSEMBLY LINE s' EB$(10):EB0: ERROR MESSAGE BUFFER t' 12000: READ INSTRUCTION TABLE @t'AI1: ASSEMBLER IS INITIALIZED ]t'NS0: NUMBER OF %SYMBOLS yt'NE0: NUMBER OF ERRORS t'EH0: ERROR HANDLING 0=PAUSE, 1=CONTINUE t'NB0: NUMBER OF BYTES FROM ASSEMBLY LINE u'EA0: END ASSEMBLY FLAG (1=END PASS, 2=ABORT ASSEMBLY) 6u'LI1: NO LIMIT FOR OUTPUT SIZE au' ASSEMBLY RESULTS TO RET%URN TO EDITOR u (RA0:RB0: START ADDRESS AND BANK OF PROGRAM u
(RO0: SET IF ASSEMBLY WAS OK AND ADDRESS HAS BEEN SET v(RF0: RUNFLAGS: BIT 0=CLEAR SCREEN, BIT 1=WAIT FOR KEY, BIT 2=AUTORUN Qv(OF$"": OUTPUT FILE, OR ASSEMBLE TO MEMORY IF NONE %}v((EF0: EXTERNAL FLAG FOR ADDING SYMBOLS v*: v+ ----- ASSEMBLE PROGRAM ----- v+: v+ PASS 1 v +PA1:O$"PASS 1": 16600:EA0 v*+ 20000 v4+ EA2  11300 (w>+Z1ZP: SAVE NUMBER OF ZERO PAGE ACCESSES 5w\+ PASS 2 Wwf+PA2:O$"PASS 2": 166%	00:EA0 iwg+O$"": 16600 uwp+ 20000 wq+O$"": 16600 wr+ LI1  RA0  11125 xs+ (ADRA)LI  AL0:EH1:EM$"OUTPUT LIMIT EXCEEDED, POSSIBLE MEMORY CORRUPTION": 15100: 15400 xu+ EA2  11300 yxw+ ZPZ1  AL0:EH1:EM$"SYNCHRONIZATION ERROR%
: CHECK ZERO PAGE ACCESSES": 15100: 15400 xy+ NE0   40700 xz+ NE  S$(NE):S$""(S$,2): S$"NO" x+S$S$" ERROR": NE1  S$S$"S" x+O$S$"": 16600 !y+ NE0  RA0  RO1: ASSEMBLY OK Cy+ CLOSE FILE AND WAIT FOR KEY _y+ OF%$""  #1:OF$"" y+ (RF  4)0  AR0  RO0  AR1 y+ AR  K$"R": 11224 y+ "PRESS ANY KEY"; y+ RO   " OR R TO RUN"; y+ "" y+ K$ y+ AR1  AR0 4z+ (K$"R"  K$"")  RO1   "RUNNING...";: 6100 >z+ 300 Sz$, ABORT% ASSEMBLY xz.,O$"ABORTING ASSEMBLY": 16600 z8, 11200 z.: z. SUB ----- READ ASSEMBLER INSTRUCTION TABLE ----- z.: z. NA: NUMBER OF ADDRESSING MODES {. AM$(NA1): X0  NA1: AM$(X): X 9{. NI: NUMBER OF INSTRUCTIONS h{/ MN$(NI1%): MNEMONICS, INDEX STARTS AT 0 {/ OP$(NI1,NA1): OPCODES, SECOND INDEXES START AT 0 {/ 13500: PI(NI1): PUT INDEX {/ X0  NI1: PI(X): X |/ SI(25): X0  25: SI(X): X: SEARCH INDEX %|/ 13005:C0 P|/ MN$: MN$"*"  12100: EN%D OF TABLE g|&/MN$(PI(C))MN$:I0 |0/ OP$: OP$"*"  CC1: 12060 |5/ OP$"--"  OP$"" |:/OP$(PI(C),I)OP$:II1: 12080 }D/ CNI   "WARNING! INCONSISTENT INSTRUCTION TABLE!": 	}N/ }0: G}0 ---------- ASSEMBLER INSTRUCTION TABLE -------%--- M}0: }0 IMPORTANT: RUN CODE GENERATOR AT 14000 WHEN INSTRUCTION TABLE CHANGES }0: }0 ADDRESSING MODES }0 19: NUMBER OF ADDRESSING MODES "~1 IMPLIED,IMMEDIATE,BASE PAGE,ABSOLUTE, RELATIVE, 16-BIT RELATIVE P~1 X-INDEXED BASE PAGE,Y-IND%EXED BASE PAGE |~1 X-INDEXED ABSOLUTE,Y-INDEXED ABSOLUTE ~$1 X-INDEXED INDIRECT,INDIRECT Y-INDEXED,INDIRECT Z-INDEXED,INDIRECT ~)1 BASE PAGE AND RELATIVE,X-INDEXED INDIRECT 16 BIT .*1 SP-INDEXED INDIRECT Y-INDEXED,IMMEDIATE WORD S+1 INDIRECT FL%AT MEMORY Z-INDEXED Y.1: l2 INSTRUCTIONS 2 EACH LINE ENDS WITH *, TABLE ENDS WITH * 2: 2 145: NUMBER OF INSTRUCTIONS 2: 2 PREFIX: @=4510, \=45GS02, \Q=QUAD   POSTFIX: ^=A/Q, Z=],Z NEEDED U2         ## BP AB RL 16 BX BY AX AY X) %)Y )Z () BR IX IS #W ]Z 2 ADC,--,69,65,6D,--,--,75,--,7D,79,61,71,@72,--,--,--,--,--,\EA72,* 2 AND,--,29,25,2D,--,--,35,--,3D,39,21,31,@32,--,--,--,--,--,\EA32,* 2 ASL,0A^,--,06,0E,--,--,16,--,1E,* .2 BCC,--,--,--,--,90,@93,* M2 BCS,--,%--,--,--,B0,@B3,* l2 BEQ,--,--,--,--,F0,@F3,* 2 BIT,--,@89,24,2C,--,--,@34,--,@3C,* 2 BMI,--,--,--,--,30,@33,* ԁ2 BNE,--,--,--,--,D0,@D3,* 2 BPL,--,--,--,--,10,@13,* 2 BRK,00,* !2 BVC,--,--,--,--,50,@53,* @2 BVS,--,--,--,--,70%,@73,* O2 CLC,18,* ^2 CLD,D8,* m2 CLI,58,* |2 CLV,B8,* ł2 CMP,--,C9,C5,CD,--,--,D5,--,DD,D9,C1,D1,@D2,--,--,--,--,--,\EAD2,* ݂2 CPX,--,E0,E4,EC,* 2 CPY,--,C0,C4,CC,* 2 DEC,@3A^,--,C6,CE,--,--,D6,--,DE,* -2 DEX,CA,* <2 DEY,%88,* 2 EOR,--,49,45,4D,--,--,55,--,5D,59,41,51,@52,--,--,--,--,--,\EA52,* 2 INC,@1A^,--,E6,EE,--,--,F6,--,FE,* 2 INX,E8,* ̃2 INY,C8,* 	2 JMP,--,--,--,4C,--,--,--,--,--,--,--,--,--,6C,--,@7C,* G2 JSR,--,--,--,20,--,--,--,--,--,--,--,-%-,--,@22,--,@23,* 2 LDA,--,A9,A5,AD,--,--,B5,--,BD,B9,A1,B1,@B2,--,--,--,@E2,--,\EAB2,* 2 LDX,--,A2,A6,AE,--,--,--,B6,--,BE,* 2 LDY,--,A0,A4,AC,--,--,B4,--,BC,* 
2 LSR,4A^,--,46,4E,--,--,56,--,5E,* 2 NOP,EA,* b2 ORA,--,09,05,0D,--,-%-,15,--,1D,19,01,11,@12,--,--,--,--,--,\EA12,* q2 PHA,48,* 2 PHP,08,* 2 PLA,68,* 2 PLP,28,* ƅ2 ROL,2A^,--,26,2E,--,--,36,--,3E,* 2 ROR,6A^,--,66,6E,--,--,76,--,7E,* 2 RTI,40,* 2 RTS,60,@62,* Y2 SBC,--,E9,E5,ED,--,--,F5,--%,FD,F9,E1,F1,@F2,--,--,--,--,--,\EAF2,* h2 SEC,38,* w2 SED,F8,* 2 SEI,78,* І2 STA,--,--,85,8D,--,--,95,--,9D,99,81,91,@92,--,--,--,@82,--,\EA92,* 2 STX,--,--,86,8E,--,--,--,96,--,@9B,* # 3 STY,--,--,84,8C,--,--,94,--,@8B,* 23 TAX,AA%,* A3 TAY,A8,* P3 TSX,BA,* _3 TXA,8A,* n3 TXS,9A,* }3 TYA,98,* 3 MAP,@5C,* 3 EOM,@EA,* 	3 TAZ,@4B,* 
3 TZA,@6B,* 3 LDZ,--,@A3,--,@AB,--,--,--,--,@BB,* 3 STZ,--,--,@64,@9C,--,--,@74,--,@9E,* 73 ASR,@43^,--,@44,--,--%,--,@54,* P3 ASW,--,--,--,@CB,* 3 BBR0,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@0F,* ƈ3 BBR1,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@1F,* 3 BBR2,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@2F,* <3 BBR3,--,--,--,--,--,--,--,--,--,--,-%-,--,--,--,@3F,* w3 BBR4,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@4F,* 3 BBR5,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@5F,* 3 BBR6,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@6F,* (3 BBR7,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@7F,* c%3 BBS0,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@8F,* 3 BBS1,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@9F,* ي3 BBS2,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@AF,* 3 BBS3,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@BF,* O3 BBS4,--,--,--%,--,--,--,--,--,--,--,--,--,--,--,@CF,* 3 BBS5,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@DF,* ŋ3 BBS6,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@EF,*  3 BBS7,--,--,--,--,--,--,--,--,--,--,--,--,--,--,@FF,*  3 BRA,--,--,--,--,@80,@83,* ? 3% BSR,--,--,--,--,--,@63,* O!3 CLE,@02,* j"3 CPZ,--,@C2,@D4,@DC,* #3 DEW,--,--,@C3,* $3 DEZ,@3B,* %3 INW,--,--,@E3,* &3 INZ,@1B,* ǌ'3 NEG,@42^,* (3 PHW,--,--,--,@FC,--,--,--,--,--,--,--,--,--,--,--,--,--,@F4,* )3 PHX,@DA,* +*3 PH%Y,@5A,* ;+3 PHZ,@DB,* K,3 PLX,@FA,* [-3 PLY,@7A,* k.3 PLZ,@FB,* /3 RMB0,--,--,@07,* 03 RMB1,--,--,@17,* 13 RMB2,--,--,@27,* Ǎ23 RMB3,--,--,@37,* ލ33 RMB4,--,--,@47,* 43 RMB5,--,--,@57,* 53 RMB6,--,--,@67,* #63 RMB7,--,--,@77,% * <73 ROW,--,--,--,@EB,* L83 SEE,@03,* c93 SMB0,--,--,@87,* z:3 SMB1,--,--,@97,* ;3 SMB2,--,--,@A7,* <3 SMB3,--,--,@B7,* =3 SMB4,--,--,@C7,* ֎>3 SMB5,--,--,@D7,* ?3 SMB6,--,--,@E7,* @3 SMB7,--,--,@F7,* A3 TAB,@5B,* $B3 TBA,@%!7B,* >C3 TRB,--,--,@14,@1C,* XD3 TSB,--,--,@04,@0C,* hE3 TSY,@0B,* xF3 TYS,@2B,* ȏG3 ADCQ,--,--,\Q65,\Q6D,--,--,--,--,--,--,--,--,\Q72,--,--,--,--,--,\QEA72,* H3 ANDQ,--,--,\Q25,\Q2D,--,--,--,--,--,--,--,--,\Q32,--,--,--,--,--,\QEA32,* KI3%" ASLQ,\Q0A^,--,\Q06,\Q0E,--,--,\Q16,--,\Q1E,* tJ3 ASRQ,\Q43^,--,\Q44,--,--,--,\Q54,* K3 BITQ,--,--,\Q24,\Q2C,* L3 CMPQ,--,--,\QC5,\QCD,--,--,--,--,--,--,--,--,\QD2,--,--,--,--,--,\QEAD2,* M3 DEQ,\Q3A^,--,\QC6,\QCE,--,--,\QD6,--,\QDE,* cN3 EO%#RQ,--,--,\Q45,\Q4D,--,--,--,--,--,--,--,--,\Q52,--,--,--,--,--,\QEA52,* O3 INQ,\Q1A^,--,\QE6,\QEE,--,--,\QF6,--,\QFE,* P3 LDQ,--,--,\QA5,\QAD,--,--,--,--,--,--,--,--,\QB2,--,--,--,--,--,\QEAB2Z,* Q3 LSRQ,\Q4A^,--,\Q46,\Q4E,--,--,\Q56,--,\Q5E,* g%$R3 ORQ,--,--,\Q05,\Q0D,--,--,--,--,--,--,--,--,\Q12,--,--,--,--,--,\QEA12,* S3 ROLQ,\Q2A^,--,\Q26,\Q2E,--,--,\Q36,--,\Q3E,* ͒T3 RORQ,\Q6A^,--,\Q66,\Q6E,--,--,\Q76,--,\Q7E,* U3 SBCQ,--,--,\QE5,\QED,--,--,--,--,--,--,--,--,\QF2,--,--,--,--,--,\QE%%AF2,* lV3 STQ,--,--,\Q85,\Q8D,--,--,--,--,--,--,--,--,\Q92,--,--,--,--,--,\QEA92,* W3 LBCC,--,--,--,--,--,@93,* X3 LBCS,--,--,--,--,--,@B3,* ̓Y3 LBEQ,--,--,--,--,--,@F3,* Z3 LBMI,--,--,--,--,--,@33,* [3 LBNE,--,--,--,--,--,@D3,* ,\3 LBP%&L,--,--,--,--,--,@13,* L]3 LBVC,--,--,--,--,--,@53,* l^3 LBVS,--,--,--,--,--,@73,* _3 LBRA,--,--,--,--,--,@83,* X4 * ̔4 INDEXES USED TO STORE INSTRUCTIONS ALPHABETICALLY 4 0,2,4,25,26,27,28,30,31,32,34,36,37,38,39,41,42 ;4 43,45,46,48%',51,52,55,57,60,61,63,64,74,76,77,79,83 4 84,86,87,92,93,105,107,110,111,112,114,115,117,126,128,129,132 4 133,138,140,141,142,81,54,134,144,78,130,6,8,9,10,11,12 4 13,14,15,16,17,18,19,20,21,22,23,24,33,35,40,47,50 34 53,59,62,82,88,89,90$ ,91,94,95,96,97,98,99,100,101,102 }4 103,104,109,116,118,119,120,121,122,123,124,125,131,135,136,137,139 4 143,1,3,5,7,29,44,49,56,58,75,80,85,106,108,113,127 ؖ4 65,66,67,68,69,70,72,73,71 ! 5 INDEX TABLE INTO INSTRUCTION ARRAY FOR EACH LETTE& XM1  M2:C$(XM11)L$(X)::NCM2M11  H NCMC   XNC1  MC:C$(X)"": 2H XM1  NL(M2M11):L$(X)L$(XM2M11): X [H XNL(M2M11)1  NL:L$(X)"": X HNLNL(M2M11): NLM1  NLM1 HCLM1:M10:M20: CLFL  FLCL H 400:& 1000 H: H" ----- MEGA-V: PASTE CLIPBOARD ----- H,: I6 NLNCML  NC0  1000 8I@ XNL  CL  1:L$(XNC)L$(X): X:NLNLNC \IJ X1  NC:L$(CLX1)C$(X): X ITCLCLNC: CLFL23  FLCL23 I^ 400: 1000 I|: I ----- MEGA-F: F&IND ----- I: IP$"FIND:":L$"": 7200:FS$L$ I FIND NEXT J FS$""  1000 JLCL:CCC1:A0 ?J LCL1  LNL  AA1: A2  1000 [J (L$(L),FS$,C)  5630 vJLL1:C1: LNL  L1 J 5590 JCLL:CC(L$(L),FS$,C) J CLFL & FLCL: 5660 J CLFL23  FLCL23 J 400: 1000 JD: KN ----- MEGA-S: SAVE ----- KX: ,K] NL1  (L$(1))0  1000 TKbL$FI$:P$"SAVE AS (*.ASM):": 7200 gKl L$""  1000 Kv (L$,4)".ASM"  L$L$".ASM" KFI$(L$,16): 5770: 3&00 K: K SUB ----- SAVE AS FI$ ----- K: K "";: SF   "AUTO"; 	L "SAVING..." L#1,("@"FI$),W .L DS  5830 ]L X1  NL:1,(34)L$(X)(34): X:1,"*" fL#1 qLMF0: L#1: "CAN NOT SAVE FILE: ";DS$ L "PRESS &ANY KEY" L K$:SE1: L: L ----- MEGA-L: LOAD ----- L : M% AL$""  LF$AL$:AL$"": 5970 M&AA0 DM*L$FI$:P$"LOAD FILE (*.ASM):": 7200 WM4 L$""  1000 |M> (L$,4)".ASM"  L$L$".ASM" MHLF$(L$,16) MJ 7800 MM 7700:& SE  300 MR "LOADING..." M\#1,(LF$) Mf DS  AA0: 6030  Nk X1  NL:L$(X)"": X:NL0:CL1:CC1:FL1:MF0 :Np1,L$: L$"*"  6005 MNq NLML  6060 jNrNLNL1:L$(NL)L$: 6000 |Nu NL0  NL1 Nz#1 NFI$LF$: ID$(ID)FI$ & ID0 N 7900 N 300 N#1: "CAN NOT LOAD FILE: ";DS$ N "PRESS ANY KEY" 
O K$: 300 O#1 ?O "UNRECOVERABLE ERROR: FILE TOO LONG" EO PO 6080 VO: tO ----- RUN PROGRAM ----- zO: O RO0  1000 O 7700: SE  3&	00 O RF  1   ""; O RB: RA O RF  2   K$ O 300 O8: PB ----- DISPLAY DIRECTORY OF .ASM FILES ----- $PL: ;PV "";: "*.ASM",W \P` "PRESS ANY KEY"(SP$,40); fPj K$ pPt 300 vP: P ----- ESC-Q: DELETE TO THE END OF&
 LINE ----- P: PL$(L$(CL),CC1): 7100:L$(CL)L$: 3100 P : Q
 ----- MEGA-I: TOGGLE IGNORE MODE ----- Q: (QIG1IG: 360 3Q( 1000 9Qd: [Qn ----- ESC N: NEW FILE ----- aQx: sQ} MF0  6556 QP$"REALLY START NEW FILE (Y/N)? ":L&$"" Q 7200 Q (L$,1)"Y"  1000 Q 7700: SE  300 Q 7800 R X1  NL:L$(X)"": X:NL1:CL1:CC1:FL1:MF0 8RFI$"":ID0:PR$"": 300 >R: rR ----- CTRL-1 TO CTRL-0: SET FILE NUMBER ----- xR: R FI$""  1000 R I10  &I0 R ID  ID$(ID)"" RIDI:ID$(ID)FI$ R 360: 1000 R,: S6 ----- ESC 1-9: LOAD FILE NUMBER ----- S@: 7SJI(K$): IID  ID$(I)""  1000 BSO 7800 WSTIDI:LF$ID$(ID) bS^ 5965 hS: S ----- MEGA-*: TOGGLE AUTOSAVE ----- S:& SAS1AS: 360 S 1000 SX: Sb  Tl *************** EDITOR UTILITY FUNCTIONS *************** Tv T: AT SUB ----- REMOVE TRAILING SPACES FROM L$ ----- GT: nT  (L$,1)" ":L$(L$,(L$)1): tT zT : T* SUB ----- PROMPT P$ F&OR TEXT L$ ----- T4: U> "Ϸ" ^UH "                                                                             " UR "̯&" Uf 1,2,77,2 Up P$;L$;: "";P$; UzL$"": "",L$ U "" V 16000 V 400: 7100 V: bV SUB ----- CHECK FOR AUTOLOAD/RUN, RETURN FILENAME IN AL$ ----- hV: VI0:AL$"":AA0: AUTO-ASSEMBLE AND R&UN V (2048I)64(("AUTOLOAD",I1,1))  7540 VII1: I8  7440 W$A(2048I): A34  I20  II1: 7460  W. A34  AA0: AW8II1: I40  AL$"":AA0: _WBA(2048I): A34  7520 {WL A1  A26  AA64 WVAL$AL$(A): 7&480 W` (AL$)16  AL$"":AA0 Wj WtI0 W~ (2048I)64(("AUTORUN",I1,1))   XII1: I7  7550 XAA1: 7460 X: BX SUB ----- FILE WAS MODIFIED ----- HX: `X MF0  MF1: 360 fX lX: X SUB ----- AUTOSAVE ----- X&# RETURN SE=1 FOR SAVE ERROR X(: X2SE0 X< AS  MF  FI$""  SF1: 5770:SF0 XF Xx: Y SUB ----- SAVE EDITOR POSITION ----- #Y: UY ID  ID%(ID,0)FL:ID%(ID,1)CL:ID%(ID,2)CC [Y aY: Y SUB ----- RESTORE EDITOR POSITION --&--- Y: Y ID  FLID%(ID,0):CLID%(ID,1):CCID%(ID,2) Y Y(#: Y2# Z<# ******************** HELP ********************** ZF# Z#: :Z# ----- EDITOR HELP ----- @Z#: \Z# "EDITOR FUNCTIONS" Z# "HOME          GO TO BEGINNING/END OF L&INE" Z# "TAB           GO TO PREDEFINED COLUMNS FOR LABELS, COMMANDS AND COMMENTS" 6[# "SHIFT-TAB     ALIGN TEXT FROM CURSOR POSITION TO NEXT TAB STOP (INSERT SPACES)" b[# "RETURN        SPLIT LINE & NEW LINE" [# "SHIFT-RETURN  NEW LINE WITHOUT& SPLITTING" [# "DEL           DELETE CHARACTER & JOIN LINES" [# "ESC I         INSERT EMPTY LINE" \# "ESC D         DELETE LINE" I\# "ESC Q         DELETE FROM CURSOR TO END OF LINE" r\# "CLR           CLEAR LINE CONTENT" \# "F9/SHIFT-F9 &  SCROLL DOWN / PAGE DOWN" \# "F11/SHIFT-F11 SCROLL UP / PAGE UP" \# "ESC F9        BOTTOM OF FILE" ]# "ESC F11       TOP OF FILE" F]# "MEGA-M        MARK LINES WITH CURSOR UP/DOWN" ]# "              ESC:ABORT   C/X:COPY/CUT TO CLIPBOARD" &]# "MEGA-V        PASTE LINES FROM CLIPBOARD" ]# "MEGA-F        FIND TEXT" ]# "MEGA-N        FIND NEXT OCCURENCE" ^# "PRESS ANY KEY"; ^# K$ x^# "AUTOLOAD "(34)"TESTDRIVE.ASM"(34)"  ON TOP LEFT OF THE SCREEN (LIKE HERE)" ^# "WI&LL AUTOMATICALLY LOAD THE GIVEN FILE WHEN RUNNING MEGA ASSEMBLER." ^# "TRY IT NOW: PRESS STOP KEY, THEN TYPE RUN" "_# "_ CAN BE USED AS ALTERNATE ESC KEY" P_# "PRESS _ TWICE TO ENTER AN _ CHARACTER" _# "NOTE: QUOTATION MARKS (";(34);") CAN N&OT BE ENTERED IN THE EDITOR!" _# "USE SINGLE QUOTES (') INSTEAD" _# "MULTI-FILE SUPPORT:" '`# "CTRL-1 TO CTRL-9 MARKS THE LOADED FILE WITH THE PRESSED NUMBER" d`# "ENTER ESC 1-9 TO SWITCH QUICKLY BETWEEN MARKED FILES" `# "CTRL-0 REMOVES THE& MARK" `# "PRESS ANY KEY"; `# K$ `$ 300 `%: `&% ----- ASSEMBLER HELP ----- `0%: `:% "ASSEMBLER HELP" ?a;% "*=         SET DESTINATION ADDRESS FOR ASSEMBLY (DEFAULT=$1800)" a<% "           ADD ,'FILENAME' TO OUTPUT TO FILE INSTEAD &OF MEMORY" a=% "           (TO BE LOADED WITH BLOAD LATER)" a>% "*          VALUE OF CURRENT ASSEMBLY ADDRESS" b?% "=          ASSIGN VALUE TO SYMBOL" db@% "!          FORCES ABSOLUTE ADDRESSING (NO ZERO PAGE), E.G. LDA !$12" bA% "           OR &16 BIT BRANCH, E.G. BEQ !<LABEL>" bB% ";          COMMENT" bC% ";;         HIGHLIGHT COMMENT IN LISTING" -cD% "NUMBER LITERALS: DECIMAL, $HEXADECIMAL, %BINARY OR 'C' (CHAR)" icE% "                 PREFIX WITH - FOR NEGATIVE NUMBERS" cF% "OPERAT&ORS: PRIO 1: < =LOW BYTE   > =HIGH BYTE" cG% "           PRIO 2: * / %=MODULO &=AND .=OR :=XOR" cH% "           PRIO 3: + -" EdI% "           USE BRACKETS () AS NEEDED, MAY BE NESTED UP TO 10 LEVELS" bdL% "PRESS ANY KEY": K$ wdN% "DIRECTIVES:&" dR% ".END       END ASSEMBLY" dS% ".BASIC     'FILENAME' OUTPUTS AS BASIC PROGRAM TO GIVEN FILE" eT% "           (IS USED INSTEAD OF *=)" ReU% ".BASIC64   AS BASIC, BUT OUTPUT FOR C64 (USE TOGETHER WITH .6502)" eX% ".PRINT     PRINT ARGUMENTS& DURING ASSEMBLY (COMMA SEPARATED LIST)" eb% ".PRINTHEX  PRINT ARGUMENTS IN HEXADECIMAL" el% ".BYTE      OUTPUT ARGUMENTS AS BYTES" >fv% ".WORD      OUTPUT ARGUMENTS AS WORDS (LOW BYTE, HIGH BYTE)" fw% ".LONG      OUTPUT ARGUMENTS AS LONGS (CAUTIO& N: MAX 28 BITS!)" fx% ".TEXT      OUTPUT 'TEXT' AS BYTES" fy% ".BANK      SET DESTINATION BANK FOR ASSEMBLY (DEFAULT=128)" 6gz% ".RUN       SET RUN FLAGS, SEPARATED BY COMMA (USED BY MEGA-R)" g{% "           CLEAR=CLEAR SCREEN FIRST, WAIT=WAIT FOR&! KEY AFTER RUNNING" g|% "           AUTO=AUTORUN AFTER SUCCESSFUL ASSEMBLY" g}% ".PAUSE     PAUSE ASSEMBLY TO TAKE A LOOK AT THE LISTING" 2h% ".6502      SET TARGET TO 6502 CPU (C64 MODE)" gh% ".4510      SET TARGET TO 4510 CPU (C65 MODE)" h% &"".45GS02    SET TARGET TO 45GS02 CPU (MEGA65 MODE, DEFAULT)" h% ".LIMIT     SET MAXIMUM NUMBER OF OUTPUT BYTES" h% "PRESS ANY KEY": K$ =i% "LABELS OR SYMBOLS MUST START WITH A LETTER ON COLUMN 1" xi% "THEN MAY CONTINUE WITH A MIX OF LETTERS&# AND DIGITS" i% "GLOBAL LABELS START WITH A LETTER, E.G. 'GLABEL'." 	j% "LOCAL LABELS START WITH A DOT, E.G. '.LLABEL'. THEY ARE LOCAL WITHIN THE LAST" ^j% "SECTION THAT STARTED WITH A GLOBAL LABEL. LOCAL LABELS WITHIN OTHER SECTIONS" j% "CAN &$BE REFERENCED BY FULLY QUALIFYING THE SECTION, E.G. 'GLABEL.LLABEL'" j% "ASSEMBLY INSTRUCTIONS AND DIRECTIVES MUST NOT START ON LEFTMOST COLUMN" %k% "AT LEAST ONE SPACE IS REQUIRED" Qk% "PRESS ESC TO ABORT AN ASSEMBLY RUN" k% "TRY LOADING, A&%SSEMBLING AND RUNNING TESTDRIVE.ASM" k% "PRESS MEGA-L TO LOAD, ENTER 'TESTDRIVE' AND PRESS RETURN" l% "PRESS MEGA-A TO ASSEMBLE, THEN ANY KEY TO RETURN TO THE EDITOR" Ll% "RUN THE PROGRAM WITH MEGA-R, THEN PRESS ANY KEY" hl&"PRESS ANY KEY": &&K$ l& "USING MULTI-FILE PROJECTS" l& "YOU CAN SPLIT LARGER PROGRAMS INTO MULTIPLE FILES." m& "START EACH FILE WITH A .PROJECT 'PNAME' DIRECTIVE." 6m& "THIS WILL CREATE A PROJECT FILE 'PNAME.PRJ'" m& "YOU CAN EXPORT GLOBAL LABELS TO THE PR&'OJECT FILE USING THE EXPORT KEYWORD:" m& "EXPORT LABEL" m& "WHEN THE FILE IS ASSEMBLED, ALL EXPORTED LABELS WILL BE WRITTEN TO THE" Cn& "PROJECT FILE, WHERE THEY ARE AUTOMATICALLY IMPORTED INTO ALL ASSEMBLER FILES" kn& "THAT USE THE SAME PROJE% CT NAME." n& "BY SPLITTING THE PROJECT INTO MULTIPLE FILES, ASSEMBLY CAN BE FASTER" n& "SINCE NOT ALL FILES HAVE TO BE ASSEMBLED EACH TIME." Io& "THE BINARY FILES OF EACH PROJECT FILE ARE LOADED INTO MEMORY AUTOMATICALLY," o& "SO YOU CAN TEST'  
    MEGA ASSEMBLER   : O     WRITTEN IN 2022 BY THOMAS GRUBER (GRUBI) U ( :  2    THE ONLY PURPOSE OF THIS IS TO PROVIDE A SIMPLE ASSEMBLER FOR  <    MYSELF SINCE NO ASSEMBLER ON THE MEGA65 WAS AVAILABLE #!F    WHEN I GOT MY MEGA65 ON MAY-'11 2022. SO DON'T EXPECT TOO MUCH :-) )!P : u!Z    THIS SOFTWARE IS OPEN SOURCE. USE, MODIFY AND SHARE IT AS YOU LIKE, ![    BUT PLEASE KEEP THE REFERENCE TO ITS ORIGINAL AUTHOR. !\ : !b  100: SKIP CONTINUE LINE "c  300: TYPE GOTO99 TO CONTINUE' EDITING 
"d : 6"n  ----- INITIALIZE MEGA ASSEMBLER ----- <"x : t"} VN$"2.0.3": VERSION NUMBER (MUST BE 5 CHARS LONG) "~ TB(0)14:TB(1)22:TB(2)32: TAB POSITIONS " ML2000: MAXIMUM LINES #  L$(ML): LINES ARE STORED HERE, INDEX=LINE NUMBER, S'TARTING WITH 1 J# NL1:L$(1)"": NUMBER OF LINES, STARTING WITH ONE EMPTY LINE #              : LINES NEVER CONTAIN TRAILING SPACES # FL1: FIRST LINE DISPLAYED ON THE SCREEN # CL1: CURRENT LINE (WHERE THE CURSOR IS) 	$ CC1: CURRENT COLUMN', STARTING WITH 1 }$ SP$"                                                                                ": 80 SPACES, VERY USEFUL $ MC250: MAXIMUM CLIPBOARD LINES $  C$(MC):NC0: NUMBER OF LINES IN CLIPBOARD % M10:M20: FIRST AND LAST MAR'KED LINES, 0=NONE  % FS$"": FIND STRING 6% FI$"": FILENAME }% ID0: ID$(9),ID%(9,2): FILE NUMBER/ID, NAMES, POSITION IN EDITOR % PR$"": PROJECT NAME % DA$1800: DEFAULT ADDRESS FOR ASSEMBLY %DB128: DEFAULT BANK FOR ASSEMBLY )&	AR0:' AUTO-RUN AFTER SUCCESSFUL ASSEMBLY, 1=ONCE 2=ALWAYS T&
IG0: IGNORE MODE FOR UNKNOWN SYMBOLS }&AS1:MF0: AUTOSAVE / FILE MODIFIED & 7400: AL$""  5900: AUTOLOAD &,: &6  ----- DISPLAY MAIN SCREEN AND ENTER EDITOR ----- &@: 'E $:' WHOLE EDITOR NEEDS TO RUN WITH KEY OFF %'I ""; 'J "LINE    COL                                        PRESS HELP   MA V";VN$;""; 'O FI$""   "";21);FI$;""; 'Q 360 'T 400: DISPLAY CONTENT '^ 1000: GO TO EDITOR (h S'	UB DISPLAY INDICATORS IN STATUS LINE 6(i ID  I$((ID),1): I$" " N(j "";39);I$;""; k(k AS  I$"AS": I$"  " (l "";43);I$;""; (m IG  I$"IGNORE": I$"      " (n "";48);I$;""; (o MF  I$"*": I$" " (p "";20);I$'
;""; (q (: ,) SUB ----- DISPLAY EDITOR CONTENT ----- 2): >) ""; M) X0  23 |)    FLXM1  FLXM2   "";:  ""; )    FLXNL    L$(FLX);(SP$,79(L$(FLX))); )   :  (SP$,79); )    X23   ) X )' ): ,* SUB ----- DISPLAY CURSOR & LINE/COL NUMBERS ----- 2*: T* "";((10000CL),4); x* "";((100CC),2);""; *&A ,CC1,CLFL1,0 *0 *: * ----- MAIN EDIT LOOP ----- *: * AA  AA0:AR1:K$"": 1045: A'UTO ASSEMBLE+RUN + 500: SHOW CURSOR + K$ .+A $:K(K$) I+ K$"_"  K27  1500 j+$ K20   7600: 3200: DEL +. K$""  3400: CURSOR RIGHT +8 K$""  3500: CURSOR LEFT +B K$""  3600: HOME +L K$"	"  3700: TAB ,V' K$""   7600: 3760: SHIFT-TAB (, K$""  2500: EXIT K, K$""  K132  2000: HELP o, K13   7600: 3800: RETURN , K141   7600: 4000: SHIFT-RETURN , K$""  4100: CURSOR DOWN , K$""  4200: CURSOR UP , K$'""   7600: 4300: CLR - K16  4580: F9 3- K21  4500: SHIFT-F9 K-  K22  4470: F11 i- K23  4400: SHIFT-F11 - K$""  5000: MEGA-M - K$""   7600: 5400: MEGA-V -( K$""  5500: MEGA-F -2 K$""  5560: MEGA'-N .< K$""  5700: MEGA-S  .F K$""  5900: MEGA-L N.P K34  1030: NO QUOTATION MARK ALLOWED l.Z K$""  10100: MEGA-A .d K$""  6100: MEGA-R .e K$""  6200: MEGA-D .f K$""  6400: MEGA-I .gI("",K$): I ' 6600: CTRL-1 TO CTRL-9 /h K$""  6800: MEGA-* U/x (K32  K94)  (K193  K218)  3000: ENTER CHAR `/ 1030 f/: / ----- HANDLE KEYBOARD COMMAND (ESC SEQUENCE) ----- /: /A ,CC1,CLFL1,1 / K$:K(K$) /A $,0,0,0 '/ K16  4700: ESC F9 0" K22  4600: ESC F11 ;0' K$"I"   7600: 4900: ESC I `0, K$"D"   7600: 4800: ESC D 06 K$"Q"   7600: 6300: ESC Q 0@ K$"_"  3000 0J K$"N"  6500: ESC N 0T K$"1"  K$"9"  6700: ESC 1-9' 0 1000 0: 1 ----- DISPLAY HELP ----- 1: !1 ""; h1 "" 1 "              MEGA ASSEMBLER               " 1 "     WRITTEN IN 202'2 BY THOMAS GRUBER      " =2 "                                           " 2  "   KEYBOARD COMMANDS:                      " 2* "     MEGA-X EXIT       MEGA-D DIR *.ASM    " 3+ "'     MEGA-L LOAD       MEGA-S SAVE         " Y3, "     MEGA-A ASSEMBLE   MEGA-R RUN          " 3- "     MEGA-* AUTOSAVE   ESC  N NEW FILE     " 3. "                              '             " .4/ "     MEGA-I TOGGLE IGNORE MODE             " u40 "            (IGNORE UNKNOWN SYMBOLS)       " 44 "                                           " 55 "'   PRESS FOR DETAILED HELP:                " J56 "     E: EDITOR FUNCTIONS                   " 57 "     A: ASSEMBLER DIRECTIVES               " 5> "                                         '  " 6H "          ANY OTHER KEY TO CLOSE           " f6R "" p6 K$ 6	 K$"E"  9100 6	 K$"A"  9500 6	 300 6	: 6	 ----- EXIT MEGA ASSEMBLER ----- 6'	: 6	 "EXITING MEGA ASSEMBLER" 07	 MF  (AS0  FI$"")   "WARNING: UNSAVED CHANGES" ;7	 7700 o7	 "TYPE CONT OR GOTO99 TO RETURN TO THE EDITOR" ~7	 128:  7	 7 
 300 7: 7 ----- ENTER CHARACTER K$ INTO CURRENT LINE ----- 7': 7 7600 7 (L$(CL))79  3040 
8 CC79  1000 28L$(L$(CL),78)K$: 7100:L$(CL)L$ =8 3100 r8 K$" "  (L$(CL))CC  CC79  CCCC1: 1000 8L$(L$(CL),CC1):L$L$(SP$,CC1(L$)) 8L$(CL)L$K$(L$(CL),CC) 8 CC79  C'CCC1 8: 9& ----- PRINT CURRENT LINE TO SCREEN AND GO TO EDIT LOOP ----- #90: 99:A $,0,CLFL1,0 [9D L$(CL);(SP$,79(L$(CL))); f9N 1000 l9: 9 ----- DEL ----- 9: 9 CC1  3290 9 CC(L$(CL))1  CCCC1: 1000 9 CC('L$(CL))1   :   L$(L$(CL),(L$(CL))1): 7100:L$(CL)L$ 7:: L$(CL)(L$(CL),CC2)(L$(CL),CC) J:CCCC1: 3100 \: CL1  1000 : (L$(CL1))(L$(CL))79  1000 :CC(L$(CL1))1:L$(CL1)L$(CL1)L$(CL) :CLCL1: CLFL  FL'CL : XCL1  NL1:L$(X)L$(X1): X ;L$(NL)"":NLNL1 ; 400: 1000 ;H: >;R ----- CURSOR RIGHT ----- D;\: W;f CC79  3450 j;pCCCC1: 1000 };z CLNL  1000 ;CC1: 4100 ;: ; ----- CURSOR LEFT ----- ;: ; CC1  355'0 ;CCCC1: 1000 ; CL1  1000 ;CC79: 4200 <: < ----- HOME ----- "<$: <<. CC1  CC1: 1000 _<8CC(L$(CL))1: CC79  CC79 j<B 1000 p<t: <~ ----- TAB ----- <: <I0 < TB(I)0  CC1: 1000 < CCTB(I)  II'1: 3735 <CCTB(I): 1000 <: $= ----- SHIFT-TAB: INSERT SPACES TO NEXT TAB POS ----- *=: H=I0: CC(L$(CL))  1000 ]= TB(I)0  1000 |= CCTB(I)  II1: 3766 =CTB(I) = CCC  1000 = (L$(CL),CC,1)" "  CCCC1: 377'3 = CCC  1000 >ICCCC: (L$(CL))IC79  IC79(L$(CL)) 9>L$(CL)(L$(CL),CC1)(SP$,IC)(L$(CL),CC) M>CCCCIC: 3100 S>: l> ----- RETURN ----- r>: > NLML  1000 > R$(L$(CL),CC):L$(L$(CL),CC1): 7100:L$(CL)L$:L$R$'  >S1:  (L$(CL),S,1)" ":SS1: >
 CLNL  3900 3?NLNL1:L$(NL)L$:CLCL1:CCS: CLFL23  FLFL1 D? 400: 1000 m?< XNL  CL1  1:L$(X1)L$(X): X ?FNLNL1:CLCL1:L$(CL)L$:CCS ?P CLFL23  FLFL1 ?Z 400: 1000 ?:'! ? ----- SHIFT-RETURN ----- ?: ? NLML  1000 	@L$"": 3845 @: -@ ----- CURSOR DOWN ----- 3@: F@" CLNL  1000 m@,CLCL1: CLFL23  FLFL1: 400 x@6 1000 ~@h: @r ----- CURSOR UP ----- @|: @ CL1  1000 @CLCL1'": CLFL  FLCL: 400 @ 1000 @: @ ----- CLR ----- A: AL$(CL)"":CC1: 3100 !A0: AA: ----- F12 (PAGE UP) ----- GAD: bANCLCL23: CL1  CL1 tAX FL1  1000 AbFLFL23: FL1  FL1 Al 400: 1000 Av: Aw ----- F11 (SCRO'#LL UP) ----- Ax: Ay FL1  FLFL1:CLCL1: 400 Az 1000 B: $B ----- F10 (PAGE DOWN) ----- *B: GBCLCL23: CLNL  CLNL ]B NLFL24  1000 BL23: LNLFL23  LNLFL23 BFLFLL B 400: 1000 B: B ----- F9 (SCROLL'$ DOWN) ----- B: B CLNL  FLFL1:CLCL1: 400 B 1000 C: -C ----- ESC F11: GOTO TOP OF FILE ----- 3C: JCCL1: FL1  1000 `C FL1: 400: 1000 fC\: Cf ----- ESC F9: GOTO BOTTOM OF FILE ----- Cp: CzCLNL: CLFL24  1000 '%CFLNL23: 400: 1000 C: C ----- ESC DEL: DELETE LINE ----- D: "D CLNL  L$(CL)"": 3100 FD XCL  NL1:L$(X)L$(X1): X \DL$(NL)"":NLNL1 mD 400: 1000 sD$: D. ----- INST: INSERT LINE ----- D8: DB NLML  1000 DL'& XNL  CL  1:L$(X1)L$(X): X DVNLNL1:L$(CL)"" D` 400: 1000 E: )E ----- MEGA-M: MARK LINES ----- /E: EEM1CL:M2CL: 400 WE K$:K(K$) E K$"_"  K27  M10:M20: 400: 1000 E K$""  5110 E K$""  5160 E K''$"C"  5210 E K$"X"  5240 E 5040 E CURSOR DOWN F  CLNL  5040 &F CL1M2  M2M12MC  5040 GF
CLCL1: CLFL23  FLFL1 cF CLM2  M2CL: M1CL tF 400: 5040 F( CURSOR UP F2 CL1  5040 F7 CL1M1  M2M12MC &  5040 F<CLCL1: CLFL  FLCL FF CLM1  M1CL: M2CL GP 400: 5040 GZ COPY TO CLIPBOARD GGd XM1  M2:C$(XM11)L$(X)::NCM2M11 nGi NCMC   XNC1  MC:C$(X)"": GnM10:M20: 400: 1000 Gx CUT TO CLIPBOARD G} 7600 G(D SILENT ENIGMA3D                                                                                                                                                                                                                                   (D@                                                                                                                                                                                                                                                 D@                                                                                               !((((((((((((((((((((((((($BASLOGO.EL         3   	GRABBER.EL.BAK         X   LINE.EL.BAK         !   )11.DEFAULTS            )"11.EDIT         V   %PETLINE.EL.BAK         #   LINE.EL         !   -11.POST          ()11.TOKENIZE            -11.SETTINGS            )POST            ) B65SUPPORT.BIN            , MEGAPLOT            ' MEGA ASSEMBLER            BAGLOGO.BAK         2   ) ROTATE.ASM          (Z.L            "ROTATE.EL            SPRITELINE.EL            !MELODY.EL            .VART.EL         I    GRABBER.EL         X   -#FOOT.EL            "!ANA.LN         	 (.ENIGMA.P            "ASMROTATE            PLAYMAKER         ?   VART         "   11BOOT.C65            BAS.BIN         !   BAS.DAT            GRABBER          (4ASMHELPER            $PETLINE.EL         #    MELODY.EL.BAK            
WRITER.EL.BAK            STARFIELD.EL         +   S.L            6SILENT.L         "   "SPRITELINE.E.BAK          (	 BIGSPRITE.EL            ABC.LN            XANADU.EL         V   	WRITER.EL             SPRITELINE            ROTATE.EL.BAK            XANADU.EL.BAK         V   AUTOBOOT.C65          (
 LINE             11TEMP           $ROTATE            11.PARSE         ;   7	STARFIELD            5PETLINE            5 WRITER            6BASLOGO            8 PETLINE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         )"; ROTATE - ASSEMBLY VERSION""; 17/04/2024 - GURCE""""; ASSEMBLE WITH MEGA-A, THEN RUN WITH MEGA-R""""; IT WILL BUILD A FILE 'ASMROTATE' ON YOUR DISK""""; LOAD IT WITH BLOAD 'ASMROTATE',B0""""; RUN IT WITH BANK 0:SYS $1800""""ZPTR32 = $FC""")"    *=$1800,'ASMROTATE'"".PAUSE""    ; BACKUP ZPTR32""      LDA ZPTR32""      STA ZBKP""      LDA ZPTR32+1""      STA ZBKP+1""      LDA ZPTR32+2""      STA ZBKP+2""      LDA ZPTR32+3""      STA ZBKP+3""""    ; INIT""      LDA #$00""      S)TA Y1ADD""      STA Y1ADD+1""""    ; FOR Y = 0 TO 49""      LDY #$00""""        ; CX = TX""LP1       LDA TX""          STA CX""          LDA TX+1""          STA CX+1""          LDA TX+2""          STA CX+2""          LDA #$00""          STA) TX+3""          STA CX+3""""        ; CY = TY""          LDA TY""          STA CY""          LDA TY+1""          STA CY+1""          LDA TY+2""          STA CY+2""          LDA #$00""          STA TY+3""          STA CY+3""""        ; FOR )X = 0 TO 79""          LDX #$00""""            ; POKE $FF80000 + X + Y1ADD, PEEK($40000 + CX/256 + CY/256 * 96)""                ; PUT $40000 IN ZPTR32""LP2               LDA #$00""                  STA ZPTR32""                  STA ZPTR32+1""   )               STA ZPTR32+3""                  LDA #$04""                  STA ZPTR32+2""""                ; ADD CX HIGH BYTE INTO ZPTR32""                  LDA CX+2""                  CLC""                  ADC ZPTR32""                  STA ZPTR)32""                  LDA #$00""                  ADC ZPTR32+1""                  STA ZPTR32+1""""                ; PUT HIGH WORD OF CY INTO TMPW1 AND LEFT-SHIFT 5 TIMES""                  CLC""                  LDA #$00""                  STA TM)PW1""                  STA TMPW1+1""                  LDA CY+2""                  STA TMPW1+2""                  LDA CY+3""                  STA TMPW1+3""""                  LDZ #$05"".SHIFTLOOP""                  ASW TMPW1""                  B)	CS .NXTCARRY1""                  ASW TMPW1+2""                  JMP .NXT"".NXTCARRY1""                  ASW TMPW1+2""                  INC TMPW1+2"".NXT""                  DEZ""                  BNE .SHIFTLOOP""""                ; STORE THIS SH)
IFTED VALUE INTO TMPW2""                  LDA TMPW1""                  STA TMPW2""                  LDA TMPW1+1""                  STA TMPW2+1""                  LDA TMPW1+2""                  STA TMPW2+2""                  LDA TMPW1+3""         )         STA TMPW2+3""""                ; ADD IT TO TMPW1 2 TIMES (TO GET MULTIPLE OF 96)""                  LDZ #$02""""LP3               CLC""                  LDA TMPW2""                  ADC TMPW1""                  STA TMPW1""              )    LDA TMPW2+1""                  ADC TMPW1+1""                  STA TMPW1+1""                  LDA TMPW2+2""                  ADC TMPW1+2""                  STA TMPW1+2""                  LDA TMPW2+3""                  ADC TMPW1+3""            )      STA TMPW1+3""""                  DEZ""                  BNE LP3""""                ; THEN ADD INTEGRAL PART OF TMPW1 (HIGH WORD) TO ZPTR32""                  CLC""                  LDA TMPW1+2""                  ADC ZPTR32""               )   STA ZPTR32""                  LDA TMPW1+3""                  ADC ZPTR32+1""                  STA ZPTR32+1""                  LDA #$00""                  ADC ZPTR32+2""                  STA ZPTR32+2""""                ; PERFORM THE PEEK AND STO)RE IT IN PEEKVAL""                  LDZ #$00""                  LDA [ZPTR32],Z""                  STA PEEKVAL""""                ; PUT $FF80000 INTO ZPTR32""                  LDA #$00""                  STA ZPTR32""                  STA ZPTR32+1")"                  LDA #$F8""                  STA ZPTR32+2""                  LDA #$0F""                  STA ZPTR32+3""""                ; ADD X TO ZPTR32""                  TXA""                  CLC""                  ADC ZPTR32""          )        STA ZPTR32""                  LDA #$00""                  ADC ZPTR32+1""                  STA ZPTR32+1""""                ; ADD Y1ADD TO ZPTR32""                  CLC""                  LDA Y1ADD""                  ADC ZPTR32""          )        STA ZPTR32""                  LDA Y1ADD+1""                  ADC ZPTR32+1""                  STA ZPTR32+1""""                ; POKE THIS ZPTR32 LOCATION WITH PEEKVAL""                  LDZ #$00""                  LDA PEEKVAL""            )      STA [ZPTR32],Z""""            ; CX = CX + XINC""              CLC""              LDA XINC""              ADC CX""              STA CX""              LDA XINC+1""              ADC CX+1""              STA CX+1""              LDA XINC+2""  )            ADC CX+2""              STA CX+2""              LDA XINC+3""              ADC CX+3""              STA CX+3""""            ; CY = CY + YINC""              CLC""              LDA YINC""              ADC CY""              STA CY""    )          LDA YINC+1""              ADC CY+1""              STA CY+1""              LDA YINC+2""              ADC CY+2""              STA CY+2""              LDA YINC+3""              ADC CY+3""              STA CY+3""""        ; NEXT X""     )   INX""        CPX #80""        BNE !LP2""""        ; TX = TX + TXINC""          CLC""          LDA TXINC""          ADC TX""          STA TX""          LDA TXINC+1""          ADC TX+1""          STA TX+1""          LDA TXINC+2""          A)DC TX+2""          STA TX+2""          LDA TXINC+3""          ADC TX+3""          STA TX+3""""        ; TY = TY + TYINC""          CLC""          LDA TYINC""          ADC TY""          STA TY""          LDA TYINC+1""          ADC TY+1""     )     STA TY+1""          LDA TYINC+2""          ADC TY+2""          STA TY+2""          LDA TYINC+3""          ADC TY+3""          STA TY+3""""        ; Y1ADD = Y1ADD + 80""          CLC""          LDA #80""          ADC Y1ADD""          STA )Y1ADD""          LDA #$00""          ADC Y1ADD+1""          STA Y1ADD+1""""    INY""    CPY #50""    BNE !LP1""""    ; RESTORE ZPTR32""    LDA ZBKP""    STA ZPTR32""    LDA ZBKP+1""    STA ZPTR32+1""    LDA ZBKP+2""    STA ZPTR32+2""    L)DA ZBKP+3""    STA ZPTR32+3""""    CLI""    RTS""""""    *=$1A00""TX           .LONG 0""TY           .LONG 0""XINC         .LONG 0""YINC         .LONG 0""TXINC        .LONG 0""TYINC        .LONG 0""""Y1ADD        .WORD 0""CX           .LO |NG 0""CY           .LONG 0""ZBKP         .LONG 0""PEEKVAL      .BYTE 0""TMPW1        .LONG 0""TMPW2        .LONG 0"*                                                                                                                                     SK 	       BASLOGO.EL L                    LINE                                                                                                                                                                                                        ) -  }128: X05:A$:("1600")X,(A$):X S } 248,0 :  RESTORE ROW LINK MODE  }: "PASS 3: TOKENIZING":""(27)"T"""(27)"B";  } 1,1,5,"11TEMP,S,R":("1600") :  STDIN = 11TEMP  } FILL KEYBOARD BUFFER !!}208,4: 688,("R ?"):689,("U"):690,("N"): 691,13 9!} A2,01,20,C6,FF,60                                                                                                                                                                                                   ) ! T$ "B65SUPPORT.BIN": $1600 3 ^$F$"HELLO.EL" ] h$L$"/FILE:"F$: 9450: POST FILENAME k r$#2,(F$) u |$L$""  $#2,C$  $L$L$C$  $ (L$)128   9450: POST CHUNK  $ N$;  $  ST  64  9350  $#2 !$ (L$)0   9450: POST R EMAINING CHUNK D!$ 9450: POST EMPTY CHUNK TO DECLARE WE'VE FINISHED ^!$ "FINISHED POSTING!" d!$ }!$ *** POST CHUNK *** !$L$((L$)1)  L$: PREPEND THE LENGTH OF STRING+1 !$A("/"L$) !% "POSTING CHUNK..." !%L$"" !%              )! G/ЩS/Т< }MEGA65 UNIT TEST SUPPORT INSTALLED `  fg  L ded 겱=/'cP(F/D6l    L  L L L   `H    h `c
겱 L\ `C `                                                                                                                                                                                                                                                           )# 8   LL0:LZ0:XZ0:130: BUFFER OF PAST LINE LOCATION e  A$(A$,XI):B(A$):OB80:"";:OB79   P
(A$):0:M(P1)256(P2):CMB1:B06    IV1   "";   1:AMC:ZA(A):A$(ZA);: IV1  ZA34   ""; ! :128:O9 HL:7)$9);"$";:9 FG !  !d : =!n  --- GENERAL INITIALIZATIONS --- C!x : M! 8560 V! 4  !  0,65             :  M65 FAST MODE ! 7940:  INSTALL M/L ! PF$"11.EDIT" "  7,"SCRATCH "(34)PF$(34)":DSAVE"(34)PF$(34)":DVERIFY"(34)PF$)%(34) 3"  	(2)80  (27)"X";: FORCE 80COLS MODE M" 7040: READ DEFAULTS z" ; BG: < BO: 9 FG : ""(27)"M"; " 5490:" EE V0.5.0"; "  10500           :  ENABLE RAW FN KEYS " : " MX2000               :  MAX NUMBER OF LINES)& $# ES%0                 :  ESCAPE FLAG # T$"                                                                               ":BL$T$T$T$:T$"" # Q$(34)           :  FAST ACCESS TO QUOTE CHAR #FO$(27)(27) :  ESCAPE FLASH ETC. 8$CC$)'""(22)(20)(148)(13) :  CTRL CHARS r$HM$""(20)     :  HORIZONTAL MOVEMENT CHARACTERS $"CH$(0)" ":CH$(1)"*" :  FOR FILE CHANGED INDICATOR $,CM$(0)"    ":        :  FOR CONTROL CHAR MODE INDICATOR  %6CM$(1)"* CTRL"FO$ @%@R$(1)"SUCCESS: ":R$(0)"ERROR: " :  DISC OPERATION RESULT %JCO(1)SB:CO(0)HL                 :  DISC OPERATION RESULT COLORS %TDF$"11.DEFAULTS"                 :  DEFAULTS FILE NAME %^ LI$(MX)           :  LINE BUFFER &c C*B$(100)        :  CLIPBOARD OF LINES P&h MK$(72),MK(72),FI$(72),FI(72)   :  MARKER TABLE s&rEE$(0)"VARIABLE NOT DECLARED" y&: & --- BUILD CHAR TRANSLATION TABLE --- &: & A$(255)           :  CHAR TRANSLATION TABLE 'A131:A$(A)"*"(64A)"":A$(128A)""(192A)"":A L'A32127:A$(A)(A):A$(A128)(A128):A a'A$(34)(34)FO$ 'A$(160)"" :  MAKE SHIFT+SPACE VISIBLE ': ': 'XI1 :  HORIZONTAL SCROLL INDEX IN CURRENT LINE ' 128 ( 248,(248)26 *   :  DISABLE SCREEN EDITOR LINE LINKING W(&XC0:YC0:SL	(1)2 :  CURSOR POS, STATUS LINE POSITION i(0 CF$""  (5   ($4FF70)55  ($4FF71)77   (6     9100 (7  :  (:    5010:  LOAD FILE IF SET )<     9000:  KEEP COPY *OF FILE IN ATTIC RAM )?     $4FF70,55,77 _)D     DE0 CF$"" :  DELETE CURRENT FILENAME IF FILE NOT THERE h)I   o)N u)X: )b UNCOMMENT THIS FOR OUTPUT PERFORMANCE TEST )l TS=TI:FORTE=0TO10:GOSUB2080:NEXTTE:PRINT""TI-TS:STOP )v: **5150:  REDRAW SCREEN #*5540:  BUILD STATUS BAR )*: F* ********************** c* ** MAIN EDITOR LOOP ** * ********************** *: *128:V4 :  ENABLE VIC IV * JL1  *  LYJL:CL5:6600:  BRING LINE IN CONTEXT  +*    ($4FF30)0  ?+*    R0:PE$""::P($4FF30R):PE$PE$(P):RR1:  P0 ^+>     5490: "";PE$;:NS1 q+C     $4FF30,0 z+H   +R  JY1:CL0             :  CLEAR JUMP LINE +\ +f +p   YCCT0 CT0:YC0 ,z   NS1 PO$"*      "((XC),2)":"((YC),2):5400 ',  CL$LI$(YC) P,    (YCCT)	(1)1  YCCT	(1)1 b,  A XC,YCCT ,  9 SB:A :  T$ : A $:9 FG ,   MF1   10050: 2160: MARK-MODE HANDLING ,   NS1 5540: 128:V4: NS0 - *  128:AK  (54801)  16 :  CHECK ALT KEY E-   -- IF T$=F11 (ALSO CTRL+5/GREEN FOR XEMU?) x-   T$""  (AK  T$"C") CM(CM1) : 2170 -    CO((CC$,T$)  CM0)  AK -    CO  -     T$"G" T$"" :  WORKAROUND FOR CHALLENGED K*	EYBOARDS .     T$"S" T$"" 6.     T$(13) CH1: 5650:  INSERT RETURN W.     (HM$,T$)0  XI1  .       XI1:A 0,YCCT:CL$LI$(YC):A$CL$:1 .	        T$(13) A 0,YCCT1:A$LI$(YC1):1 .	     .	     T$""   9510:*
 CTRL-W = NEXT WORD )/	     T$""   9700: CTRL-U = PREVIOUS WORD e/	     T$""   9900: SHIFT-DEL = DELETE CURRENT CHAR /	     T$""   $4FF07,($4FF07)  8: ($4FF07)8   "T0O5SG" /	     T$"P" 9300: POST CURRENT FILE TO PC 0*	     T$"Z" 11000: NAVIGATE TO LABEL UNDER CURSOR @0	     T$"F"  FR%0 : 8000:  FIND u0$	     T$"R"  FR%1 : 8000:  FIND AND REPLACE 0.	     T$"" 5990:  SAVE 08	     T$"" SA1:5990:  SAVE AS 0B	     T$"" 6260:  LOAD *0L	     T$"" 7360:  STOP 1V	     T$"" 7230:  NEW >1`	     T$"" 7430:  LABELS c1j	     T$"" 6710:  GOTO LINE 1o	     T$"" 10700:  GO TO PREVIOUS FILE (PV$) 1t	     T$"" 6790:  HELP 2y	     T$""  TMYC:YCLL:LL*TM: TMCT:CTLZ:LZTM: TMXC:XCXZ:XZTM: 5150 72~	     T$""            :  HOME/END l2	       AK0 LY0:XC0:6600: LYNL:XC0:6600 w2	     2	     T$""  :  -------- CURSOR RIGHT 2	       AK  2	          79XI(CL$) XI*XI1:A0,YCCT:A$CL$:1 
3	       : XCXC1  3	       XC79  J3	        XC79: XCXI(CL$) XIXI1 k3	        A 0,YCCT:A$CL$:1 x3	       3	     3	     T$""  3 
       XC0 XCXC1 : Ջ YC0 YCYC1:XC(LI$(YC)): XC*79 XC79 3

     4
     T$""  *4
       AK LYYCSL:6600:YCYC1 ]4(
       YCCTSL3 5250:  YCCTSL YCYC1 h42
     }4<
     T$""  4F
       AK LYYCSL:6600:YCYC1 4P
       YCCT0 5330:  YCCT0 YCYC1 *4Z
     5d
     T$"" 7790:  --- F5 - COMPILE +5n
     T$(20) : DELETE :5x
      CH1 t5
       XC0  AK 5840: :  MERGE WITH LAST LINE 5
      CL$(CL$,XCXI2)(CL$,XCXI) 5
      LI$(YC)CL$ 5
      A 0,YCCT:A$CL$:1:*(CL$)79" "; 5
       XC0 XCXC1 
6
     6
   B6
   T$""  :  --- F14 - SAVE DEFAULTS i6
    5490:"SAVING DEFAULTS..."; 6
     (DF$): (DF$),B(4),P(("FF00"))  P(("FF80")) 6
    DEDS : DE$DS$ 6
    9 CO((DE0))* 7
    5490: "";R$((DE0));DE$;" ";:9 SB 7
    NS1 7   K7: : T$(27)  :  -- CHECK ESCAPE FLAG o7  T$"": ES%0  ES%1: ES%0 7: : ES%1   :  -- CHECK ESCAPE CHARACTERS 7   T$"K"  XC(CL$): XC78  XI*XC78:XC78: 9970 8   T$"J"  XC0: XI1  XI1: 9970 /8   T$"D"  AK1: 5840:CH1 X8   T$"M"  MF1:MSYC:MEYC: 9970 q8   T$"P"   10200 }8  ES%0 8: :  -- INSERT CHAR 8    CH1 8"     XC79 XIXI1 9,      *(CL$)XC:CL$CL$" "::  FILL UP SPACES IF NEEDED ,96    CL$(CL$,XCXI1)T$(CL$,XCXI) @9@    LI$(YC)CL$ ]9J    A 0,YCCT:A$CL$:1 ~9T    XCXC1 :  XC79 XC79 9^  : ENDIF ES%=1 9`  : ENDIF T$=CHR$(27) 9b  : ENDIF CO (CTRL*-CHAR) 9h  QU1 9r 9|: (: ==================== SUBROUTINES ===================== =: --- READ IN F$ b: 1,1,5,CF$",S,R":DEDS:DE$DS$ }: DE0 CF$OF$: 1: :A0MX:LI$(A)"":A:LC0 :NL0:CT0:YC0:XC0 : :  L$"": 1*,L$ :  LI$(NL)L$ :  NLNL1 :  ST0 
;NLNL1:CH0 ;  1 ;
 ;: 7; ---  REDRAW SCREEN J;(9 FG :  ""; [;2 CT0 CT0 j;< I0  SL w;F  A 0,I ;P  A$LI$(CTI) ;Z   (27)"Q";:ZYYC:YCCTI:10000:YCZY:1 ;d I ;n* ;x: ; --- SCROLL UP ; CTSLNL1  <CTCT1 :  CURRENT TOP %<S$LI$(CTSL) =<A 0,0: (27)"V"; R<A 0,SL:A$S$:1 X< ^<: t< --- SCROLL DOWN < CT0  <CTCT1 <S$LI$(CT) <A0,0: (27)"W";:A$S$:1 < *<: < --- DISPLAY STATUS IN ST$ <"9 SB =,"";:A 20,SL1:""PO$; -=6A 75,SL1:CM$(CM); M=@A 0,SL1:""CH$(CH)""; ^=J 0,0,79,SL h=T9 FG n=^ t=h: =r 	(1)25  CB2048(2480) : FB$FF80000  (2480) =t 	(1)50  CB$4*0800(4980) : FB$FF80000  (4980) >w! 3,80,160,CB       :   --- CLEAR STATUS BAR O>|! 3,80,SB,FB        :   SET STATUS BAR COLOUR d>"";:A 0,SL1 n>9 SB t> > --- CLEAR STATUS > 5490 >"";:A 18,SL1:"        F1LOAD* F3SAVE F5COMPILE F7LBLS F9GO F11CMODE "; '?A 2,SL1: CF$""  CF$;:ՙ "<UNTITLED>"; 8? 0,0,79,SL B?9 FG H? N?: f? --- INSERT RETURN r?YCYC1 ~?NLNL1 ?& YCNL NLYC ?0ANL1YC11:LI$(A)LI$(A1):A:LI$(YC)*"" ?:LI$(YC)(LI$(YC1),XCXI) @DLI$(YC1)(LI$(YC1),XCXI1) !@NXC0:SC1:PL$LI$(YC1) L@X  (PL$,SC,1)" " :  --- AUTOINDENT u@b   LI$(YC)"" LI$(YC)" "LI$(YC) @l  SCSC1:XCXC1 @v @ YCCTSL 5250:  SCROLL UP @A XC*,YCCT: (27)"I"; @A$LI$(YC):1 AA XCSC1,YCCT1: (27)"Q"; AA$LI$(YC1):1 !A 'A: =A --- MERGE LINES RA AK0  YC1  vA AK SXXC:XC0:YCYC1: 5880 AYCYC1:XC(LI$(YC)) ALI$(YC)LI$(YC)LI$(YC1) AAYC1N*L1:LI$(A)LI$(A1):A A YCNL LI$(NL)"" A NL0 NLNL1 B: +B  AK0  A 0,YCCT:A$LI$(YC):1 HB*A 0,YCCT1:(27)"D"; eB4A 0,SL:A$LI$(CTSL):1 B> CTSLNL1 A 0,SL: (27)"Q"; BH AK XCSX:YCYC1 BR B\: Bf ---* SAVE FILE Bp BU  CF$""  SA0  
Cz  5490:"BACKING UP OLD FILE..."; $C  B$(CF$,12)".BAK" 1C   (B$) FC   (CF$)  (B$) MC zC CF$""  SA1 SA0 : 6520:  SAVE AS C CF$"" 5540:  C5490:"SAVING..."; C (CF$) *CIMX:  LI$(I)"":II1: CNLI D 1,1,3,CF$",S,W":DEDS:DE$DS$ D A0  NL "D  1,LI$(A) *D A >D DS0  DEDS FD 1 PD5490 aD$ DE0 CH0 tD.9 CO((DE0)) D8 R$((DE0));DE$;" ";:9 SB DB7720:  SAVE FILENAME IN MA* ILBOX RAM DLNS1 DV D`: Dj: Dt --- LOAD FILE D~5490 EOF$CF$ E CH1  \E   "CURRENT FILE "CF$" NOT SAVED. REALLY PROCEED? (Y/N) "FO$; yE  : T$:  ("YN",T$) E  5490 E   T$"N" 5540: E E5490: "L*!OAD FILE NAME ($ FOR DIRECTORY, RETURN TO CANCEL) "(27)"T"; ENF$"" F  "";NF$ 0F (NF$)0  (NF$,1)"$"   SF  0,0,79,SL :  ""; : 9 FG qF   (NF$)  1   :   F     ((NF$,2)) F   F   6350 F F"";:54*"90 F  NF$"" 5540:5150: G
PV$CF$:PVYC:CF$NF$: "LOADING "CF$"..."; G5010 G""FO$; 8G(5150:  REDRAW SCREEN ^G2 DE0 7720:  PERSIST FILENAME wG<5490:9 CO((DE0)) GF "";CF$;" - ";R$((DE0));DE$;" ";:9 SB GP DE*#0 "; READ ";NL; "LINES."; GZNS1 Gd Gn:  Hx --- QUERY SAVE FILE NAME >H5490: "SAVE FILE NAME (RETURN TO CANCEL) "(27)"T"; IHNF$"" XH  "";NF$ iH"";:5490 uHCF$NF$ {H H: H --- ENSURE LY IS AT SANE POSITION END *$H     MAKE LINE LY THE CURRENT LINE H IF LY>NL-SL THEN LY=NL-SL ICTLY :YCLY I CTCL CTCTCL &I6690 7I CT0 CT0 HI YC0 YC0 hI YCNL YCNL : CTYCSL3 I CTCL CTCTCL :  CONTEXT LINES I CT0 CT0 I"5150 *%I, I6 --- QUERY LINE NO J@5490: "JUMP TO LINE # (RETURN TO CANCEL) "(27)"T"; JJNN$"":  NN$ 5JTNN(NN$):"";:5490 DJ^ NNNL  YJhLYNN:CL8:6600 cJr5540 iJ| xJ --- HELP J"-- CURSOR MOVEMENT --",,"-- EDITOR FUNCT*&IONS --" J"CURSOR KEYS   MOVE THE CURSOR" K"ALT + UP      SCROLL UP 1 PAGE" ,K"ALT + DOWN    SCROLL DOWN 1 PAGE" YK"ALT + LEFT   SCROLL LEFT 1 CHAR(*)" K"ALT + RIGHT   SCROLL RIGHT 1 CHAR(*)" K"SHIFT + CLR   GO TO TOP*' OF FILE" K"ALT + CLR     GO TO END OF FILE" L"ALT + DELETE  DELETE CURRENT LINE" 4L"ALT + RETURN  TO START OF NEXT LINE" QL"ALT + F       FIND" wL"ALT + R       FIND & REPLACE" L"ALT + Z       GO TO LABEL UNDER CURSOR+ " L"*) ONLY IN LINES WITH >80 CHARACTERS" L"#) XEMU-EQUIVALENT SHORTCUT KEY" M"",,,," F1  LOAD FILE" :M,,,," F2  NEW FILE" VM,,,," F3  SAVE FILE" uM,,,," F4  SAVE FILE AS" M&,,,," F5  COMPILE + RUN" M0,,,," F+6  JUST COMPILE" M:,,,," F7  GO TO LABEL" M?,,,," F8  GO TO PREVIOUS FILE" ,ND,,,," F9  GO TO LINE NR     (#)CTRL + P" XNF,,,,"CTRL-O JUMP TO LOC PRIOR TO F7" NN,,,,"F11  TOGGLE CTRL MODE  (#)CTRL + 5" NX,,,,"F14  UPDA+TE DEFAULTS   (#)CTRL + Z" Nb,,,,"HELP THIS SCREEN       (#)PAGEUP" 	Og 10550 :  MORE HELP MOl5490:"EE CHEAT SHEET -- PRESS ANY KEY TO RETURN TO EDITOR"; eOv T$:5150:5540: O --- SET FILENAME FROM MAILBOX RAM O 4:T$(((+"FF00")))((("FF01"))) O T$"SK" BO6:FG5:BG0:SB14:HL2:JL1: PJL1 :  JUMP LINE ,PAL(("FF07"))1 :  AUTOLOAD FLAG? >P AL0 7170 aPTF$"":I("FF10"):  (I)0 }PTF$TF$((I)):II1: PCF$TF$ P (("FF07"))2+  :  AUTOJUMP FLAG P ("FF07"),(("FF07"))(255  2) QJL(("FF09"))256(("FF0A")):EE(("FF08")) Q KQBO(("FF02")):BG(("FF03")):FG(("FF04")) oQHL(("FF05")):SB(("FF06")) QBU(("FF07"))4 :  BACKUP FLAG QSM+($4FF07)8: SM   (27)"5";:  (27)"8" Q  128 Q* Q4: Q> ------ NEW QH CH  HRR:  5490:"URRENT FILE WAS MODIFIED! EALLY START OVER (Y/N)? "; kR\:  : T$:  T$"Y"  T$"N" Rf:   T$"N" 5540:     Rp RzA0M+X:LI$(A)"":A:LC0 RCF$"" R"":5150 R5540 RCH0:XC0:YC0:CT0 S5490:"** EW FILE **";:NS1 S &S ------ NEW RS5490:"REALLY QUIT EE? "(27)"O"; rS: T$:  T$"Y"  T$"N" S T$"N" 5540: S 128:248+,0: :4  S"TSCHUESSN...!" S S --- FILTER LABELS BASED ON FZ$ TA072:FI$(A)"":FI(A)0:A:FZ0:MP1 NTA0MN1: ((FZ$)0  (MK$(A),FZ$)0) (FZ$)0   xT   FI$(FZ)MK$(A):FI(FZ)MK(A):FZFZ1 T   MK(A)  YC  MPMP1+ T U A: "";: 5490: FZ0 "HOOSE LABEL WITH CURSOR KEYS + , ESCAPE WITH Ò - FILTER='";FZ$;"'"; PU FZ0 "O LABELS FOUND - FILTER='";FZ$;"'"FO$;:NS1: ULSL1:0,0,79,SL:"":A0FZ:A 20(AL),(A,L): FI$(A);:+	 A: MP0  MP0::  U --- LABELS UMP  0 U 1 V5490:"OLLECTING LABELS...";: NZ%0  FZ$"" BV$A072:MK$(A)"":MK(A)0:FI$(A)"":FI(A)0:A:MN0:FZ0 rV.A0NL:T$LI$(A):LB$"":(T$,1)"."7490 V8MK$(MN)(T$,1,38):MK(MN)A+
:MNMN1 VB VL5490: 7421 VV NZ%1   VX   FZ1  T$(13): T$(27) VZ  NZ%0: 7690 V\ 	W`NZ%0 W 8W  SX20(MPL): SY(MP,L):A 0,10 ZW  A SX,SY: "";FI$(MP);""; fW   T$ W  A SX,SY: FI$(MP); W   T$"" +MPMP1 W   T$"" MPMPL W  T$"" MPMP1 W  T$"" MPMPL X  (T$"A"  T$"Z")  T$""  FZ$FZ$T$:7421 LX  T$(20)  (FZ$)0  FZ$(FZ$,(FZ$)1):7421 dX  MPFZ1 MPFZ1 wX   MP0 MP0 X   T$(13)  T$+(27) X
 T$(13)  XZXC:LLYC:LZCT:XC0:LYFI(MP):6600:Ս5150 X5540:  REDRAW STATUS BAR X Y( --- SAVE FILENAME IN MAILBOX RAM ;Y2 9000 :  SAVE TO ATTIC mY< I1  (CF$): $4FF10I1,((CF$,I,1)): I YF $4FF10I1,0 YP $4FF0+0,("S"),("K") YZ $4FF07,($4FF07)1 Yd128: Yn --- COMPILE YxAB0 Z CF$""  :  NOW FILENAME, NO CIGAR Z CH1  (Z  5490: 9 HL aZ   "CURRENT FILE NOT SAVED - PRESS ANY KEY";: T$ zZ  9 FG: 5540: AB1 Z Z AB+1  Z""(27)"L"; Z GOSUB9000 : REM SAVE LINE BUFFER .["EDMA 0,$D400,$8010000,$2001:NEW RESTORE":"RUN";: LOAD '11.PARSE' FROM ATTIC CACHE 9[ 128 l[ 208,2     :  NO OF CHARS IN KEYBOARD BUFFER [ 688,13,13 :  2X RETU+RN [ [ --- M/L HELPER FOR VIC-IV MODE [128:7970 [ I0  12: A$: ("1600")I,(A$): I \" 78,A2,47,A0,53,8E,2F,D0,8C,2F,D0,58,60 /\,V4("1600") 5\6 L\@ ================ c\J FIND AND REPLACE z\T ================ \^: \h+5490: "FIND:"(27)"T"; \rFS$"":RS$"":SD1 :  FIND STRING, REPLACE STRING, SEARCH DIR \|RA%0 :  REPLACE ALL ] 1,0,0: 1,FS$: 1 )] FR%0 8110 U]  "";:5490:"REPLACE:"(27)"T"; p]   1,0,0: 1,RS$: 1 ]"";:5490 ]+ FS$""  FS$" " "FIND CANCELLED.";:NS1: ]SYC ]5490:"SEARCHING..."; ]  S0  SNL ^  FP(LI$(S),FS$) :  FOUND POS &^   FP0 8240 @^     LYS:CL8: 6600 P^      128 k^       MARK FOUND LINE ^       RV0  79 +^        I((YCCT)80)RV ^         2048I,(2048I)  128 ^      RV ^       FLASH FOUND STRING _!       RV0  (FS$)1 )_"        I((YCCT)80)FPRV1 N_#         $D800I,($D800I)  16 \_$       RV |_&       FR%0 8310: Ս8390 _0+   SSSD _:  _D  FD$"Q"  5540: Ս5490:9 HL:"END OF FOUND";:NS1 -`I  FD$"Q"  SNL   " - SEARCH FROM START?(Y/N):";:  FD$:  FD$"Y"  S0: 8140:  5490 O`N XC0:A XC,YCCT: (27)"Q"; Y`X 9 FG }`b A$LI$(YC):1:  REDRAW CURRENT +`l  `v  --- FIND NEXT `  128 ` 5490: "FIND N)EXT P)REV Q)UIT"; ` : FD$:  ("NPQ",FD$) `  FD$"N" SD1 a  FD$"P" SD1 &a  FD$"Q" SNL2 ,a  >a  --- REPLACE Ia  128 ya 5490: "R)EPLACE A)LL N)EXT P)REV Q)UIT"; a+ : FD$:  ("RANPQ",FD$) a  FD$"N" SD1 a  FD$"P" SD1 a! FD$"Q" SNL1 a! FD$"R" 8480 a! b !TS$LI$(S) /b*!NS$(TS$,FP1)RS$(TS$,FP(FS$),255) >b4!LI$(S)NS$ [b>!A XC,YCCT: (27)"Q"; lbH!A$LI$(S):1 vbR!SS1 |b\+! bf! bp! --- ERROR HANDLER bz! ER30  b! b! 128:248,0: :4  b! (27)"Q"(27)"L";(ER),EL b! c(# --- COPY LINE BUFFER TO ATTIC RAM 5c<#CB$8030000 : CCB acA# C,NL1 : CC2 :  STORE NO OF LINES pcF# A0  NL cP#  P+
(LI$(A)):L(LI$(A)):B$10000(P1) cZ#   C,L : CC1 cd#   L0 ! 0,L,B,C:CCL cn# cx# d# --- COPY ATTIC RAM TO LINE BUFFER d#CB$8030000 : CCB 1d#NL(C):CC2 :d#CL0 Id#  CLNL ud#  L(C):LI$(CL)(BL$,L):P
(LI$(CL)) +d#  B$10000(P1):CC1 d#   L0  ! 0,L,C,B : CCL d#  CLCL1 d# d# dT$ "B65SUPPORT.BIN": $1600 e^$A(0): SET ISSUE# TO ZERO 9eh$L$"/FILE:"CF$: 9450: POST FILENAME Her$#2,(CF$) Re|$L$"" ]e$#2,C$ je$L$L$C$ e$ (L+$)128   9450: POST CHUNK e$ N$; e$  ST  64  9350 e$#2 e$ (L$)0   9450: POST REMAINING CHUNK !f$ 9450: POST EMPTY CHUNK TO DECLARE WE'VE FINISHED ;f$ "FINISHED POSTING!" Af$ Zf$ *** POST CHUNK *** f$L$((L$)1)  L$:+ PREPEND THE LENGTH OF STRING+1 f$A("/"L$) f% "POSTING CHUNK..." f%L$"" f% f!% MOVE TO NEXT WORD g&%  (CL$,XCXI,1)  " " g0%   9600 g:%   EF   #gD% @gN%  (CL$,XCXI,1)  " " MgX%   9600 \gb%   EF   bgl% hgv% g% M+OVE TO NEXT CHAR g%EF0:XCXC1 g% XC(CL$)   g%   YC NL  XC0:YCYC1:CL$LI$(YC): YCCT20   5250 g%  EF1 g% g% h% MOVE TO PREVIOUS WORD /h% 9800: PREV CHAR Lh%  (CL$,XCXI,1)  " " Yh%   9800 hh&   EF   nh&+ h&  (CL$,XCXI,1)  " " h &   9800 h*&   EF   h4& h9& 9600: NEXT CHAR h>& hH& MOVE TO PREV CHAR hR&EF0:XCXC1 i\& XC0   Eif&   YC0  YCYC1:CL$LI$(YC):XC(CL$)1: YCCT0  5330 Yik&   XC0  XC0 dip&  EF1 kiz& +i& EF1  (CL$)  YC0   9810 i& i& DELETE CURRENT CHAR i& XC(CL$)   i&  CH1 i&  CL$(CL$,XCXI1)(CL$,XCXI1) 	j&  LI$(YC)CL$ j&  9970 j& "j& <j& *** REDRAW LINE *** Mj&IV0: 10000 yj&A 0,YCCT:A$CL$: 1:+(CL$)79" "; j'IV0 j' j' *** INVERT IF MARKED LINE j'IV0: MF0   j$' MSME  MSYC  YCME  IV1: 	k.' MEMS  MEYC  YCMS  IV1 k8' 0kB' *** MARK-MODE HANDLING *** BkL' T$""   kkM'  MEYC1:CL$LI$(YC): 9970:YCY+C1 kN'   YCCTSL3   5250::  kO'    CL$LI$(YC): 9970: kP'   kQ' kV' T$""  YC0   kW'  MEYC1:CL$LI$(YC): 9970:YCYC1 lX'   YCCT0   5330::  :lY'    CL$LI$(YC): 9970: ClZ'   Jl[' el`' T$"X"  T$"C"   + lj'   MSME  IVMS:MSME:MEIV lt'   IVME  MS  1 l~'    CB$(IVMS)  LI$(IV) l'   IV l'   T$"X"   l'     AMS  NL(MEMS1) m'      LI$(A)LI$(A(MEMS1)) 'm'     A em'    NLNL(MEMS1): ANL1  NL(MEMS1):LI$(A)"": +!A m'    YCMS: YCCT0  LYMS: 6600 m'   m'  IV0:MF0:CSMEMS1:MS0:ME0 m' m' 5150 m' m' *** PASTE *** m' IVCS1  0  1 n'   INSERT A LINE AT YC ,n'  MFYC: TEMP >n (  CH1: 5650 On
(  YCMF:MF0 en(  LI$(YC)CB$(+"IV) nn( IV yn(( 5150 n2( n) --- SET FN KEYS AND MAKE SURE F11 DOESN'T GENERATE PASTE n)  n)FK$""(132) 	o") R1  15: R, (FK$,R,1): R o,) do6) 	(1)25   "-- PRESS ANY KEY FOR NEXT PAGE";:T$:"";:5490:  "+#"; o@)"ALT + P POST TO PC (M65POSTBOX)" oJ)"ESC, J GO TO START OF LINE" oT)"ESC, K GO TO END OF LINE" o^)"ESC, D DELETE CURRENT LINE" ph)"CTRL + W MOVE TO NEXT WORD" Cpr)"CTRL + U MOVE TO PREVIOUS WORD" vp|)"SHIFT + INST/DEL D+$ELETE CURRENT CHARACTER" p)"CTRL + = TOGGLE COMPILATION DEBUGGING ON/OFF" p)"ESC, M TURN 'MARK-MODE' ON" q)"  - WHEN 'MARK-MODE' IS ON, USE CURSOR UP/DOWN TO SELECT LINES" 5q)"  - PRESS 'X' TO CUT" Tq)"  - PRESS 'C' TO COPY" q)" +% - HEN USE ESC,P TO PASTE CLIPBOARD CONTENTS" q) q) --- JUMP TO PREVIOUS FILE q) CH1   q)   5490:9 HL r)   "CURRENT FILE NOT SAVED - PRESS ANY KEY";:  T$ %r)   5490: 5540: ,r) Er*TMPV:NF$PV$: 6390 Vr*LYTM: 6600 \r+&* r* --- NAVIGATE TO LABEL UNDER CURSOR r+ 11100:  GET TERM UNDER CURSOR r+NZ%1:  NAV TO LABEL FLAG = TRUE r+ 7430:  GOSUB FIND LABEL SCREEN r + %s\+ --- GET TERM UNDER CURSOR INTO FZ$ Ksf+ 11200:  START OF LABEL INTO SZ osp+ 11300:+'  END OF LABEL INTO EZ sz+FZ$  (CL$,SZ1,EZSZ1) s+ s+ --- GET START OF LABEL INTO SZ s+K  XC  1 : ZZ$" :" : SZ  0 s+  K  0 t+   (ZZ$,(CL$,K1,1))  SZ  K  1 :  't+  K  K  1 -t+ 3t+ Vt$, --- GET END OF LABEL INTO EZ  |t.,K  XC : ZZ$" :" : EZ  (CL$)1 t8,  K  EZ tB,   (ZZ$,(CL$,K1,1))  EZ  K  1 :  tL,  K  K  1 tV, t`,                                                                                                                               , ~L~L~Lb~L~~LiHZ ~zh b~`P1)(21) B~` c)bЅ` B~ `  { m`xH hɠɠk ~8IiIi  8,āŁ080IiIi  8āŁ0mm k~ʹ͵Ͷ
ͷX`**Á8āÁŁ0 ʹ
͵X`mm,mm8āÁŁ0āLͶ
ͷX`mmmmLX``LLLZ`ɠ8`8`P	P8`ɠ8`2	28`d8``j,,400  PRINT CHR$(27);"5";  ' WPOKE , $0800  ' POKE , $04  RETURN'-------------.DRAWBACKDROP'-------------    FRAMEIDX = ͯ    FX=-999 : FY = -999    MIRROR = 0    GOSUB DRAWPETSCIIFRAME    RETURN'-----,-------.ANIMATELOGO'------------  IF BASSTATE = 0 THEN BEGIN    ORIGFRMY(0) = 6    ORIGFRMY(1) = 23    ORIGFRMY(2) = 6    FRMY(0) = -44    FRMY(1) = -69    FRMY(2) = -107    BASSTATE = 1    INCDIR(0) = 1    INC(0) = 1    INCDIR(1), = 1    INC(1) = 1    INCDIR(2) = 1    INC(2) = 1    INCDIR(3) = 1    INC(3) = 1  BEND  IF BASSTATE = 1 THEN BEGIN    FINISHCNT = 0    FOR K = 0 TO 2      IF FRMY(K) < ORIGFRMY(K) THEN BEGIN        FRMY(K) = FRMY(K) + 2        IF FRM4Y(K) > ORIGFRMY(K) THEN FRMY(K) = ORIGFRMY(K)      BEND      IF FRMY(K) = ORIGFRMY(K) THEN FINISHCNT = FINISHCNT OR 2^K    NEXT K  BEND  GOSUB DRAWBAS  GOSUB PAGEFLIP  FOR FRAMEIDX = 0 TO 2    IF FINISHCNT AND 2^FRAMEIDX AND BCNT(FRAME ύj``ЬaІ  `   BBp׭BBtBBxeeee`͎ ` `    P`          P2 ~|{alb                               ɠ8`2	28`d8``j,	 FOUND = 1    ACTANIM = -1  BEND  'CURSOR 0,8:PRINT "FOUND = ";FOUND;  IF FOUND = 0 THEN BEGIN ' WE'RE DRAWING A PETSCII FRAME NOW?    FRAMEIDX = AVAL    'CURSOR 0,5:PRINT "DRAW FRAMEIDX=";FRAMEIDX;    'INPUT AVAL    GOSUB DRAWPETSCIIFRAME,
    FRAMEDUR = ANIMS(ACTANIM,ANIMIDX)    ANIMIDX = ANIMIDX + 1    FRAMESTART = TI  BEND  RETURN.CLEARTEXT'-----------  EDMA 3,80,32,$800  RETURN.DRAWTXTGREY'-------------  IF ACTTIMER = -1 THEN RETURN  SLEEP .05  CURSOR ACTX + ACT,TIMER, ACTY  PRINT "";MID$(ACTSTR$,1+ACTTIMER,1);  ACTTIMER = ACTTIMER + 1  IF ACTTIMER >= LEN(ACTSTR$) THEN ACTTIMER = -1  RETURN.DRAWTXTTALK'-------------  IF ACTTIMER = -1 THEN RETURN  SLEEP .05  ACTX=(80-LEN(ACTSTR$))/2+7  ACTY=1  CU,RSOR ACTX + ACTTIMER, ACTY  PRINT "";MID$(ACTSTR$,1+ACTTIMER,1);  ACTTIMER = ACTTIMER + 1  IF ACTTIMER >= LEN(ACTSTR$) THEN ACTTIMER = -1  IF MOD(ACTTIMER,2) = 0 THEN FRAMEIDX=ͯί:ELSE FRAMEIDX=ͯů  GOSUB DRAWPETSCIIFRAME,  RETURN.CLEARTXTTALK'--------------  CURSOR 0,1:PRINT CHR$(27);"Q";  RETURN.DRAWPETSCIIFRAME'------------------  DATAADDR = FRAMEADDR(FRAMEIDX)  FRMX = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMY = PEEK(DATAADDR)  DATAADDR = ,DATAADDR + 1  FRMW = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMH = PEEK(DATAADDR)  DATAADDR = DATAADDR + 1  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  #DECLARE YY, SCRADDR,CLRADDR  SCRADDR = $800 + FRMX + FRMY * 80  CLRADDR = $1F800 + FRMX, + FRMY * 80  CDATAADDR = DATAADDR + FRMW * FRMH  FOR YY=FRMY TO FRMY1    EDMA 0, FRMW, DATAADDR, SCRADDR    EDMA 0, FRMW, CDATAADDR, CLRADDR    DATAADDR = DATAADDR + FRMW    CDATAADDR = CDATAADDR + FRMW    SCRADDR = SCRADDR + 80    CLRAD,DR = CLRADDR + 80    NEXT YY  RETURN.INITREACTION'-------------  PRINT "";  FRAMEIDX = ͯ:GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯԯ1:GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯԯ2:GOSUB DRAWPETSCIIFRAME  RETURN.DRA,WREACTION'-------------  ACTTIMER = ACTTIMER + 1  SLEEP .1  IF MOD(ACTTIMER,2) = 0 THEN FRAMEIDX=ͯ˯:ELSE FRAMEIDX=ͯү  GOSUB DRAWPETSCIIFRAME  IF ACTTIMER > 10 THEN ACTION = :ACTTIMER = 0  RETURN.DRAWPAINTING,'-------------  PRINT "";  FRAMEIDX = ͯ  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ1 + ACTPAINTING - 1  GOSUB DRAWPETSCIIFRAME  RETURN#DECLARE RVAL, AIDX, VIDX#DECLARE TEST$.INITANIMS'----------  AIDX = 0  VIDX = 0  DO,    READ RVAL    ' PRINT RVAL;", ";    IF RVAL = ̯ӯ THEN EXIT    ANIMS(AIDX,VIDX) = RVAL    VIDX = VIDX + 1    IF RVAL = į THEN AIDX=AIDX+1:VIDX=0  LOOP  RETURN.ANIMS'-----  ' ͯ  DATA ͯ,   .3, _      , ͯͯ1, .3, _       ͯͯ2, .3, _       ͯͯ3, .3    ' RAISE ARM TO CHIN  DATA 1  DATA ͯͯ4, .5, _       ͯͯ3, .5, _       ͯͯ4, .5, _       ͯͯ3, .5    ' SCRATCH CHIN  DATA ͯů, 0 , _ ,      ͯͯ4,     .5, _       ͯͯ3,     .5, _       ͯͯ4,     .5, _       ͯͯ3,     .5    ' CLOSE EYES & SCRATCH CHIN  DATA ͯů, .2    ' NORMAL FACE  DATA , 1,   DATA į  ' ͯ,  DATA ͯί, 0 , _       ͯͯ1, 1     ' GAPING MOUTH AND FINGER POINT UP  DATA ͯů,.2, _       ͯͯ2,  .2, _       ͯͯ3,  .2, _       ͯͯ4,  .2, _       ͯͯ1, .2, _       ͯͯ,2, .2 ' GET BRUSH  DATA 1  DATA ͯů, .1  DATA 2  DATA ͯͯ3, .1, _       ͯͯ4, .1  DATA , 2,   5  DATA ͯů,  .5  DATA 3  DATA ͯͯ3, .1, _       ͯͯ4, .1  D,ATA , 3,   5  DATA , 1,   DATA į  ' ͯ  DATA ͯͯ2, .25, _       ͯͯ1, .25, _       ͯί, .5, _       ͯͯ5, .25, _       ͯͯ6, .25, _       ͯ,ԯ1, .25, _       ͯԯ2, .25  DATA 1  DATA ͯů, .1, _       ͯӯ, .1, _       , 1, 5  DATA į  ' ͯ  DATA ͯͯ, .2, _       ͯ1, .1, _       ͯ2, .1, _       ,ͯ3, .1, _       ͯ4, .1, _       ͯ5, .1, _       ͯ6, .1, _       ͯ7, .1, _       ͯ8, .1, _       ͯ9, .1, _       ͯ10, .1, _       ͯ11, .1  DATA į  DATA ̯ӯ.STORYDA,TA'----------                  '      TIMEDELTA  ACTION       TEXT                            X   Y  DUR(SEC)  ' ONNY: ATTEMPT #1  DATA 0,        ,        ͯ  DATA 2,        ,     "HERE'S SONNY...",              4,  0  DATA 1.5,,      ,     "A STRUGGLING ARTIST...",       22, 0  DATA 1.7,      ,     "SEARCHING FOR INSPIRATION...", 47, 0  DATA 2,          DATA .5,       ,     "HMM... WHAT TO DRAW TODAY...",        3  DATA 2,        ,        ,ͯ  DATA 1.5,      ,     "I KNOW!",                             2  DATA 1,          DATA 3,        ,        ͯ  DATA 4,        ,    1  DATA 2,        ,    "BLECH!",                       1,     2  DATA ,2,        ,        ͯ  DATA 1.5,        DATA .,        ,     "TRY AGAIN SONNY...",           34, 12  DATA 2,        ' ONNY: ATTEMPT #2  DATA .,        ,        ͯ  DATA 2,        ,        ͯ  DATA 1.5,,      ,     "AHA!",                             2  DATA 1,          DATA 3,        ,        ͯ  DATA 4,        ,    2  DATA 2,        ,    "YUCK!",                       1,     2  DATA 2,        ,       ,  ͯ  DATA 1.5,        DATA .,        ,     "DON'T GIVE UP SONNY!",           32, 12  DATA 2,          ' ONNY: ATTEMPT #3  DATA .,        ,        ͯ  DATA 2,        ,        ͯ  DATA 1.5,      ,   ,!  "I GOT IT!",                             2  DATA 1,          DATA 3,        ,        ͯ  DATA 4,        ,    3  DATA 2,        ,    "EWW!",                       1,     2  DATA 2,        ,        ͯ  DAT,"A 1.5,      ,     ͯį  DATA .,        ,     "AWW... POOR SONNY...",           32, 0  DATA 2,          DATA .1,       ,     "GUYS LIKE ME SHOULDN'T DREAM ANYWAY...", 3.5  DATA 3.5,      ,     ͯį ,# DATA 1,          DATA .5,       ,     "...AND WITH THAT, SONNY'S DREAMS BLEW AWAY WITH THE WIND...", 10, 12  DATA 3.5,        DATA 1,       '=====.ENDER'=====  GOSUB SWITCHTO80X25MODE  GOSUB RESTORESCREENPOINTER  PALET,$TE RESTORE  RETURN'============.XANADUTITLE'============  PRINT CHR$(147);  BACKGROUND 0  BORDER 0  ' FILL SCREEN WITH BLACK INVERTED SPACES  EDMA 3,4000,0,$FF80000  EDMA 3,4000,160,$48000      GOSUB LOADPALETTE  GOSUB SWITCHTO80X50MO,%DE  GOSUB SETSCREENPOINTER  GOSUB PANTITLE  RETURN.SWITCHTO80X50MODE'--------------------  BANK 128  SETBIT ǯ7, 7  POKE $D031, $E8 ' 640, , , 400  RETURN.SWITCHTO80X25MODE'--------------------  BANK 128  POKE $D031,&, $E0 ' 640, ,   RETURN.RESTORESCREENPOINTER'----------------------  ' TO BANK 0 - $0800  BANK 128  WPOKE , $0800  POKE , 0  RETURN.SETSCREENPOINTER'------------------  ' MOVE TO BANK4 - $8000  BANK 128  SE,'TBIT ǯ7, 7  WPOKE , $8000  POKE , $04  RETURN.PANTITLE'---------  FOR PANIDX = 0 TO 196    IF PANIDX > 79 THEN BEGIN      PANSRCIDX = PANIDX - 79      PANDESTIDX = 0      IF PANIDX > 117 THEN BEGIN        PA- NLEN = 80 - (PANIDX - 117)        IF PANLEN < 1 THEN PANLEN = 0      BEND:ELSE BEGIN        PANLEN = 80      BEND    BEND:ELSE BEGIN      PANSRCIDX = 0      PANDESTIDX = 79 - PANIDX      PANLEN=PANIDX + 1    BEND    FOR PANY = 0 T-O 49      EDMA 0,PANLEN,$41000+PANY*118+PANSRCIDX,$FF80000+PANY*80+PANDESTIDX    NEXT PANY    SLEEP .02    GOSUB POLLPLAY  NEXT PANIDX  RETURN.LOADPALETTE'------------  #DECLARE LOC=$40FA0  FOR K = 0 TO 31    POKE $D100+K,PEEK(LOC-):LOC=LOC+1    POKE $D200+K,PEEK(LOC):LOC=LOC+1    POKE $D300+K,PEEK(LOC):LOC=LOC+1  NEXT K  RETURN'========.BASLOGO'========  GOSUB POLLPLAY  GOSUB FADETOWHITE  GOSUB DRAWLOGO  GOSUB FADETODEFAULTS  GOSUB CYCLEALTPALETTELOOP  GOS-UB FADETOBLACK  RETURN.CYCLEALTPALETTELOOP'----------------------  FOR M = 0 TO 32*4    GOSUB CYCLEALTPALETTE    GOSUB POLLPLAY    GOSUB ANIMDRAWSUBTEXT    SLEEP .04  NEXT M  RETURN.ANIMDRAWSUBTEXT'-----------------  IF M = 40- THEN BEGIN    SUBTEXTIDX = 1    PLEN = 0    EDMA 3,80,32,$800+80*24  BEND  IF PLEN < LEN(SUBTEXT$(SUBTEXTIDX)) THEN BEGIN    PLEN = PLEN + 1    RAINBOWSTR$=LEFT$(SUBTEXT$(SUBTEXTIDX),PLEN)    IF SUBTEXTIDX = 0 THEN RAINBOWX = 36:ELSE RAINB-OWX = 21    RAINBOWY = 24    GOSUB PRINTRAINBOWSTR  BEND  RETURN.PRINTRAINBOWSTR  #DECLARE RAINIDX  CURSOR RAINBOWX, RAINBOWY  FOR RAINIDX=1 TO LEN(RAINBOWSTR$)    FOREGROUND MOD(RAINIDX-1,16)+16    PRINT MID$(RAINBOWSTR$,RAINIDX,-1);  NEXT RAINIDX  RETURN.CYCLEALTPALETTE'-----------------  #DECLARE TEMPR, TEMPG, TEMPB  TEMPR = PEEK($D100+16)  TEMPG = PEEK($D200+16)  TEMPB = PEEK($D300+16)  FOR K = 16 TO 30    POKE $D100+K, PEEK($D100+K+1)    POKE $D200+K, PEEK($D20-0+K+1)    POKE $D300+K, PEEK($D300+K+1)  NEXT K  POKE $D100+31, TEMPR  POKE $D200+31, TEMPG  POKE $D300+31, TEMPB  RETURN.DRAWLOGO'---------  BACKGROUND 1  BORDER 1  EDMA 0, 2000, $40000, $800  EDMA 0, 2000, $407D0, $FF80000  RETURN.FAD-ETOWHITE'-------------  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTOWHITE    SLEEP .05  NEXT FADEVAL  RETURN.FADETOBLACK'-------------  GOSUB STORECURRCOLOURS  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTOBLACK    SLEEP .05  NEXT FAD-	EVAL  RETURN.FADETODEFAULTS'----------------  GOSUB STORECURRCOLOURS  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTODEFAULTS    SLEEP .05  NEXT FADEVAL  RETURN'====.INIT'====  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $F-
D  ^^BLOAD "INTRO.DAT",P($40000),R  ' $4,0000 +------------------+ .  '         !  LOGO CHARS   !  ' $4,070 +..................+  '         !  LOGO COLORS  !  ' $4,00 +..................+  '         ! 32 X   !  ' $4,1-000 +..................+  '         !  COLORS     !  ' $4,270 +..................+  '         !  FRAMES   !  ' $4,54 +------------------+  GOSUB INITMUSIC  GOSUB STOREDEFAULTCOLOURS  RETURN.STOREDEFAULTCOLOURS'----------------------  FOR K = 0 TO 31    DEFAULTRED(K)=PEEK($D100+K)    DEFAULTGREEN(K)=PEEK($D200+K)    DEFAULTBLUE(K)=PEEK($D300+K)  NEXT K  RETURN.STORECURRCOLOURS'------------------  FOR K = 0 TO 31    CURRRED(K)=PEEK($D100+K)    CURRGREEN(K)-=PEEK($D200+K)    CURRBLUE(K)=PEEK($D300+K)  NEXT K  RETURN.FADECOLOURSTOWHITE'---------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    POKE $D100+K, DEFAULTRED(K) + (15 - DEFAULTRED(K)) * TEMPVAL    POK-E $D200+K, DEFAULTGREEN(K) + (15 - DEFAULTGREEN(K)) * TEMPVAL    POKE $D300+K, DEFAULTBLUE(K) + (15 - DEFAULTBLUE(K)) * TEMPVAL  NEXT K  RETURN.FADECOLOURSTODEFAULTS'------------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16-  FOR K = 0 TO 31    POKE $D100+K, CURRRED(K) + (DEFAULTRED(K)-CURRRED(K)) * TEMPVAL    POKE $D200+K, CURRGREEN(K) + (DEFAULTGREEN(K)-CURRGREEN(K)) * TEMPVAL    POKE $D300+K, CURRBLUE(K) + (DEFAULTBLUE(K)-CURRBLUE(K)) * TEMPVAL  NEXT K  RE-TURN.FADECOLOURSTOBLACK'---------------------  TEMPVAL = (16-FADEVAL) / 16  FOR K = 0 TO 31    POKE $D100+K, CURRRED(K) * TEMPVAL    POKE $D200+K, CURRGREEN(K) * TEMPVAL    POKE $D300+K, CURRBLUE(K) * TEMPVAL  NEXT K  RETURN'==========-.INITMUSIC'==========  PLAY  BARINDEX=0  MAPBARTOCHUNK(0)=0  MAPBARTOCHUNK(1)=1  MAPBARTOCHUNK(2)=1  MAPBARTOCHUNK(3)=2  MAPBARTOCHUNK(4)=3  FILTER 1,100,1  FILTER 2,100,1  ENVELOPE 2,3,3,3,10,0  ENVELOPE 4,9,4,9,8  ENVELOPE- 7,0,9,9,0,2,1100  ENVELOPE 8,0,12,3,5,2,1100  ENVELOPE 9,0,10,3,5,2,1100  ' *** VOICE1 - GUITAR1 ***  ' ------------------------  V1$(0)="T2O6M2 QDIR QC.R QDIR QC.R QDIR QC.R QDIR QC.R"  V1$(1)="T2O6M2 QDIR QC.R QDIR QC.R P9A IR QAIR P0IDP9O5A O54IAO6DA Q.G IDO5A IBO6DG Q.A IGD O5BO6EG Q.A IGE O5IBO6DG Q.A IGD  O5BO6EGQA IG#FE "  V1$(2)="T2O6M2 QDIR QC.R QDIR QC.R  IDDFQ.DIFD O5Q.#AHO6CIR O5#AQ#AO6HCIR IDDFHDIR  DDFQ.DIFD O5Q.#AHO6CIR O5#AQ#AO6HCIR O5Q.A O6HE IR  V1$(3)="T2O6M2 IGG#GHGIR O5Q.G -  
  POST-COMPILE 4  "COMPILING SUCCESSFUL." J   4:AD("FF30") t    (AD)0:F$F$((AD)):ADAD1:  (  F$""  (F$)16   "??FATAL ERROR DETERMINING OUTFILE":  - ("11TEMP"):(F$)  2  ("11TOKENIZED")  (F$) 	!< "RUN"(34) =F$:""; !A   !B  128 1!D  208,1: 688,13 7!F                                                                                                                                                                                                      -  d DF$"11.DEFAULTS" S n SB$" DEVELOPMENT ENVIRONMENT VERSION 0.1 ALPHA" ~ x  820:  GET SETTINGS FROM MAILBOX RAM    $   ""   DL$(27)"Q":  DELETE LINE   BU$(0)"DISABLED":BU$(1)"ENABLED "   SM$(0)"80X25":SM$(1)"80X50"- +!  1220:  READ DEFAULTS, SET SCREEN MODE 1!  I! 9 FG: ; BG: < BO j! "   PREFERENCES  " ! A 0,3: "  1  WORKING FILE NAME : ";DL$;CF$; !  CF$""   "<NOT DEFINED>"; ! : "  2  AUTOMATIC BACKUP  : ";BU$(BU) ! A 0,5 -"" "  3  BORDER COLOUR     : "; D"9 BO:  "          ":9 FG j" "  4  BACKGROUND COLOUR : "; ""9 BG:  "          ":9 FG ", "  5  FOREGROUND COLOUR : "; "69 FG:  "          ":9 FG "@ "  6  HIGHLIGHT COLOUR  : ";- #J9 HL:  "          ":9 FG B#T "  7  STATUS BAR COLOUR : "; d#^9 SB:  "          ":9 FG j#h #r "  9  SCREEN MODE       : ";SM$(SM) #|A 0,16:9 HL #"     AVE AS DEFAULTS" #"     OAD DEFAULTS FROM DISC" $" -    ESET DEFAULTS" A$"   XIT PREFERENCES & LAUNCH EDITOR"; S$A 0,24:9 SB $ SB$""  SB$" DEVELOPMENT ENVIRONMENT VERSION 0.5" $ 1130 $ T$ : SB$"" $ T$""  BOBO1: BO15  BO0 $ T$""  BGBG1: BG1-5  BG0 $% T$""  FGFG1: FG15  FG0 J% T$""  HLHL1: HL15  HL0 p% T$""  SBSB1: SB15  SB0 % T$""  BU(BU1) % T$""   %  SM  (SM1) %&   1220:  SET SCREENMODE %0 %: T$"R"  RS1:820  &D- T$"S"   &&N  SB$"SAVING DEFAULTS...": 1130 4&X   (DF$) d&b   (DF$),B(4),P(("FF00"))  P(("FF80")) &l   3,80,160,0,3968,0 :   --- CLEAR STATUS BAR &v   DS0  SB$"DEFAULTS SAVED.":  SB$"DISC ERROR "DS$ &   1130 & &- T$"L"   &'  SB$"LOADING DEFAULTS...": 1130 G'   (DF$),B(4),P(("FF00")) S'   820 '   DS0  SB$"DEFAULTS LOADED.":  SB$"DISC ERROR "DS$ '   1130: 1220 ' ' 990 '  T$"	" ' 0( "EDMA 0,$D400,$8000000-,$2001:NEW RESTORE":"RUN";: LOAD '11.EDIT' FROM ATTIC CACHE <(  128 p(  208,2     :  NO OF CHARS IN KEYBOARD BUFFER (  688,13,13 :  RETURN (   (* (4 --- LOAD SETTINGS TO MAILBOX RAM (>T$(($4FF00))(($4FF01)) (HRT0 )R- T$"SK" RS1   9)\  BG0:FG5:BO6:HL2:SB14 :  STANDARD COLOURS b)f  CF$"" : BU1 : RT1 : RS0 : SM0 i)p )z RT1   :  RETURN IF JUST INITIALIZED )TF$"":I$4FF10:  (I)0 )TF$TF$((I)):II1: )BO($4FF02):BG($4- FF03):FG($4FF04) *HL($4FF05):SB($4FF06) 9*BU  ((($4FF07)4)0) V*SM  ((($4FF07)8)0) i*CF$TF$: 128 o* u*: * --- SAVE SETTINGS FROM MAILBOX RAM * 4 * CF$""   1040 * I1  (CF$): ("FF10")I1,((CF$,I-!,1)): I + ("FF10")I1,0 2+ ("FF07"),0 : FL0 :  DELETE FLAGS a+FL  FL  1              :  AUTOLOAD FLAG +$ BU1  FLFL  4   :  AUTOBACKUP FLAG +. SM1  FLFL  8   :  80X50 FLAG +8 $4FF07,FL +B $4FF00,("S"): $4FF01,("K-"") ,L $4FF02,BO :  $4FF03,BG :  $4FF04,FG 4,V $4FF05,HL :  $4FF06,SB @,`128: U,j --- STATUS BAR ,t 	(1)25  CB2048(2480)   : FB$FF80800  (2480) ,~ 	(1)50  CB$40800(4980) : FB$FF80800  (4980) ,! 3,80,160,CB   :    --- CLEAR STATUS BAR )-! 3,80,SB,FB    :   SET STATUS BAR COLOR :-A 0,	(1)1 M-9 SB :  SB$; S- \- T$ u- --- SET SCREENMODE - SM   (27)"5":  (27)"8" - -                                                              -$' AY OF THE MPLODING OOT' -------------------------'  COLLABORATIVE TEAM-EFFORT GAME MADE BY THE 65 COMMUNITY'' URCE:' -----' - NITIAL BACKGROUND ART' - LEVEN CODE INFRASTRUCTURE' - NITIAL AME MECHANICS' EFT:' ----' - RTISTIC PL-%AYER HEAD PERMUTATIONS#OUTPUT "FOOT"' 4 EMORY USAGE' ------------------' 4.0000 -' 4.0100   (EACH PALETTE IS 16*3 IN SIZE, HAVE 12 PALETTES)' 4.0800  ' 4.2000  ' 5 EMORY USAGE' --------&-----------' 5.0000 SCREEN BUFFER' 5.1000 COLOR RAM BUFFER' 5.2000 DOUBLED-UP LAYER BUFFER' UNCOMMENT THIS LINE TO ADD DEBUG OUTPUT#DECLARE  = 0.PETSCII VARS'------------#DEFINE ͯ   = 0#DEFINE ͯ   = 1#DEFINE ͯ  -'  = 2#DEFINE ͯ     = 3#DEFINE ԯ   = 0#DEFINE ԯ1 = 1#DEFINE ԯ2 = 2#DEFINE ԯ3 = 3#DEFINE ԯ4 = 4#DEFINE ԯ    = 5#DEFINE ԯ     = 6#DECLARE DATAADDR = $42000#DECLARE MAXFRAMES(ͯ. )#DECLARE FRAMEADDR(ԯ, 25)#DECLARE FRAMEDBLUPADDR(64)#DECLARE JDIRRAW, JFIRE, JDIR#DECLARE FRMIDX = 0#DECLARE FRMW, FRMH,FRMX,FRMY,FRMX1,FRMY1,FRAMEIDX,CDATAADDR#DECLARE YY, SCRADDR,CLRADDR#DECLARE A$, LIDX, K, X, Y#DECLARE SRCA.DDR, DESTADDR, LENGTH, TRANSP#DECLARE DESTMBSEL, DESTBANK#DECLARE FORM, SZ#DEFINE  = 0#DEFINE  = 1#DECLARE CHARACTER#DECLARE OPPONENTDATAADDR#DECLARE DBLUPADDR = $52000#DECLARE KNEELFLAG#DECLARE BADDIEKNEELFLAG#DECLAR.E MIRROR, PLAYERMIRROR, BADDIEMIRROR, OPPONENTMIRROR, TMPMIRROR#DECLARE PX, PY ' PLAYER X,Y#DECLARE BX, BY ' BADDIE X,Y#DECLARE PLAYERENERGY = 18#DECLARE LAGPENERGY = 0#DECLARE BADDIEENERGY = 18#DECLARE LAGBENERGY = 0#DECLARE X1,Y1,X2,Y.2, DRAWCOLOR, IDX, TMPX1#DECLARE PX1, PY1, PX2, PY2#DECLARE OX1, OY1, OX2, OY2#DECLARE RET%#DECLARE DATIDX, PLAYERDATIDX, BADDIEDATIDX#DECLARE PLAYERDATFIXED, BADDIEDATFIXED#DECLARE TMP#DEFINE үد = 112#DEFINE үد. = 110#DEFINE үد = 109#DEFINE үد = 125#DEFINE ү   = 64#DEFINE ү   = 93#DEFINE ү  = 32.JOYSTICKDEFS'-------------#DEFINE ʯ = 1#DEFINE ʯЯ = 2#DEFINE ʯ = 3#DEFINE ʯί = 4#.DEFINE ʯ = 5#DEFINE ʯί = 6#DEFINE ʯ = 7#DEFINE ʯЯ = 8#DEFINE ʯ = 128#DEFINE į = 1#DEFINE įЯ = 2#DEFINE į = 3#DEFINE įί = 4#DEFINE į = 5#DEFINE įί = 6#DEFI.NE į = 7#DEFINE įЯ = 8#DECLARE JD(1,8) ' DIRECTIONAL JOYSTICK (PLAYER DIRECTION NEUTRAL)JD(0, ʯ) = įJD(0, ʯЯ) = įЯJD(0, ʯ) = įJD(0, ʯί) = įίJD(0, ʯ) = į.JD(0, ʯί) = įίJD(0, ʯ) = įJD(0, ʯЯ) = įЯJD(1, ʯ) = įJD(1, ʯЯ) = įЯJD(1, ʯ) = įJD(1, ʯί) = įίJD(1, ʯ) = įJD(.1, ʯί) = įίJD(1, ʯ) = įJD(1, ʯЯ) = įЯ.IMGS'----#DEFINE ǯ = 0#DEFINE ǯ = 1#DEFINE ǯԯ = 2#DEFINE ǯ˯ = 3#DEFINE ǯ = 4#DEFINE ǯɯ = 5#DEFI.	NE ǯϯ = 6#DEFINE ǯ = 7#DEFINE ǯ1 = 0#DEFINE ǯ2 = 1#DEFINE ǯ3 = 2#DEFINE ǯ1 = 3#DEFINE ǯ2 = 4#DEFINE ǯ3 = 5#DEFINE ǯ1 = 6#DEFINE ǯ2 = 7#DEFINE ǯ3 = 8#D.
EFINE ǯ1 = 9#DEFINE ǯ2 = 10#DEFINE ǯ3 = 11#DEFINE ǯ1 = 12#DEFINE ǯ2 = 13#DEFINE ǯ3 = 14#DEFINE ǯ1 = 15#DEFINE ǯ2 = 16#DEFINE ǯ3 = 17#DEFINE ǯ1 = 18#DEFIN.E ǯ2 = 19#DEFINE ǯ3 = 20#DEFINE ǯ4 = 21#DEFINE ǯ5 = 22#DEFINE ǯ1 = 0#DEFINE ǯ2 = 1#DEFINE ǯ3 = 2#DEFINE ǯ1 = 3#DEFINE ǯ2 = 4#DEFINE ǯ3 = 5#DEFINE ǯ1 = 6#DEF.INE ǯ2 = 7#DEFINE ǯ3 = 8#DEFINE ǯ4 = 9#DEFINE ǯ5 = 10#DEFINE ԯ = 7#DECLARE FX, FY#DECLARE XOFFS(ԯ) ' OFFSET INTO CYCLING OF GRAPHIC#DECLARE DRAWORDER(ԯ)DRAWORDER(0) = ǯ.DRAWORDER(1) = ǯDRAWORDER(2) = ǯDRAWORDER(3) = ǯԯDRAWORDER(4) = ǯ˯DRAWORDER(5) = ǯDRAWORDER(6) = ǯɯDRAWORDER(7) = ǯϯ#DECLARE OFFSAMOUNT(ԯ)OFFSAMOUNT(0) = .7OF.FSAMOUNT(1) = 0OFFSAMOUNT(2) = .1OFFSAMOUNT(3) = .5OFFSAMOUNT(4) = 1OFFSAMOUNT(5) = 1.5OFFSAMOUNT(6) = 2#DECLARE PALIDX, PTR.ANIMS'-----#DEFINE ͯ = 0#DEFINE ͯ = 1#DEFINE ͯ = 2#DEFINE ̯ͯ = 3#DEF0INE ̯ͯ = 4#DEFINE ͯ = 5#DEFINE ͯ = 6#DEFINE ͯ = 7#DEFINE ͯ = 8#DEFINE ͯ = 0#DEFINE ͯ = 1#DEFINE ͯ = 2#DEFINE ͯ = 10#DECLARE ANIMORDER(ͯ, ͯ, 10).' ' ====' N OPEN-SOURCE TOOL FOR DRAWING 640X400 VECTOR ART ON THE MEGA65#OUTPUT "VART"' #DEFINE ǯ=1' MENU SYSTEM' +------+--------+-----+------+----------+---------+------+------+------+-----+' ! LINE ! CIRCLE ! BOX ! POLY ! (X) .FILL ! PALETTE ! LOAD ! SAVE ! UNDO ! REDO!' +------+--------+-----+------+----------+---------+------+------+------+-----+' X = EXIT' ? = SHOW/HIDE MENU' CTRL+1-8 = SELECT FROM 1ST 8 COLOURS' MEGA+1-8 = SELECT FROM 2ND 8 COLOURS' CTRL+D = CHOOSE F.ROM DEFAULT PALETTE' CTRL+A = CHOOSE FROM ALTERNATE PALETTE.DECLARES'--------#DECLARE KEY$#DECLARE K,M0%, M1%, A$#DECLARE X%, Y%, W%, H%, X2%, Y2%#DECLARE MX%, MY%, MB%, MBOLD%#DECLARE MENUSELECTION = -1#DECLARE RET%#DECLARE LASTCOLOUR% = -.1#DECLARE SELECTEDCOLOUR% = 1#DECLARE OLDMENUSELECTION% = -1#DECLARE YMIN%, YMAX%, IDX%, PIDX%, PX%(20)#DECLARE REV%, Y0%, Y1%, X0%, X1%, TMP%, M, C, I%, J%, SWAPPED%#DECLARE LOADSTATE% = -4#DECLARE FILLSTATE% = 0#DECLARE LINESTATE%, LX0%,. LY0%#DECLARE CIRCLESTATE%, CX0%, CY0%, RADIUS%#DECLARE ELLIPSESTATE%, EX0%, EY0%, XRADIUS%, YRADIUS%#DECLARE BOXSTATE%, BX0%, BY0%#DECLARE POLYSTATE%, POLYIDX%=0, POLYX%(250), POLYY%(250)#DECLARE VECDATA%(12000)VECDATA%(0) = ASC("V")  ' .  "" VECDATA%(1) = ASC("E")VECDATA%(2) = ASC("C")#DECLARE VECSIZE% = 3#DECLARE STOR%(1000), STORCNT%#STRUCT  X%, Y%, W%, H%, TYPE%, STATE%, TEXT$#DEFINE ů = 0#DEFINE ů = 1#DEFINE     = 0#D.EFINE   = 1#DEFINE  = 2#DEFINE      = 3#DEFINE     = 4#DEFINE     = 5#DEFINE     = 6#DEFINE     = 7#DEFINE     = 8#DEFINE د = 9 BTNS(د) = [     _  [ 0, 0, 0, 0, ů, 0, "LINE", ],  .  _  [ 0, 0, 0, 0, ů, 0, "CIRCLE", ],  _  [ 0, 0, 0, 0, ů, 0, "ELLIPSE", ], _  [ 0, 0, 0, 0, ů, 0, "BOX", ],     _  [ 0, 0, 0, 0, ů, 0, "POLY", ],    _  [ 0, 0, 0, 0, ů, 0, "FILL", ],    _  [ 0, 0, .0, 0, ů, 0, "SAVE", ],    _  [ 0, 0, 0, 0, ů, 0, "LOAD", ],    _  [ 0, 0, 0, 0, ů, 0, "EXIT", ]     _] #DEFINE  = 63.INITBTNS'---------BTNSW%(0) = LEN(BTNSTEXT$(0))+2BTNSH%(0) = 3FOR K = 1 TO د-1 . BTNSX%(K) = BTNSX%(K-1) + BTNSW%(K-1)  BTNSW%(K) = LEN(BTNSTEXT$(K)) + 2  BTNSH%(K) = 3NEXT K.MAIN'----  GOSUB INIT     GOSUB DRAWMENUSYSTEM  GOSUB CHECKINPUT  GOSUB ENDER  END.INIT'----  SCREEN 0,640,400,4  FOR K = 0 TO 62    .READ X%    POKE $0600+K, X%  NEXT K  MOUSE ON, 1, 0  SPRITE 0,1,1  RETURN#DEFINE ү = 2#DEFINE ү = 1#DEFINE үү = 1#DEFINE үү = 2#DEFINE үү = 4#DEFINE үү = 8.CLEARMENU'----------  FO.R K=0 TO 7    EDMA 3, 640*2, 0, $40000+K*$4000  NEXT K  RETURN.DRAWMENUSYSTEM'----------------  GOSUB CLEARMENU  PEN 0,1  ' DRAW ITEMS  FOR K = 0 TO د-1    X%=BTNSX%(K)    Y%=BTNSY%(K)    W%=(X% + BTNSW%(K))    H%=(Y% + BTNSH%.(K))    PEN 0, 1    IF MENUSELECTION=K AND BTNSTYPE%(K) <> ů THEN BEGIN      BOX X%*8, Y%*8, W%*8, H%*8, 1      PEN 0, 0    BEND:ELSE BEGIN      BOX X%*8, Y%*8, W%*8, H%*8      IF BTNSTYPE%(K) = ů AND BTNSSTATE%(K)<>0 THEN/ BEGIN        PEN 0,3        BOX X%*8, Y%*8, W%*8, H%*8, 1        PEN 0,0      BEND    BEND    CHAR X%+1, Y%*8+4, ү, ү, үү, BTNSTEXT$(K)    PEN 0, 1  NEXT K  PEN 0,SELECTEDCOLOUR% : SPRITE 0,1,SELECTEDCOLOUR%  RE. 19 W .R                  .R           .R           O3T4.G H.RWM1T5 O1.A            .A           .A           .AP0HM3T9 O2A O4C O3B     O2A O4C O3B  O2A O4C O3B  HR WO4T4.GP0QM3T9 RH O3A O3A O4C   O3A O3A O4C  O3G O3G R   WO4T4.BWM1T5 O1.A          .  .A           .A           .AW.R                   .R           .R           IR WO2T4.AW .R                .R             .R           O3T4.G H.RWM1T5 O1.A          .A             .A           .AHM3T9 O2A O3B O3A   O2A O3B O3A    O2A O4C O3B  HR WO4. T4.GQM3T9 RH O3F O2A O3F  O3F O2A O3F   O3G O2A R   WO4T4.BWM1T5 O1.A          .A             .A           .AW.R                 .R             .R           IR WO2T4.AW .R                 .R           .R             .WRWM1T5 O1.A           .A       .!    .A             RHM3T9 O2A O3B O3A    O2A O3B O3A  O2A O4C O3B O4C QR HO4C O3AQM3T9 RH O3F O2A O3F  O3F O2A O3F  O3G O2A O3G O4D QR SO3BO4CIO3BWM1T5 O1.A           .A           .A             RW       .R          .R                .R           .R."WM1T5 O1.A          .R                .A           .RHM3T9 O4E O3A O2A O4C O3A IO4CO3B QR  HO4E O3A O2A O4C O3A IO4CO3B QRQM3T9 RH O2A O4D O3A O2A O3B O3A       O2A O4D O3A O2A O3B O3AWM1T5 O1.A          .R                .A           .RW     .R   .#           .R                  .R             .RWM1T5 O1.G            .R                  .GHM3T9  O4C O3G O3D    O4C O3D  O3B        O4C O3G O3D    O4G E CQM3T9 RH O3D O3B O3G   O4D SO4CDICQR O3A RH O3D O3B O3G  O4F SDEIDQR HO3BWM1T5 O1.G           .$ .R                  .GT2M8O6P0 H.E .D .C O5QB O6ICO5B QA P5 O6H.E P0 .D .C O5QB O6ICO5B QAT1M1O2 W.F  .F   .F   .FHM2P3T7 O4E O3A O2A O4C O3A IO4CO3B QR HO4E O3A O2A O4C O3A IO4CO3B QRQM2P3T7 RH O2A O4D O3A O2A O3B O3A      O2A O4D O3A O2A O3B O3A.%T1M1O2 W.D  .D   .D   .DT2M6O6P0 H.E .D .C O5QB O6ICO5B QA P5 O6H.E P0 .D .C O5QB O6ICO5B P0 QAT2M8O6 P5H.CP0 O5.B O6QC HD SCDICQ O5BA  P5O6H.CP0 O5.B P8O6QGP0FE SDEIDQCO5BT1M1O2 W.G .G .G .GHM3T7 O4C O3G O3D     O4C O3D O3B          O4C O3G O3D  O4G.& E CQM3T7 RH O3D O3B O3G   O4D SO4CDICQR O3A RH O3D O3B O3G O4F SDEIDQR HO3BT1M1O2 W.D .D .D .DT2M6O6 P5H.CP0 O5.B O6QC HD SCDICQ O5BA P5O6H.CP0 O5.B P8O6QGP0FE SDEIDQCO5BT2M8O5 H.B QA W.A QBO6C        WO5.B B QAGT1M1O1 H.A QA W.A QAA          T0QO2.'GIGGQGGGG GIGGQGGGGM3T7 O3H.B QA W.A QBO4C        WO3.B B QAGM1T7 O3H.F QE W.E O4P5QBO5C    WO4.B B QAGT1M1O2 H.F QE W.E QEE          T0QO2DIDDQDDDD DIDDQDDDDT2M6O5 H.B QA W.A QBO6C        WO5.B B QAGT2M8O5 W.AA QBO6CT0QO2FIFFQFFFF FIFFQFFFFM3T7 O/ 3W.AA QBO4CM1T7 O4W.AA QBO5CT0QO2CICCQCCCC CICCQCCCCT2M6O5 W.AA QBO6CT2M8O5 WA QBO6C O5WB QAG WA QBO6CT0QO2AIAAQAAAA GIGGQGGGG FIFFQFFFFM3T7 O3WA QBO4C O3WB QAG WA QBO4CM1T7 O4WA QBO5C O4WB QAG WA QBO5CT0QO2EIEEQEEEE DIDDQDDDD CICCQCCCCT2M6O5 WA/ QBO6C O5WB QAG WA QBO6CT2M8O5 WAQR G WB QR A W#G QRIFGSFGFGFG QE SDW.E QR W.RT0M1QO2DIDDQDDDD T1W.E .E .E .EM3T7 O3 WAQR  G WB QR A W#G QRIFGSFGFGFG QE SDW.EM1T7 O4 WAQR  G WB QR A W#G QRIFGSFGFGFG QE SDW.ET0QO1AIAAQAAAA T1W.E .E .E .ET2M6O5 WAQR /G WB QR A W#G QRIFGSFGFGFG QE SDW.EWRRRRRRP0M3T8 HO2A O4C O2F O4C R O3A  QR HO3A B A B O4C QRP0M3T8 QR HO3A B   A B O4C QR  HO2A O4C O2F O4C R O3AP0T3O4IGGGG QGG HC R WR          IGGGG QGG HC R WRO1M1T6 QA IAA QAA O1M0WFR       O1M1T6 QA IAA QAA /O1M0HFRP0M3T8 HO2A O4C O2F O4C R O3A  QR HO3A B A B O4C QRP0M3T8 QR HO3A B  A B O4C QR  HO2A O4C O2F O4C R O3AO1M1T6 QA IAA QAA O1M0WFR       O1M1T6 QA IAA QAA O1M0HFRP0T3O4IGGGG QGG HC R WR         IGGGG QGG HC R WRO1M0T1 QM0WE.F HR   WE.F HRO2M1T/8 QM0WE.F HR   WE.F HRP0M3T8 HO2A O4C O2F O4C R O3A QR HO3A B A B O4C QRP0M3T8 QR HO3A B  A B O4C QR  HO2A O4C O2F O4C R O3AO1M2T8 QM0WE.F HR    WE.F HRO2M0T1 QM0WE.F HR   WE.F HRO1M0T1 QM0WA.F HR  WA.F HRO2M1T8 QM0WA.F HR  WA.F HRP0M3T8 HO2A O4C /O2F O4C R O3A QR HO3A B A B O4C QRP0M3T8 QR HO3A B  A B O4C QR  HO2A O4C O2F O4C R O3AO1M2T8 QM0WA.F HR WA.F HRO2M0T1 QM0WA.F HR WA.F HRO2M0T1 HR M0W.E .E .E .E W.RO1M1T1 M0W.E .E .E .EP0M3T8 O3 T1W.#G .#G .#G .#GP0M3T8 O3 T1H.R W.E .E .E .EO1M1T/1 M0W.E .E .E .EO2M0T1 HR M0W.E .E .E .EM1T9 O5 W.A .R .FM1T1 O5 W.A .R .FM3T2 O3WA QBO4C O3W3WB QAG WA QBO4CM1T2 O4WA QBO5C O4W3WB QAG WA QBO5CM1T1 O5 W.R .GM1T9 O5 W.R .GM1T1O5W.A .G .FT1M1O2W.A .G .FM3T2 O3WA QBO4C O3W3WB QAG WA QBO4CM1T2 O/4WA QBO5C O4W3WB QAG WA QBO5CT1M1O1W.A .G .FM1T1 O5W.A .G .FM1T1O5 W.D .E .E .E .ET1M1O2 W.D .E .E .E .EM3T2 O3 WAQR  G WB QR A W#G QRIFGSFGFGFG QE SDW.EM1T2 O4 WAQR  G WB QR A W#G QRIFGSFGFGFG QE SDW.ET1M1O1 W.D .E .E .E .EM1T1O5 W.D .E .E .E .E/ 18 IANO 0  9  0  0  2  1536 CCORDION 12  0  12  0  1  0 ALLIOPE 0  0  15  0  0  0 RUM 0  5  5  0  3  0 LUTE 9  4  4  0  0  0 UITAR 0  9  2  1  1  0 ARPSICRD 0  9  0  0  2  512 RGAN 0  9  9  /	0  2  2048 RUMPET 8  9  4  1  2  512 YLOPHONE 0  9  0  0  0  0 LOWPUP 1000  1  0  0  15  1  100  10 LOWPDOWN 1000  1  0  0  15  2  100  10 LOWPOSC 1000  1  0  0  15  3  100  10 BANDPUP 1000  0  1  0 /
 15  1  100  10 BANDPDOWN 1000  0  1  0  15  2  100  10 BANDPOSC 1000  0  1  0  15  3  100  10 HIGHPUP 1000  0  0  1  15  1  100  10 HIGHPDOWN 1000  0  0  1  15  2  100  10 HIGHPOSC 1000  0  0  1  15  3 / 100  10 SPARE1 0  0  0  0  0  0  0  0 SPARE2 0  0  0  0  0  0  0  0  38 -1  18 -9  5  0  2  1  0  2  0  3  0  4  0 -9  15  5  0  6  0  5  0  7  0  8  0  9  4  10  0 -1  24 -9  5  11  2 -9  8   12  2 -9  15  13  2  14  2  13  2  15  0 -1  18 -9  5  16  0 -9  15  17  0 -9  13  17  0 -9  11  17  0 -9  9  17  0 -9  7  18  0                                                                                       /TURN.STORECOLOUR'------------  IF LASTCOLOUR% <> SELECTEDCOLOUR% THEN BEGIN    VECDATA%(VECSIZE%) =  : VECSIZE% = VECSIZE% + 1    VECDATA%(VECSIZE%) = SELECTEDCOLOUR% : VECSIZE% = VECSIZE% + 1    LASTCOLOUR% = SELECTEDCOLOUR% / BEND  RETURN.STORE'-----  FOR K = 0 TO STORCNT%    VECDATA%(VECSIZE%) = STOR%(K)    VECSIZE% = VECSIZE% + 1  NEXT K  RETURN.STORELINE'----------  STOR%(0) =  + 64 * BTNSSTATE%()  STOR%(1) = LX0% AND 255 : STOR%(2) = LX0% >> /8  STOR%(3) = LY0% AND 255 : STOR%(4) = LY0% >> 8  STOR%(5) = MX% AND 255 : STOR%(6) = MX% >> 8  STOR%(7) = MY% AND 255 : STOR%(8) = MY% >> 8  STORCNT% = 8 : GOSUB STORE  RETURN.ONCLICKLINE'-------------  IF LINESTATE% = 0 THEN BEGIN    GOS/UB STORECOLOUR    LX0%=MX%    LY0%=MY%    DOT MX%,MY%    LINESTATE%=1  BEND:ELSE IF LINESTATE% = 1 THEN BEGIN    LINE LX0%, LY0%, MX%, MY%    GOSUB STORELINE    LINESTATE% = 0  BEND  RETURN.STORECIRCLE'------------  STOR%(0) = / + 64 * BTNSSTATE%()  STOR%(1) = CX0% AND 255 : STOR%(2) = CX0% >> 8  STOR%(3) = CY0% AND 255 : STOR%(4) = CY0% >> 8  STOR%(5) = RADIUS% AND 255 : STOR%(6) = RADIUS% >> 8  STORCNT% = 6 : GOSUB STORE  RETURN.ONCLICKCIRCLE'--------------/-  IF CIRCLESTATE% = 0 THEN BEGIN    GOSUB STORECOLOUR    CX0%=MX%    CY0%=MY%    CIRCLESTATE%=1  BEND:ELSE IF CIRCLESTATE% = 1 THEN BEGIN    RADIUS% = SQR( (MX%-CX0%)^2 + (MY%-CY0%)^2 )    CIRCLE CX0%, CY0%, RADIUS%, BTNSSTATE%()   / GOSUB STORECIRCLE    CIRCLESTATE% = 0  BEND  RETURN.STOREELLIPSE'-------------  STOR%(0) =  + 64 * BTNSSTATE%()  STOR%(1) = EX0% AND 255 : STOR%(2) = EX0% >> 8  STOR%(3) = EY0% AND 255 : STOR%(4) = EY0% >> 8  STOR%(5) = XRADIUS/% AND 255 : STOR%(6) = XRADIUS% >> 8  STOR%(7) = YRADIUS% AND 255 : STOR%(8) = YRADIUS% >> 8  STORCNT% = 8 : GOSUB STORE  RETURN.ONCLICKELLIPSE'----------------  IF ELLIPSESTATE% = 0 THEN BEGIN    GOSUB STORECOLOUR    EX0%=MX%    EY0%=MY%/    ELLIPSESTATE%=1    BEND:ELSE IF ELLIPSESTATE% = 1 THEN BEGIN    XRADIUS% = ABS(MX%-EX0%)    YRADIUS% = ABS(MY%-EY0%)    ELLIPSE EX0%, EY0%, XRADIUS%, YRADIUS%, BTNSSTATE%()    GOSUB STOREELLIPSE    ELLIPSESTATE% = 0  BEND  RETUR/N.STOREBOX'---------    STOR%(0) =  + 64 * BTNSSTATE%()    STOR%(1) = BX0% AND 255 : STOR%(2) = BX0% >> 8    STOR%(3) = BY0% AND 255 : STOR%(4) = BY0% >> 8    STOR%(5) = MX% AND 255 : STOR%(6) = MX% >> 8    STOR%(7) = MY% AND 255 : STOR%/(8) = MY% >> 8    STORCNT% = 8 : GOSUB STORE    RETURN.ONCLICKBOX'------------  IF BOXSTATE% = 0 THEN BEGIN    GOSUB STORECOLOUR    BX0%=MX%    BY0%=MY%        BOXSTATE%=1  BEND: ELSE IF BOXSTATE% = 1 THEN BEGIN    BOX BX0%, BY0%, M/X%, MY%, BTNSSTATE%()    GOSUB STOREBOX    BOXSTATE% = 0  BEND  RETURN.FINDYMINYMAX'--------------  YMIN% = POLYY%(0)  YMAX% = POLYY%(0)  FOR IDX% = 0 TO POLYIDX%-1    IF POLYY%(IDX%) < YMIN% THEN YMIN% = POLYY%(IDX%)    IF PO/LYY%(IDX%) > YMAX% THEN YMAX% = POLYY%(IDX%)  NEXT IDX%  RETURN .ISYINLINEYRANGE'-------------------  RET% = 0: REV% = 0  Y0% = POLYY%(IDX%-1)  Y1% = POLYY%(IDX%)  IF Y0% > Y1% THEN TMP%=Y0%:Y0% = Y1%:Y1% = TMP%:REV%=1  IF Y0% <= Y% AND/ Y% < Y1% THEN RET% = 1  RETURN.CHECKLINEINTERSECT'--------------------  GOSUB ISYINLINEYRANGE  IF RET% = 0 THEN RETURN  X0% = POLYX%(IDX%-1)  X1% = POLYX%(IDX%)  IF REV%=1 THEN TMP%=X0%:X0% = X1%:X1% = TMP%  IF X0% = X1% THEN X% =X0%/:RET% = 1:RETURN  M = (Y1%-Y0%) / (X1% - X0%)  C = Y0% - M * X0%    X% = (Y% - C) / M  RET% = 1  RETURN  .FINDINTERSECTS'---------------  PIDX% = 0  ' CHECK LAST-POINT TO FIRST  POLYX%(POLYIDX%) = POLYX%(0)  POLYY%(POLYIDX%) = POLYY/%(0)  FOR IDX% = 1 TO POLYIDX%    GOSUB CHECKLINEINTERSECT    IF RET% = 1 THEN PX%(PIDX%)=X% : PIDX% = PIDX% + 1  NEXT IDX%  RETURN.SORTINTERSECTS'---------------  ' BUBBLE SORT ALGORITHM FROM: GEEKSFORGEEKS.ORG/BUBBLE-SORT  #IFDEF /  GOSUB CLEARMENU  CHAR 0,0,1,1,2,STR$(PIDX%-1)  FOR I%=0 TO PIDX%-1    CHAR 4+I%*4,0,1,1,2,STR$(PX%(I%))  NEXT I%#ENDIF  FOR I% = 0 TO PIDX%-2    SWAPPED% = 0    FOR J% = 0 TO PIDX%-I%-2      IF PX%(J%) > PX%(J%+1) THEN BEGIN        T/MP%=PX%(J%)        PX%(J%) = PX%(J%+1)        PX%(J%+1) = TMP%        SWAPPED% = 1      BEND    NEXT J%    IF SWAPPED% = 0 THEN I% = PIDX%  ' EXIT EARLY  NEXT I%#IFDEF ǯ  FOR I%=0 TO PIDX%-1    CHAR 4+I%*4,10,1,1,2,STR$(PX%(I%))  NE/XT I%  GETKEY A$#ENDIF  RETURN.DRAWHORIZONTALINTERSECTS'--------------------------  GOSUB FINDINTERSECTS  GOSUB SORTINTERSECTS  FOR IDX%=0 TO PIDX%-1 STEP 2    LINE PX%(IDX%),Y%,PX%(IDX%+1),Y%  NEXT IDX%  RETURN.FILLPOLY'--------- /  GOSUB FINDYMINYMAX  FOR Y%=YMIN% TO YMAX%    GOSUB DRAWHORIZONTALINTERSECTS  NEXT Y%  RETURN.STOREPOLY'----------  STOR%(0) =  + 64 * BTNSSTATE%()  STOR%(1) = POLYIDX%  STORCNT% = 1  FOR K = 0 TO POLYIDX%-1    MX% = POLYX%(/!K)    MY% = POLYY%(K)    STORCNT%=STORCNT%+1 : STOR%(STORCNT%) = MX% AND 255    STORCNT%=STORCNT%+1 : STOR%(STORCNT%) = MX% >> 8    STORCNT%=STORCNT%+1 : STOR%(STORCNT%) = MY% AND 255    STORCNT%=STORCNT%+1 : STOR%(STORCNT%) = MY% >> 8/"  NEXT K  GOSUB STORE  RETURN.ONCLICKPOLY'-------------  IF POLYSTATE% = 0 THEN BEGIN    GOSUB STORECOLOUR    POLYSTATE% = 1    POLYIDX% = 0  BEND    IF POLYIDX% > 0 THEN BEGIN    IF POLYX%(POLYIDX%-1)=MX% AND POLYY%(POLYIDX%-/#1)=MY% THEN BEGIN      LINE MX%,MY%,POLYX%(0),POLYY%(0)      GOSUB STOREPOLY      POLYSTATE% = 0      IF BTNSSTATE%() = 1 THEN GOSUB FILLPOLY      RETURN    BEND  BEND  POLYX%(POLYIDX%) = MX%  POLYY%(POLYIDX%) = MY%  IF POLYI/$DX% = 0 THEN BEGIN    DOT MX%, MY%  BEND:ELSE BEGIN    LINE POLYX%(POLYIDX%-1), POLYY%(POLYIDX%-1), MX%, MY%  BEND  POLYIDX% = POLYIDX% + 1  RETURN.ONCLICKFILL'-------------  IF BTNSSTATE%() = 0 THEN BTNSSTATE%()=1:ELSE BTNS/%STATE%()=0  RETURN.ONCLICKSAVE'-------------  BORDER 3  ' FOR NOW, JUST SAVE TO A SINGLE HARD-CODED FILE  ^^DOPEN #2,"@TEST.V",W,U8  FOR K = 0 TO VECSIZE%-1    PRINT #2, CHR$(VECDATA%(K));  NEXT K  DCLOSE #2  RETURN.LOADERROR'----/&------  BORDER 2  LOADSTATE% = -4  RETURN.CHECKVECHEADER'----------------  RET% = 0  IF K<>ASC("V") THEN RETURN  GET#2, K:PRINT K;  IF K<>ASC("E") THEN RETURN  GET#2, K:PRINT K;  IF K<>ASC("C") THEN RETURN  RET% = 1  VECSIZE% = 3  LOAD/'STATE%=-1  RETURN.ONCLICKLOAD'-------------  ' FOR NOW, JUST LOAD FROM A SINGLE HARD-CODED FILE  LOADSTATE% = -4  ^^DOPEN #2,"TEST.V",R,U8  DO    GET#2, K:PRINT "RD=";K;    IF ST THEN EXIT    IF LOADSTATE% = -4 THEN BEGIN      PRINT "C0 HECKVEC ";      GOSUB CHECKVECHEADER      IF RET% = 0 THEN GOSUB LOADERROR:EXIT:ELSE GOTO NXTLP    BEND    IF LOADSTATE% = -1 THEN BEGIN      PRINT "NEWCMD ";      FILLSTATE% = (K AND 64)/64      BTNSSTATE%() = FILLSTATE%      K = 0K AND 63      LOADSTATE% = K    BEND    IF LOADSTATE% =  THEN BEGIN      PRINT "COLOUR ";      GET#2,K:PRINT K;      PEN 0, K      VECDATA%(VECSIZE%) =       VECSIZE% = VECSIZE% +1      VECDATA%(VECSIZE%) = K      VECSIZE0% = VECSIZE% +1      LASTCOLOUR% = K      SELECTEDCOLOUR% = K      LOADSTATE% = -1      GOTO NXTLP    BEND    IF LOADSTATE% =  THEN BEGIN      PRINT "LINE ";      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% 0AND 255 : PRINT M1%;      LX0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      LY0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M10% AND 255 : PRINT M1%;      MX% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      MY% = M0% + (M1% << 8)      LINE LX0%, LY0%, MX%, MY%      GOSUB STORELINE      LOADSTATE% 0= -1      GOTO NXTLP    BEND    IF LOADSTATE% =  THEN BEGIN      PRINT "CIRCLE ";      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      CX0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND0 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      CY0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      RADIUS% = M0% + (M1% << 8)      CIRCLE CX0%, CY0%, 0RADIUS%, BTNSSTATE%()      GOSUB STORECIRCLE      LOADSTATE% = -1      GOTO NXTLP    BEND    IF LOADSTATE% =  THEN BEGIN      PRINT "ELLIPSE ";      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 :0 PRINT M1%;      EX0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      EY0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 2550	 : PRINT M1%;      XRADIUS% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      YRADIUS% = M0% + (M1% << 8)      ELLIPSE EX0%, EY0%, XRADIUS%, YRADIUS%, BTNSSTATE%()      GO0
SUB STOREELLIPSE      LOADSTATE% = -1      GOTO NXTLP    BEND    IF LOADSTATE% =  THEN BEGIN      PRINT "BOX ";      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      BX0% = M0% + (M1% << 8)0      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      BY0% = M0% + (M1% << 8)      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      MX% = M0% + (M1% << 8)0      GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;      GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;      MY% = M0% + (M1% << 8)      BOX BX0%, BY0%, MX%, MY%, BTNSSTATE%()      GOSUB STOREBOX      LOADSTATE% = -1      GOTO NXTLP    BEND0    IF LOADSTATE% =  THEN BEGIN      PRINT "POLY ";      GET#2,K:K = K AND 255      POLYIDX% = K      FOR K = 0 TO POLYIDX%-1        GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;        GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;        POLYX0%(K) = M0% + (M1% << 8)        GET#2,M0% : M0% = M0% AND 255 : PRINT M0%;        GET#2,M1% : M1% = M1% AND 255 : PRINT M1%;        POLYY%(K) = M0% + (M1% << 8)        IF (K>0) THEN LINE POLYX%(K-1), POLYY%(K-1), POLYX%(K), POLYY%(K)      NEXT 0K      LINE POLYX%(POLYIDX%-1),POLYY%(POLYIDX%-1),POLYX%(0),POLYY%(0)      IF BTNSSTATE%() = 1 THEN GOSUB FILLPOLY      GOSUB STOREPOLY      LOADSTATE% = -1      GOTO NXTLP    BEND.NXTLP  LOOP  DCLOSE #2  RETURN.RESETALL0ARTSTATES'--------------------  LOADSTATE% = -4  FILLSTATE% = 0  LINESTATE% = 0  CIRCLESTATE% = 0  ELLIPSESTATE% = 0  BOXSTATE% = 0  POLYSTATE% = 0  RETURN.CHECKACTIONCLICK'------------------  IF MENUSELECTION =  THEN GOSUB ON0CLICKLINE  IF MENUSELECTION =  THEN GOSUB ONCLICKCIRCLE  IF MENUSELECTION =  THEN GOSUB ONCLICKELLIPSE  IF MENUSELECTION =  THEN GOSUB ONCLICKBOX  IF MENUSELECTION =  THEN GOSUB ONCLICKPOLY  RETURN.REPOSITIONMOUS0E'----------------  MOVSPR 0, MX%, MY%  RETURN.CHECKKEYPRESS'---------------------  IF A$=CHR$(144) THEN SELECTEDCOLOUR% = 0  IF A$=CHR$(5)   THEN SELECTEDCOLOUR% = 1  IF A$=CHR$(28)  THEN SELECTEDCOLOUR% = 2  IF A$=CHR$(159) THEN SELECTED0COLOUR% = 3  IF A$=CHR$(156) THEN SELECTEDCOLOUR% = 4  IF A$=CHR$(30)  THEN SELECTEDCOLOUR% = 5  IF A$=CHR$(31)  THEN SELECTEDCOLOUR% = 6  IF A$=CHR$(158) THEN SELECTEDCOLOUR% = 7  IF A$=CHR$(129) THEN SELECTEDCOLOUR% = 8  IF A$=CHR$(149) THEN0 SELECTEDCOLOUR% = 9  IF A$=CHR$(150) THEN SELECTEDCOLOUR% = 10  IF A$=CHR$(151) THEN SELECTEDCOLOUR% = 11  IF A$=CHR$(152) THEN SELECTEDCOLOUR% = 12  IF A$=CHR$(153) THEN SELECTEDCOLOUR% = 13  IF A$=CHR$(154) THEN SELECTEDCOLOUR% = 14  IF A$0=CHR$(155) THEN SELECTEDCOLOUR% = 15  PEN 0,SELECTEDCOLOUR% : SPRITE 0,1,SELECTEDCOLOUR%  MX%=RSPPOS(0,0)  MY%=RSPPOS(0,1)  ' LEFT  IF A$=CHR$(157) THEN MX%=MX%-1:GOSUB REPOSITIONMOUSE  ' RIGHT  IF A$=CHR$(29) THEN MX%=MX%+1:GOSUB REPOSITIO0NMOUSE  ' UP  IF A$=CHR$(145) THEN MY%=MY%-1:GOSUB REPOSITIONMOUSE  ' DOWN  IF A$=CHR$(17) THEN MY%=MY%+1:GOSUB REPOSITIONMOUSE  ' RETURN/ENTER  IF A$=CHR$(13) THEN GOSUB READSCALEDMOUSE : GOSUB CHECKACTIONCLICK  RETURN.READSCALEDMOUSE0'-----------------  RMOUSE MX%, MY%, MB%  MX%=(MX%-24)*2  MY%=(MY%-50)*2  RETURN.CHECKINPUT'-----------  GET A$  IF A$="X" THEN RETURN  GOSUB CHECKKEYPRESS  GOSUB READSCALEDMOUSE  IF MB%=128 AND MBOLD%=0 THEN BEGIN    MBOLD%=128  0  GOSUB CHECKBUTTONHIT        IF RET%=1 THEN BEGIN      GOSUB RESETALLARTSTATES      IF MENUSELECTION =  THEN SCREEN CLOSE:END    BEND:ELSE BEGIN      GOSUB CHECKACTIONCLICK    BEND  BEND  IF MBOLD%=128 AND MB%=0 THEN MBOLD% = 00  'DEBUG STUFF  'A$ = STR$(MX%) + ", " + STR$(MY%) + ", " + STR$(MB%)  'PEN 0, 0  'BOX 0, 64, 150, 80, 1  'PEN 0, 1  'CHAR 0, 64, ү, ү, үү, A$  GOTO CHECKINPUT.CHECKBUTTONHIT'----------------  RET%=0  FOR K = 0 0TO د-1    X%=BTNSX%(K)*8    Y%=BTNSY%(K)*8    W%=BTNSW%(K)*8    H%=BTNSH%(K)*8    X2%=X%+W%    Y2%=Y%+H%    IF X%<=MX% AND MX%<=X2% AND Y%<=MY% AND MY%<=Y2% THEN BEGIN      OLDMENUSELECTION% = MENUSELECTION      MENUSELECTION = K 0     IF MENUSELECTION =  THEN BEGIN        GOSUB ONCLICKFILL        MENUSELECTION = OLDMENUSELECTION%      BEND: ELSE IF MENUSELECTION =  THEN BEGIN        GOSUB ONCLICKSAVE      BEND: ELSE IF MENUSELECTION =  THEN BEGIN    0    GOSUB ONCLICKLOAD      BEND      RET%=1      GOSUB DRAWMENUSYSTEM      K=د-1    BEND  NEXT K  RETURN  .ENDER'-----  SCREEN CLOSE  MOUSE OFF  RETURN.DATA'MOUSE POINTERDATA %11111111, %00000000, %00000000DATA %11111110, %000000000, %00000000DATA %11111100, %00000000, %00000000DATA %11111000, %00000000, %00000000DATA %11111100, %00000000, %00000000DATA %11101110, %00000000, %00000000DATA %11000111, %00000000, %00000000DATA %10000011, %10000000, %00000000DATA %000000001, %11000000, %00000000DATA %00000000, %11100000, %00000000DATA %00000000, %01110000, %00000000DATA %00000000, %00111000, %00000000DATA %00000000, %00011100, %00000000DATA %00000000, %00001110, %00000000DATA %00000000, %00000111, %00000000DATA %00 000000, %00000011, %10000000DATA %00000000, %00000001, %00000000DATA %00000000, %00000000, %00000000DATA %00000000, %00000000, %00000000DATA %00000000, %00000000, %00000000DATA %00000000, %00000000, %00000000                                       0 ANIMORDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ2ANIMORDER(ͯ, ͯ, 0) = ǯ0!1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ2ANIMORDER(ͯ, ͯ, 4) = ǯ1ANIMORDER(ͯ, ͯ, 00") = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ2ANIMORDER(ͯ, ͯ, 4) = ǯ1ANIMORDER(ͯ, ͯ0#, 0) = ǯ1ANIMORDER(ͯ, ̯ͯ, 1) = ǯ2ANIMORDER(ͯ, ̯ͯ, 2) = ǯ3ANIMORDER(ͯ, ̯ͯ, 0) = ǯ2ANIMORDER(ͯ, ̯ͯ, 1) = ǯ1ANIMO0$RDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ2ANIMORDER(ͯ, ͯ, 4) 0%= ǯ1ANIMORDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ2ANIMORDER(ͯ, 0&ͯ, 4) = ǯ1ANIMORDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ4ANIMORDER(ͯ, ͯ0', 4) = ǯ5ANIMORDER(ͯ, ͯ, 5) = ǯ5ANIMORDER(ͯ, ͯ, 6) = ǯ5ANIMORDER(ͯ, ͯ, 7) = ǯ5ANIMORDER(ͯ, ͯ, 8) = ǯ5ANIMORDER(ͯ, ͯ, 0) 1 = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) 1= ǯ2ANIMORDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ2ANIMORDER(ͯ, ͯ1, 4) = ǯ1ANIMORDER(ͯ, ͯ, 0) = ǯ1ANIMORDER(ͯ, ͯ, 1) = ǯ2ANIMORDER(ͯ, ͯ, 2) = ǯ3ANIMORDER(ͯ, ͯ, 3) = ǯ4ANIMORDER(ͯ, ͯ, 4) = 15ANIMORDER(ͯ, ͯ, 5) = ǯ5ANIMORDER(ͯ, ͯ, 6) = ǯ5ANIMORDER(ͯ, ͯ, 7) = ǯ5ANIMORDER(ͯ, ͯ, 8) = ǯ5#DECLARE MAXFRAME(ͯ, ͯ)MAXFRAME(1, ͯ) = 4MAXFRAME(ͯ, ͯ) = 5MAXFRAME(ͯ, ͯ) = 5MAXFRAME(ͯ, ̯ͯ) = 3MAXFRAME(ͯ, ̯ͯ) = 2MAXFRAME(ͯ, ͯ) = 5MAXFRAME(ͯ, ͯ1) = 5MAXFRAME(ͯ, ͯ) = 9MAXFRAME(ͯ, ͯ) = 2MAXFRAME(ͯ, ͯ) = 4MAXFRAME(ͯ, ͯ) = 5MAXFRAME(ͯ, ͯ) = 9.FANIM#DECLARE PLAYERFORM = 1 ' #DECLARE BADDIE1FORM = 1#DEFINE ͯ = 0#DEFINE ͯ = 1#DEFINE ͯ = 2#DEFINE ̯ͯ = 3#DEFINE ̯ͯ = 4#DEFINE ͯ = 5#DEFINE ͯ = 6#DEFINE ͯ = 7#DEFINE ͯ = 8#DEFINE ͯ = 9#D1ECLARE FORMANIM(ͯ, ͯ)FORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ̯ͯ) = ̯ͯFORMANIM(ͯ1, ̯ͯ) = ̯ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, 1	ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯFORMANIM(ͯ, ͯ) = ͯ#DECLARE PLAYERFRAME = 0#DECLARE PLAYERANIM = 0 ' ͯ#DECLARE BADDIEFRAME = 0#1
DECLARE BADDIEANIM = 0 ' ͯ.OFFSETS#DEFINE ԯ  = 0#DEFINE ԯͯ = 2#DEFINE ԯ0     = 3#DEFINE ͯԯ          = 0#DEFINE ͯԯ          = 1#DEFINE ͯԯ          = 2#DEFINE ͯ1ԯ          = 3#DEFINE ͯԯ   = 4#DEFINE ͯԯ¯    = 4#DEFINE ͯԯ¯   = 8#DEFINE ͯԯ¯    = 12#DEFINE ͯԯ¯  = 16#DEFINE ͯԯ       = 20#DECLARE BXOFFS(3)BXOFF1S(0) = ͯԯ¯BXOFFS(1) = ͯԯ¯BXOFFS(2) = ͯԯ¯BXOFFS(3) = ͯԯ¯.MUSICVARS'----------#DEFINE CHUNKMAX = 50#DECLARE CHUNKCNT, CHUNKIDX, VIDX, TMPO%, ROW#DECLARE ECHOM, ECHOB, ECHOSZ 1= .05, CHUNKRPT, ECHODELAY#DECLARE V$(5,CHUNKMAX), V#DECLARE SONG$#DECLARE V1$, V2$, V3$, V4$, V5$, V6$#DECLARE CURRFREQ, CURRDIR#STRUCT  NAME$, ATTACK, DECAY, SUSTAIN, RELEASE, WAVEFORM, PW ENVS(9) = [ _  [ "IANO",       0, 1 9,  0,  0,  2, 1536 ], _  [ "CCORDION",  12,  0, 12,  0,  1,    0 ], _  [ "ALLIOPE",    0,  0, 15,  0,  0,    0 ], _  [ "RUM",        0,  5,  5,  0,  3,    0 ], _  [ "LUTE",       9,  4,  4,  0,  0,    0 ], _  [ "UITAR",      0,  9,  2,  1,  11,    0 ], _  [ "ARPSICRD",   0,  9,  0,  0,  2,  512 ], _  [ "RGAN",       0,  9,  9,  0,  2, 2048 ], _  [ "RUMPET",     8,  9,  4,  1,  2,  512 ], _  [ "YLOPHONE",   0,  9,  0,  0,  0,    0 ]  _]#DEFINE ү = 0#DEFINE ү   = 1#DEFI1NE ү = 2#DEFINE ү  = 3#DEFINE Ư = 0#DEFINE Ư  = 1#DECLARE FSROW = 0, FSEL = -1#STRUCT  NAME$, FREQ, LP, BP, HP, RES, DIR, MIN, SWEEP FILT(10) = [ _  [ "LOWPUP",    1000, Ư,  Ư, Ư, 15, ү,   1100, 10 ], _  [ "LOWPDOWN",  1000, Ư,  Ư, Ư, 15, ү, 100, 10 ], _  [ "LOWPOSC",   1000, Ư,  Ư, Ư, 15, ү,  100, 10 ], __  [ "BANDPUP",   1000, Ư, Ư,  Ư, 15, ү,   100, 10 ], _  [ "BANDPDOWN", 1000, 1Ư, Ư,  Ư, 15, ү, 100, 10 ], _  [ "BANDPOSC",  1000, Ư, Ư,  Ư, 15, ү,  100, 10 ], __  [ "HIGHPUP",   1000, Ư, Ư, Ư,  15, ү,   100, 10 ], _  [ "HIGHPDOWN", 1000, Ư, Ư, Ư,  15, ү, 1100, 10 ], _  [ "HIGHPOSC",  1000, Ư, Ư, Ư,  15, ү,  100, 10 ], __  [ "SPARE1",    0,    Ư, Ư, Ư, 0,  ү, 0,   0  ], _  [ "SPARE2",    0,    Ư, Ư, Ư, 0,  ү, 0,   0  ], __]#DECLARE SEQCNT#DE1CLARE SEQCHUNK(200), SEQEXTRA(200)#DECLARE PLYPTR, PLYFLAG#DEFINE į = -1#DEFINE į = -2#DEFINE į = -3#DEFINE įϯ1 = -4   ' ECHO MELODY: VOICE 1 ON VOICE 4#DEFINE įϯ2 = -5   ' ECHO MELODY: VOICE 1 ON VOICE 21 + 4 + 5#DEFINE įϯ  = -6   ' ECHO BASS:   VOICE 3 ON VOICE 6#DEFINE įϯ = -7#DEFINE įϯ = -8#DEFINE į = -9#DEFINE į = -10#DEFINE į = 11#DECLARE PJUMP, PJDIR, BJUMP, BJDIR#DEFINE ӯ = 0#DEFINE 1 = 1#DEFINE ӯ = 2#DEFINE ӯ = 3#DECLARE NEXTBADDIETIME = 50, BADDIEDEADTIME = 50, BADDIESTATE#DECLARE BADDIEVISIBLE'----.MAIN'----PRINT CHR$(27)+"5"PRINT CHR$(147);BORDER 0BACKGROUND 0GOSUB LOADDATAPALIDX = 0GOSUB1 SETPALETTESONG$ = "CHABI.P"GOSUB LOADSONG.LOOP0  GOSUB INITVARS  GOSUB SHOWTITLE  GOSUB GAMEPLAY  ' GOSUB GAMEOVER  GOTO LOOP0'---------------.TRANSPARENTDMA'---------------  WPOKE $40009, SRCADDR  WPOKE $4000C, DESTADDR  WPOKE $140007, LENGTH  POKE  $40004, TRANSP  POKE $D702, 4 ' DMA LIST IN BANK 4  POKE $D701, $00 ' DMA LIST MSB  POKE $D705, $00 ' DMA LIST LSB  RETURN'----------.SHOWTITLE'----------  PRINT CHR$(147);  PRINT CHR$(14);  ' LOWER-CASE  PRINT "AY OF1 THE MPLODING OOT"  PRINT "========================="  PRINT " GAME MADE BY THE 65 COMMUNITY!"  GET KEY A$  A$=""  ' ALL REVERSE-CHAR SPACES FOR MOST OF SCREEN  EDMA 3, $F00, 160, $40800  PRINT CHR$(142);  ' UPPERCASE  RETURN'--------1-.LOADDATA'---------  PTR = $42000    FORM = ͯ  DATIDX = ԯ  BLOAD "LEVEL1-BG.DAT",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB PREPAREDOUBLECOPYLAYER  GOSUB INCREMENTPTRTONEXTFREE  FORM = ͯ  DATIDX = ԯ11  BLOAD "PLAYER.DAT",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  FORM = ͯ  DATIDX = ԯ2  BLOAD "PLAYER2.DAT",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  FORM = ͯ1  DATIDX = ԯ3  BLOAD "PLAYER3.DAT",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  FORM = ͯ  DATIDX = ԯ4  BLOAD "PLAYER4.DAT",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFRE1E  FORM = ͯ  DATIDX = ԯ  BLOAD "DUCK.DAT",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  BLOAD "PAL.BIN",P($40100),R  RETURN'---------------------------.INCREMENTPTRTONEXTFREE'--------------------1-------  PTR = TMP  SZ = WPEEK(PTR + ԯ)  'PRINT  'PRINT "INC SZ = ";SZ  'PRINT "PTR = ";HEX$(PTR + ԯ)  PTR = PTR + SZ  'GET KEY A$  RETURN'-----------.SETPALETTE'----------- (PALIDX)  PTR = $40100 + PALIDX * 116 * 3  FOR K = 0 TO 15    ' RED    POKE $D100 + K + 16, PEEK(PTR)    PTR = PTR + 1    ' GREEN    POKE $D200 + K + 16, PEEK(PTR)    PTR = PTR + 1    ' BLUE    POKE $D300 + K + 16, PEEK(PTR)    PTR = PTR + 1  NEXT K  RETURN'---------.INIT1 VARS'---------  ' CLEAR DMA LIST AREA  FOR K = 0 TO 20    POKE $40000+K, 0  NEXT K  POKE $40000, $81 ' OPT = DEST ADDR  SELECTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' 1!OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $00 '  LSB =   WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C,1" $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    '  MSB (IGNORE)  WPOKE $40010, $0000 ' MODULO (IGNORE)  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $F00, 160, $50000  EDMA 3, $A0, $20, $50F00  EDMA 3, $FA0, $4F, $51000  KN1#EELFLAG = 0  PLAYERFORM = ͯ  PLAYERDATFIXED = ԯ4  PLAYERDATIDX = PLAYERDATFIXED  BADDIEKNEELFLAG = 0  BADDIEFORM = ͯ  BADDIEDATFIXED = ԯ2  BADDIEDATIDX = BADDIEDATFIXED  PLAYERFRAME = 0  PL1$AYERANIM = FORMANIM(PLAYERFORM, ͯ)  PX = 0 : PY = 23  BX = 60 : BY = 23  PLAYERENERGY = 18  LAGPENERGY = 0  BADDIEENERGY = 0  LAGBENERGY = 0  PJUMP = 0  PJDIR = 0  BJDIR = 0  PLAYERMIRROR = 0  BADDIEMIRROR = 1  BJUMP = 01%  NEXTBADDIETIME = 50  BADDIEDEADTIME = 50  BADDIESTATE = ӯ  RETURN'-------------------.INITPETSCIIFRAMES'-------------------  TMP = PTR  MAXFRAMES(FORM) = PEEK(PTR + ԯͯ)  'PRINT  'PRINT "PTR=";HEX$(PTR + ԯ1&ͯ)  PTR = PTR + ԯ0  'PRINT  'PRINT "FORM=";FORM;" - MXFRM=";MAXFRAMES(FORM);": ";  FRMIDX = 0  DO WHILE FRMIDX < MAXFRAMES(FORM)    'PRINT FRMIDX;    FRAMEADDR(DATIDX, FRMIDX) = PTR    FRMW = PEEK(PTR + ͯԯ)1'    FRMH = PEEK(PTR + ͯԯ)        'PRINT "PTR=";HEX$(PTR);", IDX=";FRMIDX;", W=";FRMW;", H=";FRMH    PTR = PTR + ͯԯ + FRMW * FRMH    ':PRINT CHR$(147);"FRMIDX=";FRMIDX    FRMIDX = FRMIDX + 1  LOOP  PTR = TMP  RETURN2 '-------------------------.PREPAREDOUBLECOPYLAYER'-------------------------  DBLUPADDR = $52000  FOR FRAMEIDX = 0 TO MAXFRAMES(ͯ)-1    PTR = FRAMEADDR(ԯ, FRAMEIDX)    FRMX = PEEK(PTR + ͯԯ)    FRMY = PEEK(PTR + 2ͯԯ)    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    FRMX1=FRMX+FRMW-1    FRMY1=FRMY+FRMH-1    FRAMEDBLUPADDR(FRAMEIDX) = DBLUPADDR    '   FOR EACH ROW TWICE INTO SOME LOCATION IN DBLUPADDR    FOR Y2 = FRMY TO FRMY1      FOR K = 0 TO 1          ' COPY IT TO SOME PLACE IN $5.2000          EDMA 0, FRMW, (PTR + ͯԯ), DBLUPADDR          DBLUPADDR = DBLUPADDR + FRMW      NEXT K      PTR = PTR + FRMW    NEXT Y  NEXT FRAMEIDX  RET2URN'---------------.DRAWBACKGROUND'---------------   '   FRAMEIDX = ǯ   '   GOSUB DRAWPETSCIILAYER    '   RETURN  POKE $4000B, $05  ' ASSURE SOURCE BANK 5 (FOR DOUBLED-UP LAYERS)  FOR LIDX = 0 TO MAXFRAMES(ͯ)-1     ' IF LA2YERVISIBLE[LIDX] = 1 THEN BEGIN       FRAMEIDX = DRAWORDER(LIDX)       GOSUB DRAWPETSCIILAYER      'BEND  NEXT LIDX  RETURN'----------.MOVERIGHT'----------  BADDIEVISIBLE = BADDIESTATE = ӯ OR BADDIESTATE = ӯ  IF PX < 252 OR (BADDIESTATE = ӯ AND PX < 59) THEN BEGIN    PX = PX + 1  BEND:ELSE BEGIN    IF BX > 0 AND BADDIEVISIBLE THEN BEGIN      GOSUB INCROFFS      BX = BX - 1    BEND    IF BADDIESTATE = ӯ THEN BEGIN      GOSUB INCROFFS    BEND  2BEND  IF BADDIESTATE <> ӯ AND PX > 26 THEN BEGIN    IF MOD(PLAYERFRAME,2) = 0 THEN PX = PX - 1  BEND  KNEELFLAG = 0  RETURN'---------.MOVELEFT'---------  IF PX > 0 THEN BEGIN    PX = PX - 1  BEND:ELSE BEGIN    IF BX < 60 THEN 2BEGIN      GOSUB DECROFFS      BX = BX + 1    BEND  BEND  KNEELFLAG = 0  RETURN'--------------.GETUSERINPUT'--------------  GOSUB KEYBOARDINPUT  GOSUB JOYSTICKINPUT  IF A$="X" THEN BEGIN    KNEELFLAG = 0    PLAYERANIM = FORMAN2IM(PLAYERFORM, ͯ)    PLAYERFRAME = 0  BEND  RETURN'--------------.KEYBOARDINPUT'--------------  GET A$  IF A$="," AND PALIDX>0 THEN PALIDX=PALIDX-1:GOSUB SETPALETTE  IF A$="." AND PALIDX<11 THEN PALIDX=PALIDX+1:GOSUB SETPALETTE2	  IF A$="1" THEN BEGIN    =MOD(+1,2)    EDMA 3, $F00, 160, $50000    EDMA 3, $F00, 160, $40800  BEND  ' D = TOGGLE BETWEEN HUMAN AND DUCK  IF A$="D" THEN BEGIN    IF PLAYERFORM = ͯ THEN BEGIN      PLAYERFORM = ͯ  2
    PLAYERDATIDX = ԯ    BEND:ELSE BEGIN      PLAYERFORM = ͯ      PLAYERDATIDX = PLAYERDATFIXED    BEND    PLAYERANIM = FORMANIM(PLAYERFORM, ͯ)    PLAYERFRAME = 0    KNEELFLAG = 0  BEND  IF A$="<" AND PLAYER2DATFIXED > ԯ1 THEN BEGIN    PLAYERDATFIXED = PLAYERDATFIXED - 1    PLAYERDATIDX = PLAYERDATFIXED  BEND  IF A$=">" AND PLAYERDATFIXED < ԯ4 THEN BEGIN    PLAYERDATFIXED = PLAYERDATFIXED + 1    PLAYERDATIDX = PLAYER2DATFIXED  BEND  RETURN'--------------.JOYSTICKINPUT'--------------  JDIRRAW = JOY(2)  JFIRE = JDIRRAW AND 128  JDIR = JDIRRAW AND $7F  IF JDIR > 8 THEN JDIR = 0  ' HIDE ANY NONSENSICALS  ' HANDLE NO JOYSTICK INPUT CASES  ' -------------2-----------------  IF JDIRRAW=0 AND PLAYERANIM = ̯ͯ THEN BEGIN    IF PLAYERFRAME >= MAXFRAME(ͯ, ̯ͯ)-1 THEN BEGIN    KNEELFLAG = 0    PLAYERANIM = ̯ͯ    PLAYERFRAME = 0    BEND  BEND  IF JDIRRAW2 = 0 THEN RETURN  ' HANDLE CASES WITH SOME JOYSTICK INPUT  ' -------------------------------------  ' NO FIRE BUTTON MOVES  ' --------------------  IF JFIRE=0 THEN BEGIN    IF JDIR=ʯ AND PJUMP=0 THEN GOSUB MOVERIGHT    IF JDIR=ʯ AND 2PJUMP=0 THEN GOSUB MOVELEFT    IF JDIR=ʯ AND PLAYERANIM = ͯ THEN BEGIN      PLAYERANIM = ̯ͯ      PLAYERFRAME = 0    BEND    IF (JDIR=ʯ OR JDIR=ʯЯ OR JDIR=ʯЯ) AND PJUMP=0 THEN BEGIN      PLAYERANIM = 2ͯ      PJUMP = 1      IF JDIR=ʯ THEN PJDIR = 0      IF JDIR=ʯЯ THEN PJDIR = -1      IF JDIR=ʯЯ THEN PJDIR = 1      PLAYERFRAME = 0    BEND  BEND  ' FIRE BUTTON MOVES  ' -----------------  IF JFIRE = 128 AND PJUMP=0 2THEN BEGIN    IF JD(PLAYERMIRROR, JDIR)=įЯ AND PLAYERANIM = FORMANIM(PLAYERFORM, ͯ) THEN BEGIN      PLAYERANIM = FORMANIM(PLAYERFORM, ͯ)      SOUND 1 + PLAYERMIRROR * 3, 4000, 5, 1, 100, 1000, 3      IF KNEELFLA2G = 1 THEN PLAYERANIM = ͯ      PLAYERFRAME = 0    BEND    IF JD(PLAYERMIRROR, JDIR)=įί AND PLAYERANIM = ͯ THEN BEGIN      PLAYERANIM = ͯ      SOUND 1 + PLAYERMIRROR * 3, 2000, 5, 1, 100, 1000, 3      2IF KNEELFLAG = 1 THEN PLAYERANIM = ͯ      PLAYERFRAME = 0    BEND  BEND  RETURN'-----------.DRAWPLAYER'-----------  CHARACTER =   FRAMEIDX = ANIMORDER(PLAYERFORM, PLAYERANIM, PLAYERFRAME)  FX=PX : FY=PY  MIRROR = PLAY2ERMIRROR  FORM = PLAYERFORM  DATIDX = PLAYERDATIDX  GOSUB DRAWPETSCIIFRAME  RETURN'-----------.DRAWBADDIE'-----------  CHARACTER =   FRAMEIDX = ANIMORDER(BADDIEFORM, BADDIEANIM, BADDIEFRAME)  FX=BX : FY=BY  MIRROR = BADDIE2MIRROR  FORM = BADDIEFORM  DATIDX = BADDIEDATIDX  GOSUB DRAWPETSCIIFRAME  RETURN'--------------------------.CONSIDERNEXTPLAYERFRAME'--------------------------  IF PLAYERANIM = FORMANIM(PLAYERFORM, ͯ) AND (JDIR=ʯ OR JD2IR=ʯ) THEN BEGIN    PLAYERFRAME = PLAYERFRAME + 1  BEND  IF PLAYERANIM <> FORMANIM(PLAYERFORM, ͯ) THEN BEGIN    PLAYERFRAME = PLAYERFRAME + 1  BEND  IF PLAYERANIM = ̯ͯ AND JDIR=ʯ THEN BEGIN    IF PLAYERFRA2ME >= MAXFRAME(ͯ, ̯ͯ) THEN BEGIN      PLAYERFRAME = MAXFRAME(ͯ, ̯ͯ) - 1      KNEELFLAG = 1    BEND    RETURN  BEND  IF PLAYERANIM = ͯ THEN BEGIN    IF PLAYERFRAME >= MAXFRAME(ͯ, 2ͯ) THEN BEGIN      PLAYERFRAME = MAXFRAME(ͯ, ͯ) - 1    BEND  BEND  IF PJUMP > 0 THEN BEGIN    IF PJDIR>0 THEN GOSUB MOVERIGHT:GOSUB MOVERIGHT    IF PJDIR<0 THEN GOSUB MOVELEFT:GOSUB MOVELEFT    IF PJUMP = 1 THEN BE2GIN      PY = PY - 2      IF PY <= 0 THEN PJUMP = 2    BEND    IF PJUMP = 2 THEN BEGIN      PY = PY + 2      IF PY >= 23 THEN BEGIN        PY = 23        PJUMP = 0        PLAYERANIM = FORMANIM(PLAYERFORM, ͯ)        PLAYERFRAME = 02      BEND    BEND  BEND  IF PLAYERFRAME >= MAXFRAME(PLAYERFORM, PLAYERANIM) THEN BEGIN    IF PLAYERANIM = ͯ THEN BEGIN      IF PLAYERENERGY > 0 THEN BEGIN        PLAYERANIM = ̯ͯ        PLAYERFRAME = 0      BEND:ELSE 2BEGIN        PLAYERFRAME = MAXFRAME(PLAYERFORM, PLAYERANIM) - 1      BEND      RETURN    BEND    IF KNEELFLAG = 1 AND PLAYERANIM <> ̯ͯ THEN BEGIN      PLAYERANIM = ̯ͯ      PLAYERFRAME = MAXFRAME(ͯ, ͯ2̯) - 1    BEND:ELSE BEGIN      PLAYERANIM = FORMANIM(PLAYERFORM, ͯ)      PLAYERFRAME = 0    BEND  BEND  IF BADDIESTATE = ӯ OR BADDIESTATE = ӯ THEN BEGIN    IF PX > (BX + 5) THEN PLAYERMIRROR = 1    IF BX > (PX 2+ 5) THEN PLAYERMIRROR = 0  BEND:ELSE BEGIN    PLAYERMIRROR = 0  BEND  RETURN'--------------------------.CONSIDERNEXTBADDIEFRAME'--------------------------  IF BADDIESTATE = ӯ THEN BEGIN    IF BX > (PX + 5) THEN BADDIEMIRROR = 12    IF PX > (BX + 5) THEN BADDIEMIRROR = 0  BEND  IF BADDIEANIM <> ͯ THEN BEGIN    BADDIEFRAME = BADDIEFRAME + 1  BEND  IF BADDIEFRAME >= MAXFRAME(BADDIEFORM, BADDIEANIM) THEN BEGIN    IF BADDIEANIM = ͯ THEN BEGIN      2IF BADDIEENERGY > 0 THEN BEGIN        BADDIEANIM = ̯ͯ        BADDIEFRAME = 0      BEND:ELSE BEGIN        BADDIEFRAME = MAXFRAME(BADDIEFORM, BADDIEANIM) - 1      BEND      RETURN    BEND    IF BADDIEKNEELFLAG = 1 AND BADDIEAN2 IM <> ̯ͯ THEN BEGIN      BADDIEANIM = ̯ͯ      BADDIEFRAME = MAXFRAME(ͯ, ̯ͯ) - 1    BEND:ELSE BEGIN      BADDIEANIM = FORMANIM(BADDIEFORM, ͯ)      BADDIEFRAME = 0    BEND    RETURN  BEND2!  IF BADDIESTATE <> ӯ THEN RETURN  IF BADDIEANIM = ͯ THEN RETURN  GOSUB IFPLAYERFARWALKCLOSER  IF RET% = 1 THEN RETURN  GOSUB IFPLAYERNEARERWALKCAUTIOUS  IF RET% = 1 THEN RETURN  GOSUB IFPLAYERHITTABLETRYHITTING  2"IF RET% = 1 THEN RETURN  ' IF PLAYER IS TRYING TO HIT ME, CONSIDER FLEEING  RETURN'------------------------------.IFPLAYERHITTABLETRYHITTING'------------------------------  RET% = 0  ' IF PLAYER IS WITHIN HITTING DISTANCE, CONSIDER HITTING2#  IF ABS(PX-BX) >= 8 AND BADDIEANIM = ͯ THEN BEGIN    RET% = 1    K = INT(RND(1)*8)    IF K = 1 THEN BEGIN      BADDIEANIM = ͯ      BADDIEFRAME=0      SOUND 1 + BADDIEMIRROR * 3, 4000, 5, 1, 100, 1000, 3    BEND    IF K = 22$ THEN BEGIN      BADDIEANIM = ͯ      BADDIEFRAME=0      SOUND 1 + BADDIEMIRROR * 3, 2000, 5, 1, 100, 1000, 3    BEND  BEND  RETURN'------------------------------.IFPLAYERNEARERWALKCAUTIOUS'------------------------------  RET% 2%= 0  ' IF PLAYER IS NEARER, WALK AHEAD MORE CAUTIOUSLY  IF ABS(PX-BX) > 8 THEN BEGIN    IF INT(RND(1)*4) >= 3 THEN GOSUB MOVEBADDIECLOSER    RET% = 1  BEND  RETURN'-------------------------.IFPLAYERFARWALKCLOSER'-------------------------2&  RET% = 0  ' IF PLAYER IS A LONG DISTANCE AWAY, COMMIT TO WALKING CLOSER  IF ABS(PX-BX) > 20 THEN BEGIN    GOSUB MOVEBADDIECLOSER    RET% = 1  BEND  RETURN'------------------.MOVEBADDIECLOSER'------------------  BADDIEANIM = ͯ2'  BADDIEFRAME = BADDIEFRAME + 1  IF BADDIEFRAME >= MAXFRAME(BADDIEFORM, BADDIEANIM) THEN BADDIEFRAME = 0  IF BX > PX THEN BEGIN    BX = BX - 1  BEND:ELSE BEGIN    BX = BX + 1  BEND  RETURN'------------------.DRAWPETSCIIFRAME'--------3 ----------  POKE $4000B, $04  ' ASSURE SOURCE BANK 4 (FOR ORIGINAL FRAME DATA)  IF MIRROR = 1 THEN SETBIT $40006, 5:ELSE CLRBIT $40006, 5  DATAADDR = FRAMEADDR(DATIDX, FRAMEIDX)  FRMX = PEEK(DATAADDR + ͯԯ)  FRMY = PEEK(DATAADDR + ͯ3ԯ)  FRMW = PEEK(DATAADDR + ͯԯ)  FRMH = PEEK(DATAADDR + ͯԯ)  FRMX = FX ' OVERRIDE POSITION  FRMY = FY  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  CLRADDR = $51000 + FRMX + FRMY * 80  IF MIRROR = 1 THEN CLRADDR = CLRADDR 3+ FRMW - 1  CDATAADDR = DATAADDR + ͯԯ  FOR YY=FRMY TO FRMY1    ' DRAW CHARS    ' ----------    SRCADDR = CDATAADDR    DESTADDR = CLRADDR    LENGTH = FRMW    TRANSP = $FF    GOSUB TRANSPARENTDMA    CDATAADDR = CDATAADDR 3+ FRMW    CLRADDR = CLRADDR + 80    NEXT YY  IF  THEN GOSUB DRAWBOXES  GOSUB CHECKIFHITOPPONENT  RETURN'------------------.DRAWPETSCIILAYER'------------------  CLRBIT $40006, 5  DATAADDR = FRAMEADDR(ԯ, FRAMEIDX)  FRMX3 = PEEK(DATAADDR + ͯԯ)  FRMY = PEEK(DATAADDR + ͯԯ)  FRMW = PEEK(DATAADDR + ͯԯ)  FRMH = PEEK(DATAADDR + ͯԯ)  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  CLRADDR = $51000 + FRMX + FRMY * 80  CDATAADDR = DATA3ADDR + ͯԯ + FRMW * FRMH  XOFFS(FRAMEIDX) = MOD(XOFFS(FRAMEIDX) + 80, 80)  XOFFS = INT(XOFFS(FRAMEIDX))  CDATAADDR = FRAMEDBLUPADDR(FRAMEIDX)  FOR YY=FRMY TO FRMY1    ' DRAW CHARS FROM OFFSET TO END    ' -------------------------3----    SRCADDR = CDATAADDR + XOFFS    DESTADDR = CLRADDR    LENGTH = FRMW    TRANSP = $FF    GOSUB TRANSPARENTDMA    CDATAADDR = CDATAADDR + FRMW * 2    CLRADDR = CLRADDR + 80    NEXT YY  RETURN'--------.GAMEPLAY'--------  GOSUB GE3TUSERINPUT  GOSUB DRAWBACKGROUND  GOSUB DRAWSPRITES  GOSUB PAGEFLIP  GOSUB GAMELOGIC  GOSUB DRAWENERGYBARS  RET% = 0  DO WHILE RET% = 0    GOSUB PARSECURRENTSEQPTR  LOOP  GOTO GAMEPLAY  RETURN'----------------.DRAWENERGYBARS'3----------------  IF PLAYERENERGY <> LAGPENERGY THEN BEGIN    IF LAGPENERGY < PLAYERENERGY THEN BEGIN      LAGPENERGY = LAGPENERGY + 1      K = LAGPENERGY      GOSUB DRAWBLUETRIANGLE      RETURN    BEND    IF LAGPENERGY > PLAYERENERGY 3	THEN BEGIN      K = LAGPENERGY      GOSUB CLEARBLUETRIANGLE      LAGPENERGY = LAGPENERGY - 1      RETURN    BEND  BEND  IF BADDIEENERGY <> LAGBENERGY THEN BEGIN    IF LAGBENERGY < BADDIEENERGY THEN BEGIN      LAGBENERGY = LAGBENERGY 3
+ 1      K = LAGBENERGY      GOSUB DRAWREDTRIANGLE      RETURN    BEND    IF LAGBENERGY > BADDIEENERGY THEN BEGIN      K = LAGBENERGY      GOSUB CLEARREDTRIANGLE      LAGBENERGY = LAGBENERGY - 1      RETURN    BEND  BEND  RETURN'3------------------.DRAWBLUETRIANGLE'------------------  CURSOR 1 + K * 2, 48:PRINT "";  CURSOR 1 + K * 2, 49:PRINT "";  RETURN'-------------------.CLEARBLUETRIANGLE'-------------------  CURSOR 1 + K * 2, 48:PRINT " ";  CURSOR 1 + K 3* 2, 49:PRINT " ";  RETURN'-----------------.DRAWREDTRIANGLE'-----------------  CURSOR 78 - K * 2, 48:PRINT "";  CURSOR 78 - K * 2, 49:PRINT "";  RETURN'------------------.CLEARREDTRIANGLE'------------------  CURSOR 78 - K * 2, 483:PRINT " ";  CURSOR 78 - K * 2, 49:PRINT " ";  RETURN'------------.DRAWSPRITES'------------  IF BADDIESTATE = ӯ OR BADDIESTATE = ӯ THEN BEGIN    GOSUB DRAWBADDIE  BEND  GOSUB DRAWPLAYER  RETURN'----------.GAMELOGIC'---3-------  GOSUB CONSIDERNEXTPLAYERFRAME  GOSUB ASSESSBADDIESTATE  RETURN'-------------------.ASSESSBADDIESTATE'-------------------  IF BADDIESTATE = ӯ THEN BEGIN    ' CONSIDER WHEN TO SPAWN NEXT BADDIE    NEXTBADDIETIME = NEXTBA3DDIETIME - 1    IF NEXTBADDIETIME = 0 THEN BADDIESTATE = ӯ    RETURN  BEND  IF BADDIESTATE = ӯ THEN BEGIN    BADDIEFORM = ͯ    IF BADDIEDATFIXED = ԯ2 THEN BEGIN      BADDIEDATFIXED = ԯ3    BEND:3 ELSE BEGIN      BADDIEDATFIXED = ԯ2    BEND    BADDIEDATIDX = BADDIEDATFIXED    BADDIESTATE = ӯ    BX = 60 : BY = 23    BADDIEANIM = FORMANIM(BADDIEFORM, ͯ)    BADDIEFRAME = 0    BADDIEENERGY = 18    LAGB3ENERGY = 0    BADDIEMIRROR = 1    BJUMP = 0    RETURN  BEND  IF BADDIESTATE = ӯ THEN BEGIN    GOSUB CONSIDERNEXTBADDIEFRAME    IF BADDIEENERGY = 0 THEN BADDIESTATE = ӯ: BADDIEDEADTIME=50    RETURN  BEND  IF BADDIESTATE3 = ӯ THEN BEGIN    GOSUB CONSIDERNEXTBADDIEFRAME    PLAYERMIRROR = 0    BADDIEDEADTIME = BADDIEDEADTIME - 1    IF BADDIEDEADTIME = 0 THEN BADDIESTATE = ӯ:NEXTBADDIETIME=50    RETURN  BEND  RETURN'---------.PAGEFLIP'--3-------  IF  THEN BEGIN    EDMA 0, $F00, $50000, $40800    EDMA 3, $F00, 160, $50000  BEND  EDMA 0, $F00, $51000, $FF80000  ' FILL THE TOP PART  EDMA 3, $F00, $4F, $51000  RETURN'---------.INCROFFS'---------  FOR K = 0 TO ԯ3    XOFFS(K) = XOFFS(K) + OFFSAMOUNT(K)  NEXT K  RETURN'---------.DECROFFS'---------  FOR K = 0 TO ԯ    XOFFS(K) = XOFFS(K) - OFFSAMOUNT(K)  NEXT K  RETURN'----------.DRAWBOXES'----------  PTR = DATAADDR + ͯԯ3  FOR IDX = 0 TO 3    X1 = PEEK(PTR + 0)    Y1 = PEEK(PTR + 1)    X2 = PEEK(PTR + 2)    Y2 = PEEK(PTR + 3)    IF NOT (X1=0 AND Y1=0 AND X2=0 AND Y2=0) THEN BEGIN      GOSUB ADJUSTCOORDS      DRAWCOLOR = 7      IF IDX = 3 THEN BEGIN 3       DRAWCOLOR = 2        GOSUB DRAWBOX        ' GOSUB CHECKIFHITOPPONENT      BEND:ELSE BEGIN        GOSUB DRAWBOX      BEND    BEND    PTR = PTR + 4  NEXT IDX  RETURN'--------.DRAWBOX'--------  ' DRAW CORNERS  ' ------------3  X = X1 : Y = Y1 : K = үد : GOSUB DRAWCHAR  X = X2 : Y = Y1 : K = үد : GOSUB DRAWCHAR  X = X1 : Y = Y2 : K = үد : GOSUB DRAWCHAR  X = X2 : Y = Y2 : K = үد : GOSUB DRAWCHAR  ' DRAW HORIZONTALS  ' ------------3----  FOR X = X1+1 TO X2-1    Y = Y1 : K = ү : GOSUB DRAWCHAR    Y = Y2 : K = ү : GOSUB DRAWCHAR  NEXT X  ' DRAW VERTICALS  ' --------------  FOR Y = Y1+1 TO Y2-1    X = X1 : K = ү : GOSUB DRAWCHAR    X = X2 : K = 3ү : GOSUB DRAWCHAR  NEXT Y  RETURN'---------.DRAWCHAR'---------  IF PEEK($50000 + X + Y * 80) <> ү THEN BEGIN    K = K + 128  BEND:ELSE BEGIN    POKE $51000 + X + Y * 80, 1  BEND  IF DRAWCOLOR = 2 THEN POKE $51000 + X + Y *3 80, DRAWCOLOR  POKE $50000 + X + Y * 80, K  RETURN'---------------------.CHECKIFHITOPPONENT'---------------------  DATAADDR = FRAMEADDR(DATIDX, FRAMEIDX)  TMPMIRROR = MIRROR  IF CHARACTER =  THEN BEGIN    FRAMEIDX = ANIMORDER(3BADDIEFORM, BADDIEANIM, BADDIEFRAME)    OPPONENTDATAADDR = FRAMEADDR(BADDIEDATIDX, FRAMEIDX)    OPPONENTMIRROR = BADDIEMIRROR    FX=BX : FY=BY  BEND  IF CHARACTER =  THEN BEGIN    FRAMEIDX = ANIMORDER(PLAYERFORM, PLAYERANIM, PLAY3ERFRAME)    OPPONENTDATAADDR = FRAMEADDR(PLAYERDATIDX, FRAMEIDX)    OPPONENTMIRROR = PLAYERMIRROR    FX=PX : FY=PY  BEND  X1 = PEEK(DATAADDR + ͯԯ¯ + 0)  Y1 = PEEK(DATAADDR + ͯԯ¯ + 1)  X2 = PEEK(DATAADD3R + ͯԯ¯ + 2)  Y2 = PEEK(DATAADDR + ͯԯ¯ + 3)  IF X1=0 AND Y1=0 AND X2=0 AND Y2=0 THEN RETURN  GOSUB ADJUSTCOORDS  PX1 = X1  PY1 = Y1  PX2 = X2  PY2 = Y2  FRMX = PEEK(OPPONENTDATAADDR + ͯԯ)  F3RMY = PEEK(OPPONENTDATAADDR + ͯԯ)  FRMX = FRMX + FX  FRMY = FRMY + FY  FRMW = PEEK(OPPONENTDATAADDR + ͯԯ)  FRMH = PEEK(OPPONENTDATAADDR + ͯԯ)  ' ITERATE THROUGH HEAD/TORSO/FEET HITBOXES OF OPPONENT  PTR = OPPO3NENTDATAADDR + ͯԯ  FOR IDX = 0 TO 2    X1 = PEEK(PTR + 0)    Y1 = PEEK(PTR + 1)    X2 = PEEK(PTR + 2)    Y2 = PEEK(PTR + 3)    GOSUB ADJUSTCOORDS    OX1 = X1    OY1 = Y1    OX2 = X2    OY2 = Y2    GOSUB CHECKBOXCOL3 LISION    IF RET% = 1 THEN BEGIN      IF CHARACTER =  THEN BEGIN        PLAYERANIM = FORMANIM(PLAYERFORM, ͯ)        PLAYERFRAME = 0        IF PLAYERENERGY > 0 THEN PLAYERENERGY = PLAYERENERGY - 1        IF PLAYERENERGY = 0 TH3!EN BEGIN          SOUND 1 + PLAYERMIRROR * 3, 8000, 50, 1, 435, 100, 0, 4000        BEND:ELSE BEGIN          SOUND 1 + PLAYERMIRROR * 3, 8000, 10, 1, 435, 200, 0, 4000        BEND      BEND      IF CHARACTER =  THEN BEGIN        BADDIEANI3"M = FORMANIM(BADDIEFORM, ͯ)        BADDIEFRAME = 0        IF BADDIEENERGY > 0 THEN BADDIEENERGY = BADDIEENERGY - 1        IF BADDIEENERGY = 0 THEN BEGIN          SOUND 1 + BADDIEMIRROR * 3, 8000, 50, 1, 435, 100, 0, 4000        BEND:3#ELSE BEGIN          SOUND 1 + BADDIEMIRROR * 3, 8000, 10, 1, 435, 200, 0, 4000        BEND      BEND      IDX = 2  ' FORCE BAIL OUT OF FOR-LOOP UPON ANY HIT    BEND    PTR = PTR + 4  NEXT IDX  MIRROR = TMPMIRROR  PTR = FRAMEADDR(DATIDX, FRA3$MEIDX)  RETURN'-------------.ADJUSTCOORDS'-------------  IF MIRROR = 0 THEN BEGIN    X1 = FRMX + X1    Y1 = FRMY + Y1    X2 = FRMX + X2    Y2 = FRMY + Y2  BEND:ELSE BEGIN    TMPX1 = X1    X1 = FRMX + FRMW - X2 - 1    Y1 = FRMY + Y1    X23% = FRMX + FRMW - TMPX1 - 1    Y2 = FRMY + Y2  BEND  RETURN'-------------------.CHECKBOXCOLLISION'-------------------  'PRINT "";CHR$(27);"Q";PX1;PY1;PX2;PY2  'PRINT CHR$(27);"Q";OX1;OY1;OX2;OY2;  'GET KEY A$  IF NOT ((OX1 > PX2)3& OR _          (OX2 < PX1) OR _          (OY1 > PY2) OR _          (OY2 < PY1)) THEN _  BEGIN    RET% = 1  BEND:ELSE BEGIN    RET% = 0  BEND  RETURN'---------.LOADSONG'---------  DOPEN #2,(SONG$),R,U8  ' LOAD MELODY CHUNKS  ' ----3'--------------  INPUT #2, CHUNKCNT  FOR CHUNKIDX = 0 TO CHUNKCNT - 1    FOR VIDX=0 TO 5      INPUT #2,V$(VIDX, CHUNKIDX)    NEXT VIDX  NEXT CHUNKIDX  INPUT #2,TMPO%    ' LOAD ENVELOPES  ' --------------  FOR ROW = 0 TO 9    INPUT #2, EN4 VSNAME$(ROW)    INPUT #2, ENVSATTACK(ROW)    INPUT #2, ENVSDECAY(ROW)    INPUT #2, ENVSSUSTAIN(ROW)    INPUT #2, ENVSRELEASE(ROW)    INPUT #2, ENVSWAVEFORM(ROW)    INPUT #2, ENVSPW(ROW)    GOSUB SETENV  NEXT ROW  PRINT  ' LOAD FILTER P4RESETS  ' -------------------  FOR ROW = 0 TO 10    INPUT #2, FILTNAME$(ROW)    INPUT #2, FILTFREQ(ROW)    INPUT #2, FILTLP(ROW)    INPUT #2, FILTBP(ROW)    INPUT #2, FILTHP(ROW)    INPUT #2, FILTRES(ROW)    INPUT #2, FILTDIR(ROW)    INP4UT #2, FILTMIN(ROW)    INPUT #2, FILTSWEEP(ROW)  NEXT ROW  ' LOAD SEQUENCE  ' -------------  SEQCNT = 0  INPUT #2, SEQCNT  ROW = 0  DO WHILE ROW < SEQCNT    INPUT #2, SEQCHUNK(ROW)    INPUT #2, SEQEXTRA(ROW)    ROW = ROW + 1  LOOP  DC4LOSE #2  CHUNKIDX = 0  RETURN'-------.SETENV'-------  ENVELOPE ROW, ENVSATTACK(ROW), ENVSDECAY(ROW), ENVSSUSTAIN(ROW), ENVSRELEASE(ROW), ENVSWAVEFORM(ROW), ENVSPW(ROW)  RETURN'--------------------.PARSECURRENTSEQPTR'-------------4-------  RET% = 0  IF RPLAY(1)<>0 THEN RET%=1:RETURN  K = SEQCHUNK(PLYPTR)    IF K >= 0 THEN BEGIN    CHUNKIDX = K    IF CHUNKRPT <= 0 THEN CHUNKRPT = SEQEXTRA(PLYPTR)    GOSUB PLAYCHUNKIDX    'SLEEP .1    RET% = 1  BEND  IF K = į4 THEN BEGIN    K = SEQEXTRA(PLYPTR)    TEMPO (K)    TMPO% = K  BEND  IF K = į THEN BEGIN    K = SEQEXTRA(PLYPTR)    FSROW = K    FSEL = K    GOSUB APPLYSELECTEDFILTER  BEND  IF K = įϯ1 THEN ECHOM = 1 : ECHODELAY = 04  IF K = įϯ2 THEN ECHOM = 2 : ECHODELAY = 0  IF K = įϯ  THEN ECHOB = 1 : ECHODELAY = 0  IF K = įϯ THEN ECHOM = 0 : ECHOB = 0  IF K = įϯ THEN ECHOSZ = SEQEXTRA(PLYPTR)  IF K = į THEN ECHODELAY = 1 : 4ECHOM = 0 : ECHOB = 0  IF K = į THEN V = SEQEXTRA(PLYPTR) : VOL V, V  IF CHUNKRPT > 0 THEN CHUNKRPT = CHUNKRPT - 1  IF CHUNKRPT <= 0 THEN PLYPTR = PLYPTR + 1  IF K = į THEN PLYPTR = 0  IF PLYPTR >= SEQCNT THEN PLYFLAG = 0 : 4PLYPTR = -1  RETURN'--------------.PLAYCHUNKIDX'--------------  V1$ = V$(0,CHUNKIDX)  V2$ = V$(1,CHUNKIDX)  V3$ = V$(2,CHUNKIDX)  V4$ = V$(3,CHUNKIDX)  V5$ = V$(4,CHUNKIDX)  V6$ = V$(5,CHUNKIDX)  IF ECHODELAY = 1 THEN BEGIN    PLA4	Y V1$    SLEEP (ECHOSZ)    PLAY ,V2$    SLEEP (ECHOSZ)    PLAY ,,V3$    SLEEP (ECHOSZ)    PLAY ,,,V4$    SLEEP (ECHOSZ)    PLAY ,,,,V5$    SLEEP (ECHOSZ)    PLAY ,,,,,V6$    SLEEP (ECHOSZ)    RETURN  BEND  IF ECHOM = 0 AND ECHOB = 4
0 THEN BEGIN    PLAY V1$, V2$, V3$, V4$, V5$, V6$    RETURN  BEND  IF ECHOM = 1 AND ECHOB = 0 THEN BEGIN    PLAY V1$, V2$, V3$,    , V5$, V6$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$  BEND  IF ECHOM = 1 AND ECHOB = 1 THEN BEGIN    PL4AY V1$, V2$, V3$,    , V5$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$,    , V3$  BEND  IF ECHOM = 2 AND ECHOB = 0 THEN BEGIN    PLAY V1$,    , V3$,    ,    , V6$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$    SLEEP (ECHOSZ)    PLAY    ,4 V1$    SLEEP (ECHOSZ)    PLAY    ,    ,    ,    , V1$  BEND  IF ECHOM = 2 AND ECHOB = 1 THEN BEGIN    PLAY V1$,    , V3$    SLEEP (ECHOSZ)    PLAY    ,    ,    , V1$    SLEEP (ECHOSZ)    PLAY    , V1$,    ,    ,    , V3$    SLEEP (ECHOS4Z)    PLAY    ,    ,    ,    , V1$  BEND  RETURN'---------------------.APPLYSELECTEDFILTER'---------------------  IF FSEL = -1 THEN RETURN  CURRFREQ = FILTFREQ(FSEL)  CURRDIR = ү  IF   FILTDIR(FSEL) = ү _    OR FILTDIR(F4SEL) = ү THEN BEGIN    CURRFREQ = FILTMIN(FSEL)    CURRDIR = ү  BEND  IF FILTDIR(FSEL) = ү THEN BEGIN    CURRDIR = ү  BEND  FILTER 1, FILTFREQ(FSEL), FILTLP(FSEL), _          FILTBP(FSEL), FILTHP(FSEL), FILTRES w(FSEL)  FILTER 2, FILTFREQ(FSEL), FILTLP(FSEL), _          FILTBP(FSEL), FILTHP(FSEL), FILTRES(FSEL)  RETURN                                                                                                                                        4IDX)<3 THEN BEGIN      INC(FRAMEIDX) = INC(FRAMEIDX) + .2 * INCDIR(FRAMEIDX)      IF INC(FRAMEIDX) < .6 THEN BEGIN        INCDIR(FRAMEIDX) = 1        BCNT(FRAMEIDX)=BCNT(FRAMEIDX)+1      BEND      IF INC(FRAMEIDX) > 2.9 THEN BEGIN        INCDIR4(FRAMEIDX) = -1        BCNT(FRAMEIDX)=BCNT(FRAMEIDX)+1      BEND      IF BCNT(FRAMEIDX) = 2 AND INC(FRAMEIDX) > 1 THEN BEGIN        INC(FRAMEIDX) = 1        BCNT(FRAMEIDX)=BCNT(FRAMEIDX)+1      BEND    BEND    BEND  NEXT FRAMEIDX    RETURN4'----.INIT'----  BANK 0:BLOAD "ASMHELPER":BANK 128  LOGOSTATE = 0  GOSUB STOREDEFAULTCOLOURS  INCDIR(3) = -1  INC(3) = 1  ' CLEAR DMA LIST AREA  FOR K = 0 TO 20    POKE $40000+K, 0  NEXT K  POKE $40000, $81 ' OPT = DEST ADDR  SELE5CTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $00 '  LSB = 4O6HD IR AA#AHA IR A O6D #F QE I#F QD  Q.#F.EDO6.G.#FE O5G I#A O6 QE O5I#A O6QE QDIR QC.R QDIR QC.R  V1$(3)=V1$(3)+"O6Q.G.#FE O5G I#A O6QE O5I#A O6QE QDIR QC.R QDIR QC.R QDIR QC.R QDIR QC.R"  ' *** VOICE2 - GUITAR2 ***  ' ------------------------  V24$(0)="T2O5M4 QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R"  V2$(1)="T2O5M4 QAIR Q#G.R QAIR Q#G.R  O5 Q.#C .D O6I#FD O5D#FAO6Q.D IO5A#F  EGBO6Q.E O5IBG EAO6#CQ.E I#CO5A EGBO6Q.E O5IBG EAO6#CQE ID#CD"  V2$(2)="T2O5M4 QAIR Q#G.R QAIR Q#G.R  IAAO6CO5Q.AIGA 4Q.FHG IR IFQF HG IR IAAO6CO5HA IR  AAO6CO5Q.AIGA Q.FHG IRFQF HG IR Q.E .A O6E "  V2$(3)="T2O5M4 IGG#G HG IR Q.D HG IR DDGHD IR DDAQGIAQD Q.A.G#F .#A .A G  O5QEIGQ#AIG#AO6C QAIR Q#G.R QAIR Q#G.R Q.#A .A G O5QEIGQ#AIG#AO6C"  V2$(3)=V2$(3)+"QAIR Q#G.R QAI4R Q#G.R QAIR Q#G.R QAIR Q#G.R"  ' *** VOICE3 - BASS ***  ' ---------------------  V3$(0)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A   O2ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(1)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD QR IR O1A T8 O2Q.4#CQD IDE#F Q.#F O1A IA O2Q#C O1Q.E E IEBG Q.A A IA O2QC Q.E E IE O1 QB Q.A A O2IE QA"  V3$(2)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(2)=V3$(2)+"T9O2IDDDDDDDD O1#A#A#A#A#A#A#A#A #A#A#A#A#A#A#A#A O2DDFQDIDDDDDDDDDDD O1#A#A#A#A#A#A#A#A #4A#A#A T8O2QCICCC O1Q.AAIAAA"  V3$(3)="O2Q.DDIDDD O1Q.GGI#AA#A Q.#A#AI#AQ#A Q.AAIAQA O2Q.DDIO1GO2QD Q.EEIEQE O1Q.AAIAQA T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(3)=V3$(3)+"O2Q.EEIEQE O1Q.AAIAQA T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A  T47O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  ' *** VOICE4 - MELODY ***  ' -----------------------  V4$(0)=""  V4$(1)="T4O5P0 QR M2ID M4QD P5 M1O4#G H.A IAQA   O5Q.E H#F IR #F#FA QG IG#F W M5 .G P9M2O4IA O5I.B.A SG#F AGABAB QG O4IAB O5H#F SG#F Q.E.4D"  V4$(2)="O5T4P7WDHRQ.RICP5O5IDDFQ.GIFDQ.FSEDHCIFFAQGIFDSCP2H.DP5I.RICDDFQ.GIFD Q.F SED HC IFFAQGIFD IGP1H.A P7IRA"  V4$(3)="T4 IO6DD#DQDICO5#AH.#AQ.R IAA#AQAIAGP1WAP7IR"  V4$(3)=V4$(3)+"HRI#FGAQ.GI#FG#FHERIR DHDRR IR#FGAQ.GI#FG#FHERIR DHD"  RETURN4'---------.POLLPLAY'---------  IF RPLAY(1) THEN RETURN  MUSICCHUNKINDEX=MAPBARTOCHUNK(BARINDEX)    PLAY V1$(MUSICCHUNKINDEX),V3$(MUSICCHUNKINDEX),V4$(MUSICCHUNKINDEX)  SLEEP .05  PLAY ,,,V2$(MUSICCHUNKINDEX),V3$(MUSICCHUNKINDE _X),V4$(MUSICCHUNKINDEX)  BARINDEX=BARINDEX+1  IF BARINDEX=5 THEN BARINDEX=1  RETURN                                                                                                                                                                 PIDX-1,16)+16    PRINT MID$(RAINBOWSTR$,RAINIDX,1);  NEXT RAINIDX  RETURN                                                                                                                                                                               4 ~L~L~LLсLLLۄLx/ . .0/1 1j10j0 ۣ )*) h3 245 ~ ۣ")*) h3 245 ~ ۣ$)*) h3 245 ~  tX`x/ . .04 /1 1j10j0 ۣ&)*) h3 2ۣ )*) h5 4 ~ ۣ()*) h3 2ۣ")*) h5 4 ~ ۣ*)*) h3 2ۣ$)*) h5 4 ~  5X` 4!9ҍ:Ӎ;ѝ ѽҝ ҽӝ 9ѭ:ҭ;ӣۣ&)*)9ۣ()*):ۣ*)*);ۣ&)*);)ۣ()*);)ۣ*)*);)жۣ&)*9)ۣ()*:)ۣ*)4"*;)ۣ )*)9ۣ")*):ۣ$)*);ۣ )*);)ۣ")*);)ۣ$)*);)жۣ )*9)ۣ")*:)ۣ$)*;)`G FIHJ 4# !"#ۣ, =<ۣ. ?>ۣ0 A@ۣ2 CBۣ4 EDHKILA`LG0
KFFKGL 88LG7ۣ   7BBp׭JBBtBBx׎4%87<m7M=m8N@OAPJQ RfS >m7M?m8NBOCPJQ RS 憩P7 88@7@A8A8B7BC8CKF	LG`8KDKLELL`x/ . .0/1 1j10j0 V""  : "STARFIELD" %| 180 H% "AUTOLOAD ";(34);Z$;(34):: "11BOOT.C65"                                                                                                                                                                            4& ۣ )*) h3 245 ~ ۣ")*) h3 245 ~ ۣ$)*) h3 245 ~  zX` ۣ6)* ۣ8  8));))iP)`= <OJOQ 4'R 78   <m7O=m8POMPNMiMNi N +OPO NiNPiP +OPO 7iP78i 82`  M@N O PQR S 憩 MPN OP 5S 憩 M N O P S 憩 M0N OP S 憣QR M N OP + MN O P 憣  M N O P +M N OP + `	M5 ~L~L~LLˁLLcx˅ ʅ ʅ̅˅ͅ ͅj̅ͅj̅ ۣ )*) υ ΅Ѕх  ۣ")*) υ ΅Ѕх  ۣ$)*) υ ΅Ѕх   tX`x˅ ʅ ʅ̅˅5THEN CHR = 27:RETURN ' EXCLAMATION  IF CHR = 44 THEN CHR = 28:RETURN ' COMMA (SMILEY)  IF CHR = 47 THEN CHR = 29:RETURN ' FORWARD SLASH (LOVE HEART)  IF CHR = 35 THEN CHR = 30:RETURN ' # HASH (DHUFISH)  IF CHR >= 1 AND CHR <= 26 THEN CHR = CHR + 30 5
 ͅj̅ͅj̅ ۣ&)*) υ ΅ۣ )*) х Ѕ  ۣ()*) υ ΅ۣ")*) х Ѕ  ۣ*)*) υ ΅ۣ$)*) х Ѕ   5X` эՅ5 RETURN'---------------.TRANSPARENTDMA'---------------  WPOKE $40009, SRCADDR  WPOKE $4000C, DESTADDR  WPOKE $40007, LENGTH  POKE  $40004, TRANSP  POKE $D702, 4 ' DMA LIST IN BANK 4  POKE $D701, $00 ' DMA LIST MSB  POKE $D705, $00 ' DMA LI5ST LSB  RETURN'------------------.SCROLLCANVASLEFT'------------------  FOR YY = 0 TO 49    EDMA Я+ԯ+ï, _           79, $52000 + YY*80 + 78, $52000 + YY*80 + 79    POKE $52000 + YY*80, 32   NEXT YY  RETURN'------------- ------.SCROLLCANVASRIGHT'-------------------  OFFS(FIDX%) = OFFS(FIDX%) + 1  IF FIDX% = 0 THEN ADDR = $20  ' $52000  IF FIDX% = 1 THEN ADDR = $40  ' $54000  BANK 0:SYS $7E12, ADDR: BANK 128  RETURN                                             5NOPQRSש ש `	MNOPQRש ש`)



6)JJJJ6`53R8427538ۣ  87BBp׮10BBtBBx׎782m773m88L'8247358 oۣ  87BBp׮10BBtBBx׎7882773888 h`                                          ש ש`)



6)JJJJ6`53R8427538ۣ  87BBp׮10BBtBBx׎782m773m88L'82473585	6 REM CURCHAR = :AB: 107 REM PIX = :AC: 108 REM DIFFX = :AD: 109 REM DIFFY = :AE: 110 REM DELTAX = :AF: 111 REM DELTAY = :AG: 112 REM TANVAL = :AH: 113 REM ANGLE = :AI: 114 REM ANG = :AJ: 115 REM LINELENGTH = :AK: 116 REM K = :AL: 117 REM DE5BUG = :AM: 118 REM CENTREX = :AN: 119 REM CENTREY = :AO: 120 REM CENTREZ = :AP: 121 REM PX = :AQ: 122 REM PY = :AR: 123 REM PLEN = :AS: 124 REM PANG = :AT: 125 REM PIDX = :AU: 126 REM PDIST = :AV: 127 REM SQANG = :AW: 128 REM CBANGA = :AX: 15օӍׅѝ ѽҝ ҽӝ Յѭօҭׅӣۣ&)*)Յۣ()*)օۣ*)*)ׅۣ&)*);)ۣ()*);)ۣ*)*);)жۣ&)*Յ)ۣ()*օ)ۣ*)*5)ۣ )*)Յۣ")*)օۣ$)*)ׅۣ )*);)ۣ")*);)ۣ$)*);)жۣ )*Յ)ۣ")*օ)ۣ$)*ׅ)`ㅩ ⅎ免䅌慩  !5"#ۣ, م؅ۣ. ۅڅۣ0 ݅܅ۣ2 ߅ޅۣ4 䅍煭免腭݅`0
⅍煭ㅍ腩 ԅ8ㅍӅۣ   ӅBBp׭BBtBBx׎ԅӅ5؅mӅ酭مmԅ܅녭݅셩f څmӅ酭ۅmԅޅ녭߅셩 PӅ ԅ8܅Ӆ܅݅ԅ݅8ޅӅޅ߅ԅ߅	`8煭ᅍL`x˅ ʅ ʅ̅˅ͅ ͅj̅ͅj̅ ۣ )*) υ5 ΅Ѕх  ۣ")*) υ ΅Ѕх  ۣ$)*) υ ΅Ѕх   zX` ۣ6)* ۣ8  8));))iP)`	 5$ש ש `)



҅)JJJJ҅`хυR8Ѕ΅Ӆхυԅۣ  ԅӅBBp׮̅ͅBBtBBx׎Ӆԅ΅mӅӅυmԅԅLÅ8΅ЅӅυхԅۣ  ԅӅBBp׮̅ͅBBtBBx׎Ӆԅ8΅ӅӅυԅԅԅ `                                    529 REM CBANGB = :AY: 130 REM CBIDX = :AZ: 131 REM CBTMP = :BA: 132 REM PZ = :BB: 133 REM CBINCA = :BC: 134 REM CBINCB = :BD: 135 REM RETANG = :BE: 136 REM ZFACT = :BF: 137 REM DDX = :BG: 138 REM DDY = :BH: 139 REM SX = :BI: 140 REM SY = :B5J: 141 REM E = :BK: 142 REM E2 = :BL: 143 REM QLIDX = :BM: 144 REM QLCNT = :BN: 145 REM QLX1 = :BO: 146 REM QLY1 = :BP: 147 REM QLX2 = :BQ: 148 REM QLY2 = :BR: 149 REM QLVX1 = :BS: 150 REM QLVY1 = :BT: 151 REM QLVX2 = :BU: 152 REM QLVY2 = :BV5: 153 REM QLCLR = :BW: 154 REM  = :BX: 155 REM  = :A%: 156 REM A$ = :A$: 157 REM Z$ = :B$: 158 REM  = :C$: 159 REM  = :A&: 32000 32001 32002 32003 32004 32005 32006 32007 32008 32009 32010D:D"11TOKENIZED":IFDS<>0THEN?"DISC ERROR: ";D5  WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C, $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    '  MSB (IGNORE)  WPOKE $40010, $0000 ' MODULO (IGNORE)5  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32, $50000  EDMA 3, $FA0, 0, $51000  ' INIT VAR INTERFACE TO ASSEMBLY  LOC = $40020  PTR = POINTER(DEFAULTRED&(0))  GOSUB STOREPTR  PTR = POINTER(DEFAULTGREEN&(0))  GOSUB STOREPTR  PTR = POIN5TER(DEFAULTBLUE&(0))  GOSUB STOREPTR  PTR = POINTER(CURRRED&(0))  GOSUB STOREPTR  PTR = POINTER(CURRGREEN&(0))  GOSUB STOREPTR  PTR = POINTER(CURRBLUE&(0))  GOSUB STOREPTR  PTR = POINTER(DATAADDR%)  GOSUB STOREPTR  PTR = POINTER(5CDATAADDR%)  GOSUB STOREPTR  PTR = POINTER(SCRADDR%)  GOSUB STOREPTR  PTR = POINTER(CLRADDR%)  GOSUB STOREPTR  PTR = POINTER(INC%)  GOSUB STOREPTR  RETURN'---------.STOREPTR'---------  WPOKE LOC, PTR  LOC = LOC + 2  RETURN'---5------.LOADDATA'---------  PTR = $42000    BLOAD "BAS.BIN",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  RETURN'-------------------.INITPETSCIIFRAMES'-------------------  TMP = PTR  MAXFRAMES = PEEK(PTR + ԯ5ͯ)  'PRINT  'PRINT "PTR=";HEX$(PTR + ԯͯ)  PTR = PTR + ԯ0  'PRINT  'PRINT "- MXFRM=";MAXFRAMES;": "  FRMIDX = 0  DO WHILE FRMIDX < MAXFRAMES    'PRINT FRMIDX;    FRAMEADDR%(FRMIDX) = MOD(PTR,65536)   5 FRMX = PEEK(PTR + ͯԯ)    FRMY = PEEK(PTR + ͯԯ)    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    FRMX1=FRMX+FRMW-1    FRMY1=FRMY+FRMH-1    DATAADDR% = MOD(PTR, 65536)    DATAADDR% = DATAADDR% + ͯ5ԯ    CDATAADDR% = DATAADDR% + FRMW * FRMH    BANK 4    FOR Y = 0 TO FRMY1-FRMY      FOR X = 0 TO FRMX1-FRMX        IF PEEK(DATAADDR% + X + Y * FRMW) = 102 THEN BEGIN          POKE (CDATAADDR% + X + Y * FRMW), $FF        BEND      N5!EXT X    NEXT Y    BANK 128        'PRINT "PTR=";HEX$(PTR);", IDX=";FRMIDX;", W=";FRMW;", H=";FRMH    PTR = PTR + ͯԯ + FRMW * FRMH * 2    'PRINT "FRMIDX=";FRMIDX    FRMIDX = FRMIDX + 1  LOOP  PTR = TMP  RETURN'----------- 1S$:ELSE?"":D"11.POST                                                                                                                                                                                                              5 t  A126:B124:C123:D108:E254:F252:G251:H236:I127:J255:K98:L226:M97:N225:O32:P160:Q3.141592654269:    AQ(10): AR(10): BO(10): BP(10): BQ(10): BR(10): 78 *! "";:"PETLINE EXAMPLE MENU:":"--------------------":"1) LINES":"25) SQUARE":"3) MANY SQUARES":"4) DRAW CUBE" f! "5) DRAW MANY CUBES":"6) QIX LINES":B$:B$"1" 27 w! B$"2" 24 ! B$"3" 23 ! B$"4" 17 ! B$"5" 16 !	 B$"6" 12 !
 B$"1"B$"5"B$ !  3: ! BM.:BN. q" BO(BM)(6(1)160):BP(BM)((1)100):BQ(BM)((1)160):BR(BM)((1)100):BW((1)16)64:32268,1:BNBN1:RBO(BM):SBP(BM) " TBQ(BM):UBR(BM): 28:BM(BM1,10) "  13: " BD.:BC.1.9Q4Q16: 17:BC:BC.:BD.1.9Q2Q16: 17:BD: Y# AV45:A5% (   A&(12000): C%(60): D%(60):G0: h   3:H.:I.:A$",/#": 12:H.:I15:A$"RUM OOGIE!": 12:   "";:H.:I.:A270336: 10:B.:C%(.).:D%(.).:C.:D.:DB%:B&A&(D):DD1   B&255   D%(B)C:C.:BB1:C%(B)D:   B&255 9 !5"----------------.INCREMENTPTRTONEXTFREE'---------------------------  PTR = TMP  SZ = WPEEK(PTR + ԯ)  'PRINT  'PRINT "INC SZ = ";SZ  'PRINT "PTR = ";HEX$(PTR + ԯ)  PTR = PTR + SZ  'GET KEY A$  RETURN'-------5#-.DRAWBAS'--------  FRAMEIDX = ͯ  FX=-999 : FY = -999  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=FRMY(0)  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=FRMY(1)  MIRROR = 0  GOS5$UB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=FRMY(2)  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  RETURN'------------------.DRAWPETSCIIFRAME'------------------  POKE $4000B, $04  ' ASSURE SOURCE BANK 4 (FOR ORIGINAL FRAME DATA)  IF MIR     ש ש `)



҅)JJJJ҅`хυR8Ѕ΅Ӆхυԅۣ  ԅӅBBp׮̅ͅBBtBBx׎Ӆԅ΅mӅӅυmԅԅLÅ8΅ЅӅυхԅۣ  ԅӅBBp׮̅ͅBBtBBx׎Ӆԅ8΅ӅӅυԅԅԅ `                                    5& B&B&127:B&CCB& #! DD1:DD1 +!	 : S!
 #2,("ABC.LN"),R,U8::#2,B&:ST r! A&(B%)B&:B%B%1::#2: ! D1(A$):J((A$,D,1)): 17: 25 ! J32 ! HH7 ! ::: 33:HHD%(J)1: ! D: ! J0J31JJ128: " J5'32J63 "" J64J95JJ191: >" J96J127JJ223: Z" J128J159JJ64: w" J160J191JJ191: " J192J254JJ127: "  " J65J90JJ65: " J46J26: " J33J27: " J44J28: " J47J29: 	6 # J35J30:  # J1J26JJ30 &#   w#! A%C%(J):A%B%A&(A%)255:B&A&(A%):A%A%1:EB&127:B&128"";:ՙ""; #" FA&(A%):A%A%1:B$(A&(A%)):A%A%1:AHE,IF: 36:.02 ## : #$ B$;: #%  PTR = :A: #&  CHARCNT = :B: $'  MAX6WIDTH = :C: $(  TXTK = :D: $$)  X = :E: 2$*  Y = :F: D$+  DEBUG = :G: S$,  XX = :H: b$-  YY = :I: r$.  CHR = :J: $/   = :K: $0  PIDX% = :A%: $1  DIDX% = :B%: $2  CHARIDX% = :C%: $3  CHARWIDTH% = :D%: $4   = :E%: $5  S$ = :A$: %6    A%(25): V(3): W(3):AK0: AL(3): AM(3): C$(2):AU0:C$(.)"PRESENTS...":C$(1)"A SONG BY...":AV53341: A&(32): B&(32): C&(32):    D&(32): E&(32): F&(32):    52: 59: 4: 31:   AJTI   AD0    76:AD1:   AD1 2!6 128:53280,1,1: 29: 30: 75: 78: 80:AW.:AC. >!	 AD2: K!
 AD2 [! AW128 ! .:T10:32259,AW:128:AWAW1: ! .:32262:128:ACAC1:AC130AD3 !  ! AD3 !  31:.:32262:128:ACAC1:AC250AD4:AW. ! 6 	" AD4 +"  83:.:32262:128:ACAC1 :" AC360 ]" .:32268,AW:128:AWAW1: l" AW128 " 53280,.,.:"";: 78:AW.128:.:T10:32259,AW:128:AWAW1:AW:AD5: "  " AD5 " "ANATHEMA!";: " :(TIAJ).063 #  4: +# 53272,(53272)253:(27);"5";: L# M3:N999:O999:P.: 69: Y# AK. #  AM(.)6:AM(1)23:AM(2)6:R(.)44:R(1)69:R(2)107:AK1:W(.)1:V(.)1:W(1)1:V(1)1:W(2)1:V(2)1:W(3)1:V(3)1: #! AK1 #" AN.:A.2 $# R(A6
 
 
  
	   	    	 	 	 

   
               	 	 	 
 
 
 
 

  	
		 	  	 	   6       		 		 
  
  
    

  
 		                        6
  
                                        !!  !""  "##$  $%% %$6	$#  #" !  !      %&&	%	%
$	 $ 
# 	#$ # $ $ % %&&''( '	( 	'
( 
'( '('( ' & & ' & %&%% & % & % & %&& ' &'& ' '( 6
'( ( ) ()) ) * )* )  *  *! + !*"+ "*#+# +$ +% * %+ &*& )& )%( &(%($)$ ( #)# *#)"*" ) !+ !+  *+ , + , + , + , + * + *+ ** + , +,, - - .. /6/0 01 12 23 3 4 4 5 5 6 6 56 56 56 5 4 5 4 3 4 3 2 32 3 2 1 2  1!2! 1"2" 1 #2# 2$3$3% 4%3 &4&5&5% 6 %5$6$ 6#5#5 "4 "4#3#3$ < < = =6>> ? @ @ A A B B CCD DE E FE F F G F FE EDD C CB BA A @ @? ? >?> = >= < < =< =; <;; < ; : : ;  :!;! : ";" ;#<#<$ ; 6$=$< %=%>% ?% ?&@&@% A% B% B $C%C$D$ E $D #E# F #E" F "F !E! E  D! D  C! C" B"B #C# D #E$ F#F$ G$ G#H# H$I# I "J#J"K"K !L "L! h h h gg f ff eeddee f fg6ffee d dcc b b aa` __ ^ ] \ \ [ Z ZY X X Y WW X V W V V	 W 	V
 W 
VWW W X X YYZ Z[ [ [ \ \ ]]^ ^ _ _``a abb c6b c d cd d de e de de de de d c dc b c b  a  b !a! `! ` "_ !_"^" ]" ]#\#\" [" [!Z "Z!Z  [  Z [ Z Z Y Y Z XXWW V V U U V VW W X X6Y Y Z Y XYX WX W V W V U U V l lm l kkjj i j kj k k l lm mm n m 
n
 o 
n	o 	lm l k k j j k k ll mm n m n mn m n m m l 6m llm l l l l k k! k"l" m" n"n! n m  l  l !k" k# k$l $t s tuu v u v utt ss r rq qp pp q pq qr r r s s s tt u uv vwv w x 6w x wx wx wx wx w	x	 w
x
 wx wx w x w v w vwvv w v w v u uv uv uv u v u v u v u t u tu tu tu tu tu  t u! t!u" t "v "u6#v# w# w$x# x "y #y" z"y !z! z  z y zy x xw w w  x w !x !~                          6    ~~ ~ ~     !  ! !     !                              6                         !  " "! !                  6                            !! !    !            ! "      c6  A$ = :B$: %7  Z$ = :C$: !%8   = :D$: 5%9  LDATA& = :A&: G%:  VAL& = :B&: U%;   = :C&:                                                                                                                                                               6Z.:AY(1(2)):AXQ41.9QQ2:BAAV(AY):BBBA(AX):AR(AZ)AV(AY):AQ(AZ)BA(AX): 21 #  22:AQ(AZ)ANAQ(AZ)BBBF4:AR(AZ)AOAR(AZ)BBBF:AZAZ1:AX:AS4: 26:AZ.:AY(1(2)):AXQ41.9QQ2 >$ RAQ(AZ):SAR(AZ):BAAV(AY):BBBA(6AX):AR(AZ)AV(AY):AQ(AZ)BA(AX): 21: 22:AQ(AZ)ANAQ(AZ)BBBF4 $ AR(AZ)AOAR(AZ)BBBF:TAQ(AZ):UAR(AZ): 28:AZAZ1:AX:AS4: 26: $ ADAQ(AZ):AEBB:BA(ADADAEAE): 29:AIAIBC:AQ(AZ)BA(AI):BBBA(AI): 4% ADAQ(AZ):AEAR(AZ):BA6(ADADAEAE): 29:AIAIBD:AQ(AZ)BA(AI):AR(AZ)BA(AI): Q% AW.Q2Q8: 24:AW: % AV45:ATAW3Q4:AQ(.)ANAV(AT):AR(.)AOAV(AT):ATAWQ4:AQ(1)ANAV(AT):AR(1)AOAV(AT):ATAWQ4:AQ(2)ANAV(AT) '& AR(2)AOAV(AT):ATAW36Q4:AQ(3)ANAV(AT):AR(3)AOAV(AT):AS4: 26: & AU.AS2:RAQ(AU):SAR(AU):TAQ(AU1):UAR(AU1): 28:AU:RAQ(AS1):SAR(AS1):TAQ(.):UAR(.): 28: & AJ.2QQ8:R80:S50:T(8030(AJ)):U(5030(AJ)): 28:AJ: E' 32259:R((R)6256,256):S((S)256,256):T((T)256,256):U((U)256,256):32265,R,S,T,U: R' AD. d' AE.AIQ2 u' AE.AIQ2 '  ::AHAEAD:AI(AH) '! AD. '" AE.AIAIQ:AIAIQ '#  '$  '%  '& .:32262,(Z256,256),(A7A256,256),5: (' Z.Z159AA.AA99 v(( V(Z2):W(AA2):X((Z),2):Y((AA),2):AB(264192VW80): 45:X.Y.ACAC1 () X1Y.ACAC2 (* X.Y1ACAC4 (+ X1Y1ACAC8 (,  61:264192VW80,AB: (- AC.:ABAAC1: (. 6)AM(A) )$$ R(A)R(A)2:R(A)AM(A)R(A)AM(A) 0$%  J$& R(A)AM(A)ANAN2A T$' A: i$(  67: 75:M.2 $) AN2MAO(M)3 $* V(M)V(M).2W(M) $+ V(M).6 $, W(M)1:AO(M)AO(M)1: $- V(M)2.9 $. W(M)1:AO(M)AO(M)1: %/ 6$AO(M)2V(M)1 #%0 V(M)1:AO(M)AO(M)1: *%1  1%2  :%3 M: %4 .:"ASMHELPER":128:AD.: 77:W(3)1:V(3)1:A.20:262144A,.:A:262144,129:262145,0:262146,7 %&5 262147,134:262148,32:262149,0:262150,0:262151,0:262153,4096:26216                                                6!  		 
  
                              !  ! ""! !          6"    ! ! "  "## $ $ ̀ˀ ʀ ʀ   ʀ ˀ ̀  ̀   ΀ ΀  ̀΀  ̀̀ ˀ ˀʀʀɀ  Ȁ ǀǀƀ   ŀ ĀĀÀ       6#         	 	 

                          !  ! ""6%" #" "## "# ""  # !"  !À"À!Ā!   ŀ   ! ƀ ǀ ǀ Ȁ ɀ ɀ ʀ ˀ ʀ!ˀ! ʀ"ˀ" ˀ#ʀ# ɀ# ɀ$Ȁ# ǀ#ǀ"  "ǀ!Ȁ!  ! "            À  6&55,5:262156,4096:262158,5:262159,0:262160,0 &6 !3,4000,32,327680:!3,4000,.,331776:AP262176:B
(A&(.)): 58:B
(B&(.)): 58:B
(C&(.)) &7  58:B
(D&(.)): 58:B
(E&(.)): 58:B
(F&(.)): 58:B
(B%) '8  58:B
(E%): 58:B
(C%): 58:B7&ĀĀŀ ŀ ƀŀƀ ƀ  ƀ ƀ   ŀ ŀŀĀ Āπ  ЀЀ π π΀   ̀ ̀ ΀ ΀ π Ѐ  р   Ҁ Ҁ  Ҁ Ҁ Ҁ Ҁ Ҁ Ҁ Ҁ Ҁ  р р  р р!  ! 6'
(D%): 58:B
(F%): 58 '9  '': AP,B:APAP2: Q'; B270336:"BAS.BIN",P(B): 60: 66: '< CB:D(B2):BB3:E.:ED:A%(E)(B,65536):Q(B0):R(B1):F(B2):G(B3):SQF1:TRG1 '= B%(B,65536) '> B%B%20:E%B%FG:4:Y.TR:7X.SQ (? (B%XYF)102 '(@ (E%XYF),255: R(A X:Y:128:BB20FG2:EE1::BC: l(B BC:H(B0):BBH: (C M3:N999:O999:P.: 69:M0:N999:OR(.):P.: 69:M1:N999:OR(1):P.: 69:M2 (D N999:OR(2):P.: 69: )E 2621557                          !!" "# $ $ %%%$$ # $#" !     !  !"           7                     ! !"  "##  $#$ #$#  "" #" ! "!               7ABBAC2: 
)/ ABCAC4: )0 ABDAC8: -)1 ABEAC14: ?)2 ABFAC13: Q)3 ABGAC11: b)4 ABHAC7: s)5 ABIAC9: )6 ABJAC6: )7 ABKAC12: )8 ABLAC3: )9 ABMAC5: ): ABNAC10: ); ABPAC15: )<  )= AC.7ABO: *> AC1ABA: *? AC2ABB: &*@ AC3ABL: 7*A AC4ABC: H*B AC5ABM: Y*C AC6ABJ: j*D AC7ABH: {*E AC8ABD: *F AC9ABI: *G AC10ABN: *H AC11ABG: *I AC12ABK: *J AC13ABF: *K AC14ABE: *L7 AC15ABP: *M  E+N .:"MEGAPLOT":32259:AN80:AO50:(27);"5";(147);:BF(Q4): X+O  د = :A: k+P  د = :B: ~+Q  د = :C: +R  د = :D: +S  د֯ = :E: +T  د֯ = :F: +U  د֯ = :G: +V  د֯ 7= :H: ,W  دǯ̯ = :I: #,X  دǯ̯ = :J: =,Y  دů = :K: W,Z  دů = :L: r,[  دů = :M: ,\  دů = :N: ,]  د = :O: ,^  د = :P: ,_   = :Q: ,`  X1 = :R: ,a  Y1 = :S: 7,b  X2 = :T: -c  Y2 = :U: -d  DX = :V:  -e  DY = :W: /-f  MX = :X: >-g  MY = :Y: M-h  CX = :Z: ]-i  CY = :AA: s-j  CURCHAR = :AB: -k  PIX = :AC: -l  DIFFX = :AD: -m  DIFFY = :AE: -n  DELTAX = :AF: -o  DELTAY = :AG: -p  TANVAL = :A7H: -q  ANGLE = :AI: 
.r  ANG = :AJ: #.s  LINELENGTH = :AK: 2.t  K = :AL: E.u  DEBUG = :AM: Z.v  CENTREX = :AN: o.w  CENTREY = :AO: .x  CENTREZ = :AP: .y  PX = :AQ: .z  PY = :AR: .{  PLEN = :AS: .|  PANG = :AT: .}  PIDX = :AU: .~  P8	DIST = :AV:  /  SQANG = :AW: /  CBANGA = :AX: */  CBANGB = :AY: =/  CBIDX = :AZ: P/  CBTMP = :BA: `/  PZ = :BB: u/  CBINCA = :BC: /  CBINCB = :BD: /  RETANG = :BE: /  ZFACT = :BF: /  DDX = :BG: /  DDY = :BH: /  SX = 7
    A%(20): A(20): B%(20): B&(2,12288): C%(2):C%0: D%(2):D%0:E%0: E&(2):E&0: C(2): D(2): I(2): F%(60): G%(60):AH0:    16   ABTI:AAAA1: 51   AA70AA800   E%.: 56:    53:AA850AA950E%.: 100   AA3007 ! E%1: 56:AA2630 100 #!	  0!
 AH. V! D$"N DREAMLAND...":AF1:AH1: c! AH1 t! E%2: 28: !  52:(TIAB.03): !  3: " AA.:.:"ASMHELPER":128:53272,(53272)253:(27);"5";:"";:53280,.,.:B.20:A%(B)((71)80)256 " A(B)((1)50):B%(B)((1)4.5)256:B:!3,4000,32,327680:!3,4000,.,331776:!3,4000,32,335872:!3,4000,.,339968:!3,4000,32,344064 " !3,4000,.,348160:A$"ANA.LN":E%.:D(E%)1: 47:A$"SILENT.L":E%1:D(E%)2: 47:262144,129:262145,07 x# 262146,7:262147,134:262148,32:262149,0:262150,0:262151,0:262153,4096:262155,5:262156,4096:262158,5:262159,0 # 262160,0: 21:Y262198:Z
(A%(.)): 46:Z
(B%(.)): 46: #$ AF.:Q.:R.:A$"ABC.LN":E%2:D(E%)3: 47:AD.:F%(.).:G%7(.).:AE.:B.:BC%(E%):A&B&(E%,B):BB1 2$ A&255 Y$ G%(AD)AE:AE.:ADAD1:F%(AD)B: j$ A&255 27 $ A&A&127:A&AEAEA& $ BB1:BB1 $ : $ AI.AF.AF(D$) $ S((D$,AF,1)): 82: 90 $ S32 $ QQ7:AFAF17 %  :::AI1:AJS:D%(E%)F%(S): #%!  0%" AI1 >%# SAJ: 40 K%$ AG1 l%% QQG%(AJ)1:AFAF1:AI.: s%&  y%'  %( AG1 %) D%(E%)C%(E%)B&(E%,D%(E%))255 %* A&B&(E%,D%(E%)):D%(E%)D%(E%)1:JA&127:A&128E&(E%)1:E&(E%).7 R&+ KB&(E%,D%(E%)):D%(E%)D%(E%)1:B$(B&(E%,D%(E%))):D%(E%)D%(E%)1:NQJ:ORK: 76:AG. Y&,  _&-  q&. Y,Z:YY2: ~&/ A$"" &0  50:#2,(A$),R,U8::#2,A&:ST &1 B&(E%,C%(E%))A&:C%(E%)C%(E%)1::#2: 54: '2 G1:H1:I(E%).:C%(7E%).:C&.:E&(E%).:C(E%).: ='3 B.20:327680A%(B)256A(B)80,46:B: T'4 .:32271:128: p'5 T10:.:32277:128: '6 "";:C(E%).:D%(E%).:E1D%(E%)F:E. '7  '8 D%(E%)C%(E%) '9 A&B&(E%,D%(E%)):D%(E%)D%(E%)1 ': D(E%)3A&2755 (; D%(E%)FFD%(E%) (<  44: %(= JA&127 5(> D(E%)2 s(? JA&:A&B&(E%,D%(E%)):D%(E%)D%(E%)1:JJ(A&127)256: (@ A&128E&(E%)1:E&(E%). (A KB&(E%,D%(E%)):D%(E%)D%(E%)1:B$(B&(E%,D%(E%))):D%(E%)D%(E%)1 (B D(E%)2 (C7 JC(E%)78 )D  100:D%(E%)D%(E%)4:  )E  ')F  B)G NJC(E%):OK: 76:P. N)H P1 )I "";(27);"Q X,Y,PIDX,A$,OFFS=";J;K;D%(E%),(B$),C(E%):B$: )J  )K JJC(E%): )L S(B$): 82:E&(E%)1SS128 )M D(E%)1 *N 335872N7O80,S:339968NO80,1: *O D(E%)2D(E%)3 G*P 344064NO80,S:348160NO80,2: M*Q  g*R S0S31SS128: z*S S32S63 *T S64S95SS191: *U S96S127SS223: *V S128S159SS64: *W S160S191S(S127)864: +X S192S254SS127: +Y  ,+Z S65S90SS65: =+[ S46S26: N+\ S33S27: _+] S44S28: p+^ S47S29: +_ S35S30: +` S1S26SS30 +a  +b 262153,U:262156,V:262151,W:262148,X:55042,4:55041,0:55045,07                 !!"  "#  #$  $% & '  '(( ))* *+ +, --.  .// 0 /0 0 11 0170 0  /0/ /.  .- -,  ,++  *+  *+,  , , -- -  .-  .- - ,-, ,                   7          ! ! "" ##$  %$%$# " !  !                       7,4:P1-N262150,5:՜N262150,5 [)F B%A%(M):4:Q(B%0):R(B%1):F(B%2):G(B%3):128:N999QN l)G O999RO )H SQF1:TRG1:C%0Q(RG1)80:D%4096Q(RG1)80:P1D%D%F1 *I B%B%20:E%B%FG:F%V(M)256:.:32265,(R257      ! !" "# #$$ %%$$ # " "!!      	 		 
	
     7         ! " # #$$% %&& %&% $$## "" !"!  ! ! "!" "#      7      ! " # #$$ %$ %%$ %$ #$#" "!!        ! ! ! !          ! ! " # $ % %&&&%  %$ $  # # "" "# $$%& &' '(('         ! ! ! !      76,256),(T256,256),F: P*J 262153,I:262156,J:262151,K:262148,L:55042,4:55041,0:55045,0: *K !.,4000,327680,264192:!.,4000,331776,267911168:!3,4000,32,327680:!3,4000,.,331776: *L AW.128:.:T10:32256,AW:128:AW: +M A.31:A&(A7)(53504A):B&(A)(53760A):C&(A)(54016A):A: a+N A.31:D&(A)(53504A):E&(A)(53760A):F&(A)(54016A):A: v+O AC.324:AC: +P A1221:AE218(27218)(A12)9: 82:A&(A)AE:A&(43A)AE:AE137(66137)(A12)9: 82:B&(A)AE:B&(43A)A7 E !,Q AE0(110)(A12)9: 82:C&(A)AE:C&(43A)AE:A: L,R AGAE15:AF(AES4)15:AE(AGR4)AF: [,S AC330 ,T AU1:AR.:!3,80,32,2641928046: ,U AR(C$(AU)) ,V ARAR.25:B$(C$(AU),AR):AU.AS35:AS33 ,W AT46: 89: ,X  -Y 7!AAS,AT:AQ1(B$):9(AQ1,16)16:(B$,AQ,1);:AQ: +-Z  K = :A: ;-[  PTR = :B: K-\  TMP = :C: b-]  MAXFRAMES = :D: v-^  FRMIDX = :E: -_  FRMW = :F: -`  FRMH = :G: -a  SZ = :H: -b  SRCADDR = :I: -c  DESTADDR = :J: -d  LENGTH = :K7": -e  TRANSP = :L: .f  FRAMEIDX = :M: .g  FX = :N: +.h  FY = :O: >.i  MIRROR = :P: O.j  FRMX = :Q: `.k  FRMY = :R: r.l  FRMX1 = :S: .m  FRMY1 = :T: .n  YY = :U: .o  INC = :V: .p  INCDIR = :W: .q  X = :X: .r  Y = :Y: .s  TEMPR = 7#:Z: .t  TEMPG = :AA: /u  TEMPB = :AB: /v  M = :AC: 2/w  LOGOSTATE = :AD: H/x  FLIPVAR = :AE: b/y  UPPERNIBBLE = :AF: |/z  LOWERNIBBLE = :AG: /{  CLR1 = :AH: /|  CLR2 = :AI: /}  TSTART = :AJ: /~  BASSTATE = :AK: /  FRMY = :AL: /7$  ORIGFRMY = :AM: 0  FINISHCNT = :AN: 0  BCNT = :AO: /0  LOC = :AP: E0  RAINIDX = :AQ: W0  PLEN = :AR: n0  RAINBOWX = :AS: 0  RAINBOWY = :AT: 0  SUBTEXTIDX = :AU: 0  ǯ7 = :AV: 0  FADEVAL = :AW: 0  TEMPVAL = :AX:7% 0   = :AY: 1  FRAMEADDR% = :A%: 1  DATAADDR% = :B%: 31  SCRADDR% = :C%: I1  CLRADDR% = :D%: b1  CDATAADDR% = :E%: t1  INC% = :F%: 1   = :G%: 1  A$ = :A$: 1  RAINBOWSTR$ = :B$: 1  SUBTEXT$ = :C$: 1   = :D$: 1  DEFAUL TRED& = :A&: 2  DEFAULTGREEN& = :B&:  2  DEFAULTBLUE& = :C&: 72  CURRRED& = :D&: P2  CURRGREEN& = :E&: h2  CURRBLUE& = :F&: v2   = :G&:                                                                                                    7'!р"Ѐ"Ѐ#π#  $΀#΀"  "΀!  !΀ π π  πЀ ЀррӀӀ   Ԁ Ԁ Հ Հրր   ׀ ؀؀ـ  ڀ  ۀ  ۀ ۀ ۀ  ۀ ۀ  ۀڀ ڀڀ  ڀ ڀ ڀ   ـ! !ـ"7  "ـ# ؀# $؀$ ׀$׀# ׀"  " !؀!؀ ـ   ۀ                                  8 t  A126:B124:C123:D108:E254:F252:G251:H236:I127:J255:K98:L226:M97:N225:O32:P160:Q3.141592654269:    AQ(10): AR(10): BO(10): BP(10): BQ(10): BR(10): 78 *! "";:"PETLINE EXAMPLE MENU:":"--------------------":"1) LINES":"28) SQUARE":"3) MANY SQUARES":"4) DRAW CUBE" f! "5) DRAW MANY CUBES":"6) QIX LINES":B$:B$"1" 27 w! B$"2" 24 ! B$"3" 23 ! B$"4" 17 ! B$"5" 16 !	 B$"6" 12 !
 B$"1"B$"5"B$ !  3: ! BM.:BN. r" BO(BM)(8(1)160):BP(BM)((1)100):BQ(BM)((1)160):BR(BM)((1)100):BW((1)16)64:32268,BW:BNBN1:RBO(BM):SBP(BM) " TBQ(BM):UBR(BM): 28:BM(BM1,10) "  13: " BD.:BC.1.9Q4Q16: 17:BC:BC.:BD.1.9Q2Q16: 17:BD: Z# AV45:8AZ.:AY(1(2)):AXQ41.9QQ2:BAAV(AY):BBBA(AX):AR(AZ)AV(AY):AQ(AZ)BA(AX): 21 #  22:AQ(AZ)ANAQ(AZ)BBBF4:AR(AZ)AOAR(AZ)BBBF:AZAZ1:AX:AS4: 26:AZ.:AY(1(2)):AXQ41.9QQ2 ?$ RAQ(AZ):SAR(AZ):BAAV(AY):BBBA8(AX):AR(AZ)AV(AY):AQ(AZ)BA(AX): 21: 22:AQ(AZ)ANAQ(AZ)BBBF4 $ AR(AZ)AOAR(AZ)BBBF:TAQ(AZ):UAR(AZ): 28:AZAZ1:AX:AS4: 26: $ ADAQ(AZ):AEBB:BA(ADADAEAE): 29:AIAIBC:AQ(AZ)BA(AI):BBBA(AI): 5% ADAQ(AZ):AEAR(AZ):BA8(ADADAEAE): 29:AIAIBD:AQ(AZ)BA(AI):AR(AZ)BA(AI): R% AW.Q2Q8: 24:AW: % AV45:ATAW3Q4:AQ(.)ANAV(AT):AR(.)AOAV(AT):ATAWQ4:AQ(1)ANAV(AT):AR(1)AOAV(AT):ATAWQ4:AQ(2)ANAV(AT) (& AR(2)AOAV(AT):ATAW38Q4:AQ(3)ANAV(AT):AR(3)AOAV(AT):AS4: 26: & AU.AS2:RAQ(AU):SAR(AU):TAQ(AU1):UAR(AU1): 28:AU:RAQ(AS1):SAR(AS1):TAQ(.):UAR(.): 28: & AJ.2QQ8:R80:S50:T(8030(AJ)):U(5030(AJ)): 28:AJ: F' 32259:R((R8)256,256):S((S)256,256):T((T)256,256):U((U)256,256):32265,R,S,T,U: S' AD. e' AE.AIQ2 v' AE.AIQ2 '  ::AHAEAD:AI(AH) '! AD. '" AE.AIAIQ:AIAIQ '#  '$  '%  '& .:32262,(Z256,256),(8AA256,256),5: (' Z.Z159AA.AA99 w(( V(Z2):W(AA2):X((Z),2):Y((AA),2):AB(264192VW80): 45:X.Y.ACAC1 () X1Y.ACAC2 (* X.Y1ACAC4 (+ X1Y1ACAC8 (,  61:264192VW80,AB: (- AC.:ABAAC1: (. 8
:BI: /  SY = :BJ: 0  E = :BK: 0  E2 = :BL: &0  QLIDX = :BM: 90  QLCNT = :BN: K0  QLX1 = :BO: ]0  QLY1 = :BP: o0  QLX2 = :BQ: 0  QLY2 = :BR: 0  QLVX1 = :BS: 0  QLVY1 = :BT: 0  QLVX2 = :BU: 0  QLVY2 = :BV: 0  QLCLR = :B ^W: 0   = :BX: 0   = :A%: 1  A$ = :A$: 1  Z$ = :B$: *1   = :C$: 81   = :A&:                                                                                                                                                                    8ABBAC2: )/ ABCAC4: )0 ABDAC8: .)1 ABEAC14: @)2 ABFAC13: R)3 ABGAC11: c)4 ABHAC7: t)5 ABIAC9: )6 ABJAC6: )7 ABKAC12: )8 ABLAC3: )9 ABMAC5: ): ABNAC10: ); ABPAC15: )<  )= AC8.ABO: *> AC1ABA: *? AC2ABB: '*@ AC3ABL: 8*A AC4ABC: I*B AC5ABM: Z*C AC6ABJ: k*D AC7ABH: |*E AC8ABD: *F AC9ABI: *G AC10ABN: *H AC11ABG: *I AC12ABK: *J AC13ABF: *K AC14ABE: *8L AC15ABP: *M  F+N .:"MEGAPLOT":32259:AN80:AO50:(27);"5";(147);:BF(Q4): Y+O  د = :A: l+P  د = :B: +Q  د = :C: +R  د = :D: +S  د֯ = :E: +T  د֯ = :F: +U  د֯ = :G: +V  د֯8 = :H: 	,W  دǯ̯ = :I: $,X  دǯ̯ = :J: >,Y  دů = :K: X,Z  دů = :L: s,[  دů = :M: ,\  دů = :N: ,]  د = :O: ,^  د = :P: ,_   = :Q: ,`  X1 = :R: ,a  Y1 = :S: 8,b  X2 = :T: -c  Y2 = :U: -d  DX = :V: !-e  DY = :W: 0-f  MX = :X: ?-g  MY = :Y: N-h  CX = :Z: ^-i  CY = :AA: t-j  CURCHAR = :AB: -k  PIX = :AC: -l  DIFFX = :AD: -m  DIFFY = :AE: -n  DELTAX = :AF: -o  DELTAY = :AG: -p  TANVAL = :8AH: -q  ANGLE = :AI: .r  ANG = :AJ: $.s  LINELENGTH = :AK: 3.t  K = :AL: F.u  DEBUG = :AM: [.v  CENTREX = :AN: p.w  CENTREY = :AO: .x  CENTREZ = :AP: .y  PX = :AQ: .z  PY = :AR: .{  PLEN = :AS: .|  PANG = :AT: .}  PIDX = :AU: .~  8PDIST = :AV: /  SQANG = :AW: /  CBANGA = :AX: +/  CBANGB = :AY: >/  CBIDX = :AZ: Q/  CBTMP = :BA: a/  PZ = :BB: v/  CBINCA = :BC: /  CBINCB = :BD: /  RETANG = :BE: /  ZFACT = :BF: /  DDX = :BG: /  DDY = :BH: /  SX =8 :BI: /  SY = :BJ: 0  E = :BK: 0  E2 = :BL: '0  QLIDX = :BM: :0  QLCNT = :BN: L0  QLX1 = :BO: ^0  QLY1 = :BP: p0  QLX2 = :BQ: 0  QLY2 = :BR: 0  QLVX1 = :BS: 0  QLVY1 = :BT: 0  QLVX2 = :BU: 0  QLVY2 = :BV: 0  QLCLR = : _BW: 0   = :BX: 0   = :A%: 1  A$ = :A$: 1  Z$ = :B$: +1   = :C$: 91   = :A&:                                                                                                                                                                   8000,327680,264192:!.,4000,331776,267911168:!3,4000,32,327680 F(7 !3,4000,1,331776: s(8 "";:C(E%).:D%(E%).:E1D%(E%)F:E. y(9  (: D%(E%)C%(E%) (; A&B&(E%,D%(E%)):D%(E%)D%(E%)1 (< D(E%)3A&255 (= D%(E%)FFD%(E%) (>  44:8: 6,c M.49:!03216,79,335872M8078,335872M8079:335872M80,32:M: T,d C(E%)C(E%)1:E%.AC32 d,e E%1AC64 ~,f .:32274,AC:128: ,g  STARY = :A: ,h  K = :B: ,i  OFFS = :C: ,j  VER = :D: ,k  LASTFLAG = :E: ,l  LASTGROUP8IDX = :F:  -m  OLDX = :G: -n  OLDY = :H: %-o  OLDOFFS = :I: 3-p  X = :J: A-q  Y = :K: P-r  XX = :L: _-s  YY = :M: o-t  DXX = :N: -u  DYY = :O: -v  DEBUG = :P: -w  WXX = :Q: -x  WYY = :R: -y  CHR = :S: -z  TMP = :T: -{  SRCADDR = :8U: -|  DESTADDR = :V: .}  LENGTH = :W: ".~  TRANSP = :X: 2.  LOC = :Y: B.  PTR = :Z: Q.  M = :AA: e.  TSTART = :AB: w.  ADDR = :AC: .  CHARCNT = :AD: .  MAXWIDTH = :AE: .  TXTK = :AF: .  RET = :AG: .  MNSTATE = :AH: .8  WCFLAG = :AI: /  WCCHR = :AJ: /   = :AK: )/  STARX% = :A%: >/  STARVX% = :B%: Q/  DIDX% = :C%: d/  PIDX% = :D%: w/  FIDX% = :E%: /  CHARIDX% = :F%: /  CHARWIDTH% = :G%: /   = :H%: /  FNAME$ = :A$: /  A$ = :B$: /   Z$ = :C$: /  S$ = :D$: 0   = :E$: 0  VAL& = :A&: -0  LDATA& = :B&: F0  GROUPFLAG& = :C&: X0  VAL& = :D&: o0  REVFLAG& = :E&: }0   = :F&:                                                                                                 84: )G  )H  *I NJC(E%):OK: 78:P. $*J P1 i*K "";(27);"Q X,Y,PIDX,A$,OFFS=";J;K;D%(E%),(B$),C(E%):B$: p*L  *M JJC(E%): *N S(B$): 84:E&(E%)1SS128 *O D(E%)1 *P 335872NO80,S:339968NO80,1: *Q D(E%)28FLAG = :AI: /  WCCHR = :AJ: /   = :AK: $/  STARX% = :A%: 9/  STARVX% = :B%: L/  DIDX% = :C%: _/  PIDX% = :D%: r/  FIDX% = :E%: /  CHARIDX% = :F%: /  CHARWIDTH% = :G%: /   = :H%: /  FNAME$ = :A$: /  A$ = :B$: /  Z$ =  :C$: /  S$ = :D$: 0   = :E$: 0  VAL& = :A&: (0  LDATA& = :B&: A0  GROUPFLAG& = :C&: S0  VAL& = :D&: j0  REVFLAG& = :E&: x0   = :F&:                                                                                                      8) SQUARE":"3) MANY SQUARES":"4) DRAW CUBE" f! "5) DRAW MANY CUBES":"6) QIX LINES":B$:B$"1" 27 w! B$"2" 24 ! B$"3" 23 ! B$"4" 17 ! B$"5" 16 !	 B$"6" 12 !
 B$"1"B$"5"B$ !  3: ! BM.:BN. o" BO(BM)(8) SQUARE":"3) MANY SQUARES":"4) DRAW CUBE" f! "5) DRAW MANY CUBES":"6) QIX LINES":B$:B$"1" 27 w! B$"2" 24 ! B$"3" 23 ! B$"4" 17 ! B$"5" 16 !	 B$"6" 12 !
 B$"1"B$"5"B$ !  3: ! BM.:BN. i" BO(BM)(8 (1)160):BP(BM)((1)100):BQ(BM)((1)160):BR(BM)((1)100):BNBN1:RBO(BM):SBP(BM):TBQ(BM):UBR(BM) " A.,.:(27);"QX1,Y1,X2,Y2=",R,S,T,U: 28:A$:BM(BM1,10) "  13: " BD.:BC.1.9Q4Q16: 17:BC:BC.:BD.1.9Q2Q16: 17:8!BD: i# AV45:AZ.:AY(1(2)):AXQ41.9QQ2:BAAV(AY):BBBA(AX):AR(AZ)AV(AY):AQ(AZ)BA(AX): 21 #  22:AQ(AZ)ANAQ(AZ)BBBF4:AR(AZ)AOAR(AZ)BBBF:AZAZ1:AX:AS4: 26:AZ.:AY(1(2)):AXQ41.9QQ2 N$ RAQ(AZ):SAR(AZ):BAA8"V(AY):BBBA(AX):AR(AZ)AV(AY):AQ(AZ)BA(AX): 21: 22:AQ(AZ)ANAQ(AZ)BBBF4 $ AR(AZ)AOAR(AZ)BBBF:TAQ(AZ):UAR(AZ): 28:AZAZ1:AX:AS4: 26: $ ADAQ(AZ):AEBB:BA(ADADAEAE): 29:AIAIBC:AQ(AZ)BA(AI):BBBA(AI): D% ADAQ(A8#Z):AEAR(AZ):BA(ADADAEAE): 29:AIAIBD:AQ(AZ)BA(AI):AR(AZ)BA(AI): a% AW.Q2Q8: 24:AW: % AV45:ATAW3Q4:AQ(.)ANAV(AT):AR(.)AOAV(AT):ATAWQ4:AQ(1)ANAV(AT):AR(1)AOAV(AT):ATAWQ4:AQ(2)ANAV(AT) 7& AR(2)AOA8$V(AT):ATAW3Q4:AQ(3)ANAV(AT):AR(3)AOAV(AT):AS4: 26: & AU.AS2:RAQ(AU):SAR(AU):TAQ(AU1):UAR(AU1): 28:AU:RAQ(AS1):SAR(AS1):TAQ(.):UAR(.): 28: & AJ.2QQ8:R80:S50:T(8030(AJ)):U(5030(AJ)): 28:AJ: U' 8%32259:R((R)256,256):S((S)256,256):T((T)256,256):U((U)256,256):32265,R,S,T,U: b' AD. t' AE.AIQ2 ' AE.AIQ2 '  ::AHAEAD:AI(AH) '! AD. '" AE.AIAIQ:AIAIQ '#  '$  '%  (& .:32262,8&(Z256,256),(AA256,256),5: *(' Z.Z159AA.AA99 (( V(Z2):W(AA2):X((Z),2):Y((AA),2):AB(264192VW80): 45:X.Y.ACAC1 () X1Y.ACAC2 (* X.Y1ACAC4 (+ X1Y1ACAC8 (,  61:264192VW80,AB: (- AC.:A8'BAAC1: 	). ABBAC2: )/ ABCAC4: +)0 ABDAC8: =)1 ABEAC14: O)2 ABFAC13: a)3 ABGAC11: r)4 ABHAC7: )5 ABIAC9: )6 ABJAC6: )7 ABKAC12: )8 ABLAC3: )9 ABMAC5: ): ABNAC10: ); ABPAC15:8  )<  *= AC.ABO: *> AC1ABA: %*? AC2ABB: 6*@ AC3ABL: G*A AC4ABC: X*B AC5ABM: i*C AC6ABJ: z*D AC7ABH: *E AC8ABD: *F AC9ABI: *G AC10ABN: *H AC11ABG: *I AC12ABK: *J AC13ABF: *K                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 