#OUTPUT "LINE"' ÀEYS:' ----'  ’P/ƒOWN/ÃEFT/“IGHT = ÕOVE CURSOR POSITION'  √‘“Ã+9/0 = ”ET REVERSE ON/OFF'  ∆1 = LOAD FILE'  ∆3 = SAVE FILE'  ∆5 = PLAY DATA'  ∆7 = TOGGLE GROUP FLAG'       - ADDS $FF (START) OR $FE (STOP) TO DATA STREAM'         THE INTENT IS TO DRAW SUCH GROUPS IN ONE HIT'         (RATHER THAN CHAR BY CHAR)'  ∆9 = TOGGLE BETWEEN VERSION 1 OR 2 OF FILE FORMAT (DEFAULT VER2)'  ¡Ã‘+ÃEFT/“IGHT = SCROLL CANVAS LEFT/RIGHT.DECLARES'--------#DECLARE A$, Z$, LOC, K, V, DEBUG=0#DECLARE X=0, Y=0, XX, YY#DECLARE T0=0#DECLARE MODIFIED%=0#DECLARE OLDX, OLDY, OLDOFFS#DECLARE FNAME$, ALTØKEY#DECLARE LDATA&(12288), DIDX%=0, PIDX%=0#DECLARE GROUPØFLAG&, VAL&, REVØFLAG& = 0#DECLARE OFFS, VER=2#DECLARE LASTFLAG, LASTØGROUPØIDX.DEFINES'-------#DEFINE œ–Ø√œ–Ÿ = 0#DEFINE œ–ØÕ…ÿ  = 1#DEFINE œ–Ø”◊¡– = 2#DEFINE œ–Ø∆…ÃÃ = 3#DEFINE ƒ”‘Øƒ≈√ = 32#DEFINE ”“√Øƒ≈√ = 16.KEYS'----#DEFINE À≈ŸØ’– = "ë"#DEFINE À≈ŸØƒœ◊Œ = ""#DEFINE À≈ŸØÃ≈∆‘ = "ù"#DEFINE À≈ŸØ“…«»‘ = ""#DEFINE À≈ŸØ”–¡√≈ = " "#DEFINE À≈ŸØƒ≈Ã = ""#DEFINE À≈ŸØ√‘“ÃØ◊ = ""#DEFINE À≈ŸØ√‘“ÃØ’ = ""#DEFINE À≈ŸØÕ≈«¡Ø— = "´"#DEFINE À≈ŸØ∆1 = "Ö"#DEFINE À≈ŸØ∆3 = "Ü"#DEFINE À≈ŸØ∆4 = "ä"#DEFINE À≈ŸØ∆5 = "á"#DEFINE À≈ŸØ∆6 = "ã"#DEFINE À≈ŸØ∆7 = "à"#DEFINE À≈ŸØ∆8 = "å"#DEFINE À≈ŸØ∆9 = ""#DEFINE À≈ŸØ∆10 = ""#DEFINE À≈ŸØ“≈‘’“Œ = CHR$(13)#DEFINE À≈ŸØ≈”√¡–≈ = CHR$(27)#DEFINE À≈ŸØ”»…∆‘Ø“≈‘’“Œ = CHR$(141)#DEFINE À≈ŸØ”»…∆‘Ø–Ã’” = "€"#DEFINE À≈ŸØ”»…∆‘ØÕ…Œ’” = "›"#DEFINE À≈ŸØ“≈÷ØœŒ = ""#DEFINE À≈ŸØ“≈÷Øœ∆∆ = "í"#DEFINE À≈ŸØ‘¡¬ = CHR$(9)#DEFINE À≈ŸØ»œÕ≈ = ""#DEFINE À≈ŸØ√Ã“  = "ì"#DEFINE À≈ŸØÃœ◊≈“√¡”≈ = CHR$(14)#DEFINE À≈ŸØ’––≈“√¡”≈ = CHR$(142)#DEFINE À≈ŸØ¬≈≈– = CHR$(7)#DEFINE À≈ŸØ…Œ”‘ = "î"#DEFINE À≈ŸØƒ≈Ã  = ""#DEFINE À≈ŸØÕ≈«¡ØÀ = "°"#DEFINE À≈ŸØÕ≈«¡Ø  = "µ"#DEFINE À≈ŸØÕ≈«¡Ø» = "¥"#DEFINE À≈ŸØÕ≈«¡ØÃ = "∂"GOSUB INIT.MAINGOSUB CHECKØINPUTGOSUB SHOWØCURSORGOTO MAIN'----.INIT'----  KEY OFF  ' SWITCH BACK TO UPPER-CASE  ' POKE $D018, PEEK($D018) AND $FD  OLDX = -1 : OLDY = -1 : OLDOFFS = 0  DIDX% = 0  GROUPØFLAG& = 0 : REVØFLAG& = 0  PRINT "ì";  POKE $D020, 11  POKE $D021, 0  OFFS = 0  RETURN'-----------.CHECKØINPUT'-----------  GET A$  GOSUB CHECKØALTØKEYØINPUTS  IF A$<>"" THEN GOSUB DRAWØINFO  IF A$=À≈ŸØÃ≈∆‘ AND X>0 THEN GOSUB RESTOREØCHAR : X=X-1 : RETURN  IF A$=À≈ŸØ“…«»‘ AND X<78 THEN GOSUB RESTOREØCHAR : X=X+1 : RETURN  IF A$=À≈ŸØ’– AND Y>0 THEN GOSUB RESTOREØCHAR : Y=Y-1 : RETURN            IF A$=À≈ŸØƒœ◊Œ AND Y<49 THEN GOSUB RESTOREØCHAR : Y=Y+1 : RETURN  IF A$=À≈ŸØ∆1 THEN GOSUB LOADØFILE : RETURN  IF A$=À≈ŸØ∆3 THEN GOSUB SAVEØFILE : RETURN  IF A$=À≈ŸØ∆7 THEN GOSUB SETØGROUPØFLAG : RETURN  IF A$=À≈ŸØ∆9 THEN GOSUB TOGGLEØVERSION  IF A$=À≈ŸØ∆5 THEN GOSUB PLAYØDATA : RETURN  IF A$=À≈ŸØ∆6 THEN LASTFLAG=1:GOSUB PLAYØDATA : RETURN  IF A$=À≈ŸØ“≈÷ØœŒ THEN REVØFLAG& = 1 : RETURN  IF A$=À≈ŸØ“≈÷Øœ∆∆ THEN REVØFLAG& = 0 : RETURN  IF A$=À≈ŸØ∆10 THEN INPUT K, V:LDATA&(K) = V  IF A$="" THEN DEBUG=MOD(DEBUG+1,2):A$="":CURSOR 0,0:PRINT CHR$(27);"QDEBUG=";DEBUG  IF A$<>"" THEN BEGIN    CURSOR X, Y    GOSUB RESTOREØCHAR    GOSUB CHKØREV    XX = X : YY = Y    GOSUB DRAWØCHAR    GOSUB SAVEØCHAR  BEND  RETURN'--------------.TOGGLEØVERSION'--------------  VER = VER + 1  IF VER = 4 THEN VER = 1  PRINT "";CHR$(27);"QVERSION";VER;  A$=""  IF VER = 3 THEN GOSUB DRAWØFONTØGUIDEØLINES  RETURN'---------------------.DRAWØFONTØGUIDEØLINES'---------------------  PRINT "ìí----------"  PRINT  PRINT  PRINT ".........."  PRINT  PRINT  PRINT  PRINT "----------"  RETURN'---------.DRAWØCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN'--------------------.CHECKØALTØKEYØINPUTS'--------------------  ALTØKEY = PEEK($D611) AND 16  IF ALTØKEY = 0 THEN RETURN  IF A$=À≈ŸØÃ≈∆‘ THEN GOSUB SCROLLØCANVASØLEFT  IF A$=À≈ŸØ“…«»‘ THEN GOSUB SCROLLØCANVASØRIGHT  A$=""  RETURN'---------.DRAWØINFO'---------  PRINT "";CHR$(27);"QFNAME=";FNAME$;"  DIDX%=";DIDX%;  RETURN'-------.CHKØREV'-------  IF REVØFLAG& = 1 THEN PRINT "";:ELSE PRINT "í";  RETURN'---------.PLAYØDATA'---------  PRINT "ì";  IF VER = 3 THEN GOSUB DRAWØFONTØGUIDEØLINES  OFFS=0  PIDX% = 0  IF LASTFLAG = 1 THEN PIDX% = LASTØGROUPØIDX : LASTFLAG = 0  DO WHILE PIDX% < DIDX%    CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& = LDATA&(PIDX%) : PIDX% = PIDX% + 1    IF VAL& = $FF THEN BEGIN      GOSUB DRAWØFONTØGUIDEØLINES      IF PIDX% > LASTØGROUPØIDX THEN LASTØGROUPØIDX = PIDX%      GOTO PDØENDLOOP    BEND    'IF VAL& = $FF THEN GROUPØFLAG& = 1 : GOTO PDØENDLOOP    'IF VAL& = $FE THEN GROUPØFLAG& = 0 : SLEEP .02 : GOTO PDØENDLOOP    X = VAL& AND $7F    IF VER=2 THEN BEGIN      X = VAL&      VAL& = LDATA&(PIDX%)      PIDX% = PIDX% + 1      X = X + (VAL& AND $7F) * 256    BEND    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "í";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% + 1    IF VER=2 THEN BEGIN      DO WHILE X-OFFS > 78        GOSUB SCROLLØCANVASØRIGHT      LOOP    BEND    XX = X-OFFS : YY = Y: CURSOR XX, YY : GOSUB DRAWØCHAR    IF DEBUG=1 THEN GET KEY Z$    IF Z$="X" THEN GOSUB DELETEØCHAR    IF Z$="<" THEN PIDX%=PIDX%-6    IF Z$="H" THEN PIDX%=0:GOTO PLAYØDATA    IF Z$="T" THEN DIDX%=PIDX%      'PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)      'GET KEY A$    IF GROUPØFLAG& = 0 THEN SLEEP .02.PDØENDLOOP  LOOP  X = X-OFFS  RETURN'-----------.DELETEØCHAR'-----------  DIDX% = DIDX% - 3  PIDX% = PIDX% - 3  FOR K = PIDX% TO DIDX%    LDATA&(K) = LDATA&(K+3)    LDATA&(K+1) = LDATA&(K+4)    LDATA&(K+2) = LDATA&(K+5)  NEXT K  RETURN'--------------.SETØGROUPØFLAG'--------------  IF GROUPØFLAG& = 0 THEN BEGIN    ' GROUPØFLAG& = 1    LDATA&(DIDX%) = $FF    POKE $D020, (PEEK($D020)+1) AND 15    GOSUB DRAWØFONTØGUIDEØLINES  BEND:ELSE BEGIN  '  GROUPØFLAG& = 0  '  LDATA&(DIDX%) = $FE  '  POKE $D020, $00  BEND  DIDX% = DIDX% + 1  RETURN'---------.LOADØFILE'---------  INPUT "LOAD NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  GOSUB INIT  DOPEN #2,(FNAME$),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) = VAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  GOSUB PLAYØDATA  RETURN'---------.SAVEØFILE'---------  INPUT "SAVE NAME: ";FNAME$  IF FNAME$ = "" THEN RETURN  DELETE (FNAME$)  DOPEN #2,(FNAME$),W,U8  FOR XX = 0 TO DIDX%    PRINT #2, CHR$(LDATA&(XX));  NEXT XX    DCLOSE #2  RETURN'---------.SAVEØCHAR'---------  IF OLDX=X AND OLDY=Y AND OLDOFFS=OFFS AND INSTR("êüûÅïñóòôöõí", A$)=0 THEN BEGIN    ' REPLACE PREVIOUS CHAR    IF VER = 2 THEN BEGIN      LDATA&(DIDX%-4) = (X+OFFS) AND 255      LDATA&(DIDX%-3) = (X+OFFS) / 256 + REVØFLAG& * $80    BEND:ELSE BEGIN      LDATA&(DIDX%-3) = X + REVØFLAG& * $80    BEND    LDATA&(DIDX%-1) = ASC(A$)  BEND:ELSE:BEGIN    ' WRITE NEW CHAR    IF VER = 2 THEN BEGIN      LDATA&(DIDX%) = (X+OFFS) AND 255        DIDX% = DIDX% + 1      LDATA&(DIDX%) = (X+OFFS) / 256 + REVØFLAG& * $80        DIDX% = DIDX% + 1    BEND:ELSE BEGIN      LDATA&(DIDX%) = (X+OFFS) + REVØFLAG& * $80        DIDX% = DIDX% + 1          BEND    LDATA&(DIDX%) = Y      DIDX% = DIDX% + 1    LDATA&(DIDX%) = ASC(A$)      DIDX% = DIDX% + 1        OLDX=X : OLDY=Y : OLDOFFS=OFFS  BEND  RETURN  '------------  .RESTOREØCHAR'------------  IF MODIFIED% THEN BEGIN    LOC = $FF80000 + X + 80 * Y    POKE LOC, PEEK(LOC) XOR 32    MODIFIED% = 0    T0 = TI  BEND  RETURN'-----------.SHOWØCURSOR'-----------  IF TI > T0 THEN T0 = TI + .5:ELSE RETURN  LOC = $FF80000 + X + 80 * Y  POKE LOC, PEEK(LOC) XOR 32  MODIFIED% = MODIFIED% XOR 1  RETURN'------------------.SCROLLØCANVASØLEFT'------------------  IF OFFS>0 THEN OFFS=OFFS-1:ELSE RETURN  FOR YY = 0 TO 49    EDMA œ–Ø√œ–Ÿ+ƒ”‘Øƒ≈√+”“√Øƒ≈√, _           79, $40800 + YY*80 + 78, $40800 + YY*80 + 79    POKE $40800 + YY*80, 32   NEXT YY  RETURN'-------------------.SCROLLØCANVASØRIGHT'-------------------  OFFS=OFFS+1  FOR YY = 0 TO 49    EDMA œ–Ø√œ–Ÿ, 79, $40801 + YY*80, $40800 + YY*80    POKE $40800 + 79 + YY*80, 32   NEXT YY                  RETURN