#OUTPUT "BASLOGO"' 4 EMORY USAGE' ------------------' 4.0000 -' 4.0800  ' 4.2000  ' 5 EMORY USAGE' ------------------' 5.0000 SCREEN BUFFER' 5.1000 COLOR RAM BUFFER.DEFINES#DECLARE K, PTR, TMP, MAXFRAMES, FRMIDX, FRMW, FRMH, SZ#DECLARE FRAMEADDR(25), SRCADDR, DESTADDR, LENGTH, TRANSP#DECLARE FRAMEIDX, FX, FY, MIRROR, DATAADDR, FRMX, FRMY#DECLARE FRMX1, FRMY1, SCRADDR, CLRADDR, CDATAADDR, YY#DECLARE INC(3), INCDIR(3), A$, X, Y#DECLARE TEMPR, TEMPG, TEMPB, M#DECLARE LOGOSTATE#DECLARE FLIPVAR, UPPERNIBBLE, LOWERNIBBLE#DECLARE CLR1, CLR2, TSTART#DEFINE ͯ = 0#DEFINE ͯ = 1#DEFINE ͯ = 2#DEFINE ͯ = 3#DECLARE ǯ7 = $D05D  ' PALETTE  ' -------  #DECLARE DEFAULTRED&(32)  #DECLARE DEFAULTGREEN&(32)  #DECLARE DEFAULTBLUE&(32)  #DECLARE CURRRED&(32)  #DECLARE CURRGREEN&(32)  #DECLARE CURRBLUE&(32)  #DECLARE FADEVAL, TEMPVAL.OFFSETS#DEFINE ԯ  = 0#DEFINE ԯͯ = 2#DEFINE ԯ0     = 3#DEFINE ͯԯ          = 0#DEFINE ͯԯ          = 1#DEFINE ͯԯ          = 2#DEFINE ͯԯ          = 3#DEFINE ͯԯ   = 4#DEFINE ͯԯ¯    = 4#DEFINE ͯԯ¯   = 8#DEFINE ͯԯ¯    = 12#DEFINE ͯԯ¯  = 16#DEFINE ͯԯ       = 20'----.MAIN'----  GOSUB INIT  GOSUB LOADDATA  GOSUB STATELOOP  GOSUB ANIMATELOGO  END#DEFINE ԯůϯ = 0#DEFINE ԯׯЯ = 1#DEFINE ԯůϯ = 2#DEFINE ԯЯί = 3'----------.STATELOOP'----------  IF LOGOSTATE = ԯůϯ THEN BEGIN    GOSUB FADETOWHITE    LOGOSTATE = ԯׯЯ  BEND:ELSE IF LOGOSTATE = ԯׯЯ THEN BEGIN    POKE $D020, 1, 1    GOSUB INIT80X50    GOSUB DRAWBACKDROP    GOSUB PAGEFLIP    GOSUB STORECURRCOLOURS    GOSUB SETPALETTEFORBACKDROP    FADEVAL=0    M=0    LOGOSTATE = ԯůϯ  BEND:ELSE IF LOGOSTATE = ԯůϯ THEN BEGIN    TSTART = TI    IF FADEVAL <= 16 THEN BEGIN      IF MOD(M,5) = 0 THEN BEGIN        GOSUB FADECOLOURSTODEFAULTS        FADEVAL = FADEVAL + 1      BEND    BEND    GOSUB CYCLEALTPALETTE    M = M + 1    IF M = 200 THEN LOGOSTATE = ԯЯί    DO    LOOP WHILE (TI-TSTART) < .1  BEND  GOTO STATELOOP  RETURN'----------.INIT80X50'----------  PRINT ""  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $FD  ' SWITCH TO 80X50  BANK 128  SETBIT ǯ7, 7  POKE $D031, $E8 ' 1110 1000 = 640,,,400  RETURN'-------------.DRAWBACKDROP'-------------    FRAMEIDX = ͯ    FX=-999 : FY = -999    MIRROR = 0    GOSUB DRAWPETSCIIFRAME    RETURN'------------.ANIMATELOGO'------------.ANIMRPT  GOSUB DRAWBAS  GOSUB PAGEFLIP  FOR FRAMEIDX = 0 TO 2      INC(FRAMEIDX) = INC(FRAMEIDX) + .2 * INCDIR(FRAMEIDX)    IF INC(FRAMEIDX) < .6 THEN INCDIR(FRAMEIDX) = 1    IF INC(FRAMEIDX) > 2.9 THEN INCDIR(FRAMEIDX) = -1  NEXT FRAMEIDX  GOTO ANIMRPT    RETURN'----.INIT'----  LOGOSTATE = 0  GOSUB STOREDEFAULTCOLOURS  INCDIR(0) = -1  INC(0) = 3  INCDIR(1) = -1  INC(1) = 2  INCDIR(2) = -1  INC(2) = 1  INCDIR(3) = -1  INC(3) = 1  ' CLEAR DMA LIST AREA  FOR K = 0 TO 20    POKE $40000+K, 0  NEXT K  POKE $40000, $81 ' OPT = DEST ADDR  SELECTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $00 '  LSB =   WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C, $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    '  MSB (IGNORE)  WPOKE $40010, $0000 ' MODULO (IGNORE)  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32, $50000  EDMA 3, $FA0, 0, $51000  RETURN'---------.LOADDATA'---------  PTR = $42000    BLOAD "BAS.BIN",P(PTR)  GOSUB INITPETSCIIFRAMES  GOSUB INCREMENTPTRTONEXTFREE  RETURN'-------------------.INITPETSCIIFRAMES'-------------------  TMP = PTR  MAXFRAMES = PEEK(PTR + ԯͯ)  'PRINT  'PRINT "PTR=";HEX$(PTR + ԯͯ)  PTR = PTR + ԯ0  'PRINT  'PRINT "- MXFRM=";MAXFRAMES;": "  FRMIDX = 0  DO WHILE FRMIDX < MAXFRAMES    'PRINT FRMIDX;    FRAMEADDR(FRMIDX) = PTR    FRMX = PEEK(PTR + ͯԯ)    FRMY = PEEK(PTR + ͯԯ)    FRMW = PEEK(PTR + ͯԯ)    FRMH = PEEK(PTR + ͯԯ)    FRMX1=FRMX+FRMW-1    FRMY1=FRMY+FRMH-1    DATAADDR = PTR    DATAADDR = DATAADDR + ͯԯ    CDATAADDR = DATAADDR + FRMW * FRMH    FOR Y = 0 TO FRMY1-FRMY      FOR X = 0 TO FRMX1-FRMX        IF PEEK(DATAADDR + X + Y * FRMW) = 102 THEN BEGIN          POKE (CDATAADDR + X + Y * FRMW), $FF        BEND      NEXT X    NEXT Y        'PRINT "PTR=";HEX$(PTR);", IDX=";FRMIDX;", W=";FRMW;", H=";FRMH    PTR = PTR + ͯԯ + FRMW * FRMH * 2    'PRINT "FRMIDX=";FRMIDX    FRMIDX = FRMIDX + 1  LOOP  PTR = TMP  RETURN'---------------------------.INCREMENTPTRTONEXTFREE'---------------------------  PTR = TMP  SZ = WPEEK(PTR + ԯ)  'PRINT  'PRINT "INC SZ = ";SZ  'PRINT "PTR = ";HEX$(PTR + ԯ)  PTR = PTR + SZ  'GET KEY A$  RETURN'--------.DRAWBAS'--------  FRAMEIDX = ͯ  FX=-999 : FY = -999  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=-999  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=-999  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  FRAMEIDX = ͯ  FX=-999 : FY=-999  MIRROR = 0  GOSUB DRAWPETSCIIFRAME  RETURN'------------------.DRAWPETSCIIFRAME'------------------  POKE $4000B, $04  ' ASSURE SOURCE BANK 4 (FOR ORIGINAL FRAME DATA)  IF MIRROR = 1 THEN SETBIT $40006, 5:ELSE CLRBIT $40006, 5  DATAADDR = FRAMEADDR(FRAMEIDX)  FRMX = PEEK(DATAADDR + ͯԯ)  FRMY = PEEK(DATAADDR + ͯԯ)  FRMW = PEEK(DATAADDR + ͯԯ)  FRMH = PEEK(DATAADDR + ͯԯ)  IF FX<>-999 THEN FRMX = FX ' OVERRIDE POSITION  IF FY<>-999 THEN FRMY = FY  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  SCRADDR = $50000 + FRMX + (FRMY+FRMH-1) * 80  CLRADDR = $51000 + FRMX + (FRMY+FRMH-1) * 80  IF MIRROR = 1 THEN CLRADDR = CLRADDR + FRMW - 1  DATAADDR = DATAADDR + ͯԯ  CDATAADDR = DATAADDR + FRMW * FRMH  FOR YY=FRMY1 TO FRMY STEP -INC(FRAMEIDX)    IF YY < FRMY THEN YY = FRMY    IF SCRADDR < $50000 THEN GOTO FORSKIP    ' DRAW CHARS    ' ----------    SRCADDR = DATAADDR + INT(YY-FRMY) * FRMW    DESTADDR = SCRADDR    LENGTH = FRMW    TRANSP = 102    GOSUB TRANSPARENTDMA    SRCADDR = CDATAADDR + INT(YY-FRMY) * FRMW    DESTADDR = CLRADDR    LENGTH = FRMW    TRANSP = $FF    GOSUB TRANSPARENTDMA    'DATAADDR = D + FRMW * INT(FRMY1 + YY    'CDATAADDR = CDATAADDR + FRMW    SCRADDR = SCRADDR - 80    CLRADDR = CLRADDR - 80.FORSKIP  NEXT YY  RETURN'---------------.TRANSPARENTDMA'---------------  WPOKE $40009, SRCADDR  WPOKE $4000C, DESTADDR  WPOKE $40007, LENGTH  POKE  $40004, TRANSP  POKE $D702, 4 ' DMA LIST IN BANK 4  POKE $D701, $00 ' DMA LIST MSB  POKE $D705, $00 ' DMA LIST LSB  RETURN'---------.PAGEFLIP'---------  EDMA 0, $FA0, $50000, $40800  EDMA 0, $FA0, $51000, $FF80000  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32, $50000  EDMA 3, $FA0, 0, $51000  RETURN.FADETOWHITE'-------------  FOR FADEVAL=0 TO 16    GOSUB FADECOLOURSTOWHITE    SLEEP .1  NEXT FADEVAL  RETURN.FADECOLOURSTOWHITE'---------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    FLIPVAR = DEFAULTRED&(K)    GOSUB FLIPNIBBLE    CLR1 = FLIPVAR    CLR2 = $F0    FLIPVAR = CLR1 + (CLR2 - CLR1) * TEMPVAL    GOSUB FLIPNIBBLE    POKE $D100+K, FLIPVAR    FLIPVAR = DEFAULTGREEN&(K)    GOSUB FLIPNIBBLE    CLR1 = FLIPVAR    FLIPVAR = CLR1 + (CLR2 - CLR1) * TEMPVAL    GOSUB FLIPNIBBLE    POKE $D200+K, FLIPVAR    FLIPVAR = DEFAULTBLUE&(K)    GOSUB FLIPNIBBLE    CLR1 = FLIPVAR    FLIPVAR = CLR1 + (CLR2 - CLR1) * TEMPVAL    GOSUB FLIPNIBBLE    POKE $D300+K, FLIPVAR  NEXT K  RETURN.STOREDEFAULTCOLOURS'---------------------  FOR K = 0 TO 31    DEFAULTRED&(K)=PEEK($D100+K)    DEFAULTGREEN&(K)=PEEK($D200+K)    DEFAULTBLUE&(K)=PEEK($D300+K)  NEXT K  RETURN.FADECOLOURSTODEFAULTS'------------------------  ': FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    FLIPVAR = CURRRED&(K)    GOSUB FLIPNIBBLE    CLR1 = FLIPVAR    FLIPVAR = DEFAULTRED&(K)    GOSUB FLIPNIBBLE    CLR2 = FLIPVAR    FLIPVAR = CLR1 + (CLR2 - CLR1) * TEMPVAL    GOSUB FLIPNIBBLE    POKE $D100+K, FLIPVAR    ' ------    FLIPVAR = CURRGREEN&(K)    GOSUB FLIPNIBBLE    CLR1 = FLIPVAR    FLIPVAR = DEFAULTGREEN&(K)    GOSUB FLIPNIBBLE    CLR2 = FLIPVAR    FLIPVAR = CLR1 + (CLR2 - CLR1) * TEMPVAL    GOSUB FLIPNIBBLE    POKE $D200+K, FLIPVAR    ' ------    FLIPVAR = CURRBLUE&(K)    GOSUB FLIPNIBBLE    CLR1 = FLIPVAR    FLIPVAR = DEFAULTBLUE&(K)    GOSUB FLIPNIBBLE    CLR2 = FLIPVAR    FLIPVAR = CLR1 + (CLR2 - CLR1) * TEMPVAL    GOSUB FLIPNIBBLE    POKE $D300+K, FLIPVAR  NEXT K  RETURN.STORECURRCOLOURS'------------------  FOR K = 0 TO 31    CURRRED&(K)=PEEK($D100+K)    CURRGREEN&(K)=PEEK($D200+K)    CURRBLUE&(K)=PEEK($D300+K)  NEXT K  RETURN.CYCLEALTPALETTELOOP'----------------------  FOR M = 0 TO 32*4    GOSUB CYCLEALTPALETTE    ' GOSUB POLLPLAY    ' GOSUB ANIMDRAWSUBTEXT  NEXT M  RETURN.CYCLEALTPALETTE'-----------------  TEMPR = PEEK($D100+12)  TEMPG = PEEK($D200+12)  TEMPB = PEEK($D300+12)  FOR K = 12 TO 30    POKE $D100+K, PEEK($D100+K+1)    POKE $D200+K, PEEK($D200+K+1)    POKE $D300+K, PEEK($D300+K+1)  NEXT K  POKE $D100+31, TEMPR  POKE $D200+31, TEMPG  POKE $D300+31, TEMPB  TEMPR = CURRRED&(16)  TEMPG = CURRGREEN&(16)  TEMPB = CURRBLUE&(16)  FOR K = 12 TO 30    CURRRED&(K) = CURRRED&(K+1)    CURRGREEN&(K) = CURRGREEN&(K+1)    CURRBLUE&(K) = CURRBLUE&(K+1)  NEXT K  CURRRED&(31) = TEMPR  CURRGREEN&(31) = TEMPG  CURRBLUE&(31) = TEMPB  TEMPR = DEFAULTRED&(16)  TEMPG = DEFAULTGREEN&(16)  TEMPB = DEFAULTBLUE&(16)  FOR K = 12 TO 30    DEFAULTRED&(K) = DEFAULTRED&(K+1)    DEFAULTGREEN&(K) = DEFAULTGREEN&(K+1)    DEFAULTBLUE&(K) = DEFAULTBLUE&(K+1)  NEXT K  DEFAULTRED&(31) = TEMPR  DEFAULTGREEN&(31) = TEMPG  DEFAULTBLUE&(31) = TEMPB  RETURN'------------------------.SETPALETTEFORBACKDROP'------------------------#DEFINE 1 = $DA ' 218#DEFINE 1 = $89 ' 137#DEFINE 1 = $00 ' 0#DEFINE 2 = $1B ' 27#DEFINE 2 = $42 ' 66#DEFINE 2 = $0B ' 11  FOR K = 12 TO 21    FLIPVAR = 1 + (2-1) * (K-12)/9    GOSUB FLIPNIBBLE    DEFAULTRED&(K) = FLIPVAR    DEFAULTRED&(43-K) = FLIPVAR    FLIPVAR = 1 + (2-1) * (K-12)/9    GOSUB FLIPNIBBLE    DEFAULTGREEN&(K) = FLIPVAR    DEFAULTGREEN&(43-K) = FLIPVAR    FLIPVAR = 1 + (2-1) * (K-12)/9    GOSUB FLIPNIBBLE    DEFAULTBLUE&(K) = FLIPVAR    DEFAULTBLUE&(43-K) = FLIPVAR  NEXT K  RETURN'-----------.FLIPNIBBLE'-----------  LOWERNIBBLE = FLIPVAR AND $0F  UPPERNIBBLE = (FLIPVAR >> 4) AND $0F  FLIPVAR = (LOWERNIBBLE << 4) + UPPERNIBBLE  RETURN