#OUTPUT "WRITER"'--------.DECLARES'--------#DECLARE S$, PIDX%, DIDX%, LDATA&(12000), PTR, VAL&#DECLARE CHAR¯IDX%(60)#DECLARE CHAR¯WIDTH%(60)#DECLARE CHAR¯CNT, MAX¯WIDTH, K#DECLARE X, Y, A$, DEBUG=0, Z$#DECLARE XX, YY, CHR'----.MAIN'----  GOSUB INIT  XX=0:YY=0  S$ = ",/#"  GOSUB WRITE¯TEXT  XX=0:YY=15    S$ = "ÈELLO ÃAMCAM!"  GOSUB WRITE¯TEXT  END'----.INIT'----  PRINT "“";  XX = 0 : YY = 0  PTR = $42000  ' LOAD 'ABC.LN' FONT  GOSUB LOAD¯FONT  CHAR¯CNT = 0  CHAR¯IDX%(0) = 0  CHAR¯WIDTH%(0) = 0  MAX¯WIDTH = 0  K = 0  DO WHILE K < DIDX%    ' GET X VALUE    VAL& = LDATA&(K)    K=K+1    IF VAL& = $FF THEN BEGIN      ' KEEP AN ARRAY OF WIDTHS OF EACH LETTER      CHAR¯WIDTH%(CHAR¯CNT)=MAX¯WIDTH      ' PRINT "CHAR¯WIDTH(";CHAR¯CNT;") = ";MAX¯WIDTH      ' GET KEY Z$      MAX¯WIDTH = 0      CHAR¯CNT=CHAR¯CNT+1      ' KEEP AN ARRAY OF INDICES TO EACH DRAWN LETTER      CHAR¯IDX%(CHAR¯CNT) = K      'PRINT "CHAR¯IDX%(";CHAR¯CNT;")=";K      'GET KEY A$    BEND    IF VAL& = $FF THEN GOTO CONT¯LOOP    VAL& = VAL& AND $7F    IF VAL& > MAX¯WIDTH THEN MAX¯WIDTH = VAL&        K=K+1  ' SKIP Y VALUE    K=K+1  ' SKIP CHAR .CONT¯LOOP  LOOP  RETURN'---------.LOAD¯FONT'---------  DOPEN #2,("ABC.LN"),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) = VAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  RETURN'----------.WRITE¯TEXT'----------  FOR K = 1 TO LEN(S$)    CHR = ASC(MID$(S$,K,1))    ' PRINT "";CHR$(27);"QCHR=";CHR;    GOSUB PETSCII¯TO¯SCREENCODE    GOSUB SCREENCODE¯TO¯IDX    ' PRINT "FIXED CHR=";CHR;    IF CHR=32 THEN BEGIN      XX=XX+7    BEND:ELSE:BEGIN      GOSUB WRITE¯CHAR      XX = XX + CHAR¯WIDTH%(CHR) + 1    BEND  NEXT K  RETURN'---------------------.PETSCII¯TO¯SCREENCODE'---------------------  ' ÂASED ON THE TABLE HERE:  ' HTTPS://STA.C64.ORG/CBM64PETTOSCR.HTML  IF CHR>=$00 AND CHR<=$1F THEN CHR=CHR OR $80:RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF:RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF:RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40:RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=CHR AND $BF:RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F:RETURN  RETURN'-----------------.SCREENCODE¯TO¯IDX'-----------------  IF CHR >= 65 AND CHR <= 90 THEN CHR = CHR - 65:RETURN  IF CHR = 46 THEN CHR = 26:RETURN ' FULL-STOP  IF CHR = 33 THEN CHR = 27:RETURN ' EXCLAMATION  IF CHR = 44 THEN CHR = 28:RETURN ' COMMA (SMILEY)  IF CHR = 47 THEN CHR = 29:RETURN ' FORWARD SLASH (LOVE HEART)  IF CHR = 35 THEN CHR = 30:RETURN ' # HASH (DHUFISH)  IF CHR >= 1 AND CHR <= 26 THEN CHR = CHR + 30  RETURN'----------.WRITE¯CHAR'----------  ' ITERATE OVER CHARS IN STRING    ' DRAW CURRENT CHAR AT GIVEN X,Y POS    ' INCREMENT X,Y LOCATION   PIDX% = CHAR¯IDX%(CHR)  DO WHILE PIDX% < DIDX% AND LDATA&(PIDX%) <> $FF    ' CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& = LDATA&(PIDX%) : PIDX% = PIDX% + 1    X = VAL& AND $7F    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "’";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% + 1    CURSOR XX+X, YY+Y : GOSUB DRAW¯CHAR    'PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)    'GET KEY A$    SLEEP .02.PD¯ENDLOOP  LOOP  RETURN'---------.DRAW¯CHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN