#OUTPUT "WRITER"'--------.DECLARES'--------#DECLARE S$, PIDX%, DIDX%, LDATA&(12000), PTR, VAL&#DECLARE CHAR¯IDX%(60)#DECLARE CHAR¯WIDTH%(60)#DECLARE CHAR¯CNT, MAX¯WIDTH, TXT¯K#DECLARE X, Y, A$, DEBUG=0, Z$#DECLARE XX, YY, CHR#DECLARE LYR$(27), LYR¯IDX, MAX¯LEN#DECLARE LYR¯OFFS, LYR¯T, OFFS, ADDR, SCYY, ZZ'----.MAIN'----  GOSUB INIT    LYR¯OFFS = 0  ' XX=0:YY=0  ' S$ = ",/#"  ' GOSUB WRITE¯TEXT  ' XX=0:YY=15  ' SLEEP .5  ' PRINT "“";  FOR LYR¯IDX = 0 TO 27    XX = OFFS + 65 : YY = 0    ZZ = MOD(LYR¯IDX, 4)    IF ZZ = 0 THEN YY = 0    IF ZZ = 1 THEN YY = 17    IF ZZ = 2 THEN YY = 33    IF ZZ = 3 THEN YY = 17    S$ = LYR$(LYR¯IDX)    GOSUB WRITE¯TEXT  NEXT LYR¯IDX  END'----.INIT'----  LYR$(0) = "ÉN DREAMLAND..."  LYR$(1) = "GRANDEUR..."  LYR$(2) = "É HELD..."  LYR$(3) = "MESMERISED..."  LYR$(4) = "ÐEACE..."  LYR$(5) = "ÉNNOCENCE..."  LYR$(6) = "ÂREATHED AGAIN..."  LYR$(7) = "Á MIND'S ESCAPE"  LYR$(8) = "ÌEAVE WALLS OF TEARS BEHIND..."  LYR$(9) = "ÅTHEREAL VISION HAUNTING STILL..."  LYR$(10) = "ÔHE SOLITUDE LEFT ME BLIND..."  LYR$(11) = "ÂENEATH AN OPEN SKY..."  LYR$(12) = "ÓIBILANT CRIES OF YOUTH DYING..."  LYR$(13) = "ÅNSLAVE ME WITH GRIEF..."  LYR$(14) = "Á MOONLIT ERA..."  LYR$(15) = "ÏBLIVION'S TWILIGHT KISS..."  LYR$(16) = "×ISHES IN LAMENT..."  LYR$(17) = "ÈAPPINESS IN A BROKEN VISION..."  LYR$(18) = "ÕTOPIA..."  LYR$(19) = "ÓTILL UNBORN..."  LYR$(20) = "ÔORMENTED ECHOES..."  LYR$(21) = "OF A FALLEN ÅDEN..."  LYR$(22) = "É LONGED FOR HER BEAUTY..."  LYR$(23) = "ÙET FROM DUST..."  LYR$(24) = "ÓHE RETURNED..."  LYR$(25) = "ÔHE DREAM..."  LYR$(26) = "ÁN ENIGMA..."  LYR$(27) = "ÓILENT..."  PRINT "“";  XX = 0 : YY = 0  PTR = $42000  ' LOAD 'ABC.LN' FONT  GOSUB LOAD¯FONT  CHAR¯CNT = 0  CHAR¯IDX%(0) = 0  CHAR¯WIDTH%(0) = 0  MAX¯WIDTH = 0  TXT¯K = 0  DO WHILE TXT¯K < DIDX%    ' GET X VALUE    VAL& = LDATA&(TXT¯K)    TXT¯K=TXT¯K+1    IF VAL& = $FF THEN BEGIN      ' KEEP AN ARRAY OF WIDTHS OF EACH LETTER      CHAR¯WIDTH%(CHAR¯CNT)=MAX¯WIDTH      ' PRINT "CHAR¯WIDTH(";CHAR¯CNT;") = ";MAX¯WIDTH      ' GET KEY Z$      MAX¯WIDTH = 0      CHAR¯CNT=CHAR¯CNT+1      ' KEEP AN ARRAY OF INDICES TO EACH DRAWN LETTER      CHAR¯IDX%(CHAR¯CNT) = TXT¯K      'PRINT "CHAR¯IDX%(";CHAR¯CNT;")=";K      'GET KEY A$    BEND    IF VAL& = $FF THEN GOTO CONT¯LOOP    VAL& = VAL& AND $7F    IF VAL& > MAX¯WIDTH THEN MAX¯WIDTH = VAL&        TXT¯K=TXT¯K+1  ' SKIP Y VALUE    TXT¯K=TXT¯K+1  ' SKIP CHAR .CONT¯LOOP  LOOP  RETURN'---------.LOAD¯FONT'---------  DOPEN #2,("ABC.LN"),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(DIDX%) = VAL&    DIDX% = DIDX% + 1  LOOP  DCLOSE #2  RETURN'----------.WRITE¯TEXT'----------  FOR TXT¯K = 1 TO LEN(S$)    CHR = ASC(MID$(S$, TXT¯K, 1))    ' PRINT "";CHR$(27);"QCHR=";CHR;    GOSUB PETSCII¯TO¯SCREENCODE    GOSUB SCREENCODE¯TO¯IDX    ' PRINT "FIXED CHR=";CHR;    IF CHR=100 THEN BEGIN      'XX=XX+7      GOSUB SCROLL¯CANVAS¯RIGHT      GOSUB SCROLL¯CANVAS¯RIGHT      GOSUB SCROLL¯CANVAS¯RIGHT      GOSUB SCROLL¯CANVAS¯RIGHT      GOSUB SCROLL¯CANVAS¯RIGHT      GOSUB SCROLL¯CANVAS¯RIGHT    BEND:ELSE:BEGIN      GOSUB WRITE¯CHAR      XX = XX + CHAR¯WIDTH%(CHR) + 1    BEND    ' GET KEY A$  NEXT TXT¯K  RETURN'---------------------.PETSCII¯TO¯SCREENCODE'---------------------  ' ÂASED ON THE TABLE HERE:  ' HTTPS://STA.C64.ORG/CBM64PETTOSCR.HTML  IF CHR>=$00 AND CHR<=$1F THEN CHR=CHR OR $80:RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF:RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF:RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40:RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=CHR AND $BF:RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F:RETURN  RETURN'-----------------.SCREENCODE¯TO¯IDX'-----------------  IF CHR >= 65 AND CHR <= 90 THEN CHR = CHR - 65:RETURN  IF CHR = 46 THEN CHR = 26:RETURN ' FULL-STOP  IF CHR = 33 THEN CHR = 27:RETURN ' EXCLAMATION  IF CHR = 44 THEN CHR = 28:RETURN ' COMMA (SMILEY)  IF CHR = 47 THEN CHR = 29:RETURN ' FORWARD SLASH (LOVE HEART)  IF CHR = 35 THEN CHR = 30:RETURN ' # HASH (DHUFISH)  IF CHR >= 1 AND CHR <= 26 THEN CHR = CHR + 30:RETURN  IF CHR = 39 THEN CHR = 57:RETURN  IF CHR = 32 THEN CHR = 100:RETURN  RETURN'----------.WRITE¯CHAR'----------  ' ITERATE OVER CHARS IN STRING    ' DRAW CURRENT CHAR AT GIVEN X,Y POS    ' INCREMENT X,Y LOCATION   PIDX% = CHAR¯IDX%(CHR)  DO WHILE PIDX% < DIDX% AND LDATA&(PIDX%) <> $FF    ' CURSOR 0,49:PRINT CHR$(27);"QPIDX=";PIDX%;"[";LDATA&(PIDX%);LDATA&(PIDX%+1);LDATA&(PIDX%+2);    VAL& = LDATA&(PIDX%) : PIDX% = PIDX% + 1    X = VAL& AND $7F    IF VAL& AND $80 THEN PRINT ""; : ELSE PRINT "’";    Y = LDATA&(PIDX%) : PIDX% = PIDX% + 1    A$ = CHR$(LDATA&(PIDX%)) : PIDX% = PIDX% + 1    CURSOR XX+X - OFFS, YY+Y : GOSUB DRAW¯CHAR    LYR¯T = LYR¯T + 1    IF MOD(LYR¯T, 3) = 0 THEN GOSUB SCROLL¯CANVAS¯RIGHT:XX=XX-1    'PRINT "";CHR$(27);"Q X,Y,PIDX,A$=";X;Y;PIDX%,ASC(A$)    'GET KEY A$    SLEEP .02.PD¯ENDLOOP  LOOP  RETURN'---------.DRAW¯CHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)  PRINT A$;  RETURN'-------------------.SCROLL¯CANVAS¯RIGHT'-------------------  LYR¯OFFS = LYR¯OFFS + 1  ADDR = $40800  ADDR = $40800  FOR SCYY = 0 TO 49    EDMA 0, 79, ADDR+1 + SCYY*80, ADDR + SCYY*80    POKE ADDR + 79 + SCYY * 80, 32  NEXT SCYY  RETURN