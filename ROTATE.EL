' ROTATE SCREEN CONTENTS#OUTPUT "ROTATE"' 4.0800 = SCREEN POINTER' 4.4000 = 96X96 CLRBOX CANVAS (9216 BYTES)' 4.6400 = FREE.DEFINES'-------#DEFINE œ–Ø√œ–Ÿ = 0#DEFINE œ–ØÕ…ÿ  = 1#DEFINE œ–Ø”◊¡– = 2#DEFINE œ–Ø∆…ÃÃ = 3#DECLARE »œ‘“≈«Ø7 = $D05D#DECLARE ”√“Œ–‘“Ã”¬ = $D060#DECLARE ”√“Œ–‘“¬ŒÀ = $D062#DECLARE T, X, Y, COLR, ANG, XINC, YINC, TX, TY, TXINC, TYINC#DECLARE Y1ADD#DECLARE XFRAC, YFRAC#DECLARE BOXØANG, CX, CY, HYP#DEFINE –… = 3.1415926535#DECLARE PLØRAD, PLØANG, PLØDIR, PLØCLR#DECLARE A$#DECLARE STATE, K#DECLARE TXTØK, WXX, WYY, FNAME$, FIDX%, VER(2)#DECLARE CHARØCNT, CHARØIDX%(60), CHARØWIDTH%(60), MAXØWIDTH#DECLARE LDATA&(2,12288), DIDX%(2), PIDX%(2), VAL&#DECLARE OLDX, OLDY, OLDOFFS(2), OFFS(2)#DECLARE GROUPØFLAG&, REVØFLAG&(2), LASTFLAG, LASTØGROUPØIDX#DECLARE DXX, DYY, DEBUG, ADDR, CHR, CHRCLR.MAIN'----  GOSUB INIT.MNØLOOP  GOSUB ROTATEØLOGIC  GOSUB DRAWØCONTENT  GOSUB PAGEØFLIP  GOTO MNØLOOP.PAGEØFLIP'---------  BANK 0:SYS $7E15:BANK 128  EDMA 3, $FA0, 32+128, $50000  RETURN.INIT'----  ^^BLOAD "ASMROTATE",B0  BANK 0:BLOAD "ASMHELPER":BANK 128  GOSUB INITØWRITER  PRINT CHR$(27);"5";CHR$(147);  ANG = 2*–… + .1  STATE = 0  PLØRAD = 0  PLØANG = 0  PLØDIR = 0  PLØCLR = 0  ' CLEAR 80X50 CHARS AND COLOUR RAM  EDMA 3, 4000, 160, $40800  EDMA 3, 4000, 6, $FF80000  ' CLEAR 96X96 ARRAY  EDMA œ–Ø∆…ÃÃ, 96*96, 0, $44000  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $FA0, 32+128, $50000  EDMA 3, $FA0, 0, $51000  EDMA 3, $FA0, 32, $52000  EDMA 3, $FA0, 0, $53000  EDMA 3, $FA0, 32, $54000  EDMA 3, $FA0, 0, $55000  ' PREPARE DMA LIST INFO  POKE $40000, $81 ' OPT = DEST ADDR Õ¬ SELECTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $00 ' √Õƒ LSB = √œ–Ÿ  WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C, $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    ' √Õƒ MSB (IGNORE)  WPOKE $40010, $0000 ' MODULO (IGNORE)  RETURN.ROTATEØLOGIC'------------  ANG = ANG - .1  IF ANG < 0 THEN ANG = ANG + (2 * –…)  HYP = SQR(25*25+40*40) * 65536  XINC = COS(ANG) * 65536  YINC = SIN(ANG) * 65536  TXINC = COS(ANG+–…/2) * 65536  TYINC = SIN(ANG+–…/2) * 65536  BOXØANG = ATN(-25/-40)+ –… +ANG  IF BOXØANG < 0 THEN BOXØANG = BOXØANG + (2 * –…)  TX = HYP * COS(BOXØANG) + 48 * 65536  TY = HYP * SIN(BOXØANG) + 48 * 65536  CX = TX  CY = TY  XFRAC = 0  YFRAC = 0  Y1ADD = 0  RETURN.DRAWØCONTENT'------------  GOSUB PLOTØITERATION  GOSUB PLOTØITERATION  GOSUB ASMØROTATION  ' GOSUB BASICØROTATION  'CURSOR 0,0:PRINT CHR$(27);"Q TX=";TX;", TY=";TY;  'CURSOR 0,1:PRINT CHR$(27);"Q ANG=";ANG;", HYP=";HYP;  'CURSOR 0,2:PRINT CHR$(27);"Q XINC=";XINC;", YINC=";YINC;  'CURSOR 0,3:PRINT CHR$(27);"Q TXINC=";TXINC;", TYINC=";TYINC;  'GET KEY A$  RETURN.PLOTØITERATION'--------------  X = 48 + COS(PLØANG) * PLØRAD  Y = 48 + SIN(PLØANG) * PLØRAD  POKE $44000 + X + INT(Y) * 96, PLØCLR + 64  PLØANG = PLØANG + .025  IF PLØANG > 2 * –… THEN PLØANG = PLØANG - 2 * –…  PLØRAD = PLØRAD + .05  IF PLØRAD > 30 THEN BEGIN    PLØRAD=0    PLØCLR = PLØCLR + 1    IF PLØCLR = 16 THEN STATE = STATE + 1    PLØANG = .3926 * PLØCLR  BEND  RETURN.ASMØROTATION'------------  ' ¡””≈Õ¬ÃŸ VERSION  IF XINC < 0 THEN XINC = XINC + 4294967296  IF YINC < 0 THEN YINC = YINC + 4294967296  IF TXINC < 0 THEN TXINC = TXINC + 4294967296  IF TYINC < 0 THEN TYINC = TYINC + 4294967296  WPOKE $1A00, MOD(TX,65536)  WPOKE $1A02, TX/65536  WPOKE $1A04, MOD(TY, 65536)  WPOKE $1A06, TY/65536  WPOKE $1A08, MOD(XINC,65536)  WPOKE $1A0A, XINC/65536  WPOKE $1A0C, MOD(YINC, 65536)  WPOKE $1A0E, YINC/65536  WPOKE $1A10, MOD(TXINC, 65536)  WPOKE $1A12, TXINC/65536  WPOKE $1A14, MOD(TYINC, 65536)  WPOKE $1A16, TYINC/65536  BANK 0:SYS $1800:BANK 128  RETURN.BASICØROTATION'--------------  ' ¬¡”…√ VERSION  FOR Y = 0 TO 49    CX = TX    CY = TY    FOR X = 0 TO 79      POKE $FF80000 + X + Y1ADD, PEEK($44000 + CX/65536 + INT(CY/65536) * 96)      CX = CX + XINC      CY = CY + YINC    NEXT X    TX = TX + TXINC    TY = TY + TYINC    Y1ADD = Y1ADD + 80  NEXT Y  GET KEY A$  RETURN'-----------.INITØWRITER'-----------  TXTØK = 0  WXX = 0 : WYY = 0  FNAME$ = "ABC.LN"  FIDX% = 2  VER(FIDX%) = 3  GOSUB LOADØLINEØFILE  CHARØCNT = 0  CHARØIDX%(0) = 0  CHARØWIDTH%(0) = 0  MAXØWIDTH = 0  K = 0  DO WHILE K < DIDX%(FIDX%)    ' GET X VALUE    VAL& = LDATA&(FIDX%, K)    K=K+1    IF VAL& = $FF THEN BEGIN      ' KEEP AN ARRAY OF WIDTHS OF EACH LETTER      CHARØWIDTH%(CHARØCNT)=MAXØWIDTH      ' PRINT "CHARØWIDTH(";CHARØCNT;") = ";MAXØWIDTH      ' GET KEY Z$      MAXØWIDTH = 0      CHARØCNT=CHARØCNT+1      ' KEEP AN ARRAY OF INDICES TO EACH DRAWN LETTER      CHARØIDX%(CHARØCNT) = K      'PRINT "CHARØIDX%(";CHARØCNT;")=";K      'GET KEY A$    BEND    IF VAL& = $FF THEN GOTO CONTØLOOP    VAL& = VAL& AND $7F    IF VAL& > MAXØWIDTH THEN MAXØWIDTH = VAL&        K=K+1  ' SKIP Y VALUE    K=K+1  ' SKIP CHAR .CONTØLOOP  LOOP  RETURN'--------------.LOADØLINEØFILE'-------------- ' (FNAME$)  IF FNAME$ = "" THEN RETURN  GOSUB LINEØFILEØINIT  DOPEN #2,(FNAME$),R,U8  DO    GET #2, VAL&    IF ST THEN EXIT    LDATA&(FIDX%, DIDX%(FIDX%)) = VAL&    DIDX%(FIDX%) = DIDX%(FIDX%) + 1  LOOP  DCLOSE #2  GOSUB PLAYØDATAØINIT  RETURN'--------------.LINEØFILEØINIT'--------------  OLDX = -1 : OLDY = -1 : OLDOFFS(FIDX%) = 0  DIDX%(FIDX%) = 0  GROUPØFLAG& = 0 : REVØFLAG&(FIDX%) = 0  OFFS(FIDX%) = 0  RETURN         '--------------.PLAYØDATAØINIT'--------------  OFFS(FIDX%)=0  PIDX%(FIDX%) = 0  IF LASTFLAG = 1 THEN PIDX%(FIDX%) = LASTØGROUPØIDX : LASTFLAG = 0  RETURN'--------------.PLAYØDATAØITER'--------------  IF PIDX%(FIDX%) < DIDX%(FIDX%) THEN BEGIN    VAL& = LDATA&(FIDX%, PIDX%(FIDX%))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    IF VER(FIDX%)=3 AND VAL& = $FF THEN BEGIN      IF PIDX%(FIDX%) > LASTØGROUPØIDX THEN LASTØGROUPØIDX = PIDX%(FIDX%)      GOTO PDØENDLOOP    BEND    X = VAL& AND $7F    IF VER(FIDX%)=2 THEN BEGIN      X = VAL&      VAL& = LDATA&(FIDX%, PIDX%(FIDX%))      PIDX%(FIDX%) = PIDX%(FIDX%) + 1      X = X + (VAL& AND $7F) * 256    BEND    IF VAL& AND $80 THEN REVØFLAG&(FIDX%) = 1: ELSE REVØFLAG&(FIDX%) = 0    Y = LDATA&(FIDX%, PIDX%(FIDX%))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    A$ = CHR$(LDATA&(FIDX%, PIDX%(FIDX%)))    PIDX%(FIDX%) = PIDX%(FIDX%) + 1    IF VER(FIDX%)=2 THEN BEGIN      IF X-OFFS(FIDX%) > 78 THEN BEGIN        GOSUB SCROLLØCANVASØRIGHT        PIDX%(FIDX%) = PIDX%(FIDX%) - 4        RETURN        ' PRINT "";CHR$(27);"QOFFS=";OFFS(FIDX%);      BEND    BEND    DXX = X-OFFS(FIDX%) : DYY = Y: GOSUB DRAWØCHAR    DEBUG = 0    IF DEBUG=1 THEN BEGIN      PRINT "";CHR$(27);"Q X,Y,PIDX,A$,OFFS=";X;Y;PIDX%(FIDX%),ASC(A$),OFFS(FIDX%)      GET KEY A$    BEND.PDØENDLOOP  BEND  X = X-OFFS(FIDX%)  RETURN'-------------------.SCROLLØCANVASØRIGHT'-------------------  OFFS(FIDX%) = OFFS(FIDX%) + 1  IF FIDX% = 0 THEN ADDR = $20  ' $52000  IF FIDX% = 1 THEN ADDR = $40  ' $54000  IF FIDX% = 2 THEN ADDR = $20  BANK 0:SYS $7E12, ADDR: BANK 128  RETURN'---------.DRAWØCHAR'---------  ' POKE $40800 + X + Y*80, ASC(A$)  ' POKE $FF80000 + X + Y*80, RCOLOR(1)    CHR = ASC(A$)  GOSUB PETSCIIØTOØSCREENCODE  IF REVØFLAG&(FIDX%) = 1 THEN CHR = CHR + 128  IF VER(FIDX%) = 1 OR VER(FIDX%) = 3 THEN BEGIN    POKE $52000 + DXX + DYY*80, CHR    POKE $53000 + DXX + DYY*80, CHRCLR  BEND  IF VER(FIDX%) = 2 THEN BEGIN    POKE $54000 + DXX + DYY*80, CHR    POKE $55000 + DXX + DYY*80, CHRCLR  BEND  RETURN'---------------------.PETSCIIØTOØSCREENCODE'---------------------  ' ¬ASED ON THE TABLE HERE:  ' HTTPS://STA.C64.ORG/CBM64PETTOSCR.HTML  ' - SEEMS LIKE … NEEDED TO DO A REPAIR TO IT ON THE $A0-->$BF RANGE  IF CHR>=$00 AND CHR<=$1F THEN CHR=CHR OR $80:RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF:RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF:RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40:RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=(CHR AND $7F) OR $40:RETURN ' $BF:RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F:RETURN  RETURN